<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="Contents SQL SELECT Query DDL DML Filtering Data Joins Set Operations String Functions Number Functions Date &amp; Time Functions Date &amp; Time Formats NULL Functions CASE Statement Aggregate Functions Window Functions Window Aggregate Functions Window Ranking Functions Window Value Functions Subquery Functions Common Table Expressions (CTEs) Views Temporary Tables Stored Procedures Triggers Indexes Partitioning Performance Tips AI and SQL ADF ADB Spark DF Basics DF Operations Functions Date Functions Handling Nulls Aggregate functions Joins When|Cast|Union Window Functions Explode Pivot Comparisons Practice Sets SQL LeetCode Pyspark 1 Interview Prep ADF 1 Azure DataBricks SQL Azure Data Factory">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Data Engineering Notes">
    <meta name="twitter:description" content="Contents SQL SELECT Query DDL DML Filtering Data Joins Set Operations String Functions Number Functions Date &amp; Time Functions Date &amp; Time Formats NULL Functions CASE Statement Aggregate Functions Window Functions Window Aggregate Functions Window Ranking Functions Window Value Functions Subquery Functions Common Table Expressions (CTEs) Views Temporary Tables Stored Procedures Triggers Indexes Partitioning Performance Tips AI and SQL ADF ADB Spark DF Basics DF Operations Functions Date Functions Handling Nulls Aggregate functions Joins When|Cast|Union Window Functions Explode Pivot Comparisons Practice Sets SQL LeetCode Pyspark 1 Interview Prep ADF 1 Azure DataBricks SQL Azure Data Factory">
    <meta property="og:url" content="http://localhost:1313/">
    <meta property="og:site_name" content="Data Engineering Notes">
    <meta property="og:title" content="Data Engineering Notes">
    <meta property="og:description" content="Contents SQL SELECT Query DDL DML Filtering Data Joins Set Operations String Functions Number Functions Date &amp; Time Functions Date &amp; Time Formats NULL Functions CASE Statement Aggregate Functions Window Functions Window Aggregate Functions Window Ranking Functions Window Value Functions Subquery Functions Common Table Expressions (CTEs) Views Temporary Tables Stored Procedures Triggers Indexes Partitioning Performance Tips AI and SQL ADF ADB Spark DF Basics DF Operations Functions Date Functions Handling Nulls Aggregate functions Joins When|Cast|Union Window Functions Explode Pivot Comparisons Practice Sets SQL LeetCode Pyspark 1 Interview Prep ADF 1 Azure DataBricks SQL Azure Data Factory">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Data Engineering Notes">
    <meta itemprop="description" content="Contents SQL SELECT Query DDL DML Filtering Data Joins Set Operations String Functions Number Functions Date &amp; Time Functions Date &amp; Time Formats NULL Functions CASE Statement Aggregate Functions Window Functions Window Aggregate Functions Window Ranking Functions Window Value Functions Subquery Functions Common Table Expressions (CTEs) Views Temporary Tables Stored Procedures Triggers Indexes Partitioning Performance Tips AI and SQL ADF ADB Spark DF Basics DF Operations Functions Date Functions Handling Nulls Aggregate functions Joins When|Cast|Union Window Functions Explode Pivot Comparisons Practice Sets SQL LeetCode Pyspark 1 Interview Prep ADF 1 Azure DataBricks SQL Azure Data Factory">
    <meta itemprop="wordCount" content="96">
    <title>Data Engineering Notes</title>
    <link href="http://localhost:1313/" rel="canonical" type="text/html" title="Data Engineering Notes">
    <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Data Engineering Notes">
    <link href="/index.md" rel="alternate" type="text/markdown" title="Data Engineering Notes">
    <link href="/images/favicon.ico?1759986780" rel="icon" type="image/x-icon" sizes="any">
    <link href="/css/auto-complete/auto-complete.min.css?1759986780" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1759986780" defer></script>
    <script src="/js/search-lunr.js?1759986780" defer></script>
    <script src="/js/search.js?1759986780" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1759986780";
    </script>
    <script src="/js/lunr/lunr.min.js?1759986780" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1759986780" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1759986780" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1759986780" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1759986780" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1759986780" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1759986780" rel="stylesheet">
    <link href="/css/theme.css?1759986780" rel="stylesheet">
    <link href="/css/format-print.css?1759986780" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/';
      window.relearn.relBasePath='.';
      window.relearn.relBaseUri='.';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto', 'zen-light', 'zen-dark' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script><style>
:root {
    --MENU-WIDTH-S: 14.375rem;
    --MENU-WIDTH-M: 14.375rem;
    --MENU-WIDTH-L: 18.75rem;
    --MAIN-WIDTH-MAX: 1000rem;
}
</style>
  </head>
  <body class="mobile-support print" data-url="/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#contents">Contents</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class="a11y-only"><span itemprop="name">Data Engineering Notes</span><meta itemprop="position" content="1"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-edit" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="https://github.com/jampalabharath/relearn/tree/main/content/_index.md" rel="external" target="_blank" title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a>
            </div>
            <div class="topbar-button topbar-button-markdown" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/index.md" title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a>
            </div>
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><span class="topbar-control"><i class="fa-fw fas fa-chevron-left"></i></span>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/sql/" title="SQL (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable home" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="home">
  <header class="headline">
  </header>

<h1 id="data-engineering-notes">Data Engineering Notes</h1>

<h3 id="contents">Contents</h3>

<div class="list-tree"><ul class="children children-li children-sort-">
  <li class="children-title"><a href="/sql/">SQL</a><ul>
  <li class="children-title"><a href="/sql/select/">SELECT Query</a><ul></ul></li>
  <li class="children-title"><a href="/sql/ddl/">DDL</a><ul></ul></li>
  <li class="children-title"><a href="/sql/dml/">DML</a><ul></ul></li>
  <li class="children-title"><a href="/sql/filter/">Filtering Data</a><ul></ul></li>
  <li class="children-title"><a href="/sql/joins/">Joins</a><ul></ul></li>
  <li class="children-title"><a href="/sql/set-operations/">Set Operations</a><ul></ul></li>
  <li class="children-title"><a href="/sql/string-functions/">String Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/number-functions/">Number Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/date-time1/">Date &amp; Time Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/date-time2/">Date &amp; Time Formats</a><ul></ul></li>
  <li class="children-title"><a href="/sql/null-functions/">NULL Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/case-statement/">CASE Statement</a><ul></ul></li>
  <li class="children-title"><a href="/sql/aggregate-functions/">Aggregate Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/window-functions/">Window Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/window_aggregations/">Window Aggregate Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/window-ranking/">Window Ranking Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/window-value-functions/">Window Value Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/subqueries/">Subquery Functions</a><ul></ul></li>
  <li class="children-title"><a href="/sql/cte/">Common Table Expressions (CTEs)</a><ul></ul></li>
  <li class="children-title"><a href="/sql/views/">Views</a><ul></ul></li>
  <li class="children-title"><a href="/sql/temporary-tables/">Temporary Tables</a><ul></ul></li>
  <li class="children-title"><a href="/sql/stored-procedures/">Stored Procedures</a><ul></ul></li>
  <li class="children-title"><a href="/sql/triggers/">Triggers</a><ul></ul></li>
  <li class="children-title"><a href="/sql/indexes/">Indexes</a><ul></ul></li>
  <li class="children-title"><a href="/sql/partitions/">Partitioning</a><ul></ul></li>
  <li class="children-title"><a href="/sql/performance-optimization/">Performance Tips</a><ul></ul></li>
  <li class="children-title"><a href="/sql/ai-and-sql/">AI and SQL</a><ul></ul></li></ul></li>
  <li class="children-title"><a href="/azure_data_factory/">ADF</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/">ADB</a><ul>
  <li class="children-title"><a href="/azure_data_bricks/spark/">Spark</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/df-creation/">DF Basics</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/df-operations/">DF Operations</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/functions/">Functions</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/date/">Date Functions</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/nulls/">Handling Nulls</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/aggregations/">Aggregate functions</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/joins/">Joins</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/when/">When|Cast|Union</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/window-functions/">Window Functions</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/explode/">Explode</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/pivot/">Pivot</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/comparisons/">Comparisons</a><ul></ul></li></ul></li>
  <li class="children-title"><a href="/practice/">Practice Sets</a><ul>
  <li class="children-title"><a href="/practice/leetcode-sql/">SQL LeetCode</a><ul></ul></li>
  <li class="children-title"><a href="/practice/pyspark1/">Pyspark 1</a><ul></ul></li></ul></li>
  <li class="children-title"><a href="/interviewprep/">Interview Prep</a><ul>
  <li class="children-title"><a href="/interviewprep/adf1/">ADF 1</a><ul></ul></li></ul></li>
</ul></div>
<ul>
<li><a href="/azure_data_bricks/">Azure DataBricks</a></li>
<li><a href="/sql/">SQL</a></li>
<li><a href="/azure_data_factory/">Azure Data Factory</a></li>
</ul>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Data Engineering Notes</h1>
<article class="chapter narrow">
  <header class="headline">
  </header>
<div class="article-subheading">Chapter 1</div>

<h1 id="sql">SQL</h1>

<h2 id="course-content">Course Content</h2>
<h2 id="1-introduction">1. Introduction</h2>
<ul>
<li>What is SQL?</li>
<li>Types of Databases (Relational vs Non-Relational)</li>
<li>SQL vs NoSQL</li>
<li>SQL Standards (ANSI SQL, T-SQL, PL/SQL, MySQL SQL, PostgreSQL SQL)</li>
</ul>
<h2 id="2-sql-basics">2. SQL Basics</h2>
<ul>
<li>Database, Schema, Table</li>
<li>Data Types (Numeric, String, Date/Time, Boolean, JSON, XML)</li>
<li>CREATE, DROP, ALTER</li>
<li>INSERT, UPDATE, DELETE</li>
<li>SELECT Statement</li>
<li>WHERE Clause</li>
<li>ORDER BY</li>
<li>LIMIT / TOP / FETCH</li>
</ul>
<h2 id="3-filtering--operators">3. Filtering &amp; Operators</h2>
<ul>
<li>Comparison Operators</li>
<li>Logical Operators (AND, OR, NOT)</li>
<li>BETWEEN, IN, LIKE</li>
<li>IS NULL / IS NOT NULL</li>
<li>Pattern Matching (Wildcards, Regex)</li>
</ul>
<h2 id="4-functions">4. Functions</h2>
<ul>
<li>String Functions (CONCAT, SUBSTRING, TRIM, UPPER, LOWER, LENGTH)</li>
<li>Numeric Functions (ROUND, CEIL, FLOOR, ABS, MOD)</li>
<li>Date/Time Functions (NOW, DATEADD, DATEDIFF, FORMAT)</li>
<li>Conversion Functions (CAST, CONVERT)</li>
<li>Aggregate Functions (COUNT, SUM, AVG, MIN, MAX)</li>
</ul>
<h2 id="5-joins">5. Joins</h2>
<ul>
<li>INNER JOIN</li>
<li>LEFT JOIN</li>
<li>RIGHT JOIN</li>
<li>FULL OUTER JOIN</li>
<li>CROSS JOIN</li>
<li>SELF JOIN</li>
<li>USING vs ON</li>
</ul>
<h2 id="6-subqueries--nested-queries">6. Subqueries &amp; Nested Queries</h2>
<ul>
<li>Scalar Subqueries</li>
<li>Table Subqueries</li>
<li>Correlated Subqueries</li>
<li>EXISTS / NOT EXISTS</li>
<li>IN / ANY / ALL</li>
</ul>
<h2 id="7-set-operations">7. Set Operations</h2>
<ul>
<li>UNION vs UNION ALL</li>
<li>INTERSECT</li>
<li>EXCEPT / MINUS</li>
</ul>
<h2 id="8-grouping--aggregation">8. Grouping &amp; Aggregation</h2>
<ul>
<li>GROUP BY</li>
<li>HAVING</li>
<li>GROUPING SETS</li>
<li>ROLLUP</li>
<li>CUBE</li>
</ul>
<h2 id="9-constraints--keys">9. Constraints &amp; Keys</h2>
<ul>
<li>Primary Key</li>
<li>Foreign Key</li>
<li>Unique Key</li>
<li>Check Constraint</li>
<li>Default Constraint</li>
<li>Not Null</li>
</ul>
<h2 id="10-indexing--performance">10. Indexing &amp; Performance</h2>
<ul>
<li>Clustered vs Non-Clustered Index</li>
<li>Composite Index</li>
<li>Covering Index</li>
<li>Index Maintenance</li>
<li>Query Execution Plans</li>
<li>SQL Performance Tuning</li>
</ul>
<h2 id="11-transactions">11. Transactions</h2>
<ul>
<li>BEGIN, COMMIT, ROLLBACK</li>
<li>Savepoints</li>
<li>ACID Properties</li>
<li>Isolation Levels (Read Uncommitted, Read Committed, Repeatable Read, Serializable, Snapshot)</li>
<li>Deadlocks &amp; Locking</li>
</ul>
<h2 id="12-views--materialized-views">12. Views &amp; Materialized Views</h2>
<ul>
<li>Creating Views</li>
<li>Updatable Views</li>
<li>Indexed Views</li>
<li>Materialized Views</li>
<li>Refresh Strategies</li>
</ul>
<h2 id="13-stored-procedures--functions">13. Stored Procedures &amp; Functions</h2>
<ul>
<li>User-Defined Functions (Scalar, Table-Valued)</li>
<li>Stored Procedures</li>
<li>Parameters (IN, OUT, INOUT)</li>
<li>Error Handling in Procedures</li>
<li>Recursive Procedures</li>
<li>Dynamic SQL</li>
</ul>
<h2 id="14-triggers">14. Triggers</h2>
<ul>
<li>AFTER Trigger</li>
<li>INSTEAD OF Trigger</li>
<li>Row-level vs Statement-level Triggers</li>
<li>Use Cases</li>
</ul>
<h2 id="15-advanced-sql">15. Advanced SQL</h2>
<ul>
<li>Window Functions (ROW_NUMBER, RANK, DENSE_RANK, NTILE)</li>
<li>LAG &amp; LEAD</li>
<li>FIRST_VALUE &amp; LAST_VALUE</li>
<li>Common Table Expressions (CTEs)</li>
<li>Recursive CTEs</li>
<li>Pivoting and Unpivoting</li>
<li>JSON &amp; XML in SQL</li>
<li>Hierarchical Queries</li>
<li>Full-Text Search</li>
</ul>
<h2 id="16-security">16. Security</h2>
<ul>
<li>Users &amp; Roles</li>
<li>GRANT, REVOKE, DENY</li>
<li>Row-Level Security</li>
<li>Column-Level Security</li>
<li>Data Masking</li>
<li>Encryption at Rest &amp; In-Transit</li>
</ul>
<h2 id="17-advanced-database-concepts">17. Advanced Database Concepts</h2>
<ul>
<li>Normalization &amp; Denormalization</li>
<li>Star &amp; Snowflake Schema</li>
<li>Partitioning (Horizontal, Vertical)</li>
<li>Sharding</li>
<li>Federation</li>
<li>Replication</li>
<li>High Availability &amp; Failover</li>
</ul>
<h2 id="18-sql-with-big-data">18. SQL with Big Data</h2>
<ul>
<li>SQL on Hadoop / Hive</li>
<li>Spark SQL</li>
<li>SQL in Cloud Platforms (AWS Athena, BigQuery, Azure Synapse)</li>
</ul>
<h2 id="19-sql-in-practice">19. SQL in Practice</h2>
<ul>
<li>Data Warehousing with SQL</li>
<li>ETL using SQL</li>
<li>Reporting Queries</li>
<li>Performance Benchmarking</li>
<li>Debugging Complex Queries</li>
</ul>
<h2 id="20-capstone-project">20. Capstone Project</h2>
<ul>
<li>Design &amp; Implement Normalized Database</li>
<li>Build ETL Pipeline using SQL</li>
<li>Create Analytical Queries &amp; Reports</li>
<li>Optimize Large-Scale SQL Workloads</li>
</ul>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of SQL</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="select-query">SELECT Query</h1>

<p>This guide covers various <code>SELECT</code> query techniques used for retrieving, filtering, sorting, and aggregating data efficiently.</p>
<hr>
<h2 id="comments">Comments</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- This is a single-line comment.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* This
</span></span></span><span class="line"><span class="cl"><span class="cm">   is
</span></span></span><span class="line"><span class="cl"><span class="cm">   a multiple-line
</span></span></span><span class="line"><span class="cl"><span class="cm">   comment */</span></span></span></code></pre></div>
<h2 id="1-select-all-columns">1. SELECT ALL COLUMNS</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve All Customer Data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve All Order Data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-select-specific-columns">2. SELECT SPECIFIC COLUMNS</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve each customer&#39;s name, country, and score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-where-clause">3. WHERE CLAUSE</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve customers with a score not equal to 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve customers from Germany
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve the name and country of customers from Germany
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="4-order-by">4. ORDER BY</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Sort by highest score first
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Sort by lowest score first
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Sort by country
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Sort by country, then highest score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Customers with score != 0, sorted by highest score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="5-group-by">5. GROUP BY</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Find total score for each country
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ❌ Invalid: first_name not grouped or aggregated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Find total score &amp; number of customers per country
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_score</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="6-having">6. HAVING</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Average score &gt; 430 for each country
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">430</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Only consider customers with score != 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">430</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="7-distinct">7. DISTINCT</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Unique list of countries
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="8-top">8. TOP</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve only 3 customers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TOP</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Top 3 customers with highest scores
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TOP</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Lowest 2 customers by score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TOP</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Two most recent orders
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TOP</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="9-all-together">9. All Together</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Average score per country, excluding score=0,
</span></span></span><span class="line"><span class="cl"><span class="c1">-- only &gt; 430, ordered by highest avg_score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">430</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="10-cool-stuff--additional-sql-features">10. COOL STUFF – Additional SQL Features</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Execute multiple queries at once
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Select static values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="mi">123</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">static_number</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">static_string</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Assign a constant value in query results
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;New Customer&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">customer_type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="ddl">DDL</h1>

<p>This guide covers the essential <strong>DDL (Data Definition Language)</strong> commands used for defining and managing database structures, including creating, modifying, and deleting tables.</p>
<hr>
<h2 id="1-create--creating-tables">1. CREATE – Creating Tables</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Create a new table called persons 
</span></span></span><span class="line"><span class="cl"><span class="c1">-- with columns: id, person_name, birth_date, and phone
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">persons</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">person_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">birth_date</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">phone</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">pk_persons</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
<h2 id="2-alter--modifying-table-structure">2. ALTER – Modifying Table Structure</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Add a new column called email to the persons table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">persons</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ADD</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Remove the column phone from the persons table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">persons</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">phone</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-drop--removing-tables">3. DROP – Removing Tables</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Delete the table persons from the database
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">persons</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="dml">DML</h1>

<p>This guide covers the essential <strong>DML (Data Manipulation Language)</strong> commands used for inserting, updating, and deleting data in database tables.</p>
<hr>
<h2 id="1-insert--adding-data-to-tables">1. INSERT – Adding Data to Tables</h2>
<h3 id="method-1-manual-insert-using-values">Method 1: Manual INSERT using VALUES</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Insert new records into the customers table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Anna&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Sam&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Incorrect column order 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Max&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Incorrect data type in values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Max&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Max&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Insert a new record with full column values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Max&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">368</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Insert without specifying column names (not recommended)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">customers</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Andreas&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Insert a record with only id and first_name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">first_name</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Sahra&#39;</span><span class="p">);</span></span></span></code></pre></div>
<h3 id="method-2-insert-using-select-copying-data">Method 2: INSERT using SELECT (Copying Data)</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Copy data from customers table into persons
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">persons</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">person_name</span><span class="p">,</span><span class="w"> </span><span class="n">birth_date</span><span class="p">,</span><span class="w"> </span><span class="n">phone</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Unknown&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-update--modifying-existing-data">2. UPDATE – Modifying Existing Data</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Change the score of customer with ID 6 to 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Change score and country for customer with ID 10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UK&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Update all NULL scores to 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Verify the update
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-delete--removing-data-from-tables">3. DELETE – Removing Data from Tables</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Select customers with ID greater than 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Delete customers with ID greater than 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Delete all rows from persons
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">persons</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Faster method to delete all rows
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">TRUNCATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">persons</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="filtering-data">Filtering Data</h1>

<p>This document provides an overview of SQL filtering techniques using <code>WHERE</code> and various operators for precise data retrieval.</p>
<hr>
<h2 id="1-comparison-operators------">1. Comparison Operators (=, &lt;&gt;, &gt;, &gt;=, &lt;, &lt;=)</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve all customers from Germany
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve all customers who are not from Germany
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve all customers with a score greater than 500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve all customers with a score of 500 or more
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve all customers with a score less than 500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve all customers with a score of 500 or less
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-logical-operators-and-or-not">2. Logical Operators (AND, OR, NOT)</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Customers from the USA and score &gt; 500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Customers from the USA or score &gt; 500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Customers with score not less than 500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-range-filtering--between">3. Range Filtering – BETWEEN</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Customers with score between 100 and 500
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Equivalent to BETWEEN
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="4-set-filtering--in">4. Set Filtering – IN</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Customers from Germany or USA
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Germany&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="5-pattern-matching--like">5. Pattern Matching – LIKE</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- First name starts with &#39;M&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">first_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;M%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- First name ends with &#39;n&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">first_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%n&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- First name contains &#39;r&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">first_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%r%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- First name has &#39;r&#39; in the third position
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">first_name</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;__r%&#39;</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="joins">Joins</h1>

<p>This document provides an overview of <strong>SQL Joins</strong>, which allow combining data from multiple tables to retrieve meaningful insights.</p>
<hr>
<h2 id="1-basic-joins">1. Basic Joins</h2>
<h3 id="no-join">No Join</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve all data from customers and orders as separate results
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="inner-join">INNER JOIN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Get all customers along with their orders (only those who placed an order)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="left-join">LEFT JOIN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Get all customers along with their orders (including customers without orders)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="right-join">RIGHT JOIN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Get all customers along with their orders (including orders without customers)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Alternative</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">using</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="full-join">FULL JOIN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Get all customers and all orders, even if there’s no match
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FULL</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-advanced-joins">2. Advanced Joins</h2>
<h3 id="left-anti-join">LEFT ANTI JOIN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Customers who haven&#39;t placed any order
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="right-anti-join">RIGHT ANTI JOIN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Orders without matching customers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Alternative</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">RIGHT</span><span class="w"> </span><span class="n">ANTI</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">using</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Alternative</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">using</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="full-anti-join">FULL ANTI JOIN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Find customers without orders and orders without customers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FULL</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">customer_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="cross-join">CROSS JOIN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Generate all possible combinations of customers and orders
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-multiple-table-joins-4-tables">3. Multiple Table Joins (4 Tables)</h2>
<p><strong>Task</strong>: Using SalesDB, retrieve a list of all orders along with related customer, product, and employee details.
For each order, display:</p>
<p>Order ID</p>
<p>Customer&rsquo;s name</p>
<p>Product name</p>
<p>Sales amount</p>
<p>Product price</p>
<p>Salesperson&rsquo;s name</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">USE</span><span class="w"> </span><span class="n">SalesDB</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerFirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">LastName</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerLastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">Product</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ProductName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">e</span><span class="p">.</span><span class="n">FirstName</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EmployeeFirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">e</span><span class="p">.</span><span class="n">LastName</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EmployeeLastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">ProductID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ProductID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">SalesPersonID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">EmployeeID</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="set-operations">Set Operations</h1>

<p>SQL <strong>set operations</strong> enable you to combine results from multiple queries into a single result set.<br>
This guide demonstrates the rules and usage of <strong>UNION, UNION ALL, EXCEPT, and INTERSECT</strong>.</p>
<hr>
<h2 id="1-sql-operation-rules">1. SQL Operation Rules</h2>
<h3 id="rule-data-types">Rule: Data Types</h3>
<p>The data types of columns in each query should match.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="rule-data-types-example">Rule: Data Types (Example)</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="rule-column-order">Rule: Column Order</h3>
<p>The order of the columns in each query must be the same.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">EmployeeID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="rule-column-aliases">Rule: Column Aliases</h3>
<p>The column names in the result set are determined by the column names specified in the first SELECT statement.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Last_Name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">EmployeeID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="rule-correct-columns">Rule: Correct Columns</h3>
<p>Ensure that the correct columns are used to maintain data consistency.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-union-union-all-except-intersect">2. UNION, UNION ALL, EXCEPT, INTERSECT</h2>
<h3 id="task-1-union">Task 1: UNION</h3>
<p>Combine the data from Employees and Customers into one table.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-2-union-all">Task 2: UNION ALL</h3>
<p>Combine the data from Employees and Customers into one table, including duplicates.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-3-except">Task 3: EXCEPT</h3>
<p>Find employees who are NOT customers.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXCEPT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-4-intersect">Task 4: INTERSECT</h3>
<p>Find employees who are also customers.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTERSECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-5-union-with-orders">Task 5: UNION with Orders</h3>
<p>Combine order data from Orders and OrdersArchive into one report without duplicates.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Orders&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SourceTable</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SalesPersonID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ShipDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ShipAddress</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BillAddress</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Quantity</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;OrdersArchive&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SourceTable</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SalesPersonID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ShipDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ShipAddress</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BillAddress</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Quantity</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">OrdersArchive</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderID</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="string-functions">String Functions</h1>

<p>This document provides an overview of <strong>SQL string functions</strong>, which allow manipulation, transformation, and extraction of text data efficiently.</p>
<hr>
<h2 id="1-manipulations">1. Manipulations</h2>
<h3 id="concat--string-concatenation">CONCAT() – String Concatenation</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Concatenate first name and country into one column
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">full_info</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="lower--upper--case-transformation">LOWER() &amp; UPPER() – Case Transformation</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Convert the first name to lowercase
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LOWER</span><span class="p">(</span><span class="n">first_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">lower_case_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Convert the first name to uppercase
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UPPER</span><span class="p">(</span><span class="n">first_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">upper_case_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="trim--remove-white-spaces">TRIM() – Remove White Spaces</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Find customers whose first name contains leading or trailing spaces
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LEN</span><span class="p">(</span><span class="n">first_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">len_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LEN</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">first_name</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">len_trim_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LEN</span><span class="p">(</span><span class="n">first_name</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">first_name</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">flag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">first_name</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">first_name</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Alternative:
</span></span></span><span class="line"><span class="cl"><span class="c1">-- WHERE first_name != TRIM(first_name)</span></span></span></code></pre></div>
<h3 id="replace--replace-or-remove-values">REPLACE() – Replace or Remove Values</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Remove dashes (-) from a phone number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;123-456-7890&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">phone</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">REPLACE</span><span class="p">(</span><span class="s1">&#39;123-456-7890&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">clean_phone</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Replace file extension from .txt to .csv
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;report.txt&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">old_filename</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">REPLACE</span><span class="p">(</span><span class="s1">&#39;report.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">new_filename</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-calculation">2. Calculation</h2>
<h3 id="len--string-length">LEN() – String Length</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Calculate the length of each customer&#39;s first name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LEN</span><span class="p">(</span><span class="n">first_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">name_length</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-substring-extraction">3. Substring Extraction</h2>
<h3 id="left--right">LEFT() &amp; RIGHT()</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve the first two characters of each first name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">first_name</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">first_2_chars</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Retrieve the last two characters of each first name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">RIGHT</span><span class="p">(</span><span class="n">first_name</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">last_2_chars</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="substring">SUBSTRING()</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve a list of customers&#39; first names after removing the first character
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUBSTRING</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">first_name</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">LEN</span><span class="p">(</span><span class="n">first_name</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">trimmed_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="4-nesting-functions">4. Nesting Functions</h2>
<p>&ndash; Nesting example
SELECT
first_name,
UPPER(LOWER(first_name)) AS nesting
FROM customers;</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="number-functions">Number Functions</h1>

<p>This document provides an overview of <strong>SQL number functions</strong>, which allow performing mathematical operations and formatting numerical values.</p>
<hr>
<h2 id="1-rounding-functions">1. Rounding Functions</h2>
<h3 id="round--rounding-numbers">ROUND() – Rounding Numbers</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Demonstrate rounding a number to different decimal places
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">3</span><span class="p">.</span><span class="mi">516</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">original_number</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">516</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">round_2</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">516</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">round_1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="mi">516</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">round_0</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-absolute-value-function">2. Absolute Value Function</h2>
<h3 id="abs--absolute-value">ABS() – Absolute Value</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Demonstrate absolute value function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">original_number</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ABS</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">absolute_value_negative</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ABS</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">absolute_value_positive</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="date--time-functions">Date &amp; Time Functions</h1>

<p>This guide demonstrates various <strong>date and time functions</strong> in SQL.<br>
It covers <code>GETDATE</code>, <code>DATETRUNC</code>, <code>DATENAME</code>, <code>DATEPART</code>, <code>YEAR</code>, <code>MONTH</code>, <code>DAY</code>, <code>EOMONTH</code>, <code>FORMAT</code>, <code>CONVERT</code>, <code>CAST</code>, <code>DATEADD</code>, <code>DATEDIFF</code>, and <code>ISDATE</code>.</p>
<hr>
<h2 id="1-getdate--date-values">1. GETDATE() | Date Values</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Display OrderID, CreationTime, a hard-coded date, and the current system date
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;2025-08-20&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">HardCoded</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">GETDATE</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Today</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-date-part-extractions-datetrunc-datename-datepart-year-month-day">2. Date Part Extractions (DATETRUNC, DATENAME, DATEPART, YEAR, MONTH, DAY)</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Extract various parts of CreationTime
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Year_dt</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Day_dt</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">minute</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Minute_dt</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Month_dn</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">weekday</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Weekday_dn</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Day_dn</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Year_dn</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Year_dp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Month_dp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Day_dp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Hour_dp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">quarter</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Quarter_dp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">week</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Week_dp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">YEAR</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">Year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MONTH</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">Month</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">DAY</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">Day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-datetrunc-data-aggregation">3. DATETRUNC() Data Aggregation</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Aggregate orders by year
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Creation</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderCount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="4-eomonth">4. EOMONTH()</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Display end-of-month date for each order
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">EOMONTH</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EndOfMonth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="5-date-parts--use-cases">5. Date Parts | Use Cases</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Orders per year
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderYear</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Orders per month
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderMonth</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Orders per month (friendly names)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderMonth</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Orders placed in February
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="6-format">6. FORMAT()</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Format CreationTime into different formats
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MM-dd-yyyy&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">USA_Format</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dd-MM-yyyy&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EURO_Format</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dd&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dd</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ddd&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ddd</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dddd&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dddd</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MM&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MM</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MMM&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MMM</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MMMM&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MMMM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Custom format example
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Day &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ddd MMM&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39; Q&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">quarter</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;yyyy hh:mm:ss tt&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomFormat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Orders per month (formatted &#34;MMM yy&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MMM yy&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MMM yy&#39;</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="7-convert">7. CONVERT()</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Conversion using CONVERT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">String</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">Int</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2025-08-20&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">String</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">Date</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">Datetime</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">Date</span><span class="w"> </span><span class="k">CONVERT</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">USA</span><span class="w"> </span><span class="n">Std</span><span class="p">.</span><span class="w"> </span><span class="n">Style</span><span class="p">:</span><span class="mi">32</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w"> </span><span class="n">CreationTime</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">EURO</span><span class="w"> </span><span class="n">Std</span><span class="p">.</span><span class="w"> </span><span class="n">Style</span><span class="p">:</span><span class="mi">34</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="8-cast">8. CAST()</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Conversion using CAST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">String</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">Int</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="mi">123</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="nb">Int</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">String</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="s1">&#39;2025-08-20&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">String</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">Date</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="s1">&#39;2025-08-20&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DATETIME2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">String</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Datetime</span><span class="p">],</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CreationTime</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CAST</span><span class="p">(</span><span class="n">CreationTime</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">Datetime</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nb">Date</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="9-dateadd--datediff">9. DATEADD / DATEDIFF</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Date arithmetic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TenDaysBefore</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ThreeMonthsLater</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEADD</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TwoYearsLater</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Employee ages
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">EmployeeID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BirthDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">BirthDate</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Age</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Avg shipping duration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderMonth</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">,</span><span class="w"> </span><span class="n">ShipDate</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgShip</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Time gap analysis
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CurrentOrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LAG</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PreviousOrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">LAG</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">),</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NrOfDays</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="10-isdate">10. ISDATE()</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Validate OrderDate using ISDATE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ISDATE</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IsValidDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">ISDATE</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">OrderDate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">DATE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;9999-01-01&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NewOrderDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;2025-08-20&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;2025-08-21&#39;</span><span class="w"> </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;2025-08-23&#39;</span><span class="w"> </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;2025-08&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- WHERE ISDATE(OrderDate) = 0</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="date--time-formats">Date &amp; Time Formats</h1>

<p>This guide demonstrates <strong>all possible date parts, number formats, and culture-specific styles</strong> available in SQL Server.</p>
<hr>
<h2 id="1-numeric-format-specifiers">1. Numeric Format Specifiers</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FormatType</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FormattedValue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;N0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N0&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;N1&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N1&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;N2&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N2&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;N_de-DE&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;de-DE&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;N_en-US&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">56</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;en-US&#39;</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="2-date-format-specifiers">2. Date Format Specifiers</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FormatType</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FormattedValue</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Full date pattern&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Description</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;d&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Short date pattern&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;dd&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;dd&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Day of month with leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ddd&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;ddd&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Abbreviated name of day&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;dddd&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;dddd&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Full name of day&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;M&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Month without leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;MM&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;MM&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Month with leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;MMM&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;MMM&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Abbreviated name of month&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;MMMM&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;MMMM&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Full name of month&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;yy&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;yy&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Two-digit year&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;yyyy&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;yyyy&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Four-digit year&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;hh&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;hh&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;12-hour clock with leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;HH&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;HH&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;24-hour clock with leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;m&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Minutes without leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;mm&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;mm&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Minutes with leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;s&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Seconds without leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ss&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;ss&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Seconds with leading zero&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;f&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Tenths of a second&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ff&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;ff&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Hundredths of a second&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;fff&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;fff&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Milliseconds&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Full AM/PM designator&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Single char AM/PM designator&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;tt&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;tt&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;Two char AM/PM designator&#39;</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-datepart--datename--datetrunc-comparisons">3. DatePart / DateName / DateTrunc Comparisons</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Year&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DatePart</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Quarter&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">quarter</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">quarter</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="n">quarter</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;DayOfYear&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">dayofyear</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">dayofyear</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="n">dayofyear</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Day&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Week&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">week</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">week</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="n">week</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Weekday&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">weekday</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">weekday</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Hour&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Minute&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">minute</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">minute</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">minute</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Second&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="k">second</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="k">second</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">second</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Millisecond&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">millisecond</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">millisecond</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="n">millisecond</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Microsecond&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">microsecond</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">microsecond</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;Nanosecond&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">nanosecond</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">nanosecond</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ISOWeek&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">DATEPART</span><span class="p">(</span><span class="n">iso_week</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATENAME</span><span class="p">(</span><span class="n">iso_week</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">()),</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="n">iso_week</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">());</span></span></span></code></pre></div>
<h2 id="4-culture-code-formatting">4. Culture Code Formatting</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;en-US&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CultureCode</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;en-US&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;en-US&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;en-GB&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;en-GB&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;en-GB&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;fr-FR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fr-FR&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fr-FR&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;de-DE&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;de-DE&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;de-DE&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;es-ES&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;es-ES&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;es-ES&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;zh-CN&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;zh-CN&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;zh-CN&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ja-JP&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ja-JP&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ja-JP&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ko-KR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ko-KR&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ko-KR&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;pt-BR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pt-BR&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pt-BR&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;it-IT&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;it-IT&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;it-IT&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;nl-NL&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;nl-NL&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;nl-NL&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ru-RU&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ru-RU&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ru-RU&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;ar-SA&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ar-SA&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ar-SA&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;el-GR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;el-GR&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;el-GR&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;tr-TR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;tr-TR&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;tr-TR&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;he-IL&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;he-IL&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;he-IL&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;hi-IN&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="mi">1234567</span><span class="p">.</span><span class="mi">89</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hi-IN&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">FORMAT</span><span class="p">(</span><span class="n">GETDATE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;hi-IN&#39;</span><span class="p">);</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="null-functions">NULL Functions</h1>

<p>This guide covers essential SQL functions for handling <strong>NULL</strong> values in different scenarios such as aggregation, mathematical operations, sorting, joins, and comparisons.</p>
<hr>
<h2 id="1-handle-null---data-aggregation">1. Handle NULL - Data Aggregation</h2>
<p>Replace NULL values using <code>COALESCE</code> to ensure accurate averages.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Score</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">Score</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Score2</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgScores</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="n">Score</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgScores2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-handle-null---mathematical-operators">2. Handle NULL - Mathematical Operators</h2>
<p>Concatenate first and last names safely and add bonus points with COALESCE.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">LastName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FullName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Score</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">Score</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ScoreWithBonus</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-handle-null---sorting-data">3. Handle NULL - Sorting Data</h2>
<p>Order results so that NULL values appear last.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">,</span><span class="w"> </span><span class="n">Score</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="4-nullif---division-by-zero">4. NULLIF - Division by Zero</h2>
<p>Prevent division errors by using NULLIF.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Quantity</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">NULLIF</span><span class="p">(</span><span class="n">Quantity</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="5-is-null--is-not-null">5. IS NULL / IS NOT NULL</h2>
<p>Identify rows with or without NULL values.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Customers with no scores
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Customers with scores
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="6-left-anti-join">6. LEFT ANTI JOIN</h2>
<p>Retrieve customers who have not placed any orders.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="7-nulls-vs-empty-string-vs-blank-spaces">7. NULLs vs Empty String vs Blank Spaces</h2>
<p>Differentiate between NULL, empty strings (&rsquo;&rsquo;), and blank spaces (&rsquo; &lsquo;).</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;  &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATALENGTH</span><span class="p">(</span><span class="n">Category</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LenCategory</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">TRIM</span><span class="p">(</span><span class="n">Category</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Policy1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">NULLIF</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">Category</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Policy2</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">COALESCE</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="k">TRIM</span><span class="p">(</span><span class="n">Category</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Policy3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="case-statement">CASE Statement</h1>

<hr>
<h2 id="1-categorize-data">1. Categorize Data</h2>
<p>Create sales categories based on value ranges.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Category</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;High&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Medium&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Low&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-mapping">2. Mapping</h2>
<p>Map country names to abbreviations.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;DE&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w">     </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;US&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;n/a&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CountryAbbr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-quick-form-of-case-statement">3. Quick Form of CASE Statement</h2>
<p>Use the shorthand CASE syntax for direct equality comparisons.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;DE&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w">     </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;US&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;n/a&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CountryAbbr</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w"> </span><span class="n">Country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;DE&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w">     </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;US&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;n/a&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CountryAbbr2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="4-handling-nulls">4. Handling Nulls</h2>
<p>Replace NULL values with defaults and compute averages.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Score</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="n">Score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ScoreClean</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="n">Score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgCustomerClean</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgCustomer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="5-conditional-aggregation">5. Conditional Aggregation</h2>
<p>Count orders with sales above a threshold.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrdersHighSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="aggregate-functions">Aggregate Functions</h1>

<p>SQL aggregate functions perform calculations on multiple rows of data and return summary results.</p>
<hr>
<h2 id="1-basic-aggregate-functions">1. Basic Aggregate Functions</h2>
<h3 id="count--count-rows">COUNT – Count rows</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="sum--total-of-values">SUM – Total of values</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="avg--average-of-values">AVG – Average of values</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="max--maximum-value">MAX – Maximum value</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">max_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="min--minimum-value">MIN – Minimum value</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">min_score</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customers</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-grouped-aggregations--group-by">2. Grouped Aggregations – GROUP BY</h2>
<p>Aggregate results per group.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">customer_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_orders</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">highest_sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MIN</span><span class="p">(</span><span class="n">sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">lowest_sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="window-functions">Window Functions</h1>

<p>SQL window functions enable advanced calculations across sets of rows related to the current row without needing complex subqueries or joins. They support clauses like <strong>OVER, PARTITION, ORDER, FRAME</strong>, along with important rules and group-based use cases.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li>SQL Window Basics</li>
<li>SQL Window OVER Clause</li>
<li>SQL Window PARTITION Clause</li>
<li>SQL Window ORDER Clause</li>
<li>SQL Window FRAME Clause</li>
<li>SQL Window Rules</li>
<li>SQL Window with GROUP BY</li>
</ol>
<hr>
<h2 id="1-sql-window-basics">1. SQL Window Basics</h2>
<h3 id="task-1--calculate-the-total-sales-across-all-orders">TASK 1 – Calculate the Total Sales Across All Orders</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-2--calculate-the-total-sales-for-each-product">TASK 2 – Calculate the Total Sales for Each Product</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-sql-window-over-clause">2. SQL Window OVER Clause</h2>
<h3 id="task-3--total-sales-across-all-orders-with-order-details">TASK 3 – Total sales across all orders with order details</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-sql-window-partition-clause">3. SQL Window PARTITION Clause</h2>
<h3 id="task-4--total-sales-overall-and-per-product">TASK 4 – Total sales overall and per product</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Sales_By_Product</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-5--total-sales-overall-per-product-and-per-product-status-combination">TASK 5 – Total sales overall, per product, and per product-status combination</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Sales_By_Product</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="p">,</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Sales_By_Product_Status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="4-sql-window-order-clause">4. SQL Window ORDER Clause</h2>
<h3 id="task-6--rank-each-order-by-sales-highest-to-lowest">TASK 6 – Rank each order by sales (highest to lowest)</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Rank_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="5-sql-window-frame-clause">5. SQL Window FRAME Clause</h2>
<h3 id="task-7--total-sales-by-order-status-current--next-two-orders">TASK 7 – Total sales by order status (current + next two orders)</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">FOLLOWING</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-8--total-sales-by-order-status-current--previous-two-orders">TASK 8 – Total sales by order status (current + previous two orders)</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-9--total-sales-by-order-status-previous-two-orders-only">TASK 9 – Total sales by order status (previous two orders only)</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ROWS</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-10--cumulative-sales-up-to-the-current-order">TASK 10 – Cumulative sales up to the current order</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">UNBOUNDED</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-11--cumulative-sales-from-start-to-current-row">TASK 11 – Cumulative sales from start to current row</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ROWS</span><span class="w"> </span><span class="n">UNBOUNDED</span><span class="w"> </span><span class="n">PRECEDING</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="6-sql-window-rules">6. SQL Window Rules</h2>
<h3 id="rule-1--window-functions-can-only-be-used-in-select-or-order-by">RULE 1 – Window functions can only be used in SELECT or ORDER BY</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">  </span><span class="c1">-- ❌ Invalid</span></span></span></code></pre></div>
<h3 id="rule-2--window-functions-cannot-be-nested">RULE 2 – Window functions cannot be nested</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="w">  </span><span class="c1">-- ❌ Invalid nesting
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="7-sql-window-with-group-by">7. SQL Window with GROUP BY</h2>
<h3 id="task-12--rank-customers-by-total-sales">TASK 12 – Rank customers by total sales</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Total_Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Rank_Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="window-aggregate-functions">Window Aggregate Functions</h1>

<p>These functions allow you to perform aggregate calculations over a set of rows without the need for complex subqueries. They enable you to compute counts, sums, averages, minimums, and maximums while still retaining access to individual row details.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li>COUNT</li>
<li>SUM</li>
<li>AVG</li>
<li>MAX / MIN</li>
<li>ROLLING SUM &amp; AVERAGE Use Case</li>
</ol>
<hr>
<h2 id="count">COUNT</h2>
<h3 id="task-1-find-the-total-number-of-orders-and-the-total-number-of-orders-for-each-customer">Task 1: Find the Total Number of Orders and the Total Number of Orders for Each Customer</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrdersByCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>
<h3 id="task-2-find-the-total-number-of-customers-scores-and-countries">Task 2: Find the Total Number of Customers, Scores, and Countries</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalCustomersStar</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalCustomersOne</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalScores</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="n">Country</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalCountries</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span></span></span></code></pre></div>
<h3 id="task-3-check-whether-the-table-ordersarchive-contains-any-duplicate-rows">Task 3: Check whether the table &lsquo;OrdersArchive&rsquo; contains any duplicate rows</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CheckDuplicates</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">OrdersArchive</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">CheckDuplicates</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span></span></span></code></pre></div>
<h2 id="sum">SUM</h2>
<h3 id="task-4-find-the-total-sales-across-all-orders-and-per-product">Task 4: Find the Total Sales Across All Orders and per Product</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesByProduct</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>
<h3 id="task-5-find-the-percentage-contribution-of-each-products-sales-to-the-total-sales">Task 5: Find the Percentage Contribution of Each Product&rsquo;s Sales to the Total Sales</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="n">Sales</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PercentageOfTotal</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>
<h2 id="avg">AVG</h2>
<h3 id="task-6-find-the-average-sales-across-all-orders-and-per-product">Task 6: Find the Average Sales Across All Orders and per Product</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgSalesByProduct</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>
<h3 id="task-7-find-the-average-scores-of-customers">Task 7: Find the Average Scores of Customers</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Score</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">Score</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerScore</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgScore</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">COALESCE</span><span class="p">(</span><span class="n">Score</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgScoreWithoutNull</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span></span></span></code></pre></div>
<h3 id="task-8-find-all-orders-where-sales-exceed-the-average-sales-across-all-orders">Task 8: Find all orders where Sales exceed the average Sales across all orders</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">AVG</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Avg_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Avg_Sales</span></span></span></code></pre></div>
<h2 id="max--min">MAX / MIN</h2>
<h3 id="task-9-find-the-highest-and-lowest-sales-across-all-orders">Task 9: Find the Highest and Lowest Sales across all orders</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MIN</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MinSales</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MaxSales</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>
<h3 id="task-10-find-the-lowest-sales-across-all-orders-and-by-product">Task 10: Find the Lowest Sales across all orders and by Product</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MIN</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LowestSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MIN</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LowestSalesByProduct</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>
<h3 id="task-11-show-the-employees-who-have-the-highest-salaries">Task 11: Show the employees who have the highest salaries</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		   </span><span class="k">MAX</span><span class="p">(</span><span class="n">Salary</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">HighestSalary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HighestSalary</span></span></span></code></pre></div>
<h3 id="task-12-find-the-deviation-of-each-sale-from-the-minimum-and-maximum-sales">Task 12: Find the deviation of each Sale from the minimum and maximum Sales</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">HighestSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MIN</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LowestSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DeviationFromMin</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DeviationFromMax</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>
<h2 id="rolling-sum--average-use-case">ROLLING SUM &amp; AVERAGE Use Case</h2>
<h3 id="task-13-calculate-the-moving-average-of-sales-for-each-product-over-time">Task 13: Calculate the moving average of Sales for each Product over time</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgByProduct</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MovingAvg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>
<h3 id="task-14-calculate-the-moving-average-of-sales-for-each-product-over-time-including-only-the-next-order">Task 14: Calculate the moving average of Sales for each Product over time, including only the next order</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">FOLLOWING</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RollingAvg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="window-ranking-functions">Window Ranking Functions</h1>

<p>These functions allow you to rank and order rows within a result set without the need for complex joins or subqueries. They enable you to assign unique or non-unique rankings, group rows into buckets, and analyze data distributions on ordered data.</p>
<hr>
<h2 id="sql-window-ranking--row_number-rank-dense_rank">SQL WINDOW RANKING | ROW_NUMBER, RANK, DENSE_RANK</h2>
<h3 id="task-1-rank-orders-based-on-sales-from-highest-to-lowest">Task 1: Rank Orders Based on Sales from Highest to Lowest</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesRank_Row</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesRank_Rank</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesRank_Dense</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-2-top-n-analysis--find-the-highest-sale-for-each-product">Task 2: Top-N Analysis → Find the Highest Sale for Each Product</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RankByProduct</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TopProductSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">RankByProduct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-3-bottom-n-analysis--find-the-lowest-2-customers-based-on-total-sales">Task 3: Bottom-N Analysis → Find the Lowest 2 Customers Based on Total Sales</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RankCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">BottomCustomerSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">RankCustomers</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-4-assign-unique-ids-to-rows-of-the-order-archive">Task 4: Assign Unique IDs to Rows of the &lsquo;Order Archive&rsquo;</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UniqueID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">OrdersArchive</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-5-identify-duplicates-in-order-archive">Task 5: Identify Duplicates in &lsquo;Order Archive&rsquo;</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CreationTime</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rn</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">OrdersArchive</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UniqueOrdersArchive</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">rn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="sql-window-ranking--ntile">SQL WINDOW RANKING | NTILE</h2>
<h3 id="task-6-divide-orders-into-groups-based-on-sales">Task 6: Divide Orders into Groups Based on Sales</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NTILE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OneBucket</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NTILE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TwoBuckets</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NTILE</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ThreeBuckets</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NTILE</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FourBuckets</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NTILE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TwoBucketByProducts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-7-segment-orders-into-high-medium-and-low-sales">Task 7: Segment Orders into High, Medium, and Low Sales</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Buckets</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;High&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Medium&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Buckets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Low&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesSegmentations</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">NTILE</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Buckets</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesBuckets</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-8-divide-orders-into-groups-for-processing">Task 8: Divide Orders into Groups for Processing</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NTILE</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Buckets</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="sql-window-ranking--cume_dist">SQL WINDOW RANKING | CUME_DIST</h2>
<h3 id="task-9-find-products-within-the-highest-40-of-prices">Task 9: Find Products Within the Highest 40% of Prices</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Product</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Price</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DistRank</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">DistRank</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DistRankPerc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Product</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Price</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CUME_DIST</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DistRank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PriceDistribution</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">DistRank</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="window-value-functions">Window Value Functions</h1>

<p>These functions let you reference and compare values from other rows in a result set without complex joins or subqueries, enabling advanced analysis on ordered data.</p>
<hr>
<h2 id="sql-window-value--lead-lag">SQL WINDOW VALUE | LEAD, LAG</h2>
<h3 id="task-1-analyze-month-over-month-performance">Task 1: Analyze Month-over-Month Performance</h3>
<p><em>Find the percentage change in sales between the current and previous months.</em></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CurrentMonthSales</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PreviousMonthSales</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MoM_Change</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">CAST</span><span class="p">((</span><span class="n">CurrentMonthSales</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PreviousMonthSales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">/</span><span class="w"> </span><span class="n">PreviousMonthSales</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MoM_Perc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderMonth</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CurrentMonthSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">LAG</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">))</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PreviousMonthSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MonthlySales</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-2-customer-loyalty-analysis">Task 2: Customer Loyalty Analysis</h3>
<p>Rank customers based on the average days between their orders.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">DaysUntilNextOrder</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgDays</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">DaysUntilNextOrder</span><span class="p">),</span><span class="w"> </span><span class="mi">999999</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RankAvg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">OrderDate</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CurrentOrder</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">LEAD</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NextOrder</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">day</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">LEAD</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DaysUntilNextOrder</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerOrdersWithNext</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="sql-window-value--first--last-value">SQL WINDOW VALUE | FIRST &amp; LAST VALUE</h2>
<h3 id="task-3-lowest-and-highest-sales-per-product">Task 3: Lowest and Highest Sales Per Product</h3>
<p>Find the lowest and highest sales for each product and compute the difference between the current sale and the lowest sale.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FIRST_VALUE</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LowestSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LAST_VALUE</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ROWS</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="k">CURRENT</span><span class="w"> </span><span class="k">ROW</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">UNBOUNDED</span><span class="w"> </span><span class="n">FOLLOWING</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">HighestSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FIRST_VALUE</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ProductID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesDifference</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="subquery-functions">Subquery Functions</h1>

<p>This script demonstrates various subquery techniques in SQL.<br>
It covers result types, subqueries in the <code>FROM</code> clause, in <code>SELECT</code>, in <code>JOIN</code> clauses, with comparison operators, <code>IN</code>, <code>ANY</code>, correlated subqueries, and <code>EXISTS</code>.</p>
<hr>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li>SUBQUERY - RESULT TYPES</li>
<li>SUBQUERY - FROM CLAUSE</li>
<li>SUBQUERY - SELECT</li>
<li>SUBQUERY - JOIN CLAUSE</li>
<li>SUBQUERY - COMPARISON OPERATORS</li>
<li>SUBQUERY - IN OPERATOR</li>
<li>SUBQUERY - ANY OPERATOR</li>
<li>SUBQUERY - CORRELATED</li>
<li>SUBQUERY - EXISTS OPERATOR</li>
</ol>
<hr>
<h2 id="subquery--result-types">SUBQUERY | RESULT TYPES</h2>
<h3 id="scalar-query">Scalar Query</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="row-query">Row Query</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="table-query">Table Query</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">OrderDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="subquery--from-clause">SUBQUERY | FROM CLAUSE</h2>
<h3 id="task-1-products-with-price-higher-than-average-price">Task 1: Products with Price Higher than Average Price</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Price</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">AVG</span><span class="p">(</span><span class="n">Price</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgPrice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">AvgPrice</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-2-rank-customers-by-total-sales">Task 2: Rank Customers by Total Sales</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerRank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="subquery--select">SUBQUERY | SELECT</h2>
<h3 id="task-3-product-details-with-total-number-of-orders">Task 3: Product Details with Total Number of Orders</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Product</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Price</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="subquery--join-clause">SUBQUERY | JOIN CLAUSE</h2>
<h3 id="task-4-customer-details-with-total-sales">Task 4: Customer Details with Total Sales</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-5-customer-details-with-total-orders">Task 5: Customer Details with Total Orders</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="subquery--comparison-operators">SUBQUERY | COMPARISON OPERATORS</h2>
<h3 id="task-6-products-with-price-higher-than-average-price">Task 6: Products with Price Higher than Average Price</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ProductID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Price</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">Price</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgPrice</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">Price</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="subquery--in-operator">SUBQUERY | IN OPERATOR</h2>
<h3 id="task-7-orders-made-by-customers-in-germany">Task 7: Orders Made by Customers in Germany</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
<h3 id="task-8-orders-made-by-customers-not-in-germany">Task 8: Orders Made by Customers Not in Germany</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
<h2 id="subquery--any-operator">SUBQUERY | ANY OPERATOR</h2>
<h3 id="task-9-female-employees-with-salaries-greater-than-any-male-employee">Task 9: Female Employees with Salaries Greater than Any Male Employee</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">EmployeeID</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Salary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">ANY</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Salary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;M&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">);</span></span></span></code></pre></div>
<h2 id="correlated-subquery">CORRELATED SUBQUERY</h2>
<h3 id="task-10-customer-details-with-total-orders-correlated">Task 10: Customer Details with Total Orders (Correlated)</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="subquery--exists-operator">SUBQUERY | EXISTS OPERATOR</h2>
<h3 id="task-11-orders-made-by-customers-in-germany">Task 11: Orders Made by Customers in Germany</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
<h3 id="task-12-orders-made-by-customers-not-in-germany">Task 12: Orders Made by Customers Not in Germany</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="common-table-expressions-ctes">Common Table Expressions (CTEs)</h1>

<p>This script demonstrates the use of <strong>Common Table Expressions (CTEs)</strong> in SQL Server.<br>
It includes examples of non-recursive CTEs for data aggregation and segmentation, as well as recursive CTEs for generating sequences and building hierarchical data.</p>
<hr>
<h2 id="non-recursive-cte">NON-RECURSIVE CTE</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Step 1 → Total Sales Per Customer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">WITH</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Step 2 → Last Order Date for Each Customer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">,</span><span class="w"> </span><span class="n">CTE_Last_Order</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Last_Order</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Step 3 → Rank Customers by Total Sales
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">,</span><span class="w"> </span><span class="n">CTE_Customer_Rank</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerRank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Step 4 → Segment Customers by Sales
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">,</span><span class="w"> </span><span class="n">CTE_Customer_Segments</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">CASE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;High&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">WHEN</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">80</span><span class="w">  </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Medium&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Low&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerSegments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Final Query Combining All CTEs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">cts</span><span class="p">.</span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">clo</span><span class="p">.</span><span class="n">Last_Order</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ccr</span><span class="p">.</span><span class="n">CustomerRank</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ccs</span><span class="p">.</span><span class="n">CustomerSegments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">cts</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CTE_Last_Order</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">clo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">clo</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CTE_Customer_Rank</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ccr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">ccr</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CTE_Customer_Segments</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ccs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">ccs</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="recursive-cte--generate-sequence">RECURSIVE CTE | GENERATE SEQUENCE</h2>
<h3 id="task-2-generate-numbers-1-to-20">Task 2: Generate Numbers 1 to 20</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">Series</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MyNumber</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MyNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Series</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">MyNumber</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Series</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="task-3-generate-numbers-1-to-1000">Task 3: Generate Numbers 1 to 1000</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">Series</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MyNumber</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">MyNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Series</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">MyNumber</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Series</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">OPTION</span><span class="w"> </span><span class="p">(</span><span class="n">MAXRECURSION</span><span class="w"> </span><span class="mi">5000</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="recursive-cte--build-hierarchy">RECURSIVE CTE | BUILD HIERARCHY</h2>
<h3 id="task-4-build-employee-hierarchy">Task 4: Build Employee Hierarchy</h3>
<p>Display each employee&rsquo;s level within the organization.</p>
<p>Anchor Query: Select employees with no manager.</p>
<p>Recursive Query: Select subordinates and increment the level.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">CTE_Emp_Hierarchy</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Anchor Query: Top-level employees (no manager)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">EmployeeID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ManagerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">Level</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">ManagerID</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Recursive Query: Get subordinate employees and increment level
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="n">EmployeeID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="n">ManagerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">Level</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CTE_Emp_Hierarchy</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ceh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ManagerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ceh</span><span class="p">.</span><span class="n">EmployeeID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">CTE_Emp_Hierarchy</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="views">Views</h1>

<p>This script demonstrates various <strong>view use cases</strong> in SQL Server.<br>
It includes examples for creating, dropping, and modifying views, hiding query complexity, and implementing data security by controlling data access.</p>
<hr>
<h2 id="create-drop-modify-view">CREATE, DROP, MODIFY VIEW</h2>
<h3 id="task-create-a-monthly-sales-summary-view">Task: Create a Monthly Sales Summary View</h3>
<p>Aggregate by <code>OrderMonth</code> with total sales, total orders, and total quantities.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Create View
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">V_Monthly_Summary</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderMonth</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalQuantities</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Query the View
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">V_Monthly_Summary</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Drop View if it exists
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">IF</span><span class="w"> </span><span class="n">OBJECT_ID</span><span class="p">(</span><span class="s1">&#39;Sales.V_Monthly_Summary&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">DROP</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">V_Monthly_Summary</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Re-create the View with modified logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">V_Monthly_Summary</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderMonth</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">DATETRUNC</span><span class="p">(</span><span class="k">month</span><span class="p">,</span><span class="w"> </span><span class="n">OrderDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>
<h2 id="view-use-case--hide-complexity">VIEW USE CASE | HIDE COMPLEXITY</h2>
<h3 id="task-abstract-multi-table-joins-with-a-view">Task: Abstract Multi-Table Joins with a View</h3>
<p>Join Orders, Products, Customers, and Employees into a single view.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">V_Order_Details</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">Product</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">COALESCE</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerCountry</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="n">Department</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">Quantity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ProductID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">ProductID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">EmployeeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">SalesPersonID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>
<h2 id="view-use-case--data-security">VIEW USE CASE | DATA SECURITY</h2>
<h3 id="task-restrict-access-for-eu-sales-team">Task: Restrict Access for EU Sales Team</h3>
<p>Exclude USA data from order details.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">V_Order_Details_EU</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">OrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">Product</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">COALESCE</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerCountry</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SalesName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="n">Department</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">Sales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">Quantity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ProductID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">ProductID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">EmployeeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">SalesPersonID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="temporary-tables">Temporary Tables</h1>

<p>This script provides a <strong>generic example of data migration</strong> using a temporary table.</p>
<hr>
<h2 id="step-1-create-temporary-table-orders">Step 1: Create Temporary Table (<code>#Orders</code>)</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="o">#</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="step-2-clean-data-in-temporary-table">Step 2: Clean Data in Temporary Table</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">#</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Delivered&#39;</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="step-3-load-cleaned-data-into-permanent-table">Step 3: Load Cleaned Data into Permanent Table</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">OrdersTest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="o">#</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="stored-procedures">Stored Procedures</h1>

<p>This script shows how to work with <strong>stored procedures in SQL Server</strong>, starting from basic implementations and advancing to more sophisticated techniques.</p>
<hr>
<h2 id="1-basic-stored-procedure">1. Basic Stored Procedure</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Define the Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalCustomers</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgScore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Execute Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="2-parameters-in-stored-procedure">2. Parameters in Stored Procedure</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Edit the Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Reports: Summary from Customers and Orders
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalCustomers</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgScore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Execute Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="3-multiple-queries-in-stored-procedure">3. Multiple Queries in Stored Procedure</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Edit the Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Query 1: Find the Total Nr. of Customers and the Average Score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalCustomers</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">AvgScore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Query 2: Find the Total Nr. of Orders and Total Sales
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Execute Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="4-variables-in-stored-procedure">4. Variables in Stored Procedure</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Edit the Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Declare Variables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Query 1: Find the Total Nr. of Customers and the Average Score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Total Customers from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Average Score from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Query 2: Find the Total Nr. of Orders and Total Sales
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Execute Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="5-control-flow-with-ifelse">5. Control Flow with IF/ELSE</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">ALTER</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Declare Variables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">;</span><span class="w">     
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/* --------------------------------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">       Prepare &amp; Cleanup Data
</span></span></span><span class="line"><span class="cl"><span class="cm">    -------------------------------------------------------------------------- */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Updating NULL Scores to 0&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SET</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ELSE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;No NULL Scores found&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/* --------------------------------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">       Generating Reports
</span></span></span><span class="line"><span class="cl"><span class="cm">    -------------------------------------------------------------------------- */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Total Customers from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Average Score from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FaultyCalculation</span><span class="w">  </span><span class="c1">-- Intentional error for demonstration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Execute Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="6-error-handling-with-trycatch">6. Error Handling with TRY/CATCH</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">ALTER</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">BEGIN</span><span class="w"> </span><span class="n">TRY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- Declare Variables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">;</span><span class="w">     
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cm">/* --------------------------------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">           Prepare &amp; Cleanup Data
</span></span></span><span class="line"><span class="cl"><span class="cm">        -------------------------------------------------------------------------- */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Updating NULL Scores to 0&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">UPDATE</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">SET</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;No NULL Scores found&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">END</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cm">/* --------------------------------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">           Generating Reports
</span></span></span><span class="line"><span class="cl"><span class="cm">        -------------------------------------------------------------------------- */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">Score</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Total Customers from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">TotalCustomers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Average Score from &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">AvgScore</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">COUNT</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalOrders</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FaultyCalculation</span><span class="w">  </span><span class="c1">-- Intentional error for demonstration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="n">TRY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">BEGIN</span><span class="w"> </span><span class="n">CATCH</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="cm">/* --------------------------------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">           Error Handling
</span></span></span><span class="line"><span class="cl"><span class="cm">        -------------------------------------------------------------------------- */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;An error occurred.&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Error Message: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ERROR_MESSAGE</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Error Number: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ERROR_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Error Severity: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ERROR_SEVERITY</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Error State: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ERROR_STATE</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Error Line: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">ERROR_LINE</span><span class="p">()</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NVARCHAR</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">PRINT</span><span class="p">(</span><span class="s1">&#39;Error Procedure: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">ISNULL</span><span class="p">(</span><span class="n">ERROR_PROCEDURE</span><span class="p">(),</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="n">CATCH</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Execute Stored Procedure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Germany&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="w"> </span><span class="o">@</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">GetCustomerSummary</span><span class="p">;</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="triggers">Triggers</h1>

<p>This script demonstrates:</p>
<ol>
<li>The creation of a <strong>logging table</strong>.</li>
<li>A <strong>trigger</strong> on the <code>Sales.Employees</code> table.</li>
<li>An <strong>insert operation</strong> that fires the trigger.</li>
</ol>
<p>The trigger logs details of newly added employees into the <code>Sales.EmployeeLogs</code> table.</p>
<hr>
<h2 id="step-1-create-log-table">Step 1: Create Log Table</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">EmployeeLogs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LogID</span><span class="w">      </span><span class="nb">INT</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">EmployeeID</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LogMessage</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LogDate</span><span class="w">    </span><span class="nb">DATE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>
<h2 id="step-2-create-trigger-on-employees-table">Step 2: Create Trigger on Employees Table</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">trg_AfterInsertEmployee</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AFTER</span><span class="w"> </span><span class="k">INSERT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">EmployeeLogs</span><span class="w"> </span><span class="p">(</span><span class="n">EmployeeID</span><span class="p">,</span><span class="w"> </span><span class="n">LogMessage</span><span class="p">,</span><span class="w"> </span><span class="n">LogDate</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">EmployeeID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;New Employee Added = &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">EmployeeID</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">GETDATE</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">INSERTED</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>
<h2 id="step-3-insert-new-data-into-employees">Step 3: Insert New Data Into Employees</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Maria&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Doe&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;HR&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1988-01-12&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">80000</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>
<h2 id="step-4-check-the-logs">Step 4: Check the Logs</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">EmployeeLogs</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="indexes">Indexes</h1>

<p>This script demonstrates various <strong>index types in SQL Server</strong> including clustered, non-clustered, columnstore, unique, and filtered indexes.<br>
It also covers <strong>index monitoring techniques</strong> like usage stats, missing/duplicate indexes, updating statistics, and fragmentation.</p>
<hr>
<h2 id="-table-of-contents">📑 Table of Contents</h2>
<h3 id="index-types">Index Types</h3>
<ul>
<li>Clustered and Non-Clustered Indexes</li>
<li>Leftmost Prefix Rule Explanation</li>
<li>Columnstore Indexes</li>
<li>Unique Indexes</li>
<li>Filtered Indexes</li>
</ul>
<h3 id="index-monitoring">Index Monitoring</h3>
<ul>
<li>Monitor Index Usage</li>
<li>Monitor Missing Indexes</li>
<li>Monitor Duplicate Indexes</li>
<li>Update Statistics</li>
<li>Fragmentations</li>
</ul>
<hr>
<h2 id="index-types-1">Index Types</h2>
<h3 id="clustered-and-non-clustered-indexes">Clustered and Non-Clustered Indexes</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Create a Heap Table as a copy of Sales.Customers 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Test Query
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Create a Clustered Index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">CLUSTERED</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_DBCustomers_CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w"> </span><span class="p">(</span><span class="n">CustomerID</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Attempt to create a second Clustered Index (will fail)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">CLUSTERED</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_DBCustomers_CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w"> </span><span class="p">(</span><span class="n">CustomerID</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Drop the Clustered Index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">DROP</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_DBCustomers_CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Query using LastName filter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">LastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Brown&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Create a Non-Clustered Index on LastName
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">NONCLUSTERED</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_DBCustomers_LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w"> </span><span class="p">(</span><span class="n">LastName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Additional Non-Clustered Index on FirstName
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_DBCustomers_FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w"> </span><span class="p">(</span><span class="n">FirstName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Composite Index on Country and Score
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_DBCustomers_CountryScore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w"> </span><span class="p">(</span><span class="n">Country</span><span class="p">,</span><span class="w"> </span><span class="n">Score</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Query that uses Composite Index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Query that may not use Composite Index due to column order
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="leftmost-prefix-rule-explanation">Leftmost Prefix Rule Explanation</h3>
<p>For a composite index (A, B, C, D) the index is useful when filtering on:</p>
<p>A only</p>
<p>A, B</p>
<p>A, B, C</p>
<p>It is not effective when filtering on:</p>
<p>B only</p>
<p>A, C</p>
<p>A, B, D</p>
<h3 id="columnstore-indexes">Columnstore Indexes</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Create Clustered Columnstore Index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">CLUSTERED</span><span class="w"> </span><span class="n">COLUMNSTORE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_DBCustomers_CS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Non-Clustered Columnstore Index on FirstName
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">NONCLUSTERED</span><span class="w"> </span><span class="n">COLUMNSTORE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_DBCustomers_CS_FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w"> </span><span class="p">(</span><span class="n">FirstName</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Switch context to AdventureWorksDW2022
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">USE</span><span class="w"> </span><span class="n">AdventureWorksDW2022</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Create Heap Table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="n">FactInternetSales_HP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">FactInternetSales</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Create RowStore Table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="n">FactInternetSales_RS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">FactInternetSales</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Clustered Index on RowStore
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">CLUSTERED</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_FactInternetSales_RS_PK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">FactInternetSales_RS</span><span class="w"> </span><span class="p">(</span><span class="n">SalesOrderNumber</span><span class="p">,</span><span class="w"> </span><span class="n">SalesOrderLineNumber</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Create Columnstore Table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="n">FactInternetSales_CS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">FactInternetSales</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Clustered Columnstore Index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">CLUSTERED</span><span class="w"> </span><span class="n">COLUMNSTORE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_FactInternetSales_CS_PK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">FactInternetSales_CS</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="unique-indexes">Unique Indexes</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Attempt Unique Index on Category (fails if duplicates exist)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_Products_Category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="p">(</span><span class="n">Category</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Unique Index on Product
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_Products_Product</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="p">(</span><span class="n">Product</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Test Insert (should fail if duplicate constraint holds)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="p">(</span><span class="n">ProductID</span><span class="p">,</span><span class="w"> </span><span class="n">Product</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">106</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Caps&#39;</span><span class="p">);</span></span></span></code></pre></div>
<h3 id="filtered-indexes">Filtered Indexes</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Test Query
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Filtered Index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">NONCLUSTERED</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_Customers_Country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="p">(</span><span class="n">Country</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="index-monitoring-1">Index Monitoring</h2>
<h3 id="monitor-index-usage">Monitor Index Usage</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- List all indexes on a table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">sp_helpindex</span><span class="w"> </span><span class="s1">&#39;Sales.DBCustomers&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Monitor Index Usage
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">tbl</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TableName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">idx</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IndexName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">idx</span><span class="p">.</span><span class="n">type_desc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IndexType</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">idx</span><span class="p">.</span><span class="n">is_primary_key</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IsPrimaryKey</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">idx</span><span class="p">.</span><span class="n">is_unique</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IsUnique</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">idx</span><span class="p">.</span><span class="n">is_disabled</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IsDisabled</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">user_seeks</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UserSeeks</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">user_scans</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UserScans</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">user_lookups</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UserLookups</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">user_updates</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">UserUpdates</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">COALESCE</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">last_user_seek</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">last_user_scan</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LastUpdate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">indexes</span><span class="w"> </span><span class="n">idx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">tables</span><span class="w"> </span><span class="n">tbl</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tbl</span><span class="p">.</span><span class="n">object_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">dm_db_index_usage_stats</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">object_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">index_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">index_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">tbl</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">name</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="monitor-missing-indexes">Monitor Missing Indexes</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">dm_db_missing_index_details</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="monitor-duplicate-indexes">Monitor Duplicate Indexes</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">tbl</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TableName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">col</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IndexColumn</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">idx</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IndexName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">idx</span><span class="p">.</span><span class="n">type_desc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IndexType</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">tbl</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="n">ColumnCount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">indexes</span><span class="w"> </span><span class="n">idx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">tables</span><span class="w"> </span><span class="n">tbl</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tbl</span><span class="p">.</span><span class="n">object_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">index_columns</span><span class="w"> </span><span class="n">ic</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ic</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">index_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ic</span><span class="p">.</span><span class="n">index_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">columns</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ic</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">ic</span><span class="p">.</span><span class="n">column_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col</span><span class="p">.</span><span class="n">column_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ColumnCount</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="update-statistics">Update Statistics</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SCHEMA_NAME</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">schema_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SchemaName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TableName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">StatisticName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sp</span><span class="p">.</span><span class="n">last_updated</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LastUpdate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">last_updated</span><span class="p">,</span><span class="w"> </span><span class="n">GETDATE</span><span class="p">())</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LastUpdateDay</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sp</span><span class="p">.</span><span class="k">rows</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">&#39;Rows&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sp</span><span class="p">.</span><span class="n">modification_counter</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ModificationsSinceLastUpdate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">stats</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">tables</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">object_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CROSS</span><span class="w"> </span><span class="n">APPLY</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">dm_db_stats_properties</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">object_id</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">stats_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sp</span><span class="p">.</span><span class="n">modification_counter</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Update specific system statistic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">UPDATE</span><span class="w"> </span><span class="k">STATISTICS</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="w"> </span><span class="n">_WA_Sys_00000001_6EF57B66</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Update all statistics for a table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">UPDATE</span><span class="w"> </span><span class="k">STATISTICS</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">DBCustomers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Update all statistics in the database
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_updatestats</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>
<h3 id="fragmentations">Fragmentations</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Retrieve fragmentation stats
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">tbl</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TableName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">idx</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">IndexName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">avg_fragmentation_in_percent</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">page_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">dm_db_index_physical_stats</span><span class="p">(</span><span class="n">DB_ID</span><span class="p">(),</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;LIMITED&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">tables</span><span class="w"> </span><span class="n">tbl</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tbl</span><span class="p">.</span><span class="n">object_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">indexes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">idx</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">object_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">idx</span><span class="p">.</span><span class="n">index_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">index_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">avg_fragmentation_in_percent</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Reorganize index (lightweight)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_Customers_CS_Country</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="n">REORGANIZE</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Rebuild index (full)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_Customers_Country</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="n">REBUILD</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GO</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="partitioning">Partitioning</h1>

<p>This script demonstrates <strong>SQL Server partitioning features</strong> including:</p>
<ul>
<li>Partition functions, filegroups, data files, partition schemes</li>
<li>Partitioned tables and data insertion</li>
<li>Verification queries and execution plan comparisons</li>
</ul>
<hr>
<h2 id="step-1-create-a-partition-function">Step 1: Create a Partition Function</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Create Left Range Partition Functions based on Years
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">PartitionByYear</span><span class="w"> </span><span class="p">(</span><span class="nb">DATE</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w"> </span><span class="n">RANGE</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;2023-12-31&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-12-31&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2025-12-31&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- List all existing Partition Functions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">function_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">type</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">type_desc</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">boundary_value_on_right</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">partition_functions</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="step-2-create-filegroups">Step 2: Create Filegroups</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Create Filegroups in SalesDB
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2023</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2024</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2025</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2026</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Optional: Remove a Filegroup
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="n">REMOVE</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2023</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- List existing Filegroups
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">filegroups</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;FG&#39;</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="step-3-create-data-files">Step 3: Create Data Files</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Create Data Files and map them to Filegroups
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">FILE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P_2023</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">FILENAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\P_2023.ndf&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2023</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">FILE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P_2024</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">FILENAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\P_2024.ndf&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2024</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">FILE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P_2025</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">FILENAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\P_2025.ndf&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2025</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">SalesDB</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="n">FILE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P_2026</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">FILENAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C:\Program Files\Microsoft SQL Server\MSSQL16.SQLEXPRESS\MSSQL\DATA\P_2026.ndf&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">FILEGROUP</span><span class="w"> </span><span class="n">FG_2026</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- List all files in SalesDB
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fg</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FilegroupName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mf</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LogicalFileName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mf</span><span class="p">.</span><span class="n">physical_name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PhysicalFilePath</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mf</span><span class="p">.</span><span class="k">size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SizeInMB</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">filegroups</span><span class="w"> </span><span class="n">fg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">master_files</span><span class="w"> </span><span class="n">mf</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">fg</span><span class="p">.</span><span class="n">data_space_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mf</span><span class="p">.</span><span class="n">data_space_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">mf</span><span class="p">.</span><span class="n">database_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DB_ID</span><span class="p">(</span><span class="s1">&#39;SalesDB&#39;</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="step-4-create-partition-scheme">Step 4: Create Partition Scheme</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Partition Scheme using the Partition Function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">SCHEME</span><span class="w"> </span><span class="n">SchemePartitionByYear</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w"> </span><span class="n">PARTITION</span><span class="w"> </span><span class="n">PartitionByYear</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">TO</span><span class="w"> </span><span class="p">(</span><span class="n">FG_2023</span><span class="p">,</span><span class="w"> </span><span class="n">FG_2024</span><span class="p">,</span><span class="w"> </span><span class="n">FG_2025</span><span class="p">,</span><span class="w"> </span><span class="n">FG_2026</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- List Partition Schemes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ps</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PartitionSchemeName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">pf</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PartitionFunctionName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ds</span><span class="p">.</span><span class="n">destination_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PartitionNumber</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">fg</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FilegroupName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">partition_schemes</span><span class="w"> </span><span class="n">ps</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">partition_functions</span><span class="w"> </span><span class="n">pf</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="n">function_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">function_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">destination_data_spaces</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ps</span><span class="p">.</span><span class="n">data_space_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">partition_scheme_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">filegroups</span><span class="w"> </span><span class="n">fg</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">data_space_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fg</span><span class="p">.</span><span class="n">data_space_id</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="step-5-create-the-partitioned-table">Step 5: Create the Partitioned Table</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_Partitioned</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">OrderID</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">OrderDate</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Sales</span><span class="w"> </span><span class="nb">INT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">SchemePartitionByYear</span><span class="w"> </span><span class="p">(</span><span class="n">OrderDate</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="step-6-insert-data-into-the-partitioned-table">Step 6: Insert Data Into the Partitioned Table</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_Partitioned</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-05-15&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_Partitioned</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-07-20&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_Partitioned</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2025-12-31&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_Partitioned</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2026-01-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="step-7-verify-partitioning-and-compare-execution-plans">Step 7: Verify Partitioning and Compare Execution Plans</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Verify that data is correctly partitioned
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">partition_number</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PartitionNumber</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PartitionFilegroup</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="k">rows</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">NumberOfRows</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">partitions</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">destination_data_spaces</span><span class="w"> </span><span class="n">dds</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">partition_number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dds</span><span class="p">.</span><span class="n">destination_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">filegroups</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dds</span><span class="p">.</span><span class="n">data_space_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">data_space_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">OBJECT_NAME</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">object_id</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Orders_Partitioned&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Non-partitioned copy for comparison
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_NoPartition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_Partitioned</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Query on Partitioned Table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_Partitioned</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;2026-01-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2025-12-31&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Query on Non-Partitioned Table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders_NoPartition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;2026-01-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2025-12-31&#39;</span><span class="p">);</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="performance-tips">Performance Tips</h1>

<p>This guide demonstrates best practices for:</p>
<ul>
<li>Fetching data</li>
<li>Filtering</li>
<li>Joins</li>
<li>UNION</li>
<li>Aggregations</li>
<li>Subqueries/CTE</li>
<li>DDL</li>
<li>Indexing</li>
</ul>
<p>It covers techniques such as selecting only necessary columns, proper filtering methods, explicit joins, avoiding redundant logic, and efficient indexing strategies.</p>
<hr>
<h2 id="fetching-data">Fetching Data</h2>
<h3 id="tip-1-select-only-what-you-need">Tip 1: Select Only What You Need</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad Practice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good Practice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">LastName</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-2-avoid-unnecessary-distinct--order-by">Tip 2: Avoid unnecessary DISTINCT &amp; ORDER BY</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad Practice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">FirstName</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">FirstName</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good Practice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">FirstName</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-3-for-exploration-purpose-limit-rows">Tip 3: For Exploration Purpose, Limit Rows!</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad Practice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="n">Sales</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good Practice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TOP</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="n">Sales</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="filtering">Filtering</h2>
<h3 id="tip-4-create-nonclustered-index-on-frequently-used-columns">Tip 4: Create nonclustered index on frequently used columns</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Delivered&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">NONCLUSTERED</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">Idx_Orders_OrderStatus</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">);</span></span></span></code></pre></div>
<h3 id="tip-5-avoid-applying-functions-in-where">Tip 5: Avoid applying functions in WHERE</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">LOWER</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;delivered&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Delivered&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">FirstName</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;A%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2025</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">OrderDate</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2025-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2025-12-31&#39;</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-6-avoid-leading-wildcards">Tip 6: Avoid leading wildcards</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">LastName</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%Gold%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">LastName</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;Gold%&#39;</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-7-use-in-instead-of-multiple-or">Tip 7: Use IN instead of multiple OR</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="joins">Joins</h2>
<h3 id="tip-8-use-inner-join-when-possible">Tip 8: Use INNER JOIN when possible</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Best
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Slower
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Worst
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-9-use-explicit-ansi-joins">Tip 9: Use explicit (ANSI) joins</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="p">,</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-10-index-columns-used-in-on-clause">Tip 10: Index columns used in ON clause</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">NONCLUSTERED</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">IX_Orders_CustomerID</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">(</span><span class="n">CustomerID</span><span class="p">);</span></span></span></code></pre></div>
<h3 id="tip-11-filter-before-joining-big-tables">Tip 11: Filter before joining big tables</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Best for big tables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Delivered&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-12-aggregate-before-joining">Tip 12: Aggregate before joining</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Best for big tables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderCount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderCount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-13-use-union-instead-of-or-in-joins">Tip 13: Use UNION instead of OR in joins</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">OR</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">SalesPersonID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">SalesPersonID</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-14-use-sql-hints-for-optimization">Tip 14: Use SQL hints for optimization</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">OPTION</span><span class="w"> </span><span class="p">(</span><span class="n">HASH</span><span class="w"> </span><span class="k">JOIN</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="union">Union</h2>
<h3 id="tip-15-use-union-all-when-duplicates-are-acceptable">Tip 15: Use UNION ALL when duplicates are acceptable</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">OrdersArchive</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">OrdersArchive</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-16-use-union-all--distinct-when-duplicates-not-allowed">Tip 16: Use UNION ALL + DISTINCT when duplicates not allowed</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">OrdersArchive</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">CombinedData</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="aggregations">Aggregations</h2>
<h3 id="tip-17-use-columnstore-indexes">Tip 17: Use columnstore indexes</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">OrderID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderCount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">CLUSTERED</span><span class="w"> </span><span class="n">COLUMNSTORE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">Idx_Orders_Columnstore</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="p">;</span></span></span></code></pre></div>
<h3 id="tip-18-pre-aggregate-data">Tip 18: Pre-aggregate data</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderYear</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">SalesSummary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">MONTH</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">OrderYear</span><span class="p">,</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">SalesSummary</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="subqueries--cte">Subqueries &amp; CTE</h2>
<h3 id="tip-19-prefer-join-or-exists-over-in">Tip 19: Prefer JOIN or EXISTS over IN</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">AND</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Bad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
<h3 id="tip-20-avoid-redundant-logic">Tip 20: Avoid redundant logic</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Good
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">EmployeeID</span><span class="p">,</span><span class="w"> </span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">Salary</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Above Average&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">Salary</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Below Average&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Average&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Status</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">;</span></span></span></code></pre></div>
<h2 id="ddl">DDL</h2>
<h3 id="tip-21-avoid-varcharmax-unless-necessary">Tip 21: Avoid VARCHAR(MAX) unless necessary.</h3>
<h3 id="tip-22-avoid-overly-large-lengths">Tip 22: Avoid overly large lengths.</h3>
<h3 id="tip-23-use-not-null-when-possible">Tip 23: Use NOT NULL when possible.</h3>
<h3 id="tip-24-all-tables-should-have-a-clustered-primary-key">Tip 24: All tables should have a clustered primary key.</h3>
<h3 id="tip-25-create-nonclustered-indexes-on-foreign-keys-when-frequently-used">Tip 25: Create nonclustered indexes on foreign keys when frequently used.</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Good Practice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">CustomersInfo</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">CLUSTERED</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FirstName</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LastName</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Country</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">TotalPurchases</span><span class="w"> </span><span class="nb">FLOAT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Score</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">BirthDate</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">EmployeeID</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">FK_CustomersInfo_EmployeeID</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">EmployeeID</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Employees</span><span class="p">(</span><span class="n">EmployeeID</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">NONCLUSTERED</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">IX_CustomersInfo_EmployeeID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">CustomersInfo</span><span class="p">(</span><span class="n">EmployeeID</span><span class="p">);</span></span></span></code></pre></div>
<h2 id="indexing">Indexing</h2>
<h3 id="tip-26-avoid-over-indexing-slows-down-writes">Tip 26: Avoid over-indexing (slows down writes).</h3>
<h3 id="tip-27-drop-unused-indexes-regularly">Tip 27: Drop unused indexes regularly.</h3>
<h3 id="tip-28-update-table-statistics-weekly">Tip 28: Update table statistics weekly.</h3>
<h3 id="tip-29-reorganizerebuild-fragmented-indexes-weekly">Tip 29: Reorganize/rebuild fragmented indexes weekly.</h3>
<h3 id="tip-30-for-very-large-tables-partition--columnstore-index">Tip 30: For very large tables, partition + columnstore index.</h3>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="ai-and-sql">AI and SQL</h1>

<p>This document contains a series of <strong>AI-powered prompts</strong> designed to help SQL developers and learners improve skills in writing, optimizing, and understanding SQL queries.<br>
The prompts cover <strong>tasks, readability, performance, debugging, interview/exam prep</strong>, and more.<br>
Each section provides clear <strong>instructions and sample code</strong> to support <strong>self-learning</strong> and <strong>real-world application</strong>.</p>
<hr>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="/sql/ai-and-sql/#1-solve-an-sql-task">Solve an SQL Task</a></li>
<li><a href="/sql/ai-and-sql/#2-improve-the-readability">Improve the Readability</a></li>
<li><a href="/sql/ai-and-sql/#3-optimize-the-performance-query">Optimize the Performance Query</a></li>
<li><a href="/sql/ai-and-sql/#4-optimize-execution-plan">Optimize Execution Plan</a></li>
<li><a href="/sql/ai-and-sql/#5-debugging">Debugging</a></li>
<li><a href="/sql/ai-and-sql/#6-explain-the-result">Explain the Result</a></li>
<li><a href="/sql/ai-and-sql/#7-styling--formatting">Styling &amp; Formatting</a></li>
<li><a href="/sql/ai-and-sql/#8-documentations--comments">Documentations &amp; Comments</a></li>
<li><a href="/sql/ai-and-sql/#9-improve-database-ddl">Improve Database DDL</a></li>
<li><a href="/sql/ai-and-sql/#10-generate-test-dataset">Generate Test Dataset</a></li>
<li><a href="/sql/ai-and-sql/#11-create-sql-course">Create SQL Course</a></li>
<li><a href="/sql/ai-and-sql/#12-understand-sql-concept">Understand SQL Concept</a></li>
<li><a href="/sql/ai-and-sql/#13-comparing-sql-concepts">Comparing SQL Concepts</a></li>
<li><a href="/sql/ai-and-sql/#14-sql-questions-with-options">SQL Questions with Options</a></li>
<li><a href="/sql/ai-and-sql/#15-prepare-for-a-sql-interview">Prepare for a SQL Interview</a></li>
<li><a href="/sql/ai-and-sql/#16-prepare-for-a-sql-exam">Prepare for a SQL Exam</a></li>
</ol>
<hr>
<h2 id="1-solve-an-sql-task">1. Solve an SQL Task</h2>
<p>Prompt:<br>
In my SQL Server database, we have two tables:</p>
<ul>
<li><code>orders(order_id, sales, customer_id, product_id)</code></li>
<li><code>customers(customer_id, first_name, last_name, country)</code></li>
</ul>
<p>Tasks:</p>
<ul>
<li>Write a query to rank customers based on their sales.</li>
<li>Result must include: <code>customer_id</code>, full name, country, total sales, rank.</li>
<li>Write <strong>3 different versions</strong> of the query.</li>
<li>Include comments (avoid obvious ones).</li>
<li>Evaluate which version is best in terms of <strong>readability</strong> and <strong>performance</strong>.</li>
</ul>
<hr>
<h2 id="2-improve-the-readability">2. Improve the Readability</h2>
<p>The following SQL Server query is long and hard to understand.</p>
<p><strong>Task:</strong></p>
<ul>
<li>Improve its readability.</li>
<li>Remove any redundancy and consolidate it.</li>
<li>Include comments (avoid obvious ones).</li>
<li>Explain each improvement.</li>
</ul>
<p><strong>Original Query:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">CTE_Total_Sales_By_Customer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">LastName</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FullName</span><span class="p">,</span><span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w">  </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w">  </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">LastName</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="n">CTE_Highest_Order_Product</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">p</span><span class="p">.</span><span class="n">Product</span><span class="p">,</span><span class="w"> </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">Sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">ProductID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ProductID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">CTE_Highest_Category</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">  </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">rn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">ProductID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ProductID</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w">  </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">CTE_Last_Order_Date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">LastOrderDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w">  </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">CTE_Total_Discounts_By_Customer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w">  </span><span class="k">SUM</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">Quantity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalDiscounts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w">  </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Products</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">ProductID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ProductID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ts</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">FullName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ts</span><span class="p">.</span><span class="n">TotalSales</span><span class="p">,</span><span class="n">hop</span><span class="p">.</span><span class="n">Product</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">HighestOrderProduct</span><span class="p">,</span><span class="n">hc</span><span class="p">.</span><span class="n">Category</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">HighestCategory</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">lod</span><span class="p">.</span><span class="n">LastOrderDate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">td</span><span class="p">.</span><span class="n">TotalDiscounts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">CTE_Total_Sales_By_Customer</span><span class="w"> </span><span class="n">ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">CTE_Highest_Order_Product</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">rn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">hop</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hop</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">CTE_Highest_Category</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">rn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">hc</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hc</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CTE_Last_Order_Date</span><span class="w"> </span><span class="n">lod</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lod</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w">  </span><span class="n">CTE_Total_Discounts_By_Customer</span><span class="w"> </span><span class="n">td</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ts</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">td</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">  </span><span class="n">ts</span><span class="p">.</span><span class="n">TotalSales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w">  </span><span class="n">ts</span><span class="p">.</span><span class="n">TotalSales</span><span class="w"> </span><span class="k">DESC</span></span></span></code></pre></div>
<h2 id="3-optimize-the-performance-query">3. Optimize the Performance Query</h2>
<p>The following query is slow.</p>
<p><strong>Task:</strong></p>
<p>Propose optimizations.</p>
<p>Provide an improved query.</p>
<p>Explain each improvement.</p>
<p><strong>Original Query:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">OrderID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CustomerFirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">o2</span><span class="p">.</span><span class="n">OrderID</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">WHERE</span><span class="w"> </span><span class="n">o2</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OrderCount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LOWER</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">OrderStatus</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;delivered&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">OR</span><span class="w"> </span><span class="k">YEAR</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">OrderDate</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2025</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">OR</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="mi">2</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">OR</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Country</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%USA%&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span></span></span></code></pre></div>
<h2 id="4-optimize-execution-plan">4. Optimize Execution Plan</h2>
<p><strong>Task:</strong></p>
<p>Describe the execution plan step by step.</p>
<p>Identify performance bottlenecks.</p>
<p>Suggest optimizations.</p>
<h2 id="5-debugging">5. Debugging</h2>
<p>The following query causes an error:
Msg 8120, Level 16, State 1, Line 5</p>
<p><strong>Task:</strong></p>
<p>Explain the error.</p>
<p>Find the root cause.</p>
<p>Suggest a fix.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">C</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">C</span><span class="p">.</span><span class="n">Country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">O</span><span class="p">.</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">C</span><span class="p">.</span><span class="n">Country</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">O</span><span class="p">.</span><span class="n">Sales</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">RankInCountry</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">C</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> </span><span class="n">O</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">C</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">O</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">C</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="k">C</span><span class="p">.</span><span class="n">Country</span></span></span></code></pre></div>
<h2 id="6-explain-the-result">6. Explain the Result</h2>
<p><strong>Query:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">Series</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">-- Anchor Query
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">MyNumber</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">-- Recursive Query
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="n">MyNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">FROM</span><span class="w"> </span><span class="n">Series</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">WHERE</span><span class="w"> </span><span class="n">MyNumber</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Series</span></span></span></code></pre></div>
<p><strong>Task:</strong></p>
<p>Break down how SQL processes this query step by step.</p>
<p>Explain how the result is formed.</p>
<h2 id="7-styling--formatting">7. Styling &amp; Formatting</h2>
<p>The following query is hard to read.</p>
<p><strong>Task:</strong></p>
<p>Restyle for readability.</p>
<p>Align column aliases.</p>
<p>Keep compact.</p>
<p><strong>Original Query:</strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">with</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w"> </span><span class="k">as</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">Select</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cte_customer_segments</span><span class="w"> </span><span class="k">as</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;High Value&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">when</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;Medium Value&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Low Value&#39;</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">CustomerSegment</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">from</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cts</span><span class="p">.</span><span class="n">TotalSales</span><span class="p">,</span><span class="w"> </span><span class="n">ccs</span><span class="p">.</span><span class="n">CustomerSegment</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sales</span><span class="p">.</span><span class="n">customers</span><span class="w"> </span><span class="k">c</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w"> </span><span class="n">cts</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">cts</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">cte_customer_segments</span><span class="w"> </span><span class="n">ccs</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ccs</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span></span></span></code></pre></div>
<h2 id="8-documentations--comments">8. Documentations &amp; Comments</h2>
<p>The following query lacks comments.</p>
<p><strong>Task:</strong></p>
<p>Add a leading comment.</p>
<p>Insert clarifying comments where needed.</p>
<p>Create two documents:</p>
<p>Business rules implemented.</p>
<p>How the query works.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w"> </span><span class="k">AS</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TotalSales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Orders</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">CTE_Customer_Segements</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">CustomerID</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">CASE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">WHEN</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;High Value&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">WHEN</span><span class="w"> </span><span class="n">TotalSales</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Medium Value&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Low Value&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">END</span><span class="w"> </span><span class="n">CustomerSegment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">c</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cts</span><span class="p">.</span><span class="n">TotalSales</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ccs</span><span class="p">.</span><span class="n">CustomerSegment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">.</span><span class="n">Customers</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CTE_Total_Sales</span><span class="w"> </span><span class="n">cts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">cts</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">CTE_Customer_Segements</span><span class="w"> </span><span class="n">ccs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">ccs</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">CustomerID</span><span class="w"> </span></span></span></code></pre></div>
<h2 id="9-improve-database-ddl">9. Improve Database DDL</h2>
<p><strong>Task:</strong></p>
<p>Check naming consistency.</p>
<p>Optimize data types.</p>
<p>Verify PK/FK integrity.</p>
<p>Review indexes.</p>
<p>Ensure normalization.</p>
<h2 id="10-generate-test-dataset">10. Generate Test Dataset</h2>
<p><strong>Task:</strong></p>
<p>Generate realistic test dataset with INSERT statements.</p>
<p>Keep it small.</p>
<p>Ensure valid PK/FK relationships.</p>
<p>Avoid NULL.</p>
<h2 id="11-create-sql-course">11. Create SQL Course</h2>
<p><strong>Task:</strong></p>
<p>Build a beginner-to-advanced SQL roadmap.</p>
<p>Include analytics-focused topics.</p>
<p>Use real-world scenarios.</p>
<h2 id="12-understand-sql-concept">12. Understand SQL Concept</h2>
<p><strong>Task:</strong></p>
<p>Explain SQL Window Functions.</p>
<p>Provide an analogy.</p>
<p>Describe when/why to use them.</p>
<p>Show syntax &amp; examples.</p>
<p>List top 3 use cases.</p>
<h2 id="13-comparing-sql-concepts">13. Comparing SQL Concepts</h2>
<p><strong>Task:</strong></p>
<p>Compare Window Functions vs GROUP BY.</p>
<p>Explain key differences.</p>
<p>Show examples.</p>
<p>Provide pros/cons.</p>
<p>Summarize in a side-by-side table.</p>
<h2 id="14-sql-questions-with-options">14. SQL Questions with Options</h2>
<p><strong>Task:</strong></p>
<p>Act as SQL trainer.</p>
<p>Provide sample dataset.</p>
<p>Create progressive tasks.</p>
<p>Simulate SQL Server results.</p>
<p>Review solutions &amp; suggest improvements.</p>
<h2 id="15-prepare-for-a-sql-interview">15. Prepare for a SQL Interview</h2>
<p><strong>Task:</strong></p>
<p>Act as interviewer.</p>
<p>Ask common SQL questions.</p>
<p>Progress to advanced topics.</p>
<p>Evaluate answers &amp; give feedback.</p>
<h2 id="16-prepare-for-a-sql-exam">16. Prepare for a SQL Exam</h2>
<p><strong>Task:</strong></p>
<p>Ask SQL exam-style questions.</p>
<p>Progress gradually.</p>
<p>Evaluate answers &amp; give feedback.</p>

  <footer class="footline">
  </footer>
</article>
          </section>
<article class="chapter narrow">
  <header class="headline">
  </header>
<div class="article-subheading">Chapter 2</div>

<h1 id="azure-data-factory">Azure Data Factory</h1>

<ul class="children children-li children-sort-">
</ul>
<h2 id="1-introduction">1. Introduction</h2>
<ul>
<li>Overview of Azure Data Factory</li>
<li>Data Integration in Cloud</li>
<li>ADF Architecture</li>
<li>ADF Components (Pipelines, Activities, Datasets, Linked Services, Triggers)</li>
<li>ADF vs SSIS vs Synapse Pipelines</li>
</ul>
<h2 id="2-adf-basics">2. ADF Basics</h2>
<ul>
<li>Creating an ADF Instance</li>
<li>ADF Studio Overview</li>
<li>Linked Services</li>
<li>Datasets</li>
<li>Pipelines</li>
<li>Activities</li>
<li>Triggers (Schedule, Tumbling Window, Event-based, Manual)</li>
</ul>
<h2 id="3-data-movement">3. Data Movement</h2>
<ul>
<li>Copy Activity</li>
<li>Integration Runtime (IR) Types
<ul>
<li>Azure IR</li>
<li>Self-hosted IR</li>
<li>Azure-SSIS IR</li>
</ul>
</li>
<li>Data Movement Performance</li>
<li>Parallelism &amp; Batch Copy</li>
</ul>
<h2 id="4-data-transformation">4. Data Transformation</h2>
<ul>
<li>Mapping Data Flows</li>
<li>Wrangling Data Flows</li>
<li>Data Flow Debugging</li>
<li>Joins, Aggregations, Filters, Derived Columns</li>
<li>Surrogate Keys &amp; Window Functions</li>
<li>Data Flow Performance Tuning</li>
</ul>
<h2 id="5-orchestration">5. Orchestration</h2>
<ul>
<li>Control Activities (Execute Pipeline, ForEach, If Condition, Until, Switch, Wait)</li>
<li>Parameterization</li>
<li>Variables in Pipelines</li>
<li>Expressions &amp; Functions</li>
<li>Dynamic Content</li>
<li>Error Handling &amp; Retry Policies</li>
</ul>
<h2 id="6-data-sources--destinations">6. Data Sources &amp; Destinations</h2>
<ul>
<li>Azure Blob Storage</li>
<li>Azure Data Lake Storage (ADLS)</li>
<li>Azure SQL Database</li>
<li>Azure Synapse Analytics</li>
<li>On-Premises SQL Server</li>
<li>Cosmos DB</li>
<li>REST API</li>
<li>SAP, Oracle, Teradata, Snowflake</li>
<li>Amazon S3</li>
<li>Google Cloud Storage</li>
</ul>
<h2 id="7-integration-with-other-azure-services">7. Integration with Other Azure Services</h2>
<ul>
<li>Azure Key Vault Integration</li>
<li>Azure Monitor &amp; Log Analytics</li>
<li>Power BI Integration</li>
<li>Event Grid &amp; Event Hub</li>
<li>Logic Apps &amp; Functions</li>
<li>Azure Machine Learning</li>
</ul>
<h2 id="8-cicd--devops-with-adf">8. CI/CD &amp; DevOps with ADF</h2>
<ul>
<li>Source Control with Git (GitHub, Azure Repos)</li>
<li>Branching &amp; Collaboration</li>
<li>Publishing &amp; ARM Templates</li>
<li>Continuous Integration &amp; Deployment</li>
<li>Automated Testing</li>
<li>Environment Promotion (Dev → Test → Prod)</li>
</ul>
<h2 id="9-security">9. Security</h2>
<ul>
<li>Managed Identity in ADF</li>
<li>Service Principals</li>
<li>Access Control (RBAC)</li>
<li>Data Encryption</li>
<li>Network Security (VNET Integration, Private Endpoints)</li>
<li>Credential Management with Key Vault</li>
</ul>
<h2 id="10-monitoring--troubleshooting">10. Monitoring &amp; Troubleshooting</h2>
<ul>
<li>Pipeline Monitoring</li>
<li>Activity Run Details</li>
<li>Debugging Failures</li>
<li>Alerts &amp; Notifications</li>
<li>Logging with Log Analytics</li>
<li>Performance Optimization</li>
</ul>
<h2 id="11-advanced-features">11. Advanced Features</h2>
<ul>
<li>Incremental Data Loading (Watermarking, Change Data Capture)</li>
<li>Slowly Changing Dimensions (SCD) Implementation</li>
<li>Parameterized Pipelines &amp; Templates</li>
<li>Global Parameters</li>
<li>Data Lineage &amp; Impact Analysis</li>
<li>ADF REST API</li>
<li>Managed VNET Data Integration</li>
</ul>
<h2 id="12-best-practices">12. Best Practices</h2>
<ul>
<li>Designing Efficient Pipelines</li>
<li>Naming Conventions</li>
<li>Error Handling Framework</li>
<li>Cost Optimization in ADF</li>
<li>Scalability &amp; Performance Tuning</li>
<li>Version Control Strategies</li>
</ul>
<h2 id="13-real-world-use-cases">13. Real-World Use Cases</h2>
<ul>
<li>Building an ETL Pipeline with ADF</li>
<li>Data Lake to Synapse ETL</li>
<li>Real-Time Event Processing</li>
<li>Hybrid Data Integration (On-Prem + Cloud)</li>
<li>Machine Learning Model Deployment Orchestration</li>
</ul>
<h2 id="14-capstone-project">14. Capstone Project</h2>
<ul>
<li>End-to-End Data Warehouse Load using ADF</li>
<li>Incremental Data Pipeline with Delta Processing</li>
<li>Enterprise Data Integration with ADF and Synapse</li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="chapter narrow">
  <header class="headline">
  </header>
<div class="article-subheading">Chapter 3</div>

<h1 id="azure-data-bricks">Azure Data Bricks</h1>

<ul class="children children-li children-sort-">
  <li class="children-title"><a href="/azure_data_bricks/spark/">Spark</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/df-creation/">DF Basics</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/df-operations/">DF Operations</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/functions/">Functions</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/date/">Date Functions</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/nulls/">Handling Nulls</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/aggregations/">Aggregate functions</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/joins/">Joins</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/when/">When|Cast|Union</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/window-functions/">Window Functions</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/explode/">Explode</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/pivot/">Pivot</a><ul></ul></li>
  <li class="children-title"><a href="/azure_data_bricks/comparisons/">Comparisons</a><ul></ul></li>
</ul>
<h2 id="1-introduction">1. Introduction</h2>
<ul>
<li>Big Data Overview</li>
<li>Introduction to Apache Spark</li>
<li>Introduction to Azure Databricks</li>
<li>Databricks Architecture</li>
<li>Databricks Workspace Overview</li>
</ul>
<h2 id="2-spark-core-concepts">2. Spark Core Concepts</h2>
<ul>
<li>RDDs (Resilient Distributed Datasets)</li>
<li>Transformations and Actions</li>
<li>Lazy Evaluation</li>
<li>Spark Execution Model</li>
<li>Caching and Persistence</li>
<li>Partitioning</li>
</ul>
<h2 id="3-spark-sql">3. Spark SQL</h2>
<ul>
<li>DataFrames and Datasets</li>
<li>Spark SQL Engine</li>
<li>Schema Inference</li>
<li>Catalog and Metadata</li>
<li>Temporary and Global Views</li>
<li>SQL Queries in Spark</li>
<li>Performance Optimization (Catalyst Optimizer, Tungsten)</li>
</ul>
<h2 id="4-spark-data-sources">4. Spark Data Sources</h2>
<ul>
<li>Reading/Writing CSV, JSON, Parquet, ORC</li>
<li>Working with Delta Lake</li>
<li>JDBC Data Sources</li>
<li>Streaming Data Sources</li>
<li>Handling Nested Data (Struct, Array, Map)</li>
</ul>
<h2 id="5-delta-lake">5. Delta Lake</h2>
<ul>
<li>Introduction to Delta Lake</li>
<li>ACID Transactions</li>
<li>Schema Enforcement &amp; Evolution</li>
<li>Time Travel</li>
<li>Upserts &amp; Deletes (MERGE)</li>
<li>Delta Lake Optimization (Z-order, Optimize, Vacuum)</li>
</ul>
<h2 id="6-spark-streaming--structured-streaming">6. Spark Streaming &amp; Structured Streaming</h2>
<ul>
<li>Introduction to Streaming</li>
<li>DStreams vs Structured Streaming</li>
<li>Streaming Sources (Kafka, Event Hubs, Socket)</li>
<li>Watermarking &amp; Late Data</li>
<li>State Management</li>
<li>Streaming Sinks (Delta, Console, Kafka, Event Hubs)</li>
</ul>
<h2 id="7-spark-mllib-machine-learning">7. Spark MLlib (Machine Learning)</h2>
<ul>
<li>MLlib Basics</li>
<li>Feature Engineering</li>
<li>Pipelines &amp; Transformers</li>
<li>Classification</li>
<li>Regression</li>
<li>Clustering</li>
<li>Model Persistence</li>
</ul>
<h2 id="8-spark-graphx">8. Spark GraphX</h2>
<ul>
<li>Introduction to GraphX</li>
<li>Graph Processing Basics</li>
<li>Graph Algorithms</li>
<li>Use Cases</li>
</ul>
<h2 id="9-performance-tuning">9. Performance Tuning</h2>
<ul>
<li>Spark Configurations &amp; Parameters</li>
<li>Memory Management</li>
<li>Shuffle Optimizations</li>
<li>Caching Strategies</li>
<li>Adaptive Query Execution (AQE)</li>
<li>Skew Handling</li>
</ul>
<h2 id="10-azure-databricks-essentials">10. Azure Databricks Essentials</h2>
<ul>
<li>Databricks Clusters (Types, Autoscaling, Pools)</li>
<li>Databricks Notebooks</li>
<li>Databricks Repos &amp; Git Integration</li>
<li>Databricks Jobs &amp; Scheduling</li>
<li>Databricks Secrets</li>
<li>Databricks Utilities (DBUtils)</li>
<li>Workspace Security &amp; Permissions</li>
</ul>
<h2 id="11-integration-with-azure-services">11. Integration with Azure Services</h2>
<ul>
<li>Azure Data Lake Storage (ADLS) Integration</li>
<li>Azure Blob Storage Integration</li>
<li>Azure Synapse Analytics</li>
<li>Azure Event Hubs</li>
<li>Azure Data Factory (ADF) with Databricks</li>
<li>Power BI with Databricks</li>
</ul>
<h2 id="12-advanced-databricks">12. Advanced Databricks</h2>
<ul>
<li>Unity Catalog</li>
<li>Databricks SQL</li>
<li>Delta Live Tables (DLT)</li>
<li>Databricks REST API</li>
<li>Databricks CLI</li>
<li>Monitoring &amp; Logging</li>
<li>Cost Optimization in Databricks</li>
</ul>
<h2 id="13-real-world-use-cases">13. Real-World Use Cases</h2>
<ul>
<li>ETL Pipeline with Databricks</li>
<li>Streaming Data Pipeline</li>
<li>Batch Data Processing</li>
<li>Machine Learning Pipeline</li>
<li>End-to-End Data Lakehouse Implementation</li>
</ul>
<h2 id="14-best-practices">14. Best Practices</h2>
<ul>
<li>Cluster Sizing &amp; Configuration</li>
<li>Code Versioning &amp; Collaboration</li>
<li>Data Governance</li>
<li>Security &amp; Compliance</li>
<li>CI/CD with Databricks</li>
<li>Productionizing Workloads</li>
</ul>
<h2 id="15-capstone-project">15. Capstone Project</h2>
<ul>
<li>Build a Scalable Data Lakehouse with Databricks</li>
<li>Real-Time Streaming Data Pipeline</li>
<li>ML Model Training and Deployment</li>
</ul>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of ADB</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="spark">Spark</h1>

<h2 id="what-is-spark">What is Spark?</h2>
<p><strong>Spark</strong> is an open source unified computing engine with a set of libraries for <strong>parallel data processing</strong> on a computer cluster.</p>
<p>It supports widely used programming languages such as:</p>
<ul>
<li><strong>Scala</strong></li>
<li><strong>Python</strong></li>
<li><strong>Java</strong></li>
<li><strong>R</strong></li>
</ul>
<p>It processes data in <strong>memory (RAM)</strong>, which makes it 100 times faster than traditional Hadoop MapReduce.</p>
<pre class="mermaid align-center ">flowchart TD
    subgraph DriverProgram[Driver Program]
        SS[SparkSession]
        SC[SparkContext]
        SS --&gt; SC
    end

    CM[Cluster Manager]

    subgraph Worker1[Worker Node]
        subgraph Executor1[Executor]
            T1[Task]
            T2[Task]
            C1[Cache]
        end
    end

    subgraph Worker2[Worker Node]
        subgraph Executor2[Executor]
            T3[Task]
            T4[Task]
            C2[Cache]
        end
    end

    SC --&gt; CM
    CM --&gt; Executor1
    CM --&gt; Executor2
    SC --&gt; Executor1
    SC --&gt; Executor2
    Executor1 --&gt; T1
    Executor1 --&gt; T2
    Executor1 --&gt; C1
    Executor2 --&gt; T3
    Executor2 --&gt; T4
    Executor2 --&gt; C2</pre>
<h3 id="spark-components">Spark Components</h3>
<p>Following represents Spark components at a high level:</p>
<ul>
<li>Low Level API – RDD &amp; Distributed Variables</li>
<li>Structured API – DataFrames, Datasets, and SQL</li>
<li>Libraries and Ecosystem – Structured Streaming and Advanced Analytics</li>
</ul>
<table>
  <thead>
      <tr>
          <th style="text-align: center">LAYER STRUCTURE</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">Libraries &amp; Ecosystem</td>
      </tr>
      <tr>
          <td style="text-align: center">Structured API</td>
      </tr>
      <tr>
          <td style="text-align: center">Low Level API</td>
      </tr>
  </tbody>
</table>
<h2 id="how-spark-works">How Spark Works</h2>
<h3 id="1-drivers-and-executors">1. Drivers and Executors</h3>
<ul>
<li><strong>Driver</strong>: The brain of a Spark application. It translates your code into a logical execution plan and coordinates work.</li>
<li><strong>Executors</strong>: The workers. They run on cluster nodes, do the actual computation, and store data in memory/disk.</li>
</ul>
<p>Think of the <strong>Driver as a manager</strong> and <strong>Executors as employees</strong> doing the tasks.</p>
<hr>
<h3 id="2-jobs-stages-and-tasks">2. Jobs, Stages, and Tasks</h3>
<ul>
<li><strong>Job</strong>: Triggered when you call an action (like <code>.collect()</code> or <code>.save()</code>). A job = big unit of work.</li>
<li><strong>Stage</strong>: Spark splits the job into smaller parts based on shuffle boundaries (data movement points).</li>
<li><strong>Task</strong>: The smallest unit. Each stage is broken into many tasks, one per partition of data.</li>
</ul>
<p>👉 Flow: <strong>Job → Stages → Tasks → Results</strong></p>
<pre class="mermaid align-center ">  flowchart LR
    JOB[JOB]
    STAGE1[STAGE]
    STAGE2[STAGE]
    TASK1[TASK]
    TASK2[TASK]
    TASK3[TASK]
    
    JOB --&gt; STAGE1
    JOB --&gt; STAGE2
    STAGE1 --&gt; TASK1
    STAGE1 --&gt; TASK2
    STAGE2 --&gt; TASK3</pre>
<h2 id="what-is-partition">What is Partition?</h2>
<p>To allow every executor to work in parallel, Spark breaks down the data into chunks called partitions.</p>
<h2 id="what-is-transformation">What is Transformation?</h2>
<p>The <strong>instruction</strong> or <strong>code</strong> to modify and transform data is known as Transformation.</p>
<p><strong>Examples</strong>: select,where,groupBy etc.</p>
<p>Transformation helps in building the <strong>logical plan</strong>.</p>
<p>Two Types:</p>
<ul>
<li><strong>Narrow Transformation</strong></li>
<li><strong>Wide Transformation</strong></li>
</ul>
<h2 id="what-are-actions">What are Actions?</h2>
<p>To <strong>trigger the execution</strong> we need to call an <strong>Action</strong>.</p>
<p>This basically executes the plan created by Transformation.</p>
<p>Actions are of three types:</p>
<ul>
<li><strong>View data</strong> in console</li>
<li><strong>Collect data</strong> to native language</li>
<li><strong>Write data</strong> to output data sources</li>
</ul>
<h3 id="spark-prefers-lazy-evaluation">Spark prefers Lazy Evaluation</h3>
<p><strong>Transformations are lazy</strong> → Spark doesn’t execute them immediately; it just builds a logical plan (DAG).
<strong>Execution happens only on actions</strong> → When an action (collect, count, save) is called, Spark optimizes the DAG and runs it.</p>
<h3 id="shuffle-in-spark">Shuffle in Spark</h3>
<ul>
<li><strong>When</strong>: Happens during <strong>wide transformations</strong> (<code>groupByKey</code>, <code>reduceByKey</code>, <code>join</code>, etc.).</li>
<li><strong>What</strong>: Data is <strong>redistributed across the cluster</strong> so records with the same key end up in the same partition.</li>
<li><strong>Impact</strong>: A <strong>new stage</strong> is created in the DAG because shuffle requires data movement across executors.</li>
</ul>
<blockquote>
<p>Shuffling occurs because wide transformations require <strong>related data (e.g., same keys)</strong> to be co-located in the <strong>same partition</strong>, which necessitates <strong>repartitioning</strong> and <strong>redistributing</strong> data across nodes.</p></blockquote>

<details open class=" box cstyle notices note">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-circle"></i> 
    Note
  </summary>
  <div class="box-content">
<p>In Spark, <strong>actions (like count, collect, saveAsTextFile) create a job and trigger its execution, wide transformations (such as groupByKey, reduceByKey, join) introduce shuffle boundaries by redistributing data across partitions, and these boundaries split the job into stages, where tasks are scheduled and executed in parallel on cluster nodes.</strong></p>
  </div>
</details>
<h2 id="what-is-spark-session">What is Spark Session?</h2>
<ul>
<li>The Driver Process is known as Spark Session.</li>
<li>It is the entry point for a Spark execution.</li>
<li>The Spark Session instance executes the code in the cluster.</li>
<li>The relation is one-to-one, i.e., for one Spark Application, there will be one Spark Session instance.</li>
</ul>
<h3 id="structured-api---dataframes">Structured API - DataFrames</h3>
<ul>
<li>DataFrame is the most common Structured API, represented like a table.</li>
<li>The table is represented in form of Rows and Columns.</li>
<li>DataFrame has schema, which is the metadata for the columns.</li>
<li>Data in DataFrames are in partitions.</li>
<li>DataFrames are immutable.</li>
</ul>

<details open class=" box cstyle notices note">
  <summary class="box-label" tabindex="-1">
    <i class="fa-fw fas fa-exclamation-circle"></i> 
    Note
  </summary>
  <div class="box-content">
<p>DataFrames are <strong>immutable</strong>, meaning every transformation creates a <strong>new DataFrame</strong> without altering the original one.</p>
  </div>
</details>
<h3 id="structured-api-execution-plan">Structured API Execution Plan</h3>
<h3 id="1-logial-planning">1. <strong>Logial Planning</strong></h3>
<p>The Spark <strong>Driver</strong> first converts your code (Transformations/Actions) into a <strong>logical plan</strong>.
Represents <strong>what</strong> needs to be done without worrying about <strong>how</strong> it will be executed.</p>
<pre class="mermaid align-center ">flowchart LR
    A[Unresolved Logical Plan] --&gt; B[Resolved Logical Plan]
    B --&gt; C[Catalyst Optimizer]
    C --&gt; D[Optimized Logical Plan]</pre>
<h3 id="2-physical-planning">2. <strong>Physical Planning</strong></h3>
<p>Spark converts the <strong>logical plan</strong> into a <strong>physical plan</strong>, deciding <strong>how</strong> to execute it (which operations run where, partitioning, joins, etc.).
Optimizes for performance (e.g., choosing sort merge join vs broadcast join).</p>
<pre class="mermaid align-center ">flowchart LR
    A[Optimized Logical Plan] --&gt; B[Multiple Physical Plans]
    B --&gt; C[Cost Optimizer]
    C --&gt; D[Best Physical Plan]
    D --&gt; E[Sent to Cluster for Execution]</pre>
<h3 id="3-dag-directed-acyclic-graph">3. DAG (Directed Acyclic Graph)</h3>
<p>Spark breaks the physical plan into a <strong>DAG of stages</strong>.
Shows <strong>dependencies between stages</strong> and ensures tasks are executed in the correct order.</p>
<p><strong>Flow</strong>: DAG → Stages → Tasks → Execution</p>
<hr>
<h3 id="summary-flow">Summary Flow</h3>
<pre class="mermaid align-center ">flowchart LR
    A[User Code] --&gt; B[Logical Plan] --&gt; C[Physical Plan] --&gt; D[DAG of Stages] --&gt; E[Tasks executed by Executors]</pre>
<h2 id="creating-a-spark-session-in-pyspark">Creating a Spark Session in PySpark</h2>
<p>A <strong>SparkSession</strong> is the entry point to using PySpark. It allows interaction with Spark’s functionalities (DataFrame, SQL, etc.).</p>
<h3 id="example">Example</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">builder</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;Spark Introduction&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&#34;local[*]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre></div>
<ul>
<li><code>SparkSession.builder</code>: used to configure the session.</li>
<li><code>.appName(&quot;...&quot;)</code>: sets the application name.</li>
<li><code>.master(&quot;local[*]&quot;)</code>: runs Spark locally using all CPU cores.</li>
<li><code>.getOrCreate()</code>: returns an existing session or creates a new one.</li>
</ul>
<p><strong>Note</strong>:In Databricks, you don’t need to create a SparkSession manually. A spark session is already available by default, so you can directly use spark.read, spark.sql, etc.</p>
<h2 id="creating-dataframes-in-pyspark">Creating DataFrames in PySpark</h2>
<h3 id="1-from-in-memory-data">1. From In-Memory Data</h3>
<p>You can create a DataFrame directly from Python objects (lists, tuples, dicts).</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="mi">35</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Age&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="2-from-file">2. From File</h3>
<p>You can load data from CSV, JSON, Parquet, etc.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&#34;path/to/file.csv&#34;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="s2">&#34;path/to/file.json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="df-basics">DF Basics</h1>

<h2 id="creating-dataframe">Creating DataFrame</h2>
<h3 id="creating-dataframe-from-liststuples">Creating DataFrame from Lists/Tuples</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Sample Data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Alice&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;Bob&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;Charlie&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&#34;David&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;Eve&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;ID&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Show DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="creating-dataframe-from-pandas">Creating DataFrame from Pandas</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample Pandas DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">pandas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Convert to PySpark DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df_from_pandas</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">pandas_df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_from_pandas</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="create-dataframe-from-dictionary">Create DataFrame from Dictionary</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data_dict</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;Alice&#34;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&#34;ID&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;Bob&#34;</span><span class="p">}]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_from_dict</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_from_dict</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="create-empty-dataframe">Create Empty DataFrame</h3>
<p>You can create an empty DataFrame with just schema definitions.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">IntegerType</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define Schema</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;ID&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create Empty DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">empty_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([],</span> <span class="n">schema</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">empty_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="creating-dataframe-from-structured-data-csv-json-parquet">Creating DataFrame from Structured Data (CSV, JSON, Parquet)</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Reading CSV file into DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df_csv</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&#34;/path/to/file.csv&#34;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_csv</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Reading JSON file into DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df_json</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="s2">&#34;/path/to/file.json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_json</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Reading Parquet file into DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df_parquet</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">&#34;/path/to/file.parquet&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_parquet</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="show-function-in-pyspark-dataframes">show() Function in PySpark DataFrames</h3>
<p>The <code>show()</code> function in PySpark displays the contents of a DataFrame in a tabular format. It has several useful parameters for customization:</p>
<h3 id="parameters">Parameters:</h3>
<ol>
<li><strong>n</strong>: Number of rows to display (default is 20)</li>
<li><strong>truncate</strong>: If set to True, it truncates column values longer than 20 characters (default is True)</li>
<li><strong>vertical</strong>: If set to True, prints rows in a vertical format</li>
</ol>
<h3 id="usage-examples">Usage Examples:</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Show the first 3 rows, truncate columns to 25 characters, and display vertically:</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show entire DataFrame (default settings):</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the first 10 rows:</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show DataFrame without truncating any columns:</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div>
<hr>
<h2 id="loading-data-from-csv-file-into-a-dataframe">Loading Data from CSV File into a DataFrame</h2>
<p>Loading data into DataFrames is a fundamental step in any data processing workflow in PySpark. This document outlines how to load data from CSV files into a DataFrame, including using a custom schema and the implications of using the inferSchema option.</p>
<h3 id="1-import-required-libraries">1. Import Required Libraries</h3>
<p>Before loading the data, ensure you import the necessary modules:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">DoubleType</span></span></span></code></pre></div>
<h3 id="2-define-the-schema">2. Define the Schema</h3>
<p>You can define a custom schema for your CSV file. This allows you to explicitly set the data types for each column.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Define the schema for the CSV file</span>
</span></span><span class="line"><span class="cl"><span class="n">custom_schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;salary&#34;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span></span></span></code></pre></div>
<h3 id="3-read-the-csv-file">3. Read the CSV File</h3>
<p>Load the CSV file into a DataFrame using the <code>read.csv()</code> method. Here, <code>header=True</code> treats the first row as headers, and <code>inferSchema=True</code> allows Spark to automatically assign data types to columns.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Read the CSV file with the custom schema</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&#34;your_file.csv&#34;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">custom_schema</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></div>
<h3 id="4-load-multiple-csv-files">4. Load Multiple CSV Files</h3>
<p>To read multiple CSV files into a single DataFrame, you can pass a list of file paths. Ensure that the schema is consistent across all files.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># List of file paths</span>
</span></span><span class="line"><span class="cl"><span class="n">file_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;file1.csv&#34;</span><span class="p">,</span> <span class="s2">&#34;file2.csv&#34;</span><span class="p">,</span> <span class="s2">&#34;file3.csv&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Read multiple CSV files into a single DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">file_paths</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></span></span></code></pre></div>
<h3 id="5-load-a-csv-from-filestore">5. Load a CSV from FileStore</h3>
<p>Here is an example of loading a CSV file from Databricks FileStore:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&#34;/FileStore/tables/Order.csv&#34;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span></span></span></code></pre></div>
<h3 id="6-display-the-dataframe">6. Display the DataFrame</h3>
<p>Use the following commands to check the schema and display the DataFrame:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Print the schema of the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the first 20 rows of the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Displays only the first 20 rows</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the DataFrame in a tabular format</span>
</span></span><span class="line"><span class="cl"><span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>  <span class="c1"># For Databricks notebooks</span></span></span></code></pre></div>
<h3 id="interview-question-how-does-inferschema-work">Interview Question: How Does inferSchema Work?</h3>
<p><strong>Behind the Scenes:</strong> When you use <code>inferSchema</code>, Spark runs a job that scans the CSV file from top to bottom to identify the best-suited data type for each column based on the values it encounters.</p>
<h3 id="does-it-make-sense-to-use-inferschema">Does It Make Sense to Use inferSchema?</h3>
<p><strong>Pros:</strong></p>
<ul>
<li>Useful when the schema of the file keeps changing, as it allows Spark to automatically detect the data types.</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li><strong>Performance Impact:</strong> Spark must scan the entire file, which can take extra time, especially for large files.</li>
<li><strong>Loss of Control:</strong> You lose the ability to explicitly define the schema, which may lead to incorrect data types if the data is inconsistent.</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>Loading data from CSV files into a DataFrame is straightforward in PySpark. Understanding how to define a schema and the implications of using <code>inferSchema</code> is crucial for optimizing your data processing workflows.</p>
<p>This document provides a comprehensive overview of how to load CSV data into DataFrames in PySpark, along with considerations for using schema inference. Let me know if you need any more details or adjustments!</p>
<h2 id="pyspark-dataframe-schema-definition">PySpark DataFrame Schema Definition</h2>
<h3 id="1-defining-schema-programmatically-with-structtype">1. Defining Schema Programmatically with StructType</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the schema using StructType</span>
</span></span><span class="line"><span class="cl"><span class="n">employeeSchema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;ID&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Age&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Salary&#34;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Joining_Date&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1"># Keeping as String for date issues</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Department&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Performance_Rating&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Email&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Address&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;Phone&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load the DataFrame with the defined schema</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&#34;/FileStore/tables/employees.csv&#34;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s2">&#34;csv&#34;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">employeeSchema</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Print the schema of the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Optionally display the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="c1"># display(df)</span></span></span></code></pre></div>
<h3 id="2-defining-schema-as-a-string">2. Defining Schema as a String</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Define the schema as a string</span>
</span></span><span class="line"><span class="cl"><span class="n">employeeSchemaString</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ID Integer,
</span></span></span><span class="line"><span class="cl"><span class="s1">Name String,
</span></span></span><span class="line"><span class="cl"><span class="s1">Age Integer,
</span></span></span><span class="line"><span class="cl"><span class="s1">Salary Double,
</span></span></span><span class="line"><span class="cl"><span class="s1">Joining_Date String,
</span></span></span><span class="line"><span class="cl"><span class="s1">Department String,
</span></span></span><span class="line"><span class="cl"><span class="s1">Performance_Rating Integer,
</span></span></span><span class="line"><span class="cl"><span class="s1">Email String,
</span></span></span><span class="line"><span class="cl"><span class="s1">Address String,
</span></span></span><span class="line"><span class="cl"><span class="s1">Phone String
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load the DataFrame with the defined schema</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&#34;dbfs:/FileStore/shared_uploads/imsvk11@gmail.com/employee_data.csv&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                     <span class="nb">format</span><span class="o">=</span><span class="s2">&#34;csv&#34;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">employeeSchemaString</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Print the schema of the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Optionally display the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="c1"># display(df)</span></span></span></code></pre></div>
<h3 id="explanation">Explanation</h3>
<ul>
<li><strong>Schema Definition</strong>: Both methods define a schema for the DataFrame, accommodating the dataset&rsquo;s requirements, including handling null values where applicable.</li>
<li><strong>Data Types</strong>: The Joining_Date column is defined as StringType to accommodate potential date format issues or missing values.</li>
<li><strong>Loading the DataFrame</strong>: The <code>spark.read.load</code> method is used to load the CSV file into a DataFrame using the specified schema.</li>
<li><strong>Printing the Schema</strong>: The <code>df.printSchema()</code> function allows you to verify that the DataFrame is structured as intended.</li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="df-operations">DF Operations</h1>

<h2 id="column-selection--manipulation">Column Selection &amp; Manipulation</h2>
<h3 id="1-different-methods-to-select-columns">1. Different Methods to Select Columns</h3>
<p>In PySpark, you can select specific columns in multiple ways:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Using col() function</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Using column() function</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="s2">&#34;Age&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Directly using string name</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Salary&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="2-selecting-multiple-columns-together">2. Selecting Multiple Columns Together</h3>
<p>You can combine different methods to select multiple columns:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># multiple column</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;ID&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;Salary&#34;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&#34;Department&#34;</span><span class="p">),</span> <span class="n">df</span><span class="o">.</span><span class="n">Phone</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="3-listing-all-columns-in-a-dataframe">3. Listing All Columns in a DataFrame</h3>
<p>To get a list of all the column names:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># get all column name</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">columns</span></span></span></code></pre></div>
<h3 id="4-renaming-columns-with-alias">4. Renaming Columns with alias()</h3>
<p>You can rename columns using the <code>alias()</code> method:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">col</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;EmployeeName&#39;</span><span class="p">),</span>  <span class="c1"># Rename &#34;Name&#34; to &#34;EmployeeName&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">col</span><span class="p">(</span><span class="s2">&#34;Salary&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;EmployeeSalary&#39;</span><span class="p">),</span>  <span class="c1"># Rename &#34;Salary&#34; to &#34;EmployeeSalary&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">column</span><span class="p">(</span><span class="s2">&#34;Department&#34;</span><span class="p">),</span>  <span class="c1"># Select &#34;Department&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">df</span><span class="o">.</span><span class="n">Joining_Date</span>  <span class="c1"># Select &#34;Joining_Date&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="5-using-selectexpr-for-concise-column-selection">5. Using selectExpr() for Concise Column Selection</h3>
<p><code>selectExpr()</code> allows you to use SQL expressions directly and rename columns concisely:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span><span class="s2">&#34;Name as EmployeeName&#34;</span><span class="p">,</span> <span class="s2">&#34;Salary as EmployeeSalary&#34;</span><span class="p">,</span> <span class="s2">&#34;Department&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="summary">Summary</h3>
<ul>
<li>Use <code>col()</code>, <code>column()</code>, or string names to select columns.</li>
<li>Use <code>expr()</code> and <code>selectExpr()</code> for SQL-like expressions and renaming.</li>
<li>Use <code>alias()</code> to rename columns.</li>
<li>Get the list of columns using <code>df.columns</code>.</li>
</ul>
<hr>
<h2 id="adding-renaming-and-dropping-columns">Adding, Renaming, and Dropping Columns</h2>
<h3 id="1-adding-new-columns-with-withcolumn">1. Adding New Columns with withColumn()</h3>
<p>In PySpark, the <code>withColumn()</code> function is widely used to add new columns to a DataFrame. You can either assign a constant value using <code>lit()</code> or perform transformations using existing columns.</p>
<h4 id="add-a-constant-value-column">Add a constant value column:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">newdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;NewColumn&#34;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span></span></span></code></pre></div>
<h4 id="add-a-column-based-on-an-expression">Add a column based on an expression:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">newdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;withinCountry&#34;</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="s2">&#34;Country == &#39;India&#39;&#34;</span><span class="p">))</span></span></span></code></pre></div>
<p>This function allows adding multiple columns, including calculated ones:</p>
<p><strong>Example:</strong></p>
<ul>
<li>Assign a constant value with <code>lit()</code>.</li>
<li>Perform calculations using existing columns like multiplying values.</li>
</ul>
<h3 id="2-renaming-columns-with-withcolumnrenamed">2. Renaming Columns with withColumnRenamed()</h3>
<p>PySpark provides the <code>withColumnRenamed()</code> method to rename columns. This is especially useful when you want to change the names for clarity or to follow naming conventions:</p>
<h3 id="renaming-a-column">Renaming a column:</h3>
<p>python</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">new_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="s2">&#34;oldColumnName&#34;</span><span class="p">,</span> <span class="s2">&#34;newColumnName&#34;</span><span class="p">)</span></span></span></code></pre></div>
<h4 id="handling-column-names-with-special-characters-or-spaces">Handling column names with special characters or spaces:</h4>
<p>If a column has special characters or spaces, you need to use backticks (`) to escape it:</p>
<p>python</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">newdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;`New Column Name`&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="3-dropping-columns-with-drop">3. Dropping Columns with drop()</h3>
<p>To remove unwanted columns, you can use the <code>drop()</code> method:</p>
<h4 id="drop-a-single-column">Drop a single column:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&#34;Country&#34;</span><span class="p">)</span></span></span></code></pre></div>
<h4 id="drop-multiple-columns">Drop multiple columns:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&#34;Country&#34;</span><span class="p">,</span> <span class="s2">&#34;Region&#34;</span><span class="p">)</span></span></span></code></pre></div>
<p>Dropping columns creates a new DataFrame, and the original DataFrame remains unchanged.</p>
<h3 id="4-immutability-of-dataframes">4. Immutability of DataFrames</h3>
<p>In Spark, DataFrames are immutable by nature. This means that after creating a DataFrame, its contents cannot be changed. All transformations like adding, renaming, or dropping columns result in a new DataFrame, keeping the original one intact.</p>
<h4 id="for-instance-dropping-columns-creates-a-new-dataframe-without-altering-the-original">For instance, dropping columns creates a new DataFrame without altering the original:</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">newdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&#34;ItemType&#34;</span><span class="p">,</span> <span class="s2">&#34;SalesChannel&#34;</span><span class="p">)</span></span></span></code></pre></div>
<p>This immutability ensures data consistency and supports Spark&rsquo;s parallel processing, as transformations do not affect the source data.</p>
<h3 id="key-points">Key Points</h3>
<ul>
<li>Use <code>withColumn()</code> for adding columns, with <code>lit()</code> for constant values and expressions for computed values.</li>
<li>Use <code>withColumnRenamed()</code> to rename columns and backticks for special characters or spaces.</li>
<li>Use <code>drop()</code> to remove one or more columns.</li>
<li>DataFrames are immutable in Spark—transformations result in new DataFrames, leaving the original unchanged.</li>
</ul>
<hr>
<h2 id="data-types-filtering-and-unique-values">Data Types, Filtering, and Unique Values</h2>
<p>Here&rsquo;s a structured set of notes with code to cover changing data types, filtering data, and handling unique/distinct values in PySpark using the employee data:</p>
<h3 id="1-changing-data-types-schema-transformation">1. Changing Data Types (Schema Transformation)</h3>
<p>In PySpark, you can change the data type of a column using the <code>cast()</code> method. This is helpful when you need to convert data types for columns like Salary or Phone.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Change the &#39;Salary&#39; column from integer to double</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Salary&#34;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;Salary&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;double&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Convert &#39;Phone&#39; column to string</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Phone&#34;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;Phone&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;string&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="2-filtering-data">2. Filtering Data</h3>
<p>You can filter rows based on specific conditions. For instance, to filter employees with a salary greater than 50,000:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Filter rows where Salary is greater than 50,000</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Salary&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Filtering rows where Age is not null</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="3-multiple-filters-chaining-conditions">3. Multiple Filters (Chaining Conditions)</h3>
<p>You can also apply multiple conditions using <code>&amp;</code> or <code>|</code> (AND/OR) to filter data. For example, finding employees over 30 years old and in the IT department:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Filter rows where Age &gt; 30 and Department is &#39;IT&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Age&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Department&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;IT&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="4-filtering-on-null-or-non-null-values">4. Filtering on Null or Non-Null Values</h3>
<p>Filtering based on whether a column has NULL values or not is crucial for data cleaning:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Filter rows where &#39;Address&#39; is NULL</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Address&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Filter rows where &#39;Email&#39; is NOT NULL</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Email&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">filtered_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="5-handling-unique-or-distinct-data">5. Handling Unique or Distinct Data</h3>
<p>To get distinct rows or unique values from your dataset:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Get distinct rows from the entire DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get distinct values from the &#39;Department&#39; column</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_departments_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Department&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_departments_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<p>To remove duplicates based on specific columns, such as Email or Phone, use <code>dropDuplicates()</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Remove duplicates based on &#39;Email&#39; column</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">([</span><span class="s2">&#34;Email&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Remove duplicates based on both &#39;Phone&#39; and &#39;Email&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">([</span><span class="s2">&#34;Phone&#34;</span><span class="p">,</span> <span class="s2">&#34;Email&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="6-counting-distinct-values">6. Counting Distinct Values</h3>
<p>You can count distinct values in a particular column, or combinations of columns:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Count distinct values in the &#39;Department&#39; column</span>
</span></span><span class="line"><span class="cl"><span class="n">distinct_count_department</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Department&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Distinct Department Count:&#34;</span><span class="p">,</span> <span class="n">distinct_count_department</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Count distinct combinations of &#39;Department&#39; and &#39;Performance_Rating&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">distinct_combinations_count</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Department&#34;</span><span class="p">,</span> <span class="s2">&#34;Performance_Rating&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Distinct Department and Performance Rating Combinations:&#34;</span><span class="p">,</span> <span class="n">distinct_combinations_count</span><span class="p">)</span></span></span></code></pre></div>
<p>This set of operations will help you efficiently manage and transform your data in PySpark, ensuring data integrity and accuracy for your analysis!</p>
<h3 id="mastering-pyspark-dataframe-operations">Mastering PySpark DataFrame Operations</h3>
<ol>
<li><strong>Changing Data Types</strong>: Easily modify column types using <code>.cast()</code>. E.g., change &lsquo;Salary&rsquo; to double or &lsquo;Phone&rsquo; to string for better data handling.</li>
<li><strong>Filtering Data</strong>: Use <code>.filter()</code> or <code>.where()</code> to extract specific rows. For example, filter employees with a salary over 50,000 or non-null Age.</li>
<li><strong>Multiple Conditions</strong>: Chain filters with <code>&amp;</code> and <code>|</code> to apply complex conditions, such as finding employees over 30 in the IT department.</li>
<li><strong>Handling NULLs</strong>: Use <code>.isNull()</code> and <code>.isNotNull()</code> to filter rows with missing or available values, such as missing addresses or valid emails.</li>
<li><strong>Unique/Distinct Values</strong>: Use <code>.distinct()</code> to get unique rows or distinct values in a column. Remove duplicates based on specific fields like Email or Phone using <code>.dropDuplicates()</code>.</li>
<li><strong>Count Distinct Values</strong>: Count distinct values in one or multiple columns to analyze data diversity, such as counting unique departments or combinations of Department and Performance_Rating.</li>
</ol>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="functions">Functions</h1>

<h2 id="sorting-and-string-functions">Sorting and String Functions</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">asc</span><span class="p">,</span> <span class="n">concat</span><span class="p">,</span> <span class="n">concat_ws</span><span class="p">,</span> <span class="n">initcap</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">instr</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">lit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;SortingAndStringFunctions&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="s2">&#34;USA&#34;</span><span class="p">,</span> <span class="s2">&#34;North America&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">50.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="s2">&#34;India&#34;</span><span class="p">,</span> <span class="s2">&#34;Asia&#34;</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="s2">&#34;Germany&#34;</span><span class="p">,</span> <span class="s2">&#34;Europe&#34;</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="s2">&#34;Australia&#34;</span><span class="p">,</span> <span class="s2">&#34;Oceania&#34;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="s2">&#34;Japan&#34;</span><span class="p">,</span> <span class="s2">&#34;Asia&#34;</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="s2">&#34;Brazil&#34;</span><span class="p">,</span> <span class="s2">&#34;South America&#34;</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the schema</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Country&#34;</span><span class="p">,</span> <span class="s2">&#34;Region&#34;</span><span class="p">,</span> <span class="s2">&#34;UnitsSold&#34;</span><span class="p">,</span> <span class="s2">&#34;UnitPrice&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the original DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="sorting-the-dataframe">Sorting the DataFrame</h3>
<h3 id="1-sort-by-a-single-column-ascending-order">1. Sort by a single column (ascending order)</h3>
<p><code>df.orderBy(&quot;Country&quot;).show(5)</code></p>
<blockquote>
<p>By default, sorting is ascending. This shows the first 5 countries alphabetically.</p></blockquote>
<h3 id="2-sort-by-multiple-columns">2. Sort by multiple columns</h3>
<p><code>df.orderBy(&quot;Country&quot;, &quot;UnitsSold&quot;).show(5)</code></p>
<blockquote>
<p>First sorts by <code>Country</code>, then within each country sorts by <code>UnitsSold</code>.</p></blockquote>
<h3 id="3-sort-by-column-in-descending-order-and-limit">3. Sort by column in descending order and limit</h3>
<p><code>df.orderBy(desc(&quot;Country&quot;)).limit(3).show(5)</code></p>
<blockquote>
<p>Sorts by <code>Country</code> in descending order and returns the top 3 rows.</p></blockquote>
<h3 id="4-sorting-with-null-values-last">4. Sorting with null values last</h3>
<p><code>df.orderBy(col(&quot;Country&quot;).desc(), nulls_last=True).show(5)</code></p>
<blockquote>
<p>Ensures null values appear at the end when sorting.</p></blockquote>
<p><strong>Key Functions:</strong></p>
<ul>
<li>
<p>Use <code>.orderBy()</code> or <code>.sort()</code> to sort DataFrames.</p>
</li>
<li>
<p>Control order with <code>asc()</code> or <code>desc()</code>.</p>
</li>
</ul>
<hr>
<h2 id="string-functions">String Functions</h2>
<h3 id="1-capitalize-first-letter-of-each-word">1. Capitalize first letter of each word</h3>
<p><code>df.select(initcap(col(&quot;Country&quot;))).show()</code></p>
<blockquote>
<p>Converts <code>&quot;united states&quot;</code> → <code>&quot;United States&quot;</code>.</p></blockquote>
<h3 id="2-convert-all-text-to-lowercase">2. Convert all text to lowercase</h3>
<p><code>df.select(lower(col(&quot;Country&quot;))).show()</code></p>
<h3 id="3-convert-all-text-to-uppercase">3. Convert all text to uppercase</h3>
<p><code>df.select(upper(col(&quot;Country&quot;))).show()</code></p>
<p><strong>Key Functions:</strong></p>
<ul>
<li>
<p><code>initcap()</code> → Capitalize first letter of each word.</p>
</li>
<li>
<p><code>lower()</code> → Convert to lowercase.</p>
</li>
<li>
<p><code>upper()</code> → Convert to uppercase.</p>
</li>
</ul>
<hr>
<h2 id="concatenation-functions">Concatenation Functions</h2>
<h3 id="1-concatenate-two-columns">1. Concatenate two columns</h3>
<p><code>df.select(concat(col(&quot;Region&quot;), col(&quot;Country&quot;))).show()</code></p>
<blockquote>
<p>Joins <code>Region</code> and <code>Country</code> without separator.</p></blockquote>
<h3 id="2-concatenate-with-a-separator">2. Concatenate with a separator</h3>
<p><code>df.select(concat_ws(&quot; | &quot;, col(&quot;Region&quot;), col(&quot;Country&quot;))).show()</code></p>
<blockquote>
<p>Joins with <code>&quot; | &quot;</code> as separator.</p></blockquote>
<h3 id="3-create-a-new-concatenated-column">3. Create a new concatenated column</h3>
<p><code>df.withColumn(&quot;concatenated&quot;, concat(df[&quot;Region&quot;], lit(&quot; &quot;), df[&quot;Country&quot;])).show()</code></p>
<blockquote>
<p>Adds a new column combining <code>Region</code> and <code>Country</code>.</p></blockquote>
<p><strong>Key Functions:</strong></p>
<ul>
<li>
<p><code>concat()</code> → Join columns directly.</p>
</li>
<li>
<p><code>concat_ws()</code> → Join columns with a separator.</p>
</li>
</ul>
<hr>
<h3 id="-summary">📌 Summary</h3>
<ul>
<li><strong>Sorting:</strong> Use <code>.orderBy()</code> or <code>.sort()</code> with <code>asc()</code> / <code>desc()</code>.</li>
<li><strong>String Manipulation:</strong> Use <code>initcap()</code>, <code>lower()</code>, <code>upper()</code>.</li>
<li><strong>Concatenation:</strong> Use <code>concat()</code> or <code>concat_ws()</code> for flexible joins.</li>
</ul>
<hr>
<h2 id="split-function-in-dataframe">Split Function in DataFrame</h2>
<p>Let’s create a PySpark DataFrame for employee data with columns such as <strong>EmployeeID, Name, Department, and Skills</strong>. We’ll explore <code>split</code>, <code>explode</code>, and other useful array functions.</p>
<h3 id="sample-data-creation-for-employee-data">Sample Data Creation for Employee Data</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">split</span><span class="p">,</span> <span class="n">explode</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">array_contains</span><span class="p">,</span> <span class="n">col</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample employee data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;HR&#34;</span><span class="p">,</span> <span class="s2">&#34;Communication Management&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;IT&#34;</span><span class="p">,</span> <span class="s2">&#34;Programming Networking&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Finance&#34;</span><span class="p">,</span> <span class="s2">&#34;Accounting Analysis&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&#34;David&#34;</span><span class="p">,</span> <span class="s2">&#34;HR&#34;</span><span class="p">,</span> <span class="s2">&#34;Recruiting Communication&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;Eve&#34;</span><span class="p">,</span> <span class="s2">&#34;IT&#34;</span><span class="p">,</span> <span class="s2">&#34;Cloud DevOps&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the schema</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;EmployeeID&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Department&#34;</span><span class="p">,</span> <span class="s2">&#34;Skills&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the original DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div>
<h3 id="examples">Examples</h3>
<h3 id="1-split-the-skills-column">1. Split the <code>Skills</code> column</h3>
<p><code>df.select(col(&quot;EmployeeID&quot;), col(&quot;Name&quot;), split(col(&quot;Skills&quot;), &quot; &quot;).alias(&quot;Skills_Array&quot;)).show(truncate=False)</code></p>
<blockquote>
<p>Splits the <code>Skills</code> column into an array of skills using space as a delimiter.</p></blockquote>
<hr>
<h3 id="2-select-the-first-skill-from-skills_array">2. Select the first skill from <code>Skills_Array</code></h3>
<p><code>df2.select(col(&quot;EmployeeID&quot;), col(&quot;Name&quot;), col(&quot;Skills_Array&quot;)[0].alias(&quot;First_Skill&quot;)).show(truncate=False)</code></p>
<blockquote>
<p>Uses index notation (<code>Skills_Array[0]</code>) to pick the first skill. Indexing starts from <strong>0</strong>.</p></blockquote>
<hr>
<h3 id="3-count-the-number-of-skills-per-employee">3. Count the number of skills per employee</h3>
<p><code>df2.select(col(&quot;EmployeeID&quot;), col(&quot;Name&quot;), size(col(&quot;Skills_Array&quot;)).alias(&quot;Number_of_Skills&quot;)).show(truncate=False)</code></p>
<blockquote>
<p>The <code>size()</code> function returns the number of elements in the array.</p></blockquote>
<hr>
<h3 id="4-check-if-the-employee-has-cloud-skill">4. Check if the employee has &ldquo;Cloud&rdquo; skill</h3>
<p><code>df.select(col(&quot;EmployeeID&quot;), col(&quot;Name&quot;), array_contains(split(col(&quot;Skills&quot;), &quot; &quot;), &quot;Cloud&quot;).alias(&quot;Has_Cloud_Skill&quot;)).show(truncate=False)</code>
`</p>
<blockquote>
<p><code>array_contains()</code> returns <strong>True</strong> if <code>&quot;Cloud&quot;</code> exists in the skill set.</p></blockquote>
<hr>
<h3 id="5-explode-the-skills_array-into-multiple-rows">5. Explode the <code>Skills_Array</code> into multiple rows</h3>
<p><code>df3 = df2.withColumn(&quot;Skill&quot;, explode(col(&quot;Skills_Array&quot;)))</code></p>
<p><code>df3.select(&quot;EmployeeID&quot;, &quot;Name&quot;, &quot;Skill&quot;).show(truncate=False)</code></p>
<blockquote>
<p><code>explode()</code> flattens the array into rows, where each skill becomes a separate row for that employee.</p></blockquote>
<hr>
<h3 id="-summary-of-key-functions">📌 Summary of Key Functions</h3>
<ul>
<li><strong>split()</strong> → Splits a string into an array.</li>
<li><strong>explode()</strong> → Converts an array into multiple rows.</li>
<li><strong>size()</strong> → Counts elements in an array.</li>
<li><strong>array_contains()</strong> → Checks if an array contains a value.</li>
<li><strong>selectExpr()</strong> → Lets you query arrays using SQL expressions like <code>Skills_Array[0]</code>.</li>
</ul>
<hr>
<hr>
<h2 id="trim-function-in-dataframe">Trim Function in DataFrame</h2>
<p>Let’s create a sample dataset for employees and demonstrate string trimming and padding functions in PySpark:</p>
<ul>
<li><code>ltrim()</code></li>
<li><code>rtrim()</code></li>
<li><code>trim()</code></li>
<li><code>lpad()</code></li>
<li><code>rpad()</code></li>
</ul>
<hr>
<h3 id="sample-data-creation-for-employees">Sample Data Creation for Employees</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">lit</span><span class="p">,</span> <span class="n">ltrim</span><span class="p">,</span> <span class="n">rtrim</span><span class="p">,</span> <span class="n">rpad</span><span class="p">,</span> <span class="n">lpad</span><span class="p">,</span> <span class="n">trim</span><span class="p">,</span> <span class="n">col</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample employee data with leading and trailing spaces in the &#39;Name&#39; column</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34; Alice   &#34;</span><span class="p">,</span> <span class="s2">&#34;HR&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;  Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;IT&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;Charlie  &#34;</span><span class="p">,</span> <span class="s2">&#34;Finance&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&#34;  David &#34;</span><span class="p">,</span> <span class="s2">&#34;HR&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;Eve  &#34;</span><span class="p">,</span> <span class="s2">&#34;IT&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the schema for the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;EmployeeID&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Department&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the original DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div>
<h3 id="applying-trimming-and-padding-functions">Applying Trimming and Padding Functions</h3>
<h3 id="1-trimming-functions">1. Trimming Functions</h3>
<ul>
<li>
<p><strong><code>ltrim()</code></strong> → Removes leading spaces.</p>
</li>
<li>
<p><strong><code>rtrim()</code></strong> → Removes trailing spaces.</p>
</li>
<li>
<p><strong><code>trim()</code></strong> → Removes both leading and trailing spaces.</p>
</li>
</ul>
<h3 id="2-padding-functions">2. Padding Functions</h3>
<ul>
<li>
<p><strong><code>lpad()</code></strong> → Pads the left side of a string with a character up to a given length.</p>
</li>
<li>
<p><strong><code>rpad()</code></strong> → Pads the right side of a string with a character up to a given length.</p>
</li>
</ul>
<hr>
<h3 id="example">Example</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Apply trimming and padding functions</span>
</span></span><span class="line"><span class="cl"><span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span><span class="p">(</span><span class="s2">&#34;EmployeeID&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span><span class="p">(</span><span class="s2">&#34;Department&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">ltrim</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;ltrim_Name&#34;</span><span class="p">),</span>   <span class="c1"># Remove leading spaces</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtrim</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;rtrim_Name&#34;</span><span class="p">),</span>   <span class="c1"># Remove trailing spaces</span>
</span></span><span class="line"><span class="cl">    <span class="n">trim</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;trim_Name&#34;</span><span class="p">),</span>     <span class="c1"># Remove both leading &amp; trailing spaces</span>
</span></span><span class="line"><span class="cl">    <span class="n">lpad</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&#34;X&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;lpad_Name&#34;</span><span class="p">),</span>  <span class="c1"># Left pad with &#34;X&#34; to length 10</span>
</span></span><span class="line"><span class="cl">    <span class="n">rpad</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&#34;Y&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;rpad_Name&#34;</span><span class="p">)</span>   <span class="c1"># Right pad with &#34;Y&#34; to length 10</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the resulting DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">result_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div>
<hr>
<h3 id="output-explanation">Output Explanation</h3>
<ul>
<li>
<p><strong><code>ltrim_Name</code></strong> → Leading spaces removed.</p>
</li>
<li>
<p><strong><code>rtrim_Name</code></strong> → Trailing spaces removed.</p>
</li>
<li>
<p><strong><code>trim_Name</code></strong> → Both leading &amp; trailing spaces removed.</p>
</li>
<li>
<p><strong><code>lpad_Name</code></strong> → Padded left with <code>&quot;X&quot;</code> until length = 10.</p>
</li>
<li>
<p><strong><code>rpad_Name</code></strong> → Padded right with <code>&quot;Y&quot;</code> until length = 10.</p>
</li>
</ul>
<hr>
<h3 id="-summary-1">📌 Summary</h3>
<ul>
<li>Use <strong>trim functions</strong> (<code>ltrim</code>, <code>rtrim</code>, <code>trim</code>) to clean up unwanted spaces.</li>
<li>Use <strong>padding functions</strong> (<code>lpad</code>, <code>rpad</code>) to format strings with fixed lengths.</li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="date-functions">Date Functions</h1>

<p>In PySpark, you can use various date functions to manipulate and analyze date and timestamp columns.<br>
We’ll explore:</p>
<ul>
<li><code>current_date</code></li>
<li><code>current_timestamp</code></li>
<li><code>date_add</code></li>
<li><code>date_sub</code></li>
<li><code>datediff</code></li>
<li><code>months_between</code></li>
</ul>
<hr>
<h3 id="sample-code">Sample Code</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">current_date</span><span class="p">,</span> <span class="n">current_timestamp</span><span class="p">,</span> <span class="n">date_add</span><span class="p">,</span> <span class="n">date_sub</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">datediff</span><span class="p">,</span> <span class="n">months_between</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">lit</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Generate a DataFrame with 10 rows, adding &#34;today&#34; and &#34;now&#34; columns</span>
</span></span><span class="line"><span class="cl"><span class="n">dateDF</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;today&#34;</span><span class="p">,</span> <span class="n">current_date</span><span class="p">())</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;now&#34;</span><span class="p">,</span> <span class="n">current_timestamp</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the DataFrame with today and now columns</span>
</span></span><span class="line"><span class="cl"><span class="n">dateDF</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div>
<h3 id="key-functions">Key Functions</h3>
<ul>
<li><strong><code>current_date()</code></strong> → Returns current date.</li>
<li><strong><code>current_timestamp()</code></strong> → Returns current timestamp (date + time).</li>
<li><strong><code>date_sub(col(&quot;today&quot;), 5)</code></strong> → Subtracts 5 days.</li>
<li><strong><code>date_add(col(&quot;today&quot;), 5)</code></strong> → Adds 5 days.</li>
<li><strong><code>datediff(date1, date2)</code></strong> → Returns difference in days.</li>
<li><strong><code>months_between(date1, date2)</code></strong> → Returns difference in months.</li>
</ul>
<hr>
<p>Working with dates and timestamps often requires converting formats and extracting components.<br>
We’ll explore:</p>
<ul>
<li><code>to_date</code></li>
<li><code>to_timestamp</code></li>
<li><code>year</code>, <code>month</code>, <code>dayofmonth</code></li>
<li><code>hour</code>, <code>minute</code>, <code>second</code></li>
</ul>
<hr>
<h3 id="1-to_date">1. to_date</h3>
<ul>
<li>Converts a string to a date (default format: <code>yyyy-MM-dd</code>).</li>
<li>If format doesn’t match, returns <strong>null</strong>.</li>
<li>Example:
<code>to_date(lit(&quot;2017-12-11&quot;), &quot;yyyy-dd-MM&quot;)</code></li>
</ul>
<h3 id="2-to_timestamp">2. to_timestamp</h3>
<ul>
<li>Converts a string with date &amp; time into a timestamp.</li>
<li>Allows extraction of time components.</li>
</ul>
<h3 id="3-extracting-components">3. Extracting Components</h3>
<ul>
<li><strong>year()</strong> → Extracts year.</li>
<li><strong>month()</strong> → Extracts month.</li>
<li><strong>dayofmonth()</strong> → Extracts day.</li>
<li><strong>hour()</strong> → Extracts hour.</li>
<li><strong>minute()</strong> → Extracts minute.</li>
<li><strong>second()</strong> → Extracts second.</li>
</ul>
<h3 id="example-output">Example Output</h3>
<p>For input <code>&quot;2017-12-11&quot;</code> (format <code>yyyy-dd-MM</code>):</p>
<ul>
<li>Year: <strong>2017</strong></li>
<li>Month: <strong>12</strong></li>
<li>Day: <strong>11</strong></li>
<li>Hour: <strong>0</strong></li>
<li>Minute: <strong>0</strong></li>
<li>Second: <strong>0</strong></li>
</ul>
<p>For invalid input (e.g., <code>&quot;2017-20-12&quot;</code>):</p>
<ul>
<li>Result: <strong>null</strong></li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="handling-nulls">Handling Nulls</h1>

<h2 id="sample-sales-data-with-null-values">Sample Sales Data with Null Values</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Sample data: sales data with nulls</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;John&#34;</span><span class="p">,</span> <span class="s2">&#34;North&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Doe&#34;</span><span class="p">,</span> <span class="s2">&#34;East&#34;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&#34;West&#34;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;South&#34;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Region&#34;</span><span class="p">,</span> <span class="s2">&#34;UnitsSold&#34;</span><span class="p">,</span> <span class="s2">&#34;Revenue&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="1-detecting-null-values">1. Detecting Null Values</h3>
<ul>
<li>Use <strong><code>isNull()</code></strong> to identify rows where a column contains null values.</li>
<li>The output is a boolean flag indicating whether the value is null.</li>
</ul>
<h3 id="2-dropping-rows-with-null-values">2. Dropping Rows with Null Values</h3>
<ul>
<li><strong><code>dropna()</code></strong> removes rows with nulls in any column (default mode).</li>
<li>Use <strong><code>how=&quot;all&quot;</code></strong> to remove rows only if <em>all</em> columns are null.</li>
<li>Use <strong><code>subset=[&quot;col1&quot;, &quot;col2&quot;]</code></strong> to target specific columns.</li>
</ul>
<h3 id="3-filling-null-values">3. Filling Null Values</h3>
<ul>
<li><strong><code>fillna()</code></strong> replaces nulls with specified default values.</li>
<li>Replace across all columns or selectively.</li>
<li>Example:
<ul>
<li>Replace <code>Region</code> nulls with <code>&quot;Unknown&quot;</code>.</li>
<li>Replace <code>UnitsSold</code> and <code>Revenue</code> nulls with <code>0</code>.</li>
</ul>
</li>
</ul>
<h3 id="4-coalesce-function">4. Coalesce Function</h3>
<ul>
<li><strong><code>coalesce()</code></strong> returns the first non-null value among multiple columns.</li>
<li>Useful when providing fallback values if some columns contain nulls.</li>
</ul>
<h3 id="5-handling-nulls-in-aggregations">5. Handling Nulls in Aggregations</h3>
<ul>
<li>Nulls can distort aggregations like <code>mean()</code>.</li>
<li>Use <strong><code>coalesce()</code></strong> to substitute nulls with defaults (e.g., <code>0.0</code>).</li>
<li>This prevents inaccurate results.</li>
</ul>
<h3 id="-summary">📌 Summary</h3>
<ol>
<li><strong>Detecting Nulls</strong>: Use <code>isNull()</code> to find null values.</li>
<li><strong>Dropping Nulls</strong>: Use <code>dropna()</code> to remove rows with nulls (all or specific columns).</li>
<li><strong>Filling Nulls</strong>: Use <code>fillna()</code> to replace nulls with defaults.</li>
<li><strong>Coalesce Function</strong>: Use <code>coalesce()</code> to return the first non-null value.</li>
<li><strong>Aggregations</strong>: Use <code>coalesce()</code> in aggregations to handle nulls safely.</li>
</ol>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="aggregate-functions">Aggregate functions</h1>

<h2 id="basic-aggregate-functions">Basic Aggregate Functions</h2>
<h3 id="sample-data">Sample Data</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="aggregate-functions-in-pyspark">Aggregate Functions in PySpark</h3>
<ol>
<li><strong>Summation (<code>sum</code>)</strong> – Adds up the values in a column.</li>
<li><strong>Average (<code>avg</code>)</strong> – Computes the average of values in a column.</li>
<li><strong>Count (<code>count</code>)</strong> – Counts the number of non-null values in a column.</li>
<li><strong>Maximum (<code>max</code>) / Minimum (<code>min</code>)</strong> – Finds the highest and lowest values.</li>
<li><strong>Distinct Count (<code>countDistinct</code>)</strong> – Counts unique values in a column.</li>
</ol>
<h3 id="notes">Notes</h3>
<ul>
<li>
<p><strong>Handling Nulls</strong>:</p>
<ul>
<li><code>count()</code> counts only <strong>non-null</strong> values.</li>
<li><code>sum()</code>, <code>avg()</code>, <code>max()</code>, and <code>min()</code> ignore null values.</li>
</ul>
</li>
<li>
<p><strong>Performance</strong>:<br>
Aggregate functions can be expensive on large datasets; partitioning improves performance.</p>
</li>
<li>
<p><strong>Use Cases</strong>:</p>
<ul>
<li><strong>Summation</strong>: Total sales, total revenue.</li>
<li><strong>Average</strong>: Average sales per day.</li>
<li><strong>Count</strong>: Number of transactions.</li>
<li><strong>Max/Min</strong>: Highest and lowest values (e.g., max sales in a day).</li>
<li><strong>Distinct Count</strong>: Unique customers, unique products.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="advanced-aggregation-functions">Advanced Aggregation Functions</h2>
<h3 id="sample-data-1">Sample Data</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">IntegerType</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;AggregationExamples&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;HR&#34;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&#34;John&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Finance&#34;</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="s2">&#34;Doe&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;HR&#34;</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&#34;Alice&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Finance&#34;</span><span class="p">,</span> <span class="mi">25000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="s2">&#34;Eve&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;HR&#34;</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="s2">&#34;Mark&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define schema</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;department&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;salary&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;bonus&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;employee_name&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="1-grouped-aggregation">1. Grouped Aggregation</h3>
<p>Perform aggregation within groups based on a column.</p>
<ul>
<li><strong><code>sum()</code></strong> → Adds values within the group.</li>
<li><strong><code>avg()</code></strong> → Computes group average.</li>
<li><strong><code>max()</code></strong> → Finds maximum value.</li>
<li><strong><code>min()</code></strong> → Finds minimum value.</li>
</ul>
<h3 id="2-multiple-aggregations">2. Multiple Aggregations</h3>
<p>Perform several aggregations in one step.</p>
<ul>
<li><strong><code>count()</code></strong> → Number of rows in each group.</li>
<li><strong><code>avg()</code></strong> → Average of values.</li>
<li><strong><code>max()</code></strong> → Maximum value in group.</li>
</ul>
<h3 id="3-concatenate-strings">3. Concatenate Strings</h3>
<ul>
<li><strong><code>concat_ws()</code></strong> → Concatenates string values within a column, separated by a delimiter (<code>,</code>).</li>
</ul>
<h3 id="4-first-and-last">4. First and Last</h3>
<ul>
<li><strong><code>first()</code></strong> → Retrieves the first value of a column in a group.</li>
<li><strong><code>last()</code></strong> → Retrieves the last value of a column in a group.</li>
</ul>
<h3 id="5-standard-deviation-and-variance">5. Standard Deviation and Variance</h3>
<ul>
<li><strong><code>stddev()</code></strong> → Standard deviation of values.</li>
<li><strong><code>variance()</code></strong> → Variance of values.</li>
</ul>
<h3 id="6-aggregation-with-alias">6. Aggregation with Alias</h3>
<ul>
<li><strong><code>.alias()</code></strong> → Rename the result columns after aggregation.</li>
</ul>
<h3 id="7-sum-of-distinct-values">7. Sum of Distinct Values</h3>
<ul>
<li><strong><code>sumDistinct()</code></strong> → Sums only <strong>unique values</strong> in a column (avoids double-counting duplicates).</li>
</ul>
<h3 id="-summary">📌 Summary</h3>
<ul>
<li>
<p>Use basic aggregations (<code>sum</code>, <code>avg</code>, <code>count</code>, <code>max</code>, <code>min</code>, <code>countDistinct</code>) for general metrics.</p>
</li>
<li>
<p>Apply advanced aggregations (<code>grouped</code>, <code>concat_ws</code>, <code>first</code>, <code>last</code>, <code>stddev</code>, <code>variance</code>, <code>sumDistinct</code>) for deeper analysis.</p>
</li>
<li>
<p>Always consider <strong>null handling</strong> and <strong>performance optimizations</strong> when using aggregate functions in PySpark.</p>
</li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="joins">Joins</h1>

<h2 id="joins-in-pyspark">Joins in PySpark</h2>
<p>In PySpark Joins are used to combine two DataFrames based on a common column or condition.</p>
<hr>
<h3 id="types-of-joins-in-pyspark">Types of Joins in PySpark</h3>
<ul>
<li><strong>Inner Join</strong>: Matches rows from both DataFrames.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;inner&#34;</span><span class="p">)</span></span></span></code></pre></div>
<ul>
<li><strong>Left/Right Join</strong>: Keeps all rows from the left or right DataFrame and matches where possible.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;left&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;right&#34;</span><span class="p">)</span></span></span></code></pre></div>
<ul>
<li><strong>Full Join</strong>: Keeps all rows from both DataFrames.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;outer&#34;</span><span class="p">)</span></span></span></code></pre></div>
<ul>
<li><strong>Left Semi</strong>: Filters <code>df1</code> to rows that match <code>df2</code> without including columns from <code>df2</code>.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;left_semi&#34;</span><span class="p">)</span> </span></span></code></pre></div>
<ul>
<li><strong>Left Anti</strong>: Filters <code>df1</code> to rows that do not match <code>df2</code>.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;left_anti&#34;</span><span class="p">)</span></span></span></code></pre></div>
<ul>
<li><strong>Cross Join</strong>: Returns the Cartesian product, combining all rows of both DataFrames.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">crossJoin</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span></span></span></code></pre></div>
<ul>
<li><strong>Explicit Condition Join</strong>: Allows complex join conditions, including columns with different names.</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">columnA</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">columnB</span><span class="p">,</span> <span class="s2">&#34;inner&#34;</span><span class="p">)</span></span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;inner&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;left&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;right&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;outer&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;left_semi&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">common_column</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">common_column</span><span class="p">,</span> <span class="s2">&#34;left_anti&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">crossJoin</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">columnA</span> <span class="o">==</span> <span class="n">df2</span><span class="o">.</span><span class="n">columnB</span><span class="p">,</span> <span class="s2">&#34;inner&#34;</span><span class="p">)</span></span></span></code></pre></div>
<hr>
<h3 id="practice-1">Practice-1</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">broadcast</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Initialize Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;JoinsExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample DataFrames</span>
</span></span><span class="line"><span class="cl"><span class="n">data1</span> <span class="o">=</span> <span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span> <span class="o">=</span> <span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Inner Join</span>
</span></span><span class="line"><span class="cl"><span class="n">inner_join</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;inner&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Inner Join:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">inner_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Right Join</span>
</span></span><span class="line"><span class="cl"><span class="n">right_join</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;right&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Right Join:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">right_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Full (Outer) Join</span>
</span></span><span class="line"><span class="cl"><span class="n">full_join</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;outer&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Full (Outer) Join:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">full_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Left Anti Join</span>
</span></span><span class="line"><span class="cl"><span class="n">left_anti_join</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;left_anti&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Left Anti Join:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">left_anti_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Right Anti Join (Equivalent to swapping DataFrames and performing Left Anti Join)</span>
</span></span><span class="line"><span class="cl"><span class="n">right_anti_join</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;left_anti&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Right Anti Join:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">right_anti_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Broadcast Join (Optimizing a join with a smaller DataFrame)</span>
</span></span><span class="line"><span class="cl"><span class="n">broadcast_join</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">broadcast</span><span class="p">(</span><span class="n">df2</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s2">&#34;id&#34;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&#34;inner&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Broadcast Join:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">broadcast_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<hr>
<h3 id="practice-2">Practice 2</h3>
<h4 id="pyspark-coding-questions">PySpark Coding Questions</h4>
<ol>
<li>
<p><strong>Find employees whose location matches the location of their department</strong></p>
<ul>
<li>Display: <code>emp_id</code>, <code>emp_name</code>, <code>emp_location</code>, <code>dept_name</code>, <code>dept_location</code>.</li>
</ul>
</li>
<li>
<p><strong>Find departments that have no employees assigned to them</strong></p>
<ul>
<li>Display: <code>dept_id</code>, <code>dept_name</code>, <code>dept_head</code>.</li>
</ul>
</li>
<li>
<p><strong>Get the average salary of employees in each department</strong></p>
<ul>
<li>Display: <code>dept_name</code>, <code>average_salary</code>.</li>
</ul>
</li>
<li>
<p><strong>List the employees who earn more than the average salary of their department</strong></p>
<ul>
<li>Display: <code>emp_id</code>, <code>emp_name</code>, <code>emp_salary</code>, <code>dept_name</code>, <code>dept_location</code>.</li>
</ul>
</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Sample DataFrames</span>
</span></span><span class="line"><span class="cl"><span class="n">emp_data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="n">emp_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">emp_name</span><span class="o">=</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="n">emp_salary</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">emp_dept_id</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">emp_location</span><span class="o">=</span><span class="s2">&#34;New York&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="n">emp_id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">emp_name</span><span class="o">=</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="n">emp_salary</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span> <span class="n">emp_dept_id</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span> <span class="n">emp_location</span><span class="o">=</span><span class="s2">&#34;Los Angeles&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="n">emp_id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">emp_name</span><span class="o">=</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="n">emp_salary</span><span class="o">=</span><span class="mi">55000</span><span class="p">,</span> <span class="n">emp_dept_id</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">emp_location</span><span class="o">=</span><span class="s2">&#34;Chicago&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="n">emp_id</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">emp_name</span><span class="o">=</span><span class="s2">&#34;David&#34;</span><span class="p">,</span> <span class="n">emp_salary</span><span class="o">=</span><span class="mi">70000</span><span class="p">,</span> <span class="n">emp_dept_id</span><span class="o">=</span><span class="mi">103</span><span class="p">,</span> <span class="n">emp_location</span><span class="o">=</span><span class="s2">&#34;San Francisco&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="n">emp_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">emp_name</span><span class="o">=</span><span class="s2">&#34;Eve&#34;</span><span class="p">,</span> <span class="n">emp_salary</span><span class="o">=</span><span class="mi">48000</span><span class="p">,</span> <span class="n">emp_dept_id</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span> <span class="n">emp_location</span><span class="o">=</span><span class="s2">&#34;Houston&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dept_data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="n">dept_id</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">dept_name</span><span class="o">=</span><span class="s2">&#34;Engineering&#34;</span><span class="p">,</span> <span class="n">dept_head</span><span class="o">=</span><span class="s2">&#34;John&#34;</span><span class="p">,</span> <span class="n">dept_location</span><span class="o">=</span><span class="s2">&#34;New York&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="n">dept_id</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span> <span class="n">dept_name</span><span class="o">=</span><span class="s2">&#34;Marketing&#34;</span><span class="p">,</span> <span class="n">dept_head</span><span class="o">=</span><span class="s2">&#34;Mary&#34;</span><span class="p">,</span> <span class="n">dept_location</span><span class="o">=</span><span class="s2">&#34;Los Angeles&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Row</span><span class="p">(</span><span class="n">dept_id</span><span class="o">=</span><span class="mi">103</span><span class="p">,</span> <span class="n">dept_name</span><span class="o">=</span><span class="s2">&#34;Finance&#34;</span><span class="p">,</span> <span class="n">dept_head</span><span class="o">=</span><span class="s2">&#34;Frank&#34;</span><span class="p">,</span> <span class="n">dept_location</span><span class="o">=</span><span class="s2">&#34;Chicago&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emp_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;emp_id&#34;</span><span class="p">,</span> <span class="s2">&#34;emp_name&#34;</span><span class="p">,</span> <span class="s2">&#34;emp_salary&#34;</span><span class="p">,</span> <span class="s2">&#34;emp_dept_id&#34;</span><span class="p">,</span> <span class="s2">&#34;emp_location&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">dept_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;dept_id&#34;</span><span class="p">,</span> <span class="s2">&#34;dept_name&#34;</span><span class="p">,</span> <span class="s2">&#34;dept_head&#34;</span><span class="p">,</span> <span class="s2">&#34;dept_location&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emp_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">emp_data</span><span class="p">,</span> <span class="n">emp_columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dept_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">dept_data</span><span class="p">,</span> <span class="n">dept_columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display emp data</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;emp_data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">emp_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display dept data</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;dept_data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dept_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Inner Join on emp_dept_id and dept_id</span>
</span></span><span class="line"><span class="cl"><span class="n">inner_join</span> <span class="o">=</span> <span class="n">emp_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dept_df</span><span class="p">,</span> <span class="n">emp_df</span><span class="p">[</span><span class="s2">&#34;emp_dept_id&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dept_df</span><span class="p">[</span><span class="s2">&#34;dept_id&#34;</span><span class="p">],</span> <span class="s2">&#34;inner&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the result</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Inner Join Result:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">inner_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Inner Join with Filtering Columns and WHERE Condition</span>
</span></span><span class="line"><span class="cl"><span class="n">inner_join</span> <span class="o">=</span> <span class="n">emp_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dept_df</span><span class="p">,</span> <span class="n">emp_df</span><span class="p">[</span><span class="s2">&#34;emp_dept_id&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dept_df</span><span class="p">[</span><span class="s2">&#34;dept_id&#34;</span><span class="p">],</span> <span class="s2">&#34;inner&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;emp_id&#34;</span><span class="p">,</span> <span class="s2">&#34;emp_name&#34;</span><span class="p">,</span> <span class="s2">&#34;emp_salary&#34;</span><span class="p">,</span> <span class="s2">&#34;dept_name&#34;</span><span class="p">,</span> <span class="s2">&#34;dept_location&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&#34;emp_salary &gt; 55000&#34;</span><span class="p">)</span>  <span class="c1"># Add a WHERE condition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the result</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Inner Join with Filter and WHERE Condition:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">inner_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Left Join with Filtering Columns and WHERE Condition</span>
</span></span><span class="line"><span class="cl"><span class="n">left_join_filtered</span> <span class="o">=</span> <span class="n">emp_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dept_df</span><span class="p">,</span> <span class="n">emp_df</span><span class="p">[</span><span class="s2">&#34;emp_dept_id&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dept_df</span><span class="p">[</span><span class="s2">&#34;dept_id&#34;</span><span class="p">],</span> <span class="s2">&#34;left&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;emp_id&#34;</span><span class="p">,</span> <span class="s2">&#34;emp_name&#34;</span><span class="p">,</span> <span class="s2">&#34;dept_name&#34;</span><span class="p">,</span> <span class="s2">&#34;dept_location&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&#34;emp_salary &gt; 55000&#34;</span><span class="p">)</span>  <span class="c1"># Add a WHERE condition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the result</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Left Join with Filter and WHERE Condition:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">left_join_filtered</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Left Anti Join</span>
</span></span><span class="line"><span class="cl"><span class="n">left_anti_join</span> <span class="o">=</span> <span class="n">emp_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">dept_df</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">emp_df</span><span class="p">[</span><span class="s2">&#34;emp_dept_id&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dept_df</span><span class="p">[</span><span class="s2">&#34;dept_id&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;left_anti&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the result</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Left Anti Join Result:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">left_anti_join</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<hr>
<h3 id="practice-3">Practice 3</h3>
<h4 id="pyspark-coding-questions-1">PySpark Coding Questions</h4>
<ol>
<li>
<p><strong>List each employee along with their manager&rsquo;s name</strong></p>
<ul>
<li>Display: <code>employee</code>, <code>manager</code>.</li>
</ul>
</li>
<li>
<p><strong>Find employees who do not have a manager (CEO-level employees)</strong></p>
<ul>
<li>Display: <code>employee</code>, <code>manager</code>.</li>
</ul>
</li>
<li>
<p><strong>Find all employees who directly report to &ldquo;Manager A&rdquo;</strong></p>
<ul>
<li>Display: <code>empid</code>, <code>ename</code>, <code>mrgid</code>.</li>
</ul>
</li>
<li>
<p><strong>Determine the hierarchy level of each employee</strong></p>
<ul>
<li>CEO → Level 1, direct reports to CEO → Level 2, and so on.</li>
<li>Display: <code>empid</code>, <code>ename</code>, <code>mrgid</code>, <code>level</code>.</li>
</ul>
</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">expr</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;EmployeeHierarchy&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&#34;CEO&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Manager A&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Manager B&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;Employee X&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;Employee Y&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;empid&#34;</span><span class="p">,</span> <span class="s2">&#34;mrgid&#34;</span><span class="p">,</span> <span class="s2">&#34;ename&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">employee_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the result</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;emp_data:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">employee_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Self-join to find the manager and CEO</span>
</span></span><span class="line"><span class="cl"><span class="n">manager_df</span> <span class="o">=</span> <span class="n">employee_df</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;e&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">employee_df</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;m&#34;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;e.mrgid&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;m.empid&#34;</span><span class="p">),</span> <span class="s2">&#34;left&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;e.ename&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;employee&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;m.ename&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;manager&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the result</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;mgr:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">manager_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Filter for employees without a manager (CEO)</span>
</span></span><span class="line"><span class="cl"><span class="n">manager_df2</span> <span class="o">=</span> <span class="n">employee_df</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;e1&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">employee_df</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;m1&#34;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;e1.mrgid&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;m1.empid&#34;</span><span class="p">),</span> <span class="s2">&#34;left&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;e1.ename&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;employee&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;m1.ename&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;manager&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> \
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;manager&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Display the result</span>
</span></span><span class="line"><span class="cl"><span class="n">manager_df2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="whencastunion">When|Cast|Union</h1>

<h2 id="when-and-otherwise"><code>when</code> and <code>otherwise</code></h2>
<p>The <code>when</code> and <code>otherwise</code> functions in <strong>PySpark</strong> provide a way to create conditional expressions within a DataFrame, allowing you to specify different values for new or existing columns based on specific conditions.</p>
<ul>
<li>
<p><strong><code>when</code></strong>:<br>
The <code>when</code> function in PySpark is used to define a condition.<br>
If the condition is met, it returns the specified value.<br>
You can chain multiple <code>when</code> conditions to handle various cases.</p>
</li>
<li>
<p><strong><code>otherwise</code></strong>:<br>
The <code>otherwise</code> function specifies a default value to return if none of the conditions in the <code>when</code> statements are met.</p>
</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">when</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">StringType</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Initialize Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;WhenOtherwiseExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the schema for the dataset</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;salary&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a sample dataset</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">3000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">4000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">5000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;David&#34;</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">4500</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Eve&#34;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Apply &#39;when&#39; and &#39;otherwise&#39; to add new columns based on conditions</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;status&#34;</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&#34;Young&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&#34;Adult&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;income_bracket&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="n">when</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">salary</span> <span class="o">&lt;</span> <span class="mi">4000</span><span class="p">,</span> <span class="s2">&#34;Low&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="o">.</span><span class="n">when</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">salary</span> <span class="o">&gt;=</span> <span class="mi">4000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">salary</span> <span class="o">&lt;=</span> <span class="mi">4500</span><span class="p">),</span> <span class="s2">&#34;Medium&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&#34;High&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the result</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<hr>
<h4 id="explanation">Explanation</h4>
<ol>
<li>
<p><strong><code>status</code> column</strong></p>
<ul>
<li>Assigns <code>&quot;Young&quot;</code> if <code>age &lt; 30</code>.</li>
<li>Otherwise assigns <code>&quot;Adult&quot;</code>.</li>
</ul>
</li>
<li>
<p><strong><code>income_bracket</code> column</strong></p>
<ul>
<li>Assigns <code>&quot;Low&quot;</code> if <code>salary &lt; 4000</code>.</li>
<li>Assigns <code>&quot;Medium&quot;</code> if <code>4000 &lt;= salary &lt;= 4500</code>.</li>
<li>Assigns <code>&quot;High&quot;</code> for any other salary values.</li>
</ul>
</li>
</ol>
<p>This approach allows for flexible handling of multiple conditions in PySpark DataFrames using <code>when</code> and <code>otherwise</code>.</p>
<h2 id="cast-and-printschema"><code>cast()</code> and <code>printSchema()</code></h2>
<p>In PySpark, the <code>cast()</code> function is used to change the data type of a column within a DataFrame.<br>
This is helpful when you need to standardize column data types for data processing, schema consistency, or compatibility with other operations.</p>
<ul>
<li>
<p><strong>Purpose</strong>:<br>
The <code>cast()</code> function allows you to change the data type of a column, useful in situations like standardizing formats (e.g., converting strings to dates or integers).</p>
</li>
<li>
<p><strong>Syntax</strong>:<br>
The <code>cast()</code> function is applied on individual columns and requires specifying the target data type in quotes.</p>
</li>
<li>
<p><strong>Multiple Columns</strong>:<br>
You can cast multiple columns at once by using a list of cast expressions and passing them to <code>select()</code>.</p>
</li>
<li>
<p><strong>Supported Data Types</strong>:<br>
PySpark supports various data types for casting, including:</p>
<ul>
<li><code>StringType</code></li>
<li><code>IntegerType</code> (or <code>&quot;int&quot;</code>)</li>
<li><code>DoubleType</code> (or <code>&quot;double&quot;</code>)</li>
<li><code>DateType</code></li>
<li><code>TimestampType</code></li>
<li><code>BooleanType</code></li>
<li>Others, based on the data types available in PySpark.</li>
</ul>
</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Single column cast</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;column_name&#34;</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;column_name&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;target_data_type&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Multiple columns cast with select</span>
</span></span><span class="line"><span class="cl"><span class="n">cast_expr</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span><span class="p">(</span><span class="s2">&#34;column1_name&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;target_data_type1&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span><span class="p">(</span><span class="s2">&#34;column2_name&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;target_data_type2&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># More columns and data types as needed</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">cast_expr</span><span class="p">)</span></span></span></code></pre></div>
<h4 id="example">Example</h4>
<p>Let&rsquo;s create a dataset and apply <code>cast()</code> to change the data types of multiple columns:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">FloatType</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Initialize Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;CastExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the schema for the dataset</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;age&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>    <span class="c1"># Stored as StringType initially</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;height&#34;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># Stored as StringType initially</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a sample dataset</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;25&#34;</span><span class="p">,</span> <span class="s2">&#34;5.5&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;35&#34;</span><span class="p">,</span> <span class="s2">&#34;6.1&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;40&#34;</span><span class="p">,</span> <span class="s2">&#34;5.8&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show schema and data before casting</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Define cast expressions for multiple columns</span>
</span></span><span class="line"><span class="cl"><span class="n">cast_expr</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;string&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span><span class="p">(</span><span class="s2">&#34;age&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;int&#34;</span><span class="p">),</span>       <span class="c1"># Casting age to IntegerType</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span><span class="p">(</span><span class="s2">&#34;height&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;double&#34;</span><span class="p">)</span>  <span class="c1"># Casting height to DoubleType</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Apply the cast expressions to the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="n">cast_expr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the result</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h4 id="explanation-1">Explanation</h4>
<ul>
<li><strong><code>age</code> column</strong>: Initially stored as <code>StringType</code>, it’s cast to <code>IntegerType</code> (or <code>&quot;int&quot;</code>).</li>
<li><strong><code>height</code> column</strong>: Initially stored as <code>StringType</code>, it’s cast to <code>DoubleType</code> (or <code>&quot;double&quot;</code>).</li>
</ul>
<hr>
<h4 id="advantages-of-using-cast">Advantages of Using <code>cast()</code></h4>
<ul>
<li><strong>Schema Alignment</strong>: Ensures data types in different tables or DataFrames are compatible for joining or union operations.</li>
<li><strong>Data Consistency</strong>: Ensures all columns conform to expected data types for downstream data processing.</li>
<li><strong>Error Reduction</strong>: Minimizes issues arising from mismatched data types in computations or transformations.</li>
</ul>
<p>This approach using <code>cast()</code> provides a flexible and powerful way to manage data types in PySpark.</p>
<hr>
<h4 id="printschema-method-in-pyspark"><code>printSchema()</code> Method in PySpark</h4>
<ul>
<li>
<p><strong>Purpose</strong>:</p>
<ul>
<li>To display the schema of a DataFrame, which includes the column names, data types, and nullability of each column.</li>
</ul>
</li>
<li>
<p><strong>Output Structure</strong>:<br>
The schema is presented in a tree-like structure showing:</p>
<ul>
<li><strong>Column Name</strong>: The name of the column.</li>
<li><strong>Data Type</strong>: The data type of the column (e.g., <code>string</code>, <code>integer</code>, <code>double</code>, <code>boolean</code>, etc.).</li>
<li><strong>Nullability</strong>: Indicates whether the column can contain null values (e.g., <code>nullable = true</code>).</li>
</ul>
</li>
<li>
<p><strong>Usage</strong>:</p>
<ul>
<li>Call <code>df.printSchema()</code> on a DataFrame <code>df</code> to see its structure.</li>
<li>Useful for verifying the structure of the DataFrame after operations like <code>select()</code>, <code>withColumn()</code>, or <code>cast()</code>.</li>
</ul>
</li>
</ul>
<h2 id="union-and-unionall"><code>union</code> and <code>unionAll</code></h2>
<h4 id="overview">Overview</h4>
<ul>
<li><strong>Purpose</strong>: Both <code>union</code> and <code>unionAll</code> are used to combine two DataFrames into a single DataFrame.</li>
<li><strong>DataFrame Compatibility</strong>: The two DataFrames must have the same schema (i.e., the same column names and data types) to perform the union operation.</li>
</ul>
<hr>
<h4 id="union"><code>union()</code></h4>
<ul>
<li>
<p><strong>Functionality</strong>:</p>
<ul>
<li>Combines two DataFrames and retains all rows, including duplicates.</li>
</ul>
</li>
<li>
<p><strong>Behavior</strong>:</p>
<ul>
<li>The <code>union()</code> method does not remove duplicate rows, resulting in a DataFrame that may contain duplicates.</li>
</ul>
</li>
</ul>
<hr>
<h4 id="unionall"><code>unionAll()</code></h4>
<ul>
<li>
<p><strong>Functionality</strong>:</p>
<ul>
<li>Combines two DataFrames and retains all rows, including duplicates.</li>
</ul>
</li>
<li>
<p><strong>Behavior</strong>:</p>
<ul>
<li>The <code>unionAll()</code> method performs the union operation but does not eliminate duplicate rows (similar to <code>union</code>).</li>
</ul>
</li>
</ul>
<hr>
<h4 id="syntax">Syntax</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Using union to retain all rows including duplicates</span>
</span></span><span class="line"><span class="cl"><span class="n">unioned_df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Using unionAll to retain all rows including duplicates</span>
</span></span><span class="line"><span class="cl"><span class="n">unionAll_df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">unionAll</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span></span></span></code></pre></div>
<h4 id="example-using-union-and-unionall-in-pyspark">Example: Using <code>union</code> and <code>unionAll</code> in PySpark</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Initialize Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;UnionExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample DataFrames</span>
</span></span><span class="line"><span class="cl"><span class="n">data1</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="mi">35</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;David&#34;</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Eve&#34;</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Using union to retain all rows including duplicates</span>
</span></span><span class="line"><span class="cl"><span class="n">unioned_df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Using unionAll to retain all rows</span>
</span></span><span class="line"><span class="cl"><span class="n">unionAll_df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">unionAll</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the results</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;unioned_df (No duplicates removed):&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">unioned_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;unionAll_df (duplicates retained):&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">unionAll_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Removing Duplicate Rows in PySpark</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Remove duplicate rows and create a new DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span> <span class="o">=</span> <span class="n">unioned_df</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># or</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span> <span class="o">=</span> <span class="n">unioned_df</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;unique_df (after removing duplicates):&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">unique_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h4 id="union-and-unionbyname">Union and UnionByName</h4>
<p>In PySpark, both <code>union</code> and <code>unionByName</code> are operations that allow you to combine two or more DataFrames. However, they do this in slightly different ways, particularly regarding how they handle column names.</p>
<hr>
<h5 id="1-union">1. <code>union</code></h5>
<p><strong>Definition</strong>:<br>
The <code>union()</code> function is used to combine two DataFrames with the same schema (i.e., the same number of columns with the same data types).<br>
It appends the rows of one DataFrame to the other.</p>
<p><strong>Key Characteristics</strong>:</p>
<ul>
<li>The DataFrames must have the same number of columns.</li>
<li>The columns must have compatible data types.</li>
<li>It does <strong>not</strong> automatically handle column names that differ between DataFrames.</li>
</ul>
<h4 id="syntax-1">Syntax</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DataFrame</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">otherDataFrame</span><span class="p">)</span></span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;Union Example&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create two DataFrames with the same schema</span>
</span></span><span class="line"><span class="cl"><span class="n">data1</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;Cathy&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;David&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Id&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Perform union</span>
</span></span><span class="line"><span class="cl"><span class="n">result_union</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the result</span>
</span></span><span class="line"><span class="cl"><span class="n">result_union</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h4 id="2-unionbyname">2. <code>unionByName</code></h4>
<p><strong>Definition</strong>:<br>
The <code>unionByName()</code> function allows you to combine two DataFrames by matching column names.<br>
If the DataFrames do not have the same schema, it will fill in missing columns with <code>null</code>.</p>
<p><strong>Key Characteristics</strong>:</p>
<ul>
<li>Matches DataFrames by <strong>column names</strong> rather than position.</li>
<li>If the DataFrames have different columns, it will include all columns and fill in <code>null</code> for missing values in any DataFrame.</li>
<li>You can specify <code>allowMissingColumns=True</code> to ignore missing columns.</li>
</ul>
<h4 id="syntax-2">Syntax</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DataFrame</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span><span class="n">otherDataFrame</span><span class="p">,</span> <span class="n">allowMissingColumns</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Create two DataFrames with different schemas</span>
</span></span><span class="line"><span class="cl"><span class="n">data3</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;Eve&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Frank&#34;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">data4</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&#34;Grace&#34;</span><span class="p">,</span> <span class="s2">&#34;New York&#34;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;Hannah&#34;</span><span class="p">,</span> <span class="s2">&#34;Los Angeles&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Id&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;City&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df3</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data3</span><span class="p">,</span> <span class="n">columns1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df4</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data4</span><span class="p">,</span> <span class="n">columns2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Perform unionByName (with allowMissingColumns=True to handle schema differences)</span>
</span></span><span class="line"><span class="cl"><span class="n">result_union_by_name</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">unionByName</span><span class="p">(</span><span class="n">df4</span><span class="p">,</span> <span class="n">allowMissingColumns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the result result_union_by_name.show()</span>
</span></span><span class="line"><span class="cl"><span class="n">result_union_by_name</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h4 id="summary-of-differences">Summary of Differences</h4>
<ul>
<li><strong><code>union()</code></strong>: Requires DataFrames to have the <strong>same schema</strong> (same number of columns and compatible data types). It combines rows without checking column names.</li>
<li><strong><code>unionByName()</code></strong>: Matches DataFrames by <strong>column names</strong>. It can handle different schemas and fill missing columns with <code>null</code> (when <code>allowMissingColumns=True</code>).</li>
</ul>
<hr>
<table>
  <thead>
      <tr>
          <th>Feature</th>
          <th>Union</th>
          <th>UnionByName</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Column Matching</td>
          <td>Positional</td>
          <td>By Name</td>
      </tr>
      <tr>
          <td>Missing Columns Handling</td>
          <td>Does not allow</td>
          <td>Allows with <code>null</code> for missing</td>
      </tr>
      <tr>
          <td>Schema Requirement</td>
          <td>Must be identical</td>
          <td>Can differ</td>
      </tr>
  </tbody>
</table>
<h4 id="conclusion">Conclusion</h4>
<p>In PySpark:</p>
<ul>
<li>Use <strong><code>union()</code></strong> when you have DataFrames with the <strong>same schema</strong> and need a straightforward concatenation.</li>
<li>Use <strong><code>unionByName()</code></strong> when your DataFrames have <strong>different schemas</strong> and you want to combine them by matching column names while handling missing columns.</li>
</ul>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="window-functions">Window Functions</h1>

<h2 id="windows-function-in-pyspark">Windows Function in PySpark</h2>
<h3 id="1-introduction-to-window-functions">1. Introduction to Window Functions</h3>
<p>Window functions allow you to perform calculations across a set of rows related to the current row within a specified partition.</p>
<p>Unlike groupBy functions, window functions do not reduce the number of rows in the result; instead, they calculate a value for each row based on the specified window.</p>
<h3 id="2-importing-required-libraries">2. Importing Required Libraries</h3>
<p>To use window functions, import the necessary modules from PySpark:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span></span></span></code></pre></div>
<h3 id="3-creating-a-window-specification">3. Creating a Window Specification</h3>
<p>A window specification defines how rows will be grouped (partitioned) and ordered within each group.</p>
<p><strong>Example – Basic Window Specification:</strong></p>
<p><code>window_spec = Window.partitionBy(&quot;category&quot;).orderBy(&quot;timestamp&quot;)</code></p>
<p><strong>Example – Advanced Window Specification:</strong></p>
<p><code>window_spec = Window.partitionBy(&quot;category&quot;, &quot;sub_category&quot;).orderBy(F.col(&quot;timestamp&quot;), F.col(&quot;score&quot;))</code></p>
<h3 id="4-common-window-functions">4. Common Window Functions</h3>
<h4 id="a-row-number">a. Row Number</h4>
<p><strong>Function:</strong> <code>row_number()</code></p>
<p><strong>Description:</strong> Assigns a unique integer to each row within the partition (starting from 1).</p>
<p><code>df = df.withColumn(&quot;row_number&quot;, F.row_number().over(window_spec))</code></p>
<h4 id="b-rank">b. Rank</h4>
<p><strong>Function:</strong> <code>rank()</code></p>
<p><strong>Description:</strong> Assigns the same rank to rows with the same values in the order criteria. The next rank has a gap.</p>
<p><code>df = df.withColumn(&quot;rank&quot;, F.rank().over(window_spec))</code></p>
<h4 id="c-dense-rank">c. Dense Rank</h4>
<p><strong>Function:</strong> <code>dense_rank()</code></p>
<p><strong>Description:</strong> Similar to rank, but does not leave gaps in ranking.</p>
<p><code>df = df.withColumn(&quot;dense_rank&quot;, F.dense_rank().over(window_spec))</code></p>
<h4 id="d-lead-and-lag">d. Lead and Lag</h4>
<p><strong>Functions:</strong> <code>lead()</code>, <code>lag()</code></p>
<p><strong>Description:</strong></p>
<p><code>lead()</code> → value of the next row within the window.</p>
<p><code>lag()</code> → value of the previous row within the window.</p>
<p><code>df = df.withColumn(&quot;next_value&quot;, F.lead(&quot;value&quot;).over(window_spec))</code>
<code>df = df.withColumn(&quot;previous_value&quot;, F.lag(&quot;value&quot;).over(window_spec))</code></p>
<h4 id="e-aggregation-functions">e. Aggregation Functions</h4>
<p>Window functions can also compute aggregated values across the specified window.</p>
<p><code>df = df.withColumn(&quot;avg_value&quot;, F.avg(&quot;value&quot;).over(window_spec))</code></p>
<p>Other common aggregations:</p>
<p><strong>Sum:</strong> <code>F.sum(&quot;column_name&quot;).over(window_spec)</code></p>
<p><strong>Min:</strong> <code>F.min(&quot;column_name&quot;).over(window_spec)</code></p>
<p><strong>Max:</strong> <code>F.max(&quot;column_name&quot;).over(window_spec)</code></p>
<h3 id="5-putting-it-all-together--example">5. Putting It All Together – Example</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Initialize Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;WindowFunctionsExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;X&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;2023-01-01&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;X&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;2023-01-02&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;Y&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;2023-01-01&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;Y&#34;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;2023-01-02&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;X&#34;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;2023-01-01&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;X&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&#34;2023-01-02&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;category&#34;</span><span class="p">,</span> <span class="s2">&#34;sub_category&#34;</span><span class="p">,</span> <span class="s2">&#34;value&#34;</span><span class="p">,</span> <span class="s2">&#34;timestamp&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define window specification</span>
</span></span><span class="line"><span class="cl"><span class="n">window_spec</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&#34;category&#34;</span><span class="p">,</span> <span class="s2">&#34;sub_category&#34;</span><span class="p">)</span> \
</span></span><span class="line"><span class="cl">                   <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;timestamp&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;value&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Apply window functions</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;row_number&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;rank&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;dense_rank&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">dense_rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;next_value&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lead</span><span class="p">(</span><span class="s2">&#34;value&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;previous_value&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="s2">&#34;value&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;avg_value&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s2">&#34;value&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="6-conclusion">6. Conclusion</h3>
<p>Window functions in PySpark are powerful tools for analyzing data within groups while retaining row-level details.</p>
<p>By defining window specifications and applying functions like rank, dense_rank, lead, lag, and aggregations, you can perform complex analytics efficiently.</p>
<h2 id="windows-function-in-pyspark--part-2">Windows Function in PySpark – Part 2</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="k">as</span> <span class="nn">F</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;David&#34;</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Eve&#34;</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Frank&#34;</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Grace&#34;</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Hank&#34;</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Ivy&#34;</span><span class="p">,</span> <span class="mi">700</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Jack&#34;</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Score&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define window</span>
</span></span><span class="line"><span class="cl"><span class="n">window_spec</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&#34;Score&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ranking functions</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Rank&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;DenseRank&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">dense_rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df3</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;RowNumber&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">row_number</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Lead &amp; Lag</span>
</span></span><span class="line"><span class="cl"><span class="n">df4</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;ScoreDifferenceWithNext&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lead</span><span class="p">(</span><span class="s2">&#34;Score&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">)</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Score&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">df5</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;ScoreDifferenceWithPrevious&#34;</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s2">&#34;Score&#34;</span><span class="p">]</span> <span class="o">-</span> <span class="n">F</span><span class="o">.</span><span class="n">lag</span><span class="p">(</span><span class="s2">&#34;Score&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span></span></span></code></pre></div>
<h2 id="windows-function-in-pyspark--part-3-student-marks-analysis">Windows Function in PySpark – Part 3 (Student Marks Analysis)</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="k">as</span> <span class="nn">F</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Updated sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Math&#34;</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Science&#34;</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;History&#34;</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Math&#34;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Science&#34;</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;History&#34;</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Math&#34;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Science&#34;</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;History&#34;</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Physics&#34;</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Chemistry&#34;</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Biology&#34;</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Physics&#34;</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Chemistry&#34;</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Biology&#34;</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Physics&#34;</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Chemistry&#34;</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Biology&#34;</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Computer Science&#34;</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Electronics&#34;</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Geography&#34;</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Computer Science&#34;</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Electronics&#34;</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Geography&#34;</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Computer Science&#34;</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Electronics&#34;</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Geography&#34;</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;First Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Subject&#34;</span><span class="p">,</span> <span class="s2">&#34;Marks&#34;</span><span class="p">,</span> <span class="s2">&#34;Semester&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 1. Max marks in each semester</span>
</span></span><span class="line"><span class="cl"><span class="n">window_spec_max_marks</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&#34;Semester&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="s2">&#34;Marks&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">max_marks_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Rank&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec_max_marks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">top_scorer</span> <span class="o">=</span> <span class="n">max_marks_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">max_marks_df</span><span class="p">[</span><span class="s2">&#34;Rank&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. Percentage of each student</span>
</span></span><span class="line"><span class="cl"><span class="n">window_spec_total_marks</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&#34;First Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Semester&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;TotalMarks&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&#34;Marks&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec_total_marks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">,</span> <span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;TotalMarks&#34;</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&#34;decimal(5,2)&#34;</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;First Name&#34;</span><span class="p">,</span><span class="s2">&#34;Semester&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">&#34;TotalMarks&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;TotalMarks&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. Top rank holder in each semester</span>
</span></span><span class="line"><span class="cl"><span class="n">window_spec_rank</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&#34;Semester&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">rank_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Rank&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec_rank</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">top_rank_holder</span> <span class="o">=</span> <span class="n">rank_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">rank_df</span><span class="p">[</span><span class="s2">&#34;Rank&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;First Name&#34;</span><span class="p">,</span><span class="s2">&#34;Semester&#34;</span><span class="p">,</span><span class="s2">&#34;Rank&#34;</span><span class="p">,</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 4. Max marks in each subject in each semester</span>
</span></span><span class="line"><span class="cl"><span class="n">window_spec_max_subject_marks</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&#34;Semester&#34;</span><span class="p">,</span><span class="s2">&#34;Subject&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="s2">&#34;Marks&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">max_subject_marks_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Rank&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec_max_subject_marks</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">max_subject_scorer</span> <span class="o">=</span> <span class="n">max_subject_marks_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">max_subject_marks_df</span><span class="p">[</span><span class="s2">&#34;Rank&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span></span></span></code></pre></div>
<h2 id="windows-function-in-pyspark--part-4-highest-salary-per-department">Windows Function in PySpark – Part 4 (Highest Salary per Department)</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Employee Data</span>
</span></span><span class="line"><span class="cl"><span class="n">emp_data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6300</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6200</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&#34;David&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7200</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;Eve&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6300</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&#34;Frank&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Department Data</span>
</span></span><span class="line"><span class="cl"><span class="n">dept_data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;HR&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;Finance&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrames</span>
</span></span><span class="line"><span class="cl"><span class="n">emp_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">emp_data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;EmpId&#34;</span><span class="p">,</span><span class="s2">&#34;EmpName&#34;</span><span class="p">,</span><span class="s2">&#34;DeptId&#34;</span><span class="p">,</span><span class="s2">&#34;Salary&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">dept_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">dept_data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;DeptId&#34;</span><span class="p">,</span><span class="s2">&#34;DeptName&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Window for salary ranking</span>
</span></span><span class="line"><span class="cl"><span class="n">window_spec</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="s2">&#34;DeptId&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">desc</span><span class="p">(</span><span class="s2">&#34;Salary&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add rank &amp; filter top salary</span>
</span></span><span class="line"><span class="cl"><span class="n">ranked_salary_df</span> <span class="o">=</span> <span class="n">emp_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Rank&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">result_df</span> <span class="o">=</span> <span class="n">ranked_salary_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Rank&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Join department names</span>
</span></span><span class="line"><span class="cl"><span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dept_df</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;DeptId&#34;</span><span class="p">],</span> <span class="s2">&#34;left&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Final Output</span>
</span></span><span class="line"><span class="cl"><span class="n">result_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;EmpName&#34;</span><span class="p">,</span><span class="s2">&#34;DeptName&#34;</span><span class="p">,</span><span class="s2">&#34;Salary&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="explode">Explode</h1>

<h2 id="explode-vs-explode_outer">Explode vs Explode_outer</h2>
<p>In PySpark, <code>explode</code> and <code>explode_outer</code> are functions used to work with nested data structures, like <strong>arrays</strong> or <strong>maps</strong>, by <em>“exploding”</em> (flattening) each element of an array or key-value pair in a map into separate rows.</p>
<p>The key difference between <strong>explode</strong> and <strong>explode_outer</strong> is in handling <strong>null</strong> or <strong>empty arrays</strong>, which makes them useful in different scenarios.</p>
<hr>
<h2 id="1-explode">1. explode()</h2>
<p>The <code>explode()</code> function takes a column with array or map data and creates a new row for each element in the array (or each key-value pair in the map).<br>
If the array is empty or null, <code>explode()</code> will <strong>drop the row entirely</strong>.</p>
<h4 id="key-characteristics">Key Characteristics</h4>
<ul>
<li>Converts each element in an array or each entry in a map into its own row.</li>
<li>Drops rows with <strong>null</strong> or <strong>empty arrays</strong>.</li>
</ul>
<h3 id="example-using-explode-in-pyspark">Example: Using <code>explode()</code> in PySpark</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">explode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Initialize Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;ExplodeExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample DataFrame with arrays</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;Math&#34;</span><span class="p">,</span> <span class="s2">&#34;Science&#34;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;History&#34;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Cathy&#34;</span><span class="p">,</span> <span class="p">[]),</span>   <span class="c1"># Empty array</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;David&#34;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Null array</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Subjects&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Use explode to flatten the array</span>
</span></span><span class="line"><span class="cl"><span class="n">exploded_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="s2">&#34;Subjects&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Subject&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the result</span>
</span></span><span class="line"><span class="cl"><span class="n">exploded_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="explanation">Explanation:</h3>
<ul>
<li><code>explode()</code> expands the Subjects array into individual rows.</li>
<li>Rows with empty (<code>[]</code>) or null arrays (<code>None</code>) are removed, which is why Cathy and David do not appear in the output.</li>
</ul>
<h2 id="2-explode_outer">2. explode_outer()</h2>
<p>The <code>explode_outer()</code> function works similarly to <code>explode()</code>, but it <strong>keeps rows</strong> with null or empty arrays.<br>
When <code>explode_outer()</code> encounters a null or empty array, it still generates a row for that entry, with <strong>null</strong> as the value in the resulting column.</p>
<h4 id="key-characteristics-1">Key Characteristics</h4>
<ul>
<li>Converts each element in an array or each entry in a map into its own row.</li>
<li><strong>Retains</strong> rows with null or empty arrays, using <code>null</code> values in the exploded column.</li>
</ul>
<h3 id="example-using-explode_outer-in-pyspark">Example: Using <code>explode_outer()</code> in PySpark</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Use explode_outer to flatten the array while keeping null or empty rows</span>
</span></span><span class="line"><span class="cl"><span class="n">exploded_outer_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Name&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">F</span><span class="o">.</span><span class="n">explode_outer</span><span class="p">(</span><span class="s2">&#34;Subjects&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Subject&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the result</span>
</span></span><span class="line"><span class="cl"><span class="n">exploded_outer_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="explanation-explode_outer">Explanation: explode_outer()</h3>
<ul>
<li><code>explode_outer()</code> expands the <strong>Subjects</strong> array into individual rows.</li>
<li>Unlike <code>explode()</code>, rows with empty (<code>[]</code>) or null arrays (<code>None</code>) are <strong>kept</strong> in the result, with <strong>null values</strong> in the <code>Subject</code> column for these cases.</li>
</ul>
<hr>
<h2 id="summary-table-of-differences">Summary Table of Differences</h2>
<table>
  <thead>
      <tr>
          <th>Function</th>
          <th>Description</th>
          <th>Null/Empty Arrays Behavior</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>explode()</strong></td>
          <td>Expands each element of an array or map into rows</td>
          <td><strong>Drops</strong> rows with null or empty arrays</td>
      </tr>
      <tr>
          <td><strong>explode_outer()</strong></td>
          <td>Similar to <code>explode()</code>, but retains null/empty</td>
          <td><strong>Keeps</strong> rows with null/empty arrays, fills with <code>null</code></td>
      </tr>
  </tbody>
</table>
<hr>
<p>These functions are very useful when working with <strong>complex, nested data structures</strong>, especially when dealing with <strong>JSON</strong> or other hierarchical data.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="pivot">Pivot</h1>

<h2 id="pivot-in-pyspark">Pivot in PySpark</h2>
<p>The <strong>pivot</strong> operation in PySpark is used to <strong>transpose rows into columns</strong> based on a specified column&rsquo;s unique values.<br>
It&rsquo;s particularly useful for creating <strong>wide-format data</strong>, where values in one column become new column headers, and corresponding values from another column fill those headers.</p>
<hr>
<h3 id="key-concepts">Key Concepts</h3>
<ol>
<li>
<p><strong>groupBy and pivot</strong></p>
<ul>
<li>The <code>pivot</code> method is typically used in combination with <code>groupBy</code>.</li>
<li>You group by certain columns and pivot one column to create new columns.</li>
</ul>
</li>
<li>
<p><strong>Aggregation Function</strong></p>
<ul>
<li>You need to specify an aggregation function (like <code>sum</code>, <code>avg</code>, <code>count</code>, etc.) to fill the values in the pivoted columns.</li>
</ul>
</li>
<li>
<p><strong>Performance Consideration</strong></p>
<ul>
<li>Pivoting can be <strong>computationally expensive</strong>, especially with a high number of unique values in the pivot column.</li>
<li>For better performance, explicitly specify the values to pivot if possible.</li>
</ul>
</li>
<li>
<p><strong>Syntax</strong></p>
</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dataframe</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;group_column&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&#34;pivot_column&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggregation_function</span><span class="p">)</span></span></span></code></pre></div>
<h3 id="example-code-pivot-in-pyspark">Example Code: Pivot in PySpark</h3>
<h4 id="sample-data">Sample Data</h4>
<p>Imagine we have a DataFrame of sales data with the following schema:</p>
<table>
  <thead>
      <tr>
          <th>Product</th>
          <th>Region</th>
          <th>Sales</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>North</td>
          <td>100</td>
      </tr>
      <tr>
          <td>B</td>
          <td>North</td>
          <td>150</td>
      </tr>
      <tr>
          <td>A</td>
          <td>South</td>
          <td>200</td>
      </tr>
      <tr>
          <td>B</td>
          <td>South</td>
          <td>300</td>
      </tr>
  </tbody>
</table>
<p>We want to pivot the data so that regions (North, South) become columns and the sales values are aggregated.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="nb">sum</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;PivotExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a sample DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;North&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;North&#34;</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;South&#34;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;South&#34;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="s2">&#34;Region&#34;</span><span class="p">,</span> <span class="s2">&#34;Sales&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pivot the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">pivoted_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the results</span>
</span></span><span class="line"><span class="cl"><span class="n">pivoted_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h4 id="output">Output</h4>
<table>
  <thead>
      <tr>
          <th>Product</th>
          <th>North</th>
          <th>South</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>100</td>
          <td>200</td>
      </tr>
      <tr>
          <td>B</td>
          <td>150</td>
          <td>300</td>
      </tr>
  </tbody>
</table>
<h3 id="explanation-of-code">Explanation of Code</h3>
<ol>
<li>
<p><strong>groupBy(&ldquo;Product&rdquo;)</strong></p>
<ul>
<li>Groups the data by the <code>Product</code> column.</li>
</ul>
</li>
<li>
<p><strong>pivot(&ldquo;Region&rdquo;)</strong></p>
<ul>
<li>Transforms unique values in the <code>Region</code> column (<code>North</code>, <code>South</code>) into new columns.</li>
</ul>
</li>
<li>
<p><strong>agg(sum(&ldquo;Sales&rdquo;))</strong></p>
<ul>
<li>Computes the sum of <code>Sales</code> for each combination of <code>Product</code> and the new columns created by the pivot.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="notes">Notes</h3>
<ul>
<li><strong>Explicit Pivot Values</strong>: To improve performance, you can specify the pivot values explicitly.</li>
</ul>
<p><code>df.groupBy(&quot;Product&quot;).pivot(&quot;Region&quot;, [&quot;North&quot;, &quot;South&quot;]).agg(sum(&quot;Sales&quot;))</code></p>
<ul>
<li><strong>Handling Null Values</strong>: If some combinations of <code>groupBy</code> and pivot values have no corresponding rows, the resulting cells will contain <code>null</code>.</li>
<li><strong>Alternative Aggregations</strong>: You can use other aggregation functions like <code>avg</code>, <code>max</code>, <code>min</code>, etc.</li>
</ul>
<hr>
<p>This approach is commonly used in creating <strong>summary reports</strong> or preparing data for <strong>machine learning models</strong> where wide-format data is required.</p>
<h2 id="unpivot-in-pyspark">Unpivot in PySpark</h2>
<p>The unpivot operation (also called melting) is used to transform a wide-format table into a long-format table. This means columns are turned into rows, effectively reversing the pivot operation. PySpark doesn&rsquo;t have a direct unpivot function like Pandas&rsquo; melt, but you can achieve it using the selectExpr method or a combination of stack and other DataFrame transformations.</p>
<h3 id="key-concepts-1">Key Concepts</h3>
<p><strong>1. Purpose of Unpivot:</strong></p>
<ul>
<li>
<p>Simplifies data analysis by converting column headers into a single column (e.g., categorical variables).</p>
</li>
<li>
<p>Ideal for scenarios where you need to aggregate data further or visualize it in a long format.</p>
</li>
</ul>
<p><strong>2. Syntax Overview:</strong></p>
<ul>
<li>
<p>Use the stack function inside a selectExpr to unpivot.</p>
</li>
<li>
<p>Stack reshapes the DataFrame by creating multiple rows for specified columns.</p>
</li>
</ul>
<p><strong>3. Performance:</strong></p>
<ul>
<li>Unpivoting can generate many rows, especially if the original DataFrame is wide with numerous columns. Ensure your environment can handle the resulting data volume.</li>
</ul>
<h3 id="example-unpivot-in-pyspark">Example: Unpivot in PySpark</h3>
<h4 id="sample-data-1">Sample Data</h4>
<p>Suppose we have the following DataFrame:</p>
<table>
  <thead>
      <tr>
          <th>Product</th>
          <th>North</th>
          <th>South</th>
          <th>East</th>
          <th>West</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>100</td>
          <td>200</td>
          <td>150</td>
          <td>130</td>
      </tr>
      <tr>
          <td>B</td>
          <td>150</td>
          <td>300</td>
          <td>200</td>
          <td>180</td>
      </tr>
  </tbody>
</table>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;UnpivotExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="s2">&#34;North&#34;</span><span class="p">,</span> <span class="s2">&#34;South&#34;</span><span class="p">,</span> <span class="s2">&#34;East&#34;</span><span class="p">,</span> <span class="s2">&#34;West&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Unpivot the DataFrame using stack</span>
</span></span><span class="line"><span class="cl"><span class="n">unpivoted_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Product&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;stack(4, &#39;North&#39;, North, &#39;South&#39;, South, &#39;East&#39;, East, &#39;West&#39;, West) as (Region, Sales)&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the results</span>
</span></span><span class="line"><span class="cl"><span class="n">unpivoted_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="explanation-of-code-1">Explanation of Code</h3>
<ol>
<li>
<p><strong>Input DataFrame</strong>:</p>
<ul>
<li>Each column (North, South, East, West) represents a region&rsquo;s sales for each product.</li>
</ul>
</li>
<li>
<p><strong>selectExpr with stack</strong>:</p>
<ul>
<li>The stack function takes two arguments:
<ul>
<li>The number of columns being unpivoted (4 in this case).</li>
<li>A sequence of column-value pairs: &lsquo;ColumnName1&rsquo;, ColumnValue1, &lsquo;ColumnName2&rsquo;, ColumnValue2, &hellip;.</li>
</ul>
</li>
<li>The result is two new columns: the first contains the column names (now rows, Region), and the second contains the corresponding values (Sales).</li>
</ul>
</li>
<li>
<p><strong>Aliasing Columns</strong>:</p>
<ul>
<li>The stack result is aliased as (Region, Sales) to give meaningful names to the new columns.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="alternative-methods">Alternative Methods</h3>
<p><strong>Using withColumn and union</strong>:<br>
If stack isn&rsquo;t flexible enough, you can manually combine rows for each column:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a DataFrame with union operations for unpivoting</span>
</span></span><span class="line"><span class="cl"><span class="n">north</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&#34;North&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;North&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">south</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&#34;South&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;South&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">east</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&#34;East&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;East&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">west</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&#34;West&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;West&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Combine all rows using union</span>
</span></span><span class="line"><span class="cl"><span class="n">unpivoted_df</span> <span class="o">=</span> <span class="n">north</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">south</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">east</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">west</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show results</span>
</span></span><span class="line"><span class="cl"><span class="n">unpivoted_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h3 id="notes-1">Notes</h3>
<ol>
<li>
<p><strong>Performance Considerations</strong></p>
<ul>
<li><code>stack</code> is efficient for unpivoting a large number of columns.</li>
<li>The <code>union</code> method may become unwieldy for many columns, but it offers more control over the transformation process.</li>
</ul>
</li>
<li>
<p><strong>Dynamic Column Unpivoting</strong></p>
<ul>
<li>If the column names are not fixed (dynamic), you can:
<ul>
<li>Collect the column names dynamically using <code>df.columns</code>.</li>
<li>Construct the <code>selectExpr</code> or <code>union</code> queries programmatically.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Resulting Format</strong></p>
<ul>
<li>After unpivoting, the data will have more rows but fewer columns.</li>
<li>Ensure downstream processes are optimized to handle the increased row count.</li>
</ul>
</li>
</ol>
<hr>
<p>Unpivoting is a powerful operation for <strong>restructuring data</strong> and is frequently used in <strong>data preprocessing, reporting, and machine learning pipelines</strong>.</p>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="comparisons">Comparisons</h1>

<h2 id="hadoop-vs-spark-architecture">Hadoop vs. Spark Architecture</h2>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Hadoop</th>
          <th>Spark</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Storage</strong></td>
          <td>Uses HDFS for storage</td>
          <td>Uses in-memory processing for speed</td>
      </tr>
      <tr>
          <td><strong>Processing</strong></td>
          <td>MapReduce is disk-based</td>
          <td>In-memory processing improves performance</td>
      </tr>
      <tr>
          <td><strong>Integration</strong></td>
          <td>Runs independently or with Hadoop ecosystem</td>
          <td>Can run on top of Hadoop; more flexible</td>
      </tr>
      <tr>
          <td><strong>Complexity</strong></td>
          <td>More complex setup and deployment</td>
          <td>Simpler to deploy and configure</td>
      </tr>
      <tr>
          <td><strong>Performance</strong></td>
          <td>Slower for iterative tasks due to disk I/O</td>
          <td>Better performance for iterative tasks</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="rdd-vs-dataframe-vs-dataset">RDD vs. DataFrame vs. Dataset</h2>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>RDD</th>
          <th>DataFrame</th>
          <th>Dataset</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>API Level</strong></td>
          <td>Low-level, more control</td>
          <td>High-level, optimized with Catalyst</td>
          <td>High-level, type-safe</td>
      </tr>
      <tr>
          <td><strong>Schema</strong></td>
          <td>No schema, unstructured</td>
          <td>Uses schema for structured data</td>
          <td>Strongly typed, compile-time type safety</td>
      </tr>
      <tr>
          <td><strong>Optimization</strong></td>
          <td>No built-in optimization</td>
          <td>Optimized using Catalyst</td>
          <td>Optimized using Catalyst, with type safety</td>
      </tr>
      <tr>
          <td><strong>Type Safety</strong></td>
          <td>No type safety</td>
          <td>No compile-time type safety</td>
          <td>Provides compile-time type safety</td>
      </tr>
      <tr>
          <td><strong>Performance</strong></td>
          <td>Less optimized for performance</td>
          <td>Better performance due to optimizations</td>
          <td>Combines type safety with optimization</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="action-vs-transformation-in-spark">Action vs. Transformation in Spark</h2>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Action</th>
          <th>Transformation</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Execution</strong></td>
          <td>Triggers execution of the Spark job</td>
          <td>Builds up a logical plan of data operations</td>
      </tr>
      <tr>
          <td><strong>Return Type</strong></td>
          <td>Returns results or output</td>
          <td>Returns a new RDD/DataFrame</td>
      </tr>
      <tr>
          <td><strong>Evaluation</strong></td>
          <td>Eager evaluation; executes immediately</td>
          <td>Lazy evaluation; executed when an action is triggered</td>
      </tr>
      <tr>
          <td><strong>Computation</strong></td>
          <td>Involves actual computation (e.g., <code>collect()</code>)</td>
          <td>Defines data transformations (e.g., <code>map()</code>)</td>
      </tr>
      <tr>
          <td><strong>Performance</strong></td>
          <td>Can cause data processing; affects performance</td>
          <td>Does not affect performance until an action is called</td>
      </tr>
  </tbody>
</table>
<h3 id="map-vs-flatmap">Map vs. FlatMap</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Map</th>
          <th>FlatMap</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Output</td>
          <td>Returns one output element per input element</td>
          <td>Can return zero or more output elements per input</td>
      </tr>
      <tr>
          <td>Flattening</td>
          <td>Does not flatten output</td>
          <td>Flattens the output into a single level</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Suitable for one-to-one transformations</td>
          <td>Suitable for one-to-many transformations</td>
      </tr>
      <tr>
          <td>Complexity</td>
          <td>Simpler, straightforward</td>
          <td>More complex due to variable number of outputs</td>
      </tr>
      <tr>
          <td>Examples</td>
          <td><code>map(x =&gt; x * 2)</code></td>
          <td><code>flatMap(x =&gt; x.split(&quot; &quot;))</code></td>
      </tr>
  </tbody>
</table>
<h3 id="groupbykey-vs-reducebykey">GroupByKey vs. ReduceByKey</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>GroupByKey</th>
          <th>ReduceByKey</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Operation</td>
          <td>Groups all values by key</td>
          <td>Aggregates values with the same key</td>
      </tr>
      <tr>
          <td>Efficiency</td>
          <td>Can lead to high shuffling</td>
          <td>More efficient due to partial aggregation</td>
      </tr>
      <tr>
          <td>Data Movement</td>
          <td>Requires shuffling of all values</td>
          <td>Minimizes data movement through local aggregation</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Useful for simple grouping</td>
          <td>Preferred for aggregations and reductions</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Less efficient with large datasets</td>
          <td>Better performance for large datasets</td>
      </tr>
  </tbody>
</table>
<h3 id="repartition-vs-coalesce">Repartition vs. Coalesce</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Repartition</th>
          <th>Coalesce</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Partitioning</td>
          <td>Can increase or decrease the number of partitions</td>
          <td>Only decreases the number of partitions</td>
      </tr>
      <tr>
          <td>Shuffling</td>
          <td>Involves full shuffle</td>
          <td>Avoids full shuffle, more efficient</td>
      </tr>
      <tr>
          <td>Efficiency</td>
          <td>More expensive due to shuffling</td>
          <td>More efficient for reducing partitions</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Used for increasing partitions or balancing load</td>
          <td>Used for reducing partitions, typically after filtering</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Can be costly for large datasets</td>
          <td>More cost-effective for reducing partitions</td>
      </tr>
  </tbody>
</table>
<h3 id="cache-vs-persist">Cache vs. Persist</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Cache</th>
          <th>Persist</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Storage Level</td>
          <td>Defaults to MEMORY_ONLY</td>
          <td>Can use various storage levels (e.g., MEMORY_AND_DISK)</td>
      </tr>
      <tr>
          <td>Flexibility</td>
          <td>Simplified, with default storage level</td>
          <td>Offers more options for storage levels</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Suitable for simple caching scenarios</td>
          <td>Suitable for complex caching scenarios requiring different storage levels</td>
      </tr>
      <tr>
          <td>Implementation</td>
          <td>Easier to use, shorthand for MEMORY_ONLY</td>
          <td>More flexible, allows custom storage options</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Suitable when memory suffices</td>
          <td>More efficient when dealing with larger datasets and limited memory</td>
      </tr>
  </tbody>
</table>
<h3 id="narrow-vs-wide-transformation">Narrow vs. Wide Transformation</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Narrow Transformation</th>
          <th>Wide Transformation</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Partitioning</td>
          <td>Each parent partition is used by one child partition</td>
          <td>Requires data from multiple partitions</td>
      </tr>
      <tr>
          <td>Shuffling</td>
          <td>No shuffling required</td>
          <td>Involves shuffling of data</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>More efficient and less costly</td>
          <td>Less efficient due to data movement</td>
      </tr>
      <tr>
          <td>Examples</td>
          <td><code>map()</code>, <code>filter()</code></td>
          <td><code>groupByKey()</code>, <code>join()</code></td>
      </tr>
      <tr>
          <td>Complexity</td>
          <td>Simpler and faster</td>
          <td>More complex and slower due to data movement</td>
      </tr>
  </tbody>
</table>
<h3 id="collect-vs-take">Collect vs. Take</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Collect</th>
          <th>Take</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Output</td>
          <td>Retrieves all data from the RDD/DataFrame</td>
          <td>Retrieves a specified number of elements</td>
      </tr>
      <tr>
          <td>Memory Usage</td>
          <td>Can be expensive and use a lot of memory</td>
          <td>More memory-efficient</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Used when you need the entire dataset</td>
          <td>Useful for sampling or debugging</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Can cause performance issues with large data</td>
          <td>Faster and more controlled</td>
      </tr>
      <tr>
          <td>Action Type</td>
          <td>Triggers full data retrieval</td>
          <td>Triggers partial data retrieval</td>
      </tr>
  </tbody>
</table>
<h3 id="broadcast-variable-vs-accumulator">Broadcast Variable vs. Accumulator</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Broadcast Variable</th>
          <th>Accumulator</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Purpose</td>
          <td>Efficiently shares read-only data across tasks</td>
          <td>Tracks metrics and aggregates values</td>
      </tr>
      <tr>
          <td>Data Type</td>
          <td>Data that is shared and read-only</td>
          <td>Counters and sums, often numerical</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Useful for large lookup tables or configurations</td>
          <td>Useful for aggregating metrics like counts</td>
      </tr>
      <tr>
          <td>Efficiency</td>
          <td>Reduces data transfer by broadcasting data once</td>
          <td>Efficient for aggregating values across tasks</td>
      </tr>
      <tr>
          <td>Mutability</td>
          <td>Immutable, read-only</td>
          <td>Mutable, can be updated during computation</td>
      </tr>
  </tbody>
</table>
<h3 id="spark-sql-vs-dataframe-api">Spark SQL vs. DataFrame API</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Spark SQL</th>
          <th>DataFrame API</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Interface</td>
          <td>Executes SQL queries</td>
          <td>Provides a programmatic interface</td>
      </tr>
      <tr>
          <td>Syntax</td>
          <td>Uses SQL-like syntax</td>
          <td>Uses function-based syntax</td>
      </tr>
      <tr>
          <td>Optimization</td>
          <td>Optimized with Catalyst</td>
          <td>Optimized with Catalyst</td>
      </tr>
  </tbody>
</table>
<h3 id="spark-streaming-vs-structured-streaming">Spark Streaming vs. Structured Streaming</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Spark Streaming</th>
          <th>Structured Streaming</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Processing</td>
          <td>Micro-batch processing</td>
          <td>Micro-batch and continuous processing</td>
      </tr>
      <tr>
          <td>API</td>
          <td>RDD-based API</td>
          <td>SQL-based API with DataFrame/Dataset support</td>
      </tr>
      <tr>
          <td>Complexity</td>
          <td>More complex and lower-level</td>
          <td>Simplified with high-level APIs</td>
      </tr>
      <tr>
          <td>Consistency</td>
          <td>Can be less consistent due to micro-batches</td>
          <td>Provides stronger consistency guarantees</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Can be slower for complex queries</td>
          <td>Better performance with optimizations</td>
      </tr>
  </tbody>
</table>
<h3 id="shuffle-vs-mapreduce">Shuffle vs. MapReduce</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Shuffle</th>
          <th>MapReduce</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Operation</td>
          <td>Data reorganization across partitions</td>
          <td>Data processing model for distributed computing</td>
      </tr>
      <tr>
          <td>Efficiency</td>
          <td>Can be costly due to data movement</td>
          <td>Designed for batch processing with high I/O</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Affects performance based on the amount of data movement</td>
          <td>Optimized for large-scale data processing but less efficient for iterative tasks</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Used in Spark for data redistribution</td>
          <td>Used in Hadoop for data processing tasks</td>
      </tr>
      <tr>
          <td>Implementation</td>
          <td>Integrated into Spark operations</td>
          <td>Core component of the Hadoop ecosystem</td>
      </tr>
  </tbody>
</table>
<h3 id="union-vs-join">Union vs. Join</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Union</th>
          <th>Join</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Operation</td>
          <td>Combines two DataFrames/RDDs into one</td>
          <td>Combines rows from two DataFrames/RDDs based on a key</td>
      </tr>
      <tr>
          <td>Data Requirements</td>
          <td>Requires same schema for both DataFrames/RDDs</td>
          <td>Requires a common key for joining</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Generally faster as it does not require key matching</td>
          <td>Can be slower due to key matching and shuffling</td>
      </tr>
      <tr>
          <td>Output</td>
          <td>Stacks data vertically</td>
          <td>Merges data horizontally based on keys</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Appending data or combining datasets</td>
          <td>Merging related data based on keys</td>
      </tr>
  </tbody>
</table>
<h3 id="executor-vs-driver">Executor vs. Driver</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Executor</th>
          <th>Driver</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Role</td>
          <td>Executes tasks and processes data</td>
          <td>Coordinates and manages the Spark application</td>
      </tr>
      <tr>
          <td>Memory</td>
          <td>Memory allocated per executor for data processing</td>
          <td>Memory used for managing application execution</td>
      </tr>
      <tr>
          <td>Lifecycle</td>
          <td>Exists throughout the application execution</td>
          <td>Starts and stops the Spark application</td>
      </tr>
      <tr>
          <td>Tasks</td>
          <td>Runs the tasks assigned by the driver</td>
          <td>Schedules and coordinates tasks and jobs</td>
      </tr>
      <tr>
          <td>Parallelism</td>
          <td>Multiple executors run in parallel</td>
          <td>Single driver coordinates multiple executors</td>
      </tr>
  </tbody>
</table>
<h3 id="checkpointing-vs-caching">Checkpointing vs. Caching</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Checkpointing</th>
          <th>Caching</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Purpose</td>
          <td>Provides fault tolerance and reliability</td>
          <td>Improves performance by storing intermediate data</td>
      </tr>
      <tr>
          <td>Storage</td>
          <td>Writes data to stable storage (e.g., HDFS)</td>
          <td>Stores data in memory or on disk (depends on storage level)</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Used for recovery in case of failures</td>
          <td>Used for optimizing repeated operations</td>
      </tr>
      <tr>
          <td>Impact</td>
          <td>Can be more costly and slow</td>
          <td>Generally faster but not suitable for fault tolerance</td>
      </tr>
      <tr>
          <td>Data</td>
          <td>Data is written to external storage</td>
          <td>Data is kept in memory or disk storage for quick access</td>
      </tr>
  </tbody>
</table>
<h3 id="reducebykey-vs-aggregatebykey">ReduceByKey vs. AggregateByKey</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>ReduceByKey</th>
          <th>AggregateByKey</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Operation</td>
          <td>Combines values with the same key using a function</td>
          <td>Performs custom aggregation and combinatory operations</td>
      </tr>
      <tr>
          <td>Efficiency</td>
          <td>More efficient for simple aggregations</td>
          <td>Flexible for complex aggregation scenarios</td>
      </tr>
      <tr>
          <td>Shuffling</td>
          <td>Involves shuffling but can be optimized</td>
          <td>Can be more complex due to custom aggregation</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Suitable for straightforward aggregations</td>
          <td>Ideal for advanced and custom aggregations</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Generally faster for simple operations</td>
          <td>Performance varies with complexity</td>
      </tr>
  </tbody>
</table>
<h3 id="sqlcontext-vs-hivecontext-vs-sparksession">SQLContext vs. HiveContext vs. SparkSession</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>SQLContext</th>
          <th>HiveContext</th>
          <th>SparkSession</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Purpose</td>
          <td>Provides SQL query capabilities</td>
          <td>Provides integration with Hive for SQL queries</td>
          <td>Unified entry point for Spark functionality</td>
      </tr>
      <tr>
          <td>Integration</td>
          <td>Basic SQL capabilities</td>
          <td>Integrates with Hive Metastore</td>
          <td>Combines SQL, DataFrame, and Streaming APIs</td>
      </tr>
      <tr>
          <td>Usage</td>
          <td>Legacy, less functionality</td>
          <td>Supports HiveQL and Hive UDFs</td>
          <td>Supports all Spark functionalities including Hive</td>
      </tr>
      <tr>
          <td>Configuration</td>
          <td>Less flexible and older</td>
          <td>Requires Hive setup and configuration</td>
          <td>Modern and flexible, manages configurations</td>
      </tr>
      <tr>
          <td>Capabilities</td>
          <td>Limited to SQL queries</td>
          <td>Extends SQL capabilities with Hive integration</td>
          <td>Comprehensive access to all Spark features</td>
      </tr>
  </tbody>
</table>
<h3 id="broadcast-join-vs-shuffle-join">Broadcast Join vs. Shuffle Join</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Broadcast Join</th>
          <th>Shuffle Join</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Operation</td>
          <td>Broadcasts a small dataset to all nodes</td>
          <td>Shuffles data across nodes for joining</td>
      </tr>
      <tr>
          <td>Data Size</td>
          <td>Suitable for small datasets</td>
          <td>Suitable for larger datasets</td>
      </tr>
      <tr>
          <td>Efficiency</td>
          <td>More efficient for small tables</td>
          <td>More suited for large datasets</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Faster due to reduced shuffling</td>
          <td>Can be slower due to extensive shuffling</td>
      </tr>
      <tr>
          <td>Use Case</td>
          <td>Use when one dataset is small relative to others</td>
          <td>Use when both datasets are large</td>
      </tr>
  </tbody>
</table>
<h3 id="sparkcontext-vs-sparksession">SparkContext vs. SparkSession</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>SparkContext</th>
          <th>SparkSession</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Purpose</td>
          <td>Entry point for Spark functionality</td>
          <td>Unified entry point for Spark functionalities</td>
      </tr>
      <tr>
          <td>Lifecycle</td>
          <td>Created before Spark jobs start</td>
          <td>Manages the Spark application lifecycle</td>
      </tr>
      <tr>
          <td>Functionality</td>
          <td>Provides access to RDD and basic Spark functionality</td>
          <td>Provides access to RDD, DataFrame, SQL, and Streaming APIs</td>
      </tr>
      <tr>
          <td>Configuration</td>
          <td>Configuration is less flexible</td>
          <td>More flexible and easier to configure</td>
      </tr>
      <tr>
          <td>Usage</td>
          <td>Older, used for legacy applications</td>
          <td>Modern and recommended for new applications</td>
      </tr>
  </tbody>
</table>
<h3 id="structured-streaming-vs-spark-streaming">Structured Streaming vs. Spark Streaming</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Structured Streaming</th>
          <th>Spark Streaming</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Processing</td>
          <td>Micro-batch and continuous processing</td>
          <td>Micro-batch processing</td>
      </tr>
      <tr>
          <td>API</td>
          <td>SQL-based API with DataFrame/Dataset support</td>
          <td>RDD-based API</td>
      </tr>
      <tr>
          <td>Complexity</td>
          <td>Simplified and high-level</td>
          <td>More complex and low-level</td>
      </tr>
      <tr>
          <td>Consistency</td>
          <td>Provides stronger consistency guarantees</td>
          <td>Can be less consistent due to micro-batches</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Better performance with built-in optimizations</td>
          <td>Can be slower for complex queries</td>
      </tr>
  </tbody>
</table>
<h3 id="partitioning-vs-bucketing">Partitioning vs. Bucketing</h3>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Partitioning</th>
          <th>Bucketing</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Purpose</td>
          <td>Divides data into multiple partitions based on a key</td>
          <td>Divides data into buckets based on a hash function</td>
      </tr>
      <tr>
          <td>Usage</td>
          <td>Used to optimize queries by reducing data scanned</td>
          <td>Used to improve join performance and maintain sorted data</td>
      </tr>
      <tr>
          <td>Shuffling</td>
          <td>Reduces shuffling by placing related data together</td>
          <td>Reduces shuffle during joins and aggregations</td>
      </tr>
      <tr>
          <td>Data Layout</td>
          <td>Data is physically separated based on partition key</td>
          <td>Data is organized into fixed-size buckets</td>
      </tr>
      <tr>
          <td>Performance</td>
          <td>Improves performance for queries involving partition keys</td>
          <td>Enhances performance for join operations</td>
      </tr>
  </tbody>
</table>

  <footer class="footline">
  </footer>
</article>
          </section>
<article class="chapter narrow">
  <header class="headline">
  </header>
<div class="article-subheading">Chapter 4</div>

<h1 id="practice-sets">Practice Sets</h1>

<ul class="children children-li children-sort-">
  <li class="children-title"><a href="/practice/leetcode-sql/">SQL LeetCode</a><ul></ul></li>
  <li class="children-title"><a href="/practice/pyspark1/">Pyspark 1</a><ul></ul></li>
</ul>

  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Practice Sets</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="sql-leetcode">SQL LeetCode</h1>

<h2 id="175-combine-two-tables">175. Combine Two Tables</h2>
<h4 id="description">Description</h4>
<p><strong>Table: Person</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>PersonId</td>
          <td>int</td>
      </tr>
      <tr>
          <td>FirstName</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>LastName</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>PersonId</strong> is the primary key column for this table.</li>
</ul>
<p><strong>Table: Address</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>AddressId</td>
          <td>int</td>
      </tr>
      <tr>
          <td>PersonId</td>
          <td>int</td>
      </tr>
      <tr>
          <td>City</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>State</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>AddressId</strong> is the primary key column for this table.</li>
</ul>
<p>Write a SQL query for a report that provides the following information for each person in the Person table, regardless if there is an address for them:</p>
<ul>
<li><strong>FirstName</strong></li>
<li><strong>LastName</strong></li>
<li><strong>City</strong></li>
<li><strong>State</strong></li>
</ul>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">LastName</span><span class="p">,</span><span class="w"> </span><span class="n">City</span><span class="p">,</span><span class="w"> </span><span class="k">State</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">PersonId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">PersonId</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="176-second-highest-salary">176. Second Highest Salary</h2>
<h4 id="description-1">Description</h4>
<p>Write a SQL query to get the second highest salary from the <strong>Employee</strong> table.</p>
<p><strong>Table: Employee</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>Salary</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>For example, given the above Employee table:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Salary</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>100</td>
      </tr>
      <tr>
          <td>2</td>
          <td>200</td>
      </tr>
      <tr>
          <td>3</td>
          <td>300</td>
      </tr>
  </tbody>
</table>
<p>The query should return <strong>200</strong> as the second highest salary.<br>
If there is no second highest salary, then the query should return <strong>null</strong>.</p>
<p><strong>Result Table:</strong></p>
<table>
  <thead>
      <tr>
          <th>SecondHighestSalary</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>200</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">IFNULL</span><span class="p">((</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">Salary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">),</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">SecondHighestSalary</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="177-nth-highest-salary">177. Nth Highest Salary</h2>
<h4 id="description-2">Description</h4>
<p>Write a SQL query to get the <strong>nth highest salary</strong> from the <strong>Employee</strong> table.</p>
<p><strong>Table: Employee</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>Salary</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>For example, given the above Employee table:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Salary</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>100</td>
      </tr>
      <tr>
          <td>2</td>
          <td>200</td>
      </tr>
      <tr>
          <td>3</td>
          <td>300</td>
      </tr>
  </tbody>
</table>
<p>The nth highest salary where n = 2 is <strong>200</strong>.<br>
If there is no nth highest salary, then the query should return <strong>null</strong>.</p>
<p><strong>Result Table:</strong></p>
<table>
  <thead>
      <tr>
          <th>getNthHighestSalary(2)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>200</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">getNthHighestSalary</span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="nb">INT</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">INT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="nb">INT</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SET</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">Salary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OFFSET</span><span class="w"> </span><span class="n">M</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="178-rank-scores">178. Rank Scores</h2>
<h4 id="description-3">Description</h4>
<p>Write a SQL query to rank scores. If there is a tie between two scores, both should have the <strong>same ranking</strong>.<br>
After a tie, the next ranking number should be the next consecutive integer value (no &ldquo;holes&rdquo; between ranks).</p>
<p><strong>Table: Scores</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>Score</td>
          <td>float</td>
      </tr>
  </tbody>
</table>
<p>For example, given the above Scores table:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Score</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>3.50</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3.65</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4.00</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3.85</td>
      </tr>
      <tr>
          <td>5</td>
          <td>4.00</td>
      </tr>
      <tr>
          <td>6</td>
          <td>3.65</td>
      </tr>
  </tbody>
</table>
<p>The query should generate the following report (ordered by highest score):</p>
<table>
  <thead>
      <tr>
          <th>Score</th>
          <th>Rank</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>4.00</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4.00</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3.85</td>
          <td>2</td>
      </tr>
      <tr>
          <td>3.65</td>
          <td>3</td>
      </tr>
      <tr>
          <td>3.65</td>
          <td>3</td>
      </tr>
      <tr>
          <td>3.50</td>
          <td>4</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MS SQL Server)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">Score</span><span class="p">,</span><span class="w"> </span><span class="n">DENSE_RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Scores</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL using Variables)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Score</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">rank</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">rank</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">prev</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">prev</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">Score</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Scores</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">rank</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">prev</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL using COUNT)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Score</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Scores</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">Score</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Scores</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Score</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="180-consecutive-numbers">180. Consecutive Numbers</h2>
<h4 id="description-4">Description</h4>
<p>Write a SQL query to find all numbers that appear <strong>at least three times consecutively</strong>.</p>
<p><strong>Table: Logs</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>Num</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>For example, given the above Logs table:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Num</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2</td>
      </tr>
      <tr>
          <td>5</td>
          <td>1</td>
      </tr>
      <tr>
          <td>6</td>
          <td>2</td>
      </tr>
      <tr>
          <td>7</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p>The number <code>1</code> is the only number that appears consecutively at least three times.</p>
<p><strong>Result Table:</strong></p>
<table>
  <thead>
      <tr>
          <th>ConsecutiveNums</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL, user-defined variables)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">Num</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ConsecutiveNums</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Num</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">cnt</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="o">@</span><span class="n">prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">@</span><span class="n">prev</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">Num</span><span class="p">),</span><span class="w"> </span><span class="o">@</span><span class="n">cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">freq</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Logs</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">cnt</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">prev</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">Num</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">n</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">freq</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="181-employees-earning-more-than-their-managers">181. Employees Earning More Than Their Managers</h2>
<h4 id="description-5">Description</h4>
<p>The <strong>Employee</strong> table holds all employees including their managers.<br>
Every employee has an <code>Id</code>, and there is also a column for the <code>ManagerId</code>.</p>
<p><strong>Table: Employee</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>Name</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>Salary</td>
          <td>int</td>
      </tr>
      <tr>
          <td>ManagerId</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Name</th>
          <th>Salary</th>
          <th>ManagerId</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Joe</td>
          <td>70000</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Henry</td>
          <td>80000</td>
          <td>4</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Sam</td>
          <td>60000</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Max</td>
          <td>90000</td>
          <td>NULL</td>
      </tr>
  </tbody>
</table>
<p>Write a SQL query to find employees who earn <strong>more than their managers</strong>.<br>
For the above table, Joe is the only employee who earns more than his manager.</p>
<p><strong>Result Table:</strong></p>
<table>
  <thead>
      <tr>
          <th>Employee</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Joe</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Employee</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ManagerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">Salary</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="182-duplicate-emails">182. Duplicate Emails</h2>
<h4 id="description-6">Description</h4>
<p>Write a SQL query to find all <strong>duplicate emails</strong> in a table named <strong>Person</strong>.</p>
<p><strong>Table: Person</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>Email</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Email</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td><a href="mailto:a@b.com" rel="external" target="_blank">a@b.com</a></td>
      </tr>
      <tr>
          <td>2</td>
          <td><a href="mailto:c@d.com" rel="external" target="_blank">c@d.com</a></td>
      </tr>
      <tr>
          <td>3</td>
          <td><a href="mailto:a@b.com" rel="external" target="_blank">a@b.com</a></td>
      </tr>
  </tbody>
</table>
<p>The query should return:</p>
<table>
  <thead>
      <tr>
          <th>Email</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="mailto:a@b.com" rel="external" target="_blank">a@b.com</a></td>
      </tr>
  </tbody>
</table>
<p><strong>Note:</strong> All emails are in lowercase.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">Email</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Email</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">Email</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="183-customers-who-never-order">183. Customers Who Never Order</h2>
<h4 id="description-7">Description</h4>
<p>Suppose that a website contains two tables: <strong>Customers</strong> and <strong>Orders</strong>.<br>
Write a SQL query to find all customers who <strong>never order anything</strong>.</p>
<p><strong>Table: Customers</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>Name</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Joe</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Henry</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Sam</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Max</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Orders</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>CustomerId</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>CustomerId</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>Using the above tables, the query should return:</p>
<table>
  <thead>
      <tr>
          <th>Customers</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Henry</td>
      </tr>
      <tr>
          <td>Max</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">CustomerId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="196-delete-duplicate-emails">196. Delete Duplicate Emails</h2>
<h4 id="description-8">Description</h4>
<p>Write a SQL query to <strong>delete all duplicate email entries</strong> in a table named <strong>Person</strong>,<br>
keeping only unique emails based on the <strong>smallest Id</strong>.</p>
<p><strong>Table: Person</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>Email</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Email</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td><a href="mailto:john@example.com" rel="external" target="_blank">john@example.com</a></td>
      </tr>
      <tr>
          <td>2</td>
          <td><a href="mailto:bob@example.com" rel="external" target="_blank">bob@example.com</a></td>
      </tr>
      <tr>
          <td>3</td>
          <td><a href="mailto:john@example.com" rel="external" target="_blank">john@example.com</a></td>
      </tr>
  </tbody>
</table>
<p>After running the query, the table should look like:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Email</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td><a href="mailto:john@example.com" rel="external" target="_blank">john@example.com</a></td>
      </tr>
      <tr>
          <td>2</td>
          <td><a href="mailto:bob@example.com" rel="external" target="_blank">bob@example.com</a></td>
      </tr>
  </tbody>
</table>
<p><strong>Note:</strong> Your output is the whole Person table after executing your SQL. Use <code>DELETE</code> statement.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL, using subquery)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">DELETE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Email</span><span class="p">,</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">minId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">Email</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">q</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">Email</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">minId</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL, self join)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">DELETE</span><span class="w"> </span><span class="n">p1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">Email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">Email</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">Id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="197-rising-temperature">197. Rising Temperature</h2>
<h4 id="description-9">Description</h4>
<p>Given a <strong>Weather</strong> table, write a SQL query to find all dates&rsquo; <strong>Ids</strong> with higher temperature compared to the previous (yesterday&rsquo;s) date.</p>
<p><strong>Table: Weather</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>RecordDate</td>
          <td>date</td>
      </tr>
      <tr>
          <td>Temperature</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>RecordDate</th>
          <th>Temperature</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2015-01-01</td>
          <td>10</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2015-01-02</td>
          <td>25</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2015-01-03</td>
          <td>20</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2015-01-04</td>
          <td>30</td>
      </tr>
  </tbody>
</table>
<p>The query should return the following Ids:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2</td>
      </tr>
      <tr>
          <td>4</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">w1</span><span class="p">.</span><span class="n">Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Weather</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">Weather</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">w2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">DATEDIFF</span><span class="p">(</span><span class="n">w1</span><span class="p">.</span><span class="n">RecordDate</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">.</span><span class="n">RecordDate</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">w1</span><span class="p">.</span><span class="n">Temperature</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">w2</span><span class="p">.</span><span class="n">Temperature</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="511-game-play-analysis-i">511. Game Play Analysis I</h2>
<h4 id="description-10">Description</h4>
<p><strong>Table: Activity</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>player_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>device_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>event_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>games_played</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(player_id, event_date)</code> is the primary key of this table.</li>
<li>This table shows the activity of players of a game.</li>
<li>Each row is a record of a player who logged in and played a number of games (possibly 0) before logging out on some day using some device.</li>
</ul>
<p>Write an SQL query that reports the <strong>first login date</strong> for each player.</p>
<p><strong>Example: Activity table</strong></p>
<table>
  <thead>
      <tr>
          <th>player_id</th>
          <th>device_id</th>
          <th>event_date</th>
          <th>games_played</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2016-03-01</td>
          <td>5</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2016-05-02</td>
          <td>6</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
          <td>2017-06-25</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
          <td>2016-03-02</td>
          <td>0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>2018-07-03</td>
          <td>5</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>player_id</th>
          <th>first_login</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2016-03-01</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2017-06-25</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2016-03-02</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">event_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">first_login</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">player_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">player_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="512-game-play-analysis-ii">512. Game Play Analysis II</h2>
<h4 id="description-11">Description</h4>
<p><strong>Table: Activity</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>player_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>device_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>event_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>games_played</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(player_id, event_date)</code> is the primary key of this table.</li>
<li>This table shows the activity of players of a game.</li>
<li>Each row is a record of a player who logged in and played a number of games (possibly 0) before logging out on some day using some device.</li>
</ul>
<p>Write an SQL query that reports the <strong>device that is first logged in</strong> for each player.</p>
<p><strong>Example: Activity table</strong></p>
<table>
  <thead>
      <tr>
          <th>player_id</th>
          <th>device_id</th>
          <th>event_date</th>
          <th>games_played</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2016-03-01</td>
          <td>5</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2016-05-02</td>
          <td>6</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
          <td>2017-06-25</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
          <td>2016-03-02</td>
          <td>0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>2018-07-03</td>
          <td>5</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>player_id</th>
          <th>device_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="n">device_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="n">event_date</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">event_date</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">player_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="534-game-play-analysis-iii">534. Game Play Analysis III</h2>
<h4 id="description-12">Description</h4>
<p><strong>Table: Activity</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>player_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>device_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>event_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>games_played</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(player_id, event_date)</code> is the primary key of this table.</li>
<li>This table shows the activity of players of a game.</li>
<li>Each row is a record of a player who logged in and played a number of games (possibly 0) before logging out on some day using some device.</li>
</ul>
<p>Write an SQL query that reports for each player and date, <strong>how many games played so far by the player</strong>.<br>
That is, the total number of games played by the player <strong>until that date</strong>. Only consider the days the player logged in.</p>
<p><strong>Example: Activity table</strong></p>
<table>
  <thead>
      <tr>
          <th>player_id</th>
          <th>device_id</th>
          <th>event_date</th>
          <th>games_played</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2016-03-01</td>
          <td>5</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2016-05-02</td>
          <td>6</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
          <td>2017-06-25</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
          <td>2016-03-02</td>
          <td>0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>2018-07-03</td>
          <td>5</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>player_id</th>
          <th>event_date</th>
          <th>games_played_so_far</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2016-03-01</td>
          <td>5</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2016-05-02</td>
          <td>11</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2017-06-25</td>
          <td>12</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2016-03-02</td>
          <td>0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2018-07-03</td>
          <td>5</td>
      </tr>
  </tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>For player 1: 5 + 6 = 11 games by 2016-05-02, 5 + 6 + 1 = 12 games by 2017-06-25.</li>
<li>For player 3: 0 + 5 = 5 games by 2018-07-03.</li>
</ul>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL, using user-defined variables)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="n">event_date</span><span class="p">,</span><span class="w"> </span><span class="n">games_played_so_far</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">player_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">event_date</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">games</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">player_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">player</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">games</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">games_played</span><span class="p">,</span><span class="w"> </span><span class="n">games_played</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">games_played_so_far</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">player</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">player_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">player_id</span><span class="p">,</span><span class="w"> </span><span class="n">event_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">player</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">games</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="570-managers-with-at-least-5-direct-reports">570. Managers with at Least 5 Direct Reports</h2>
<h4 id="description-13">Description</h4>
<p>The <strong>Employee</strong> table holds all employees including their managers.<br>
Every employee has an <code>Id</code>, and there is also a column for the <code>ManagerId</code>.</p>
<p><strong>Table: Employee</strong></p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Name</th>
          <th>Department</th>
          <th>ManagerId</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>101</td>
          <td>John</td>
          <td>A</td>
          <td>null</td>
      </tr>
      <tr>
          <td>102</td>
          <td>Dan</td>
          <td>A</td>
          <td>101</td>
      </tr>
      <tr>
          <td>103</td>
          <td>James</td>
          <td>A</td>
          <td>101</td>
      </tr>
      <tr>
          <td>104</td>
          <td>Amy</td>
          <td>A</td>
          <td>101</td>
      </tr>
      <tr>
          <td>105</td>
          <td>Anne</td>
          <td>A</td>
          <td>101</td>
      </tr>
      <tr>
          <td>106</td>
          <td>Ron</td>
          <td>B</td>
          <td>101</td>
      </tr>
  </tbody>
</table>
<p>Write a SQL query to find <strong>managers with at least 5 direct reports</strong>.<br>
No one would report to himself.</p>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>Name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>John</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">Name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ManagerId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ManagerId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="577-employee-bonus">577. Employee Bonus</h2>
<h4 id="description-14">Description</h4>
<p>Select all employees&rsquo; <strong>name</strong> and <strong>bonus</strong> whose bonus is <strong>less than 1000</strong>.</p>
<p><strong>Table: Employee</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>empId</td>
          <td>int</td>
      </tr>
      <tr>
          <td>name</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>supervisor</td>
          <td>int</td>
      </tr>
      <tr>
          <td>salary</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>empId</th>
          <th>name</th>
          <th>supervisor</th>
          <th>salary</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>John</td>
          <td>3</td>
          <td>1000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Dan</td>
          <td>3</td>
          <td>2000</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Brad</td>
          <td>null</td>
          <td>4000</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Thomas</td>
          <td>3</td>
          <td>4000</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Bonus</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>empId</td>
          <td>int</td>
      </tr>
      <tr>
          <td>bonus</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>empId</th>
          <th>bonus</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2</td>
          <td>500</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2000</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>name</th>
          <th>bonus</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>John</td>
          <td>null</td>
      </tr>
      <tr>
          <td>Dan</td>
          <td>500</td>
      </tr>
      <tr>
          <td>Brad</td>
          <td>null</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">bonus</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Bonus</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">empId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">empId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">bonus</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">bonus</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="584-find-customer-referee">584. Find Customer Referee</h2>
<h4 id="description-15">Description</h4>
<p>Given a table <strong>customer</strong> holding customer information and the referee.</p>
<p><strong>Table: customer</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>name</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>referee_id</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>Example data:</p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>name</th>
          <th>referee_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Will</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Jane</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Alex</td>
          <td>2</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Bill</td>
          <td>NULL</td>
      </tr>
      <tr>
          <td>5</td>
          <td>Zack</td>
          <td>1</td>
      </tr>
      <tr>
          <td>6</td>
          <td>Mark</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p>Write a query to return the list of <strong>customers NOT referred by the person with id <code>2</code></strong>.</p>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Will</td>
      </tr>
      <tr>
          <td>Jane</td>
      </tr>
      <tr>
          <td>Bill</td>
      </tr>
      <tr>
          <td>Zack</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">customer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">referee_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">referee_id</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="586-customer-placing-the-largest-number-of-orders">586. Customer Placing the Largest Number of Orders</h2>
<h4 id="description-16">Description</h4>
<p>Query the <code>customer_number</code> from the <strong>orders</strong> table for the customer who has placed the <strong>largest number of orders</strong>.<br>
It is guaranteed that exactly one customer will have placed more orders than any other customer.</p>
<p><strong>Table: orders</strong></p>
<table>
  <thead>
      <tr>
          <th>Column</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>order_number (PK)</td>
          <td>int</td>
      </tr>
      <tr>
          <td>customer_number</td>
          <td>int</td>
      </tr>
      <tr>
          <td>order_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>required_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>shipped_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>status</td>
          <td>char(15)</td>
      </tr>
      <tr>
          <td>comment</td>
          <td>char(200)</td>
      </tr>
  </tbody>
</table>
<p><strong>Example data</strong></p>
<table>
  <thead>
      <tr>
          <th>order_number</th>
          <th>customer_number</th>
          <th>order_date</th>
          <th>required_date</th>
          <th>shipped_date</th>
          <th>status</th>
          <th>comment</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2017-04-09</td>
          <td>2017-04-13</td>
          <td>2017-04-12</td>
          <td>Closed</td>
          <td></td>
      </tr>
      <tr>
          <td>2</td>
          <td>2</td>
          <td>2017-04-15</td>
          <td>2017-04-20</td>
          <td>2017-04-18</td>
          <td>Closed</td>
          <td></td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>2017-04-16</td>
          <td>2017-04-25</td>
          <td>2017-04-20</td>
          <td>Closed</td>
          <td></td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2017-04-18</td>
          <td>2017-04-28</td>
          <td>2017-04-25</td>
          <td>Closed</td>
          <td></td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>customer_number</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>3</td>
      </tr>
  </tbody>
</table>
<p><strong>Explanation:</strong><br>
Customer &lsquo;3&rsquo; has 2 orders, which is greater than customer &lsquo;1&rsquo; or &lsquo;2&rsquo;, who each have only 1 order.</p>
<p><strong>Follow-up:</strong><br>
If more than one customer has the largest number of orders, the query can return all such <code>customer_number</code>.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_number</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_number</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cnt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_number</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">cnt</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="595-big-countries">595. Big Countries</h2>
<h4 id="description-17">Description</h4>
<p>There is a table <strong>World</strong>:</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>name</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>continent</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>area</td>
          <td>int</td>
      </tr>
      <tr>
          <td>population</td>
          <td>int</td>
      </tr>
      <tr>
          <td>gdp</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p>A country is <strong>big</strong> if it has <strong>an area bigger than 3 million sq km</strong> or <strong>a population of more than 25 million</strong>.</p>
<p>Write a SQL query to output <strong>big countries&rsquo; name, population, and area</strong>.</p>
<p><strong>Example data</strong></p>
<table>
  <thead>
      <tr>
          <th>name</th>
          <th>continent</th>
          <th>area</th>
          <th>population</th>
          <th>gdp</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Afghanistan</td>
          <td>Asia</td>
          <td>652230</td>
          <td>25500100</td>
          <td>20343000</td>
      </tr>
      <tr>
          <td>Albania</td>
          <td>Europe</td>
          <td>28748</td>
          <td>2831741</td>
          <td>12960000</td>
      </tr>
      <tr>
          <td>Algeria</td>
          <td>Africa</td>
          <td>2381741</td>
          <td>37100000</td>
          <td>188681000</td>
      </tr>
      <tr>
          <td>Andorra</td>
          <td>Europe</td>
          <td>468</td>
          <td>78115</td>
          <td>3712000</td>
      </tr>
      <tr>
          <td>Angola</td>
          <td>Africa</td>
          <td>1246700</td>
          <td>20609294</td>
          <td>100990000</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>name</th>
          <th>population</th>
          <th>area</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Afghanistan</td>
          <td>25500100</td>
          <td>652230</td>
      </tr>
      <tr>
          <td>Algeria</td>
          <td>37100000</td>
          <td>2381741</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">population</span><span class="p">,</span><span class="w"> </span><span class="n">area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">World</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">area</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3000000</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">population</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">25000000</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="596-classes-more-than-5-students">596. Classes More Than 5 Students</h2>
<h4 id="description-18">Description</h4>
<p>There is a table <strong>courses</strong> with columns <code>student</code> and <code>class</code>.<br>
List out all <strong>classes</strong> which have <strong>5 or more students</strong>.<br>
Duplicate students in a class should <strong>not</strong> be counted.</p>
<p><strong>Example data</strong></p>
<table>
  <thead>
      <tr>
          <th>student</th>
          <th>class</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>B</td>
          <td>English</td>
      </tr>
      <tr>
          <td>C</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>D</td>
          <td>Biology</td>
      </tr>
      <tr>
          <td>E</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>F</td>
          <td>Computer</td>
      </tr>
      <tr>
          <td>G</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>H</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>I</td>
          <td>Math</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>class</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Math</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">class</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">courses</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">class</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">student</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="597-friend-requests-i-overall-acceptance-rate">597. Friend Requests I: Overall Acceptance Rate</h2>
<h4 id="description-19">Description</h4>
<p>In a social network, people send friend requests and accept others’ requests.<br>
Given two tables:</p>
<p><strong>Table: friend_request</strong></p>
<table>
  <thead>
      <tr>
          <th>sender_id</th>
          <th>send_to_id</th>
          <th>request_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2016-06-01</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
          <td>2016-06-01</td>
      </tr>
      <tr>
          <td>1</td>
          <td>4</td>
          <td>2016-06-01</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
          <td>2016-06-02</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>2016-06-09</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: request_accepted</strong></p>
<table>
  <thead>
      <tr>
          <th>requester_id</th>
          <th>accepter_id</th>
          <th>accept_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2016-06-03</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
          <td>2016-06-08</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
          <td>2016-06-08</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>2016-06-09</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>2016-06-10</td>
      </tr>
  </tbody>
</table>
<p>Write a query to find the <strong>overall acceptance rate of requests</strong> rounded to 2 decimals:<br>
<code>accept_rate = number of unique accepted requests ÷ number of unique requests</code>.</p>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>accept_rate</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0.80</td>
      </tr>
  </tbody>
</table>
<p><strong>Note:</strong></p>
<ul>
<li>Only <strong>distinct</strong> requests and acceptances are counted.</li>
<li>If there are no requests, return <code>0.00</code>.</li>
<li>Accepted requests may not appear in the <code>friend_request</code> table.</li>
</ul>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">ROUND</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">accepts</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">requests</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">accept_rate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">sender_id</span><span class="p">,</span><span class="w"> </span><span class="n">send_to_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">requests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">friend_request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">requester_id</span><span class="p">,</span><span class="w"> </span><span class="n">accepter_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">accepts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">request_accepted</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="603-consecutive-available-seats">603. Consecutive Available Seats</h2>
<h4 id="description-20">Description</h4>
<p>Several friends at a cinema want to reserve <strong>consecutive available seats</strong>.<br>
Given a table <strong>cinema</strong>:</p>
<table>
  <thead>
      <tr>
          <th>seat_id</th>
          <th>free</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
          <td>1</td>
      </tr>
      <tr>
          <td>5</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>seat_id</code> is an auto-increment integer.</li>
<li><code>free</code> is a boolean (<code>1</code> = free, <code>0</code> = occupied).</li>
<li>Consecutive available seats are <strong>2 or more consecutive free seats</strong>.</li>
</ul>
<p>Return all consecutive available seats <strong>ordered by <code>seat_id</code></strong>.</p>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>seat_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>3</td>
      </tr>
      <tr>
          <td>4</td>
      </tr>
      <tr>
          <td>5</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">seat_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">cinema</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">cinema</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">cinema</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">seat_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">seat_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">seat_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c3</span><span class="p">.</span><span class="n">seat_id</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="k">free</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="k">free</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">c3</span><span class="p">.</span><span class="k">free</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Alternative solution
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">seat_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">cinema</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">cinema</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="k">free</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="k">free</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">seat_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">seat_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">seat_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">cinema</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">cinema</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">c2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="k">free</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="k">free</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">c1</span><span class="p">.</span><span class="n">seat_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c2</span><span class="p">.</span><span class="n">seat_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seat_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="607-sales-person">607. Sales Person</h2>
<h4 id="description-21">Description</h4>
<p>Given three tables: <strong>salesperson</strong>, <strong>company</strong>, and <strong>orders</strong>,<br>
output all salesperson names who <strong>did not have sales</strong> to company <code>'RED'</code>.</p>
<p><strong>Table: salesperson</strong></p>
<table>
  <thead>
      <tr>
          <th>sales_id</th>
          <th>name</th>
          <th>salary</th>
          <th>commission_rate</th>
          <th>hire_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>John</td>
          <td>100000</td>
          <td>6</td>
          <td>4/1/2006</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Amy</td>
          <td>120000</td>
          <td>5</td>
          <td>5/1/2010</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Mark</td>
          <td>65000</td>
          <td>12</td>
          <td>12/25/2008</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Pam</td>
          <td>25000</td>
          <td>25</td>
          <td>1/1/2005</td>
      </tr>
      <tr>
          <td>5</td>
          <td>Alex</td>
          <td>50000</td>
          <td>10</td>
          <td>2/3/2007</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: company</strong></p>
<table>
  <thead>
      <tr>
          <th>com_id</th>
          <th>name</th>
          <th>city</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>RED</td>
          <td>Boston</td>
      </tr>
      <tr>
          <td>2</td>
          <td>ORANGE</td>
          <td>New York</td>
      </tr>
      <tr>
          <td>3</td>
          <td>YELLOW</td>
          <td>Boston</td>
      </tr>
      <tr>
          <td>4</td>
          <td>GREEN</td>
          <td>Austin</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: orders</strong></p>
<table>
  <thead>
      <tr>
          <th>order_id</th>
          <th>order_date</th>
          <th>com_id</th>
          <th>sales_id</th>
          <th>amount</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1/1/2014</td>
          <td>3</td>
          <td>4</td>
          <td>100000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2/1/2014</td>
          <td>4</td>
          <td>5</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3/1/2014</td>
          <td>1</td>
          <td>1</td>
          <td>50000</td>
      </tr>
      <tr>
          <td>4</td>
          <td>4/1/2014</td>
          <td>1</td>
          <td>4</td>
          <td>25000</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Amy</td>
      </tr>
      <tr>
          <td>Mark</td>
      </tr>
      <tr>
          <td>Alex</td>
      </tr>
  </tbody>
</table>
<p><strong>Explanation:</strong><br>
Only &lsquo;John&rsquo; and &lsquo;Pam&rsquo; have sales to <code>'RED'</code>. Output all other salesperson names.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">salesperson</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">sales_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">sales_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">company</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">com_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">com_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RED&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="608-tree-node">608. Tree Node</h2>
<h4 id="description-22">Description</h4>
<p>Given a table <strong>tree</strong> where <code>id</code> is the identifier of a tree node and <code>p_id</code> is its parent node&rsquo;s id:</p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>p_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>null</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p>Each node can be one of three types:</p>
<ul>
<li><strong>Leaf</strong>: Node with no children.</li>
<li><strong>Root</strong>: Node with no parent.</li>
<li><strong>Inner</strong>: Node with parent and at least one child.</li>
</ul>
<p>Write a query to print the node <code>id</code> and its <code>Type</code>. Sort output by <code>id</code>.</p>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Root</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Inner</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Leaf</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Leaf</td>
      </tr>
      <tr>
          <td>5</td>
          <td>Leaf</td>
      </tr>
  </tbody>
</table>
<p><strong>Explanation:</strong></p>
<ul>
<li>Node <code>1</code> is <strong>Root</strong> because its parent is <code>NULL</code>.</li>
<li>Node <code>2</code> is <strong>Inner</strong> because it has a parent and children.</li>
<li>Nodes <code>3</code>, <code>4</code>, and <code>5</code> are <strong>Leaf</strong> because they have a parent and no children.</li>
</ul>
<p>Tree visualization:</p>
<pre class="mermaid align-center ">graph TD
    n1[1]
    n2[2]
    n3[3]
    n4[4]
    n5[5]

    n1 --&gt; n2
    n1 --&gt; n3
    n2 --&gt; n4
    n2 --&gt; n5</pre>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">p_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Root&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">p_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">p_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tree</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Inner&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Leaf&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">Type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">tree</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="610-triangle-judgement">610. Triangle Judgement</h2>
<h4 id="description-23">Description</h4>
<p>Given a table <strong>triangle</strong> with columns <code>x</code>, <code>y</code>, and <code>z</code> representing the lengths of three sides,<br>
write a query to determine whether the sides can form a triangle.</p>
<table>
  <thead>
      <tr>
          <th>x</th>
          <th>y</th>
          <th>z</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>13</td>
          <td>15</td>
          <td>30</td>
      </tr>
      <tr>
          <td>10</td>
          <td>20</td>
          <td>15</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>x</th>
          <th>y</th>
          <th>z</th>
          <th>triangle</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>13</td>
          <td>15</td>
          <td>30</td>
          <td>No</td>
      </tr>
      <tr>
          <td>10</td>
          <td>20</td>
          <td>15</td>
          <td>Yes</td>
      </tr>
  </tbody>
</table>
<p><strong>Explanation:</strong><br>
A triangle is valid if the sum of any two sides is greater than the third side.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Yes&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;No&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">triangle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">triangle</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="612-shortest-distance-in-a-plane">612. Shortest Distance in a Plane</h2>
<h4 id="description-24">Description</h4>
<p>Given a table <strong>point_2d</strong> with coordinates <code>(x, y)</code> of unique points in a plane,<br>
write a query to find the shortest distance between any two points, rounded to 2 decimals.</p>
<table>
  <thead>
      <tr>
          <th>x</th>
          <th>y</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>-1</td>
          <td>-1</td>
      </tr>
      <tr>
          <td>0</td>
          <td>0</td>
      </tr>
      <tr>
          <td>-1</td>
          <td>-2</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>shortest</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1.00</td>
      </tr>
  </tbody>
</table>
<p><strong>Explanation:</strong><br>
The shortest distance is <code>1.00</code>, between points <code>(-1,-1)</code> and <code>(-1,-2)</code>.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">ROUND</span><span class="p">(</span><span class="k">MIN</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shortest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="n">SQRT</span><span class="p">(</span><span class="n">POWER</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">POWER</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dist</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">point_2d</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">point_2d</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">d</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="613-shortest-distance-in-a-line">613. Shortest Distance in a Line</h2>
<h4 id="description-25">Description</h4>
<p>Given a table <strong>point</strong> with the x-coordinates of unique points on the x-axis,<br>
write a query to find the shortest distance between any two points.</p>
<table>
  <thead>
      <tr>
          <th>x</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>-1</td>
      </tr>
      <tr>
          <td>0</td>
      </tr>
      <tr>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>shortest</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p><strong>Explanation:</strong><br>
The shortest distance is <code>1</code>, between points <code>-1</code> and <code>0</code>.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="k">ABS</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">shortest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="619-biggest-single-number">619. Biggest Single Number</h2>
<h4 id="description-26">Description</h4>
<p>Given a table <strong>my_numbers</strong> containing numbers in column <code>num</code> (may include duplicates),<br>
write a query to find the largest number that appears only once.</p>
<table>
  <thead>
      <tr>
          <th>num</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>8</td>
      </tr>
      <tr>
          <td>8</td>
      </tr>
      <tr>
          <td>3</td>
      </tr>
      <tr>
          <td>3</td>
      </tr>
      <tr>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
      </tr>
      <tr>
          <td>5</td>
      </tr>
      <tr>
          <td>6</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table</strong></p>
<table>
  <thead>
      <tr>
          <th>num</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>6</td>
      </tr>
  </tbody>
</table>
<p><strong>Explanation:</strong><br>
The number <code>6</code> is the largest number that appears exactly once.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">num</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">my_numbers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">num</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">n</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="620-not-boring-movies">620. Not Boring Movies</h2>
<h4 id="description-27">Description</h4>
<p>Given a table <strong>cinema</strong> with columns <code>id</code>, <code>movie</code>, <code>description</code>, and <code>rating</code>,<br>
write a query to output movies with <strong>odd-numbered IDs</strong> and a description that is <strong>not &lsquo;boring&rsquo;</strong>, ordered by <code>rating</code> descending.</p>
<p><strong>Table: cinema</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>movie</th>
          <th>description</th>
          <th>rating</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>War</td>
          <td>great 3D</td>
          <td>8.9</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Science</td>
          <td>fiction</td>
          <td>8.5</td>
      </tr>
      <tr>
          <td>3</td>
          <td>irish</td>
          <td>boring</td>
          <td>6.2</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Ice song</td>
          <td>Fantacy</td>
          <td>8.6</td>
      </tr>
      <tr>
          <td>5</td>
          <td>House card</td>
          <td>Interesting</td>
          <td>9.1</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected output</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>movie</th>
          <th>description</th>
          <th>rating</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>5</td>
          <td>House card</td>
          <td>Interesting</td>
          <td>9.1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>War</td>
          <td>great 3D</td>
          <td>8.9</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">movie</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">rating</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">cinema</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;boring&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">rating</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="626-exchange-seats">626. Exchange Seats</h2>
<h4 id="description-28">Description</h4>
<p>Given a table <strong>seat</strong> with columns <code>id</code> and <code>student</code>, Mary wants to swap seats for adjacent students.<br>
If the number of students is odd, the last student keeps their seat.</p>
<p><strong>Table: seat</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>student</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Abbot</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Doris</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Emerson</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Green</td>
      </tr>
      <tr>
          <td>5</td>
          <td>Jeames</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected output</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>student</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Doris</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Abbot</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Green</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Emerson</td>
      </tr>
      <tr>
          <td>5</td>
          <td>Jeames</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">IF</span><span class="p">(</span><span class="k">MOD</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">seat</span><span class="p">),</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">student</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">seat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="627-swap-salary">627. Swap Salary</h2>
<h4 id="description-29">Description</h4>
<p>Given a table <strong>salary</strong> with a <code>sex</code> column containing <code>'m'</code> or <code>'f'</code>, swap all values: <code>'m'</code> → <code>'f'</code> and <code>'f'</code> → <code>'m'</code> using a single update statement.</p>
<p><strong>Table: salary</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>name</th>
          <th>sex</th>
          <th>salary</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>A</td>
          <td>m</td>
          <td>2500</td>
      </tr>
      <tr>
          <td>2</td>
          <td>B</td>
          <td>f</td>
          <td>1500</td>
      </tr>
      <tr>
          <td>3</td>
          <td>C</td>
          <td>m</td>
          <td>5500</td>
      </tr>
      <tr>
          <td>4</td>
          <td>D</td>
          <td>f</td>
          <td>500</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected output after update</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>name</th>
          <th>sex</th>
          <th>salary</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>A</td>
          <td>f</td>
          <td>2500</td>
      </tr>
      <tr>
          <td>2</td>
          <td>B</td>
          <td>m</td>
          <td>1500</td>
      </tr>
      <tr>
          <td>3</td>
          <td>C</td>
          <td>f</td>
          <td>5500</td>
      </tr>
      <tr>
          <td>4</td>
          <td>D</td>
          <td>m</td>
          <td>500</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">UPDATE</span><span class="w"> </span><span class="n">salary</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;m&#39;</span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1045-customers-who-bought-all-products">1045. Customers Who Bought All Products</h2>
<h4 id="description-30">Description</h4>
<p>Given two tables <strong>Customer</strong> and <strong>Product</strong>, write an SQL query to find customers who bought <strong>all</strong> the products available in the Product table.</p>
<p><strong>Table: Customer</strong></p>
<table>
  <thead>
      <tr>
          <th>customer_id</th>
          <th>product_key</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>5</td>
      </tr>
      <tr>
          <td>2</td>
          <td>6</td>
      </tr>
      <tr>
          <td>3</td>
          <td>5</td>
      </tr>
      <tr>
          <td>3</td>
          <td>6</td>
      </tr>
      <tr>
          <td>1</td>
          <td>6</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Product</strong></p>
<table>
  <thead>
      <tr>
          <th>product_key</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>5</td>
      </tr>
      <tr>
          <td>6</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>customer_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
      </tr>
  </tbody>
</table>
<p>The customers who bought all the products (5 and 6) are customers with id <code>1</code> and <code>3</code>.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">product_key</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">product_key</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Product</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1050-actors-and-directors-who-cooperated-at-least-three-times">1050. Actors and Directors Who Cooperated At Least Three Times</h2>
<h4 id="description-31">Description</h4>
<p>Given a table <strong>ActorDirector</strong>, write an SQL query to find the pairs <code>(actor_id, director_id)</code> where the actor has cooperated with the director at least <strong>3 times</strong>.</p>
<p><strong>Table: ActorDirector</strong></p>
<table>
  <thead>
      <tr>
          <th>actor_id</th>
          <th>director_id</th>
          <th>timestamp</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>3</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>4</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>5</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>6</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>actor_id</th>
          <th>director_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>The only pair is <code>(1, 1)</code> where they cooperated exactly 3 times.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">actor_id</span><span class="p">,</span><span class="w"> </span><span class="n">director_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">ActorDirector</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">actor_id</span><span class="p">,</span><span class="w"> </span><span class="n">director_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1068-product-sales-analysis-i">1068. Product Sales Analysis I</h2>
<h4 id="description-32">Description</h4>
<p>Given two tables <strong>Sales</strong> and <strong>Product</strong>, write an SQL query to report all product names of the products in the Sales table along with their selling year and price.</p>
<p><strong>Table: Sales</strong></p>
<table>
  <thead>
      <tr>
          <th>sale_id</th>
          <th>product_id</th>
          <th>year</th>
          <th>quantity</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>100</td>
          <td>2008</td>
          <td>10</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>100</td>
          <td>2009</td>
          <td>12</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>7</td>
          <td>200</td>
          <td>2011</td>
          <td>15</td>
          <td>9000</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Product</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>product_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>100</td>
          <td>Nokia</td>
      </tr>
      <tr>
          <td>200</td>
          <td>Apple</td>
      </tr>
      <tr>
          <td>300</td>
          <td>Samsung</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>product_name</th>
          <th>year</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Nokia</td>
          <td>2008</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>Nokia</td>
          <td>2009</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>Apple</td>
          <td>2011</td>
          <td>9000</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P</span><span class="p">.</span><span class="n">product_name</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">S</span><span class="p">.</span><span class="n">price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="p">)</span><span class="w"> </span><span class="n">S</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Product</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">P</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">product_id</span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1069-product-sales-analysis-ii">1069. Product Sales Analysis II</h2>
<h4 id="description-33">Description</h4>
<p>Given two tables <strong>Sales</strong> and <strong>Product</strong>, write an SQL query to report the <strong>total quantity sold</strong> for every product id.</p>
<p><strong>Table: Sales</strong></p>
<table>
  <thead>
      <tr>
          <th>sale_id</th>
          <th>product_id</th>
          <th>year</th>
          <th>quantity</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>100</td>
          <td>2008</td>
          <td>10</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>100</td>
          <td>2009</td>
          <td>12</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>7</td>
          <td>200</td>
          <td>2011</td>
          <td>15</td>
          <td>9000</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Product</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>product_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>100</td>
          <td>Nokia</td>
      </tr>
      <tr>
          <td>200</td>
          <td>Apple</td>
      </tr>
      <tr>
          <td>300</td>
          <td>Samsung</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>total_quantity</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>100</td>
          <td>22</td>
      </tr>
      <tr>
          <td>200</td>
          <td>15</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_quantity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1070-product-sales-analysis-iii">1070. Product Sales Analysis III</h2>
<h4 id="description-34">Description</h4>
<p>Given two tables <strong>Sales</strong> and <strong>Product</strong>, write an SQL query to select the <strong>product id, year, quantity, and price for the first year</strong> of every product sold.</p>
<p><strong>Table: Sales</strong></p>
<table>
  <thead>
      <tr>
          <th>sale_id</th>
          <th>product_id</th>
          <th>year</th>
          <th>quantity</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>100</td>
          <td>2008</td>
          <td>10</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>100</td>
          <td>2009</td>
          <td>12</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>7</td>
          <td>200</td>
          <td>2011</td>
          <td>15</td>
          <td>9000</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Product</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>product_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>100</td>
          <td>Nokia</td>
      </tr>
      <tr>
          <td>200</td>
          <td>Apple</td>
      </tr>
      <tr>
          <td>300</td>
          <td>Samsung</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>first_year</th>
          <th>quantity</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>100</td>
          <td>2008</td>
          <td>10</td>
          <td>5000</td>
      </tr>
      <tr>
          <td>200</td>
          <td>2011</td>
          <td>15</td>
          <td>9000</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">first_year</span><span class="p">,</span><span class="w"> </span><span class="n">quantity</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">year</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="k">year</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">year</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1075-project-employees-i">1075. Project Employees I</h2>
<h4 id="description-35">Description</h4>
<p>Given two tables <strong>Project</strong> and <strong>Employee</strong>, write an SQL query to report the <strong>average experience years</strong> of all the employees for each project, rounded to 2 digits.</p>
<p><strong>Table: Project</strong></p>
<table>
  <thead>
      <tr>
          <th>project_id</th>
          <th>employee_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Employee</strong></p>
<table>
  <thead>
      <tr>
          <th>employee_id</th>
          <th>name</th>
          <th>experience_years</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Khaled</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Ali</td>
          <td>2</td>
      </tr>
      <tr>
          <td>3</td>
          <td>John</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Doe</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>project_id</th>
          <th>average_years</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2.00</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2.50</td>
      </tr>
  </tbody>
</table>
<p>The average experience years for the first project is <code>(3 + 2 + 1) / 3 = 2.00</code> and for the second project is <code>(3 + 2) / 2 = 2.50</code>.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="n">ROUND</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">experience_years</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">average_years</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Project</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">project_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1076-project-employees-ii">1076. Project Employees II</h2>
<h4 id="description-36">Description</h4>
<p>Given two tables <strong>Project</strong> and <strong>Employee</strong>, write an SQL query to report all the projects that have the <strong>most employees</strong>.</p>
<p><strong>Table: Project</strong></p>
<table>
  <thead>
      <tr>
          <th>project_id</th>
          <th>employee_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Employee</strong></p>
<table>
  <thead>
      <tr>
          <th>employee_id</th>
          <th>name</th>
          <th>experience_years</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Khaled</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Ali</td>
          <td>2</td>
      </tr>
      <tr>
          <td>3</td>
          <td>John</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Doe</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>project_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>The first project has 3 employees while the second one has 2.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">project_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Project</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">project_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">employee_id</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">employee_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cnt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Project</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">project_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1077-project-employees-iii">1077. Project Employees III</h2>
<h4 id="description-37">Description</h4>
<p>Given two tables <strong>Project</strong> and <strong>Employee</strong>, write an SQL query to report the <strong>most experienced employees in each project</strong>. In case of a tie, report all employees with the maximum number of experience years.</p>
<p><strong>Table: Project</strong></p>
<table>
  <thead>
      <tr>
          <th>project_id</th>
          <th>employee_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Employee</strong></p>
<table>
  <thead>
      <tr>
          <th>employee_id</th>
          <th>name</th>
          <th>experience_years</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Khaled</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Ali</td>
          <td>2</td>
      </tr>
      <tr>
          <td>3</td>
          <td>John</td>
          <td>3</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Doe</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>project_id</th>
          <th>employee_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>Both employees with id 1 and 3 have the most experience among the employees of the first project. For the second project, the employee with id 1 has the most experience.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Project</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">experience_years</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">project_id</span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">experience_years</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">experience_years</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Project</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">project_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1082-sales-analysis-i">1082. Sales Analysis I</h2>
<h4 id="description-38">Description</h4>
<p>Given two tables <strong>Product</strong> and <strong>Sales</strong>, write an SQL query to report the <strong>best seller by total sales price</strong>. If there is a tie, report all of them.</p>
<p><strong>Table: Product</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>product_name</th>
          <th>unit_price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>S8</td>
          <td>1000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>G4</td>
          <td>800</td>
      </tr>
      <tr>
          <td>3</td>
          <td>iPhone</td>
          <td>1400</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Sales</strong></p>
<table>
  <thead>
      <tr>
          <th>seller_id</th>
          <th>product_id</th>
          <th>buyer_id</th>
          <th>sale_date</th>
          <th>quantity</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>1</td>
          <td>2019-01-21</td>
          <td>2</td>
          <td>2000</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2</td>
          <td>2019-02-17</td>
          <td>1</td>
          <td>800</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2</td>
          <td>3</td>
          <td>2019-06-02</td>
          <td>1</td>
          <td>800</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>4</td>
          <td>2019-05-13</td>
          <td>2</td>
          <td>2800</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>seller_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
      </tr>
  </tbody>
</table>
<p>Both sellers with id 1 and 3 sold products with the <strong>most total price</strong> of 2800.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">seller_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seller_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">seller_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_price</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1083-sales-analysis-ii">1083. Sales Analysis II</h2>
<h4 id="description-39">Description</h4>
<p>Given two tables <strong>Product</strong> and <strong>Sales</strong>, write an SQL query to report the <strong>buyers who have bought S8 but not iPhone</strong>.</p>
<p><strong>Table: Product</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>product_name</th>
          <th>unit_price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>S8</td>
          <td>1000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>G4</td>
          <td>800</td>
      </tr>
      <tr>
          <td>3</td>
          <td>iPhone</td>
          <td>1400</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Sales</strong></p>
<table>
  <thead>
      <tr>
          <th>seller_id</th>
          <th>product_id</th>
          <th>buyer_id</th>
          <th>sale_date</th>
          <th>quantity</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>1</td>
          <td>2019-01-21</td>
          <td>2</td>
          <td>2000</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2</td>
          <td>2019-02-17</td>
          <td>1</td>
          <td>800</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>3</td>
          <td>2019-06-02</td>
          <td>1</td>
          <td>800</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>3</td>
          <td>2019-05-13</td>
          <td>2</td>
          <td>2800</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>buyer_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>The buyer with id 1 bought an S8 but didn&rsquo;t buy an iPhone. The buyer with id 3 bought both.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">buyer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;S8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">buyer_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">SELECT</span><span class="w"> </span><span class="n">buyer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">product_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;iPhone&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1084-sales-analysis-iii">1084. Sales Analysis III</h2>
<h4 id="description-40">Description</h4>
<p>Given two tables <strong>Product</strong> and <strong>Sales</strong>, write an SQL query to report the products that were <strong>only sold in spring 2019</strong> (between 2019-01-01 and 2019-03-31 inclusive).</p>
<p><strong>Table: Product</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>product_name</th>
          <th>unit_price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>S8</td>
          <td>1000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>G4</td>
          <td>800</td>
      </tr>
      <tr>
          <td>3</td>
          <td>iPhone</td>
          <td>1400</td>
      </tr>
  </tbody>
</table>
<p><strong>Table: Sales</strong></p>
<table>
  <thead>
      <tr>
          <th>seller_id</th>
          <th>product_id</th>
          <th>buyer_id</th>
          <th>sale_date</th>
          <th>quantity</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>1</td>
          <td>2019-01-21</td>
          <td>2</td>
          <td>2000</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>2</td>
          <td>2019-02-17</td>
          <td>1</td>
          <td>800</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2</td>
          <td>3</td>
          <td>2019-06-02</td>
          <td>1</td>
          <td>800</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>4</td>
          <td>2019-05-13</td>
          <td>2</td>
          <td>2800</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>product_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>S8</td>
      </tr>
  </tbody>
</table>
<p>The product with id 1 was <strong>only sold in spring 2019</strong>, while the other products were sold after.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="n">product_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Sales</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Product</span><span class="w"> </span><span class="k">USING</span><span class="p">(</span><span class="n">product_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">sale_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-03-31&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">sale_date</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1112-highest-grade-for-each-student">1112. Highest Grade For Each Student</h2>
<h4 id="description-41">Description</h4>
<p>Given a table <strong>Enrollments</strong>, write an SQL query to find the <strong>highest grade with its corresponding course</strong> for each student. In case of a tie, select the course with the <strong>smallest course_id</strong>. The output must be sorted by <strong>increasing student_id</strong>.</p>
<p><strong>Table: Enrollments</strong></p>
<table>
  <thead>
      <tr>
          <th>student_id</th>
          <th>course_id</th>
          <th>grade</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2</td>
          <td>2</td>
          <td>95</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
          <td>95</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>90</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>99</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
          <td>80</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2</td>
          <td>75</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>82</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>student_id</th>
          <th>course_id</th>
          <th>grade</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>99</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2</td>
          <td>95</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>82</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">course_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">course_id</span><span class="p">,</span><span class="w"> </span><span class="n">grade</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Enrollments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="n">grade</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">grade</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Enrollments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">student_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">student_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">student_id</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1113-reported-posts">1113. Reported Posts</h2>
<h4 id="description-42">Description</h4>
<p>Given a table <strong>Actions</strong>, write an SQL query that reports the <strong>number of posts reported yesterday for each report reason</strong>. Assume today is 2019-07-05.</p>
<p><strong>Table: Actions</strong></p>
<table>
  <thead>
      <tr>
          <th>user_id</th>
          <th>post_id</th>
          <th>action_date</th>
          <th>action</th>
          <th>extra</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-01</td>
          <td>view</td>
          <td>null</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-01</td>
          <td>like</td>
          <td>null</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-01</td>
          <td>share</td>
          <td>null</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
          <td>2019-07-04</td>
          <td>view</td>
          <td>null</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
          <td>2019-07-04</td>
          <td>report</td>
          <td>spam</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>2019-07-04</td>
          <td>view</td>
          <td>null</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>2019-07-04</td>
          <td>report</td>
          <td>spam</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2019-07-02</td>
          <td>view</td>
          <td>null</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2019-07-02</td>
          <td>report</td>
          <td>spam</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2</td>
          <td>2019-07-04</td>
          <td>view</td>
          <td>null</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2</td>
          <td>2019-07-04</td>
          <td>report</td>
          <td>racism</td>
      </tr>
      <tr>
          <td>5</td>
          <td>5</td>
          <td>2019-07-04</td>
          <td>view</td>
          <td>null</td>
      </tr>
      <tr>
          <td>5</td>
          <td>5</td>
          <td>2019-07-04</td>
          <td>report</td>
          <td>racism</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>report_reason</th>
          <th>report_count</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>spam</td>
          <td>1</td>
      </tr>
      <tr>
          <td>racism</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p>We only count reports <strong>from yesterday</strong> (2019-07-04).</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">report_reason</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">post_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">report_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Actions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">action_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2019-07-04&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;report&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">extra</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1126-active-businesses">1126. Active Businesses</h2>
<h4 id="description-43">Description</h4>
<p>Given a table <strong>Events</strong>, write an SQL query to find all <strong>active businesses</strong>.</p>
<p>An active business is a business that has <strong>more than one event type</strong> with <strong>occurences greater than the average occurences of that event type among all businesses</strong>.</p>
<p><strong>Table: Events</strong></p>
<table>
  <thead>
      <tr>
          <th>business_id</th>
          <th>event_type</th>
          <th>occurences</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>reviews</td>
          <td>7</td>
      </tr>
      <tr>
          <td>3</td>
          <td>reviews</td>
          <td>3</td>
      </tr>
      <tr>
          <td>1</td>
          <td>ads</td>
          <td>11</td>
      </tr>
      <tr>
          <td>2</td>
          <td>ads</td>
          <td>7</td>
      </tr>
      <tr>
          <td>3</td>
          <td>ads</td>
          <td>6</td>
      </tr>
      <tr>
          <td>1</td>
          <td>page views</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>page views</td>
          <td>12</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>business_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>Average for &lsquo;reviews&rsquo;, &lsquo;ads&rsquo; and &lsquo;page views&rsquo; are (7+3)/2=5, (11+7+6)/3=8, (3+12)/2=7.5 respectively.<br>
Business with id 1 has 7 &lsquo;reviews&rsquo; events (&gt;5) and 11 &lsquo;ads&rsquo; events (&gt;8), so it is an active business.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">business_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Events</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">event_type</span><span class="p">,</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">occurences</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">avg_occurences</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Events</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">event_type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">event_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">event_type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">occurences</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">avg_occurences</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">business_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1141-user-activity-for-the-past-30-days-i">1141. User Activity for the Past 30 Days I</h2>
<h4 id="description-44">Description</h4>
<p>Given a table <strong>Activity</strong>, write an SQL query to find the <strong>daily active user count</strong> for a period of 30 days ending <strong>2019-07-27</strong> inclusively.<br>
A user is considered active on a day if they performed <strong>at least one activity</strong> on that day.</p>
<p><strong>Table: Activity</strong></p>
<table>
  <thead>
      <tr>
          <th>user_id</th>
          <th>session_id</th>
          <th>activity_date</th>
          <th>activity_type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-20</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-20</td>
          <td>scroll_down</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-20</td>
          <td>end_session</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
          <td>2019-07-20</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
          <td>2019-07-21</td>
          <td>send_message</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
          <td>2019-07-21</td>
          <td>end_session</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2</td>
          <td>2019-07-21</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2</td>
          <td>2019-07-21</td>
          <td>send_message</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2</td>
          <td>2019-07-21</td>
          <td>end_session</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2019-06-25</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2019-06-25</td>
          <td>end_session</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>day</th>
          <th>active_users</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2019-07-20</td>
          <td>2</td>
      </tr>
      <tr>
          <td>2019-07-21</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<p>Days with zero active users are not included.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">activity_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">day</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">active_users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">activity_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-06-28&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-07-27&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">day</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1142-user-activity-for-the-past-30-days-ii">1142. User Activity for the Past 30 Days II</h2>
<h4 id="description-45">Description</h4>
<p>Given a table <strong>Activity</strong>, write an SQL query to find the <strong>average number of sessions per user</strong> for a period of 30 days ending <strong>2019-07-27</strong> inclusively, rounded to 2 decimal places.<br>
Only count sessions with <strong>at least one activity</strong> in that time period.</p>
<p><strong>Table: Activity</strong></p>
<table>
  <thead>
      <tr>
          <th>user_id</th>
          <th>session_id</th>
          <th>activity_date</th>
          <th>activity_type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-20</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-20</td>
          <td>scroll_down</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-07-20</td>
          <td>end_session</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
          <td>2019-07-20</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
          <td>2019-07-21</td>
          <td>send_message</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
          <td>2019-07-21</td>
          <td>end_session</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2</td>
          <td>2019-07-21</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2</td>
          <td>2019-07-21</td>
          <td>send_message</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2</td>
          <td>2019-07-21</td>
          <td>end_session</td>
      </tr>
      <tr>
          <td>3</td>
          <td>5</td>
          <td>2019-07-21</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>3</td>
          <td>5</td>
          <td>2019-07-21</td>
          <td>scroll_down</td>
      </tr>
      <tr>
          <td>3</td>
          <td>5</td>
          <td>2019-07-21</td>
          <td>end_session</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2019-06-25</td>
          <td>open_session</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2019-06-25</td>
          <td>end_session</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>average_sessions_per_user</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1.33</td>
      </tr>
  </tbody>
</table>
<p>Explanation: Users 1 and 2 each had 1 session, user 3 had 2 sessions. Average = (1+1+2)/3 = 1.33.</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">ROUND</span><span class="p">(</span><span class="n">IFNULL</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">sessions</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">average_sessions_per_user</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">session_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sessions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Activity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">activity_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-06-28&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-07-27&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1148-article-views-i">1148. Article Views I</h2>
<h4 id="description-46">Description</h4>
<p>Given a table <strong>Views</strong>, write an SQL query to find all <strong>authors who viewed at least one of their own articles</strong>, sorted in ascending order by their id.</p>
<p><strong>Table: Views</strong></p>
<table>
  <thead>
      <tr>
          <th>article_id</th>
          <th>author_id</th>
          <th>viewer_id</th>
          <th>view_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>3</td>
          <td>5</td>
          <td>2019-08-01</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
          <td>6</td>
          <td>2019-08-02</td>
      </tr>
      <tr>
          <td>2</td>
          <td>7</td>
          <td>7</td>
          <td>2019-08-01</td>
      </tr>
      <tr>
          <td>2</td>
          <td>7</td>
          <td>6</td>
          <td>2019-08-02</td>
      </tr>
      <tr>
          <td>4</td>
          <td>7</td>
          <td>1</td>
          <td>2019-07-22</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>4</td>
          <td>2019-07-21</td>
      </tr>
      <tr>
          <td>3</td>
          <td>4</td>
          <td>4</td>
          <td>2019-07-21</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>4</td>
      </tr>
      <tr>
          <td>7</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Views</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">author_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">author_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1164-product-price-at-a-given-date">1164. Product Price at a Given Date</h2>
<h4 id="description-47">Description</h4>
<p>Given a table <strong>Products</strong>, write an SQL query to find the <strong>prices of all products on 2019-08-16</strong>. Assume the price of all products before any change is 10.</p>
<p><strong>Table: Products</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>new_price</th>
          <th>change_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>20</td>
          <td>2019-08-14</td>
      </tr>
      <tr>
          <td>2</td>
          <td>50</td>
          <td>2019-08-14</td>
      </tr>
      <tr>
          <td>1</td>
          <td>30</td>
          <td>2019-08-15</td>
      </tr>
      <tr>
          <td>1</td>
          <td>35</td>
          <td>2019-08-16</td>
      </tr>
      <tr>
          <td>2</td>
          <td>65</td>
          <td>2019-08-17</td>
      </tr>
      <tr>
          <td>3</td>
          <td>20</td>
          <td>2019-08-18</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2</td>
          <td>50</td>
      </tr>
      <tr>
          <td>1</td>
          <td>35</td>
      </tr>
      <tr>
          <td>3</td>
          <td>10</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">i</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">IF</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">i</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">FROM</span><span class="w"> </span><span class="n">Products</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">WHERE</span><span class="w"> </span><span class="n">change_date</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="s1">&#39;2019-08-16&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">),</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="mi">10</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">SELECT</span><span class="w"> </span><span class="n">new_price</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">FROM</span><span class="w"> </span><span class="n">Products</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">WHERE</span><span class="w"> </span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">product_id</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">AND</span><span class="w"> </span><span class="n">change_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">max_change_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">product_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Products</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="w"> </span><span class="k">MAX</span><span class="p">(</span><span class="n">change_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">max_change_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">change_date</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="s1">&#39;2019-08-16&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">q</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">product_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1173-immediate-food-delivery-i">1173. Immediate Food Delivery I</h2>
<h4 id="description-48">Description</h4>
<p>Given a table <strong>Delivery</strong>, calculate the <strong>percentage of immediate orders</strong>. An order is immediate if <code>order_date = customer_pref_delivery_date</code>. Round the result to 2 decimal places.</p>
<p><strong>Table: Delivery</strong></p>
<table>
  <thead>
      <tr>
          <th>delivery_id</th>
          <th>customer_id</th>
          <th>order_date</th>
          <th>customer_pref_delivery_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-08-01</td>
          <td>2019-08-02</td>
      </tr>
      <tr>
          <td>2</td>
          <td>5</td>
          <td>2019-08-02</td>
          <td>2019-08-02</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
          <td>2019-08-11</td>
          <td>2019-08-11</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2019-08-24</td>
          <td>2019-08-26</td>
      </tr>
      <tr>
          <td>5</td>
          <td>4</td>
          <td>2019-08-21</td>
          <td>2019-08-22</td>
      </tr>
      <tr>
          <td>6</td>
          <td>2</td>
          <td>2019-08-11</td>
          <td>2019-08-13</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>immediate_percentage</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>33.33</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer_pref_delivery_date</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">/</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="n">delivery_id</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">immediate_percentage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Delivery</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1174-immediate-food-delivery-ii">1174. Immediate Food Delivery II</h2>
<h4 id="description-49">Description</h4>
<p>Given a table <strong>Delivery</strong>, calculate the <strong>percentage of immediate orders among the first orders of all customers</strong>. An order is immediate if <code>order_date = customer_pref_delivery_date</code>. Round the result to 2 decimal places. Each customer has exactly one first order (earliest <code>order_date</code>).</p>
<p><strong>Table: Delivery</strong></p>
<table>
  <thead>
      <tr>
          <th>delivery_id</th>
          <th>customer_id</th>
          <th>order_date</th>
          <th>customer_pref_delivery_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2019-08-01</td>
          <td>2019-08-02</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2</td>
          <td>2019-08-02</td>
          <td>2019-08-02</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
          <td>2019-08-11</td>
          <td>2019-08-12</td>
      </tr>
      <tr>
          <td>4</td>
          <td>3</td>
          <td>2019-08-24</td>
          <td>2019-08-24</td>
      </tr>
      <tr>
          <td>5</td>
          <td>3</td>
          <td>2019-08-21</td>
          <td>2019-08-22</td>
      </tr>
      <tr>
          <td>6</td>
          <td>2</td>
          <td>2019-08-11</td>
          <td>2019-08-13</td>
      </tr>
      <tr>
          <td>7</td>
          <td>4</td>
          <td>2019-08-09</td>
          <td>2019-08-09</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>immediate_percentage</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>50.00</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">ROUND</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">order_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customer_pref_delivery_date</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">immediate_percentage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Delivery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="n">order_date</span><span class="p">)</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">customer_id</span><span class="p">,</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Delivery</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">customer_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1179-reformat-department-table">1179. Reformat Department Table</h2>
<h4 id="description-50">Description</h4>
<p>Given a table <strong>Department</strong> with <code>id</code>, <code>revenue</code>, and <code>month</code>, reformat it so that each department has one row, and there is a revenue column for each month. The month values are <code>[&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;]</code>.</p>
<p><strong>Table: Department</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>revenue</th>
          <th>month</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>8000</td>
          <td>Jan</td>
      </tr>
      <tr>
          <td>2</td>
          <td>9000</td>
          <td>Jan</td>
      </tr>
      <tr>
          <td>3</td>
          <td>10000</td>
          <td>Feb</td>
      </tr>
      <tr>
          <td>1</td>
          <td>7000</td>
          <td>Feb</td>
      </tr>
      <tr>
          <td>1</td>
          <td>6000</td>
          <td>Mar</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>Jan_Revenue</th>
          <th>Feb_Revenue</th>
          <th>Mar_Revenue</th>
          <th>&hellip;</th>
          <th>Dec_Revenue</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>8000</td>
          <td>7000</td>
          <td>6000</td>
          <td>&hellip;</td>
          <td>null</td>
      </tr>
      <tr>
          <td>2</td>
          <td>9000</td>
          <td>null</td>
          <td>null</td>
          <td>&hellip;</td>
          <td>null</td>
      </tr>
      <tr>
          <td>3</td>
          <td>null</td>
          <td>10000</td>
          <td>null</td>
          <td>&hellip;</td>
          <td>null</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Jan_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Feb&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Feb_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Mar&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Mar_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Apr&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Apr_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;May&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">May_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Jun&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Jun_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Jul&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Jul_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Aug&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Aug_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Sep&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Sep_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Oct&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Oct_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Nov&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Nov_Revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Dec&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">revenue</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Dec_Revenue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Department</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1193-monthly-transactions-i">1193. Monthly Transactions I</h2>
<h4 id="description-51">Description</h4>
<p>Given a table <strong>Transactions</strong> with <code>id</code>, <code>country</code>, <code>state</code>, <code>amount</code>, and <code>trans_date</code>, calculate for each month and country:</p>
<ul>
<li>Total number of transactions</li>
<li>Total amount of transactions</li>
<li>Number of approved transactions</li>
<li>Total amount of approved transactions</li>
</ul>
<p><strong>Table: Transactions</strong></p>
<table>
  <thead>
      <tr>
          <th>id</th>
          <th>country</th>
          <th>state</th>
          <th>amount</th>
          <th>trans_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>121</td>
          <td>US</td>
          <td>approved</td>
          <td>1000</td>
          <td>2018-12-18</td>
      </tr>
      <tr>
          <td>122</td>
          <td>US</td>
          <td>declined</td>
          <td>2000</td>
          <td>2018-12-19</td>
      </tr>
      <tr>
          <td>123</td>
          <td>US</td>
          <td>approved</td>
          <td>2000</td>
          <td>2019-01-01</td>
      </tr>
      <tr>
          <td>124</td>
          <td>DE</td>
          <td>approved</td>
          <td>2000</td>
          <td>2019-01-07</td>
      </tr>
  </tbody>
</table>
<p><strong>Expected Output</strong></p>
<table>
  <thead>
      <tr>
          <th>month</th>
          <th>country</th>
          <th>trans_count</th>
          <th>approved_count</th>
          <th>trans_total_amount</th>
          <th>approved_total_amount</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2018-12</td>
          <td>US</td>
          <td>2</td>
          <td>1</td>
          <td>3000</td>
          <td>1000</td>
      </tr>
      <tr>
          <td>2019-01</td>
          <td>US</td>
          <td>1</td>
          <td>1</td>
          <td>2000</td>
          <td>2000</td>
      </tr>
      <tr>
          <td>2019-01</td>
          <td>DE</td>
          <td>1</td>
          <td>1</td>
          <td>2000</td>
          <td>2000</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DATE_FORMAT</span><span class="p">(</span><span class="n">trans_date</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%Y-%m&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">month</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">country</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">trans_count</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;approved&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">approved_count</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">trans_total_amount</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="k">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;approved&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">approved_total_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">DATE_FORMAT</span><span class="p">(</span><span class="n">trans_date</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%Y-%m&#39;</span><span class="p">),</span><span class="w"> </span><span class="n">country</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1204-last-person-to-fit-in-the-elevator">1204. Last Person to Fit in the Elevator</h2>
<h4 id="description-52">Description</h4>
<p>Given a table <strong>Queue</strong> with <code>person_id</code>, <code>person_name</code>, <code>weight</code>, and <code>turn</code>, find the <strong>last person</strong> who can fit in an elevator without exceeding a <strong>weight limit of 1000</strong>. People enter the elevator in the order of <code>turn</code>.</p>
<p><strong>Table: Queue</strong></p>
<table>
  <thead>
      <tr>
          <th>person_id</th>
          <th>person_name</th>
          <th>weight</th>
          <th>turn</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>5</td>
          <td>George Washington</td>
          <td>250</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>John Adams</td>
          <td>350</td>
          <td>2</td>
      </tr>
      <tr>
          <td>6</td>
          <td>Thomas Jefferson</td>
          <td>400</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Will Johnliams</td>
          <td>200</td>
          <td>4</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Thomas Jefferson</td>
          <td>175</td>
          <td>5</td>
      </tr>
      <tr>
          <td>1</td>
          <td>James Elephant</td>
          <td>500</td>
          <td>6</td>
      </tr>
  </tbody>
</table>
<p><strong>Result Table</strong></p>
<table>
  <thead>
      <tr>
          <th>person_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Thomas Jefferson</td>
      </tr>
  </tbody>
</table>
<p>Explanation: The first three people (250 + 350 + 400 = 1000) fit exactly. The last one in this group is Thomas Jefferson (turn 3).</p>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">person_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">person_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">total_weight</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">total_weight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total_weight</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Queue</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">total_weight</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">turn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">total_weight</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">total_weight</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1211-queries-quality-and-percentage">1211. Queries Quality and Percentage</h2>
<h4 id="description-53">Description</h4>
<p>Given a <strong>Queries</strong> table with <code>query_name</code>, <code>result</code>, <code>position</code>, and <code>rating</code>, compute for each <code>query_name</code>:</p>
<ol>
<li><strong>Quality</strong>: Average of the ratio <code>rating / position</code>.</li>
<li><strong>Poor query percentage</strong>: Percentage of queries with <code>rating &lt; 3</code>.</li>
</ol>
<p>Both metrics should be <strong>rounded to 2 decimal places</strong>.</p>
<p><strong>Example Table: Queries</strong></p>
<table>
  <thead>
      <tr>
          <th>query_name</th>
          <th>result</th>
          <th>position</th>
          <th>rating</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Dog</td>
          <td>Golden Retriever</td>
          <td>1</td>
          <td>5</td>
      </tr>
      <tr>
          <td>Dog</td>
          <td>German Shepherd</td>
          <td>2</td>
          <td>5</td>
      </tr>
      <tr>
          <td>Dog</td>
          <td>Mule</td>
          <td>200</td>
          <td>1</td>
      </tr>
      <tr>
          <td>Cat</td>
          <td>Shirazi</td>
          <td>5</td>
          <td>2</td>
      </tr>
      <tr>
          <td>Cat</td>
          <td>Siamese</td>
          <td>3</td>
          <td>3</td>
      </tr>
      <tr>
          <td>Cat</td>
          <td>Sphynx</td>
          <td>7</td>
          <td>4</td>
      </tr>
  </tbody>
</table>
<p><strong>Result Table</strong></p>
<table>
  <thead>
      <tr>
          <th>query_name</th>
          <th>quality</th>
          <th>poor_query_percentage</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Dog</td>
          <td>2.50</td>
          <td>33.33</td>
      </tr>
      <tr>
          <td>Cat</td>
          <td>0.66</td>
          <td>33.33</td>
      </tr>
  </tbody>
</table>
<hr>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">query_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">rating</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">position</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">quality</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">rating</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">poor_query_percentage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Queries</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">query_name</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1212-team-scores-in-football-tournament">1212. Team Scores in Football Tournament</h2>
<h4 id="description-54">Description</h4>
<p>Table: Teams</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>team_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>team_name</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<p><code>team_id</code> is the primary key of this table. Each row of this table represents a single football team.</p>
<p>Table: Matches</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>match_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>host_team</td>
          <td>int</td>
      </tr>
      <tr>
          <td>guest_team</td>
          <td>int</td>
      </tr>
      <tr>
          <td>host_goals</td>
          <td>int</td>
      </tr>
      <tr>
          <td>guest_goals</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<p><code>match_id</code> is the primary key of this table. Each row is a record of a finished match between two different teams. Teams <code>host_team</code> and <code>guest_team</code> are represented by their IDs in the <code>Teams</code> table (<code>team_id</code>) and they scored <code>host_goals</code> and <code>guest_goals</code> respectively.</p>
<p>Points are awarded as follows:</p>
<ul>
<li>A team receives 3 points if they win a match (score strictly more goals than the opponent).</li>
<li>A team receives 1 point if they draw a match (same number of goals as the opponent).</li>
<li>A team receives 0 points if they lose a match (score less than the opponent).</li>
</ul>
<p>Write an SQL query that selects the <code>team_id</code>, <code>team_name</code>, and <code>num_points</code> of each team in the tournament after all matches. The result table should be ordered by <code>num_points</code> (descending). In case of a tie, order by <code>team_id</code> (ascending).</p>
<p><strong>Example:</strong></p>
<p>Teams table:</p>
<table>
  <thead>
      <tr>
          <th>team_id</th>
          <th>team_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>10</td>
          <td>Leetcode FC</td>
      </tr>
      <tr>
          <td>20</td>
          <td>NewYork FC</td>
      </tr>
      <tr>
          <td>30</td>
          <td>Atlanta FC</td>
      </tr>
      <tr>
          <td>40</td>
          <td>Chicago FC</td>
      </tr>
      <tr>
          <td>50</td>
          <td>Toronto FC</td>
      </tr>
  </tbody>
</table>
<p>Matches table:</p>
<table>
  <thead>
      <tr>
          <th>match_id</th>
          <th>host_team</th>
          <th>guest_team</th>
          <th>host_goals</th>
          <th>guest_goals</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>10</td>
          <td>20</td>
          <td>3</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2</td>
          <td>30</td>
          <td>10</td>
          <td>2</td>
          <td>2</td>
      </tr>
      <tr>
          <td>3</td>
          <td>10</td>
          <td>50</td>
          <td>5</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
          <td>20</td>
          <td>30</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>5</td>
          <td>50</td>
          <td>30</td>
          <td>1</td>
          <td>0</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>team_id</th>
          <th>team_name</th>
          <th>num_points</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>10</td>
          <td>Leetcode FC</td>
          <td>7</td>
      </tr>
      <tr>
          <td>20</td>
          <td>NewYork FC</td>
          <td>3</td>
      </tr>
      <tr>
          <td>50</td>
          <td>Toronto FC</td>
          <td>3</td>
      </tr>
      <tr>
          <td>30</td>
          <td>Atlanta FC</td>
          <td>1</td>
      </tr>
      <tr>
          <td>40</td>
          <td>Chicago FC</td>
          <td>0</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">team_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">t</span><span class="p">.</span><span class="n">team_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">IFNULL</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">num_points</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_points</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Teams</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">team_id</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">num_points</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_points</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- Points as host
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">host_team</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">team_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                       </span><span class="k">WHEN</span><span class="w"> </span><span class="n">host_goals</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">guest_goals</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                       </span><span class="k">WHEN</span><span class="w"> </span><span class="n">host_goals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guest_goals</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                       </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_points</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Matches</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">host_team</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">-- Points as guest
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">guest_team</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">team_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">               </span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                       </span><span class="k">WHEN</span><span class="w"> </span><span class="n">host_goals</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">guest_goals</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                       </span><span class="k">WHEN</span><span class="w"> </span><span class="n">host_goals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">guest_goals</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                       </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                   </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_points</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Matches</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">guest_team</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">team_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">team_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">team_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">num_points</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">team_id</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1225-report-contiguous-dates">1225. Report Contiguous Dates</h2>
<h4 id="description-55">Description</h4>
<p>Table: Failed</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>fail_date</td>
          <td>date</td>
      </tr>
  </tbody>
</table>
<p>Primary key for this table is <code>fail_date</code>. Failed table contains the days of failed tasks.</p>
<p>Table: Succeeded</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>success_date</td>
          <td>date</td>
      </tr>
  </tbody>
</table>
<p>Primary key for this table is <code>success_date</code>. Succeeded table contains the days of succeeded tasks.</p>
<p>A system is running one task every day. Every task is independent of the previous tasks. The tasks can fail or succeed.</p>
<p>Write an SQL query to generate a report of <code>period_state</code> for each continuous interval of days in the period from <code>2019-01-01</code> to <code>2019-12-31</code>.</p>
<p><code>period_state</code> is <code>'failed'</code> if tasks in this interval failed or <code>'succeeded'</code> if tasks in this interval succeeded. Interval of days are retrieved as <code>start_date</code> and <code>end_date</code>.</p>
<p>Order result by <code>start_date</code>.</p>
<p><strong>Example:</strong></p>
<p>Failed table:</p>
<table>
  <thead>
      <tr>
          <th>fail_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2018-12-28</td>
      </tr>
      <tr>
          <td>2018-12-29</td>
      </tr>
      <tr>
          <td>2019-01-04</td>
      </tr>
      <tr>
          <td>2019-01-05</td>
      </tr>
  </tbody>
</table>
<p>Succeeded table:</p>
<table>
  <thead>
      <tr>
          <th>success_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2018-12-30</td>
      </tr>
      <tr>
          <td>2018-12-31</td>
      </tr>
      <tr>
          <td>2019-01-01</td>
      </tr>
      <tr>
          <td>2019-01-02</td>
      </tr>
      <tr>
          <td>2019-01-03</td>
      </tr>
      <tr>
          <td>2019-01-06</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>period_state</th>
          <th>start_date</th>
          <th>end_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>succeeded</td>
          <td>2019-01-01</td>
          <td>2019-01-03</td>
      </tr>
      <tr>
          <td>failed</td>
          <td>2019-01-04</td>
          <td>2019-01-05</td>
      </tr>
      <tr>
          <td>succeeded</td>
          <td>2019-01-06</td>
          <td>2019-01-06</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">period_state</span><span class="p">,</span><span class="w"> </span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="n">end_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Failed intervals
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;failed&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">period_state</span><span class="p">,</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">fail_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">fail_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">end_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">fail_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Failed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">fail_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-12-31&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">AND</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="n">fail_date</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">SELECT</span><span class="w"> </span><span class="n">fail_date</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">fail_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-12-31&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">fail_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Failed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">fail_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-12-31&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">AND</span><span class="w"> </span><span class="n">DATE_ADD</span><span class="p">(</span><span class="n">fail_date</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">SELECT</span><span class="w"> </span><span class="n">fail_date</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">fail_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-12-31&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">fail_date</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">fail_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">fail_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Succeeded intervals
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;succeeded&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">period_state</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">success_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="n">success_date</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">end_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">success_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Succeeded</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">success_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-12-31&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">AND</span><span class="w"> </span><span class="n">DATE_SUB</span><span class="p">(</span><span class="n">success_date</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">SELECT</span><span class="w"> </span><span class="n">success_date</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Succeeded</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">success_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-12-31&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">success_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Succeeded</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">success_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-12-31&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="k">AND</span><span class="w"> </span><span class="n">DATE_ADD</span><span class="p">(</span><span class="n">success_date</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">DAY</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="k">SELECT</span><span class="w"> </span><span class="n">success_date</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Succeeded</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">success_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-01-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-12-31&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">success_date</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="n">success_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">success_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">start_date</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1241-number-of-comments-per-post">1241. Number of Comments per Post</h2>
<h4 id="description-56">Description</h4>
<p>Table: Submissions</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>sub_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>parent_id</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li>There is no primary key for this table; it may have duplicate rows.</li>
<li>Each row can be a post or a comment on a post.</li>
<li><code>parent_id</code> is null for posts.</li>
<li><code>parent_id</code> for comments is the <code>sub_id</code> of another post in the table.</li>
</ul>
<p>Write an SQL query to find the number of comments per each post.</p>
<ul>
<li>Result table should contain <code>post_id</code> and its corresponding <code>number_of_comments</code>.</li>
<li>Sort the result by <code>post_id</code> in ascending order.</li>
<li>Count <strong>unique comments</strong> per post.</li>
<li>Treat duplicate posts as one post.</li>
<li>Ignore comments on posts that do not exist.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Submissions table:</p>
<table>
  <thead>
      <tr>
          <th>sub_id</th>
          <th>parent_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Null</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Null</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Null</td>
      </tr>
      <tr>
          <td>12</td>
          <td>Null</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
          <td>1</td>
      </tr>
      <tr>
          <td>9</td>
          <td>1</td>
      </tr>
      <tr>
          <td>10</td>
          <td>2</td>
      </tr>
      <tr>
          <td>6</td>
          <td>7</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>post_id</th>
          <th>number_of_comments</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2</td>
      </tr>
      <tr>
          <td>12</td>
          <td>0</td>
      </tr>
  </tbody>
</table>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">post_id</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">sub_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">number_of_comments</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">sub_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">post_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Submissions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">parent_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Submissions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">post_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">parent_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">post_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">post_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1251-average-selling-price">1251. Average Selling Price</h2>
<h4 id="description-57">Description</h4>
<p>Table: Prices</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>product_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>start_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>end_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>price</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(product_id, start_date, end_date)</code> is the primary key.</li>
<li>Each row indicates the price of the product in the period from <code>start_date</code> to <code>end_date</code>.</li>
<li>There are no overlapping periods for the same product.</li>
</ul>
<p>Table: UnitsSold</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>product_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>purchase_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>units</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li>There is no primary key; duplicates may exist.</li>
<li>Each row indicates the number of units sold for a product on a particular date.</li>
</ul>
<p>Write an SQL query to find the <strong>average selling price</strong> for each product.</p>
<ul>
<li><code>average_price</code> should be rounded to 2 decimal places.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Prices table:</p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>start_date</th>
          <th>end_date</th>
          <th>price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2019-02-17</td>
          <td>2019-02-28</td>
          <td>5</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2019-03-01</td>
          <td>2019-03-22</td>
          <td>20</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2019-02-01</td>
          <td>2019-02-20</td>
          <td>15</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2019-02-21</td>
          <td>2019-03-31</td>
          <td>30</td>
      </tr>
  </tbody>
</table>
<p>UnitsSold table:</p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>purchase_date</th>
          <th>units</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2019-02-25</td>
          <td>100</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2019-03-01</td>
          <td>15</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2019-02-10</td>
          <td>200</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2019-03-22</td>
          <td>30</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>average_price</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>6.96</td>
      </tr>
      <tr>
          <td>2</td>
          <td>16.96</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>Average selling price = Total price of product / Number of units sold</li>
<li>Product 1: <code>((100 * 5) + (15 * 20)) / 115 = 6.96</code></li>
<li>Product 2: <code>((200 * 15) + (30 * 30)) / 230 = 16.96</code></li>
</ul>
</li>
</ul>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">ROUND</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">units</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">units</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">average_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Prices</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">UnitsSold</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">AND</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">purchase_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">start_date</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">end_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1264-page-recommendations">1264. Page Recommendations</h2>
<h4 id="description-58">Description</h4>
<p>Table: Friendship</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>user1_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>user2_id</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(user1_id, user2_id)</code> is the primary key.</li>
<li>Each row indicates a friendship relation between <code>user1_id</code> and <code>user2_id</code>.</li>
</ul>
<p>Table: Likes</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>user_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>page_id</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(user_id, page_id)</code> is the primary key.</li>
<li>Each row indicates that <code>user_id</code> likes <code>page_id</code>.</li>
</ul>
<p>Write an SQL query to <strong>recommend pages</strong> to the user with <code>user_id = 1</code> using the pages that their friends liked.</p>
<ul>
<li>Do <strong>not</strong> recommend pages the user already liked.</li>
<li>Return the result table in any order without duplicates.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Friendship table:</p>
<table>
  <thead>
      <tr>
          <th>user1_id</th>
          <th>user2_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>1</td>
          <td>4</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>4</td>
      </tr>
      <tr>
          <td>2</td>
          <td>5</td>
      </tr>
      <tr>
          <td>6</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>Likes table:</p>
<table>
  <thead>
      <tr>
          <th>user_id</th>
          <th>page_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>88</td>
      </tr>
      <tr>
          <td>2</td>
          <td>23</td>
      </tr>
      <tr>
          <td>3</td>
          <td>24</td>
      </tr>
      <tr>
          <td>4</td>
          <td>56</td>
      </tr>
      <tr>
          <td>5</td>
          <td>11</td>
      </tr>
      <tr>
          <td>6</td>
          <td>33</td>
      </tr>
      <tr>
          <td>2</td>
          <td>77</td>
      </tr>
      <tr>
          <td>3</td>
          <td>77</td>
      </tr>
      <tr>
          <td>6</td>
          <td>88</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>recommended_page</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>23</td>
      </tr>
      <tr>
          <td>24</td>
      </tr>
      <tr>
          <td>56</td>
      </tr>
      <tr>
          <td>33</td>
      </tr>
      <tr>
          <td>77</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>User 1 is friends with users 2, 3, 4, and 6.</li>
<li>Suggested pages: 23 from user 2, 24 from user 3, 56 from user 4, 33 from user 6, 77 from users 2 &amp; 3.</li>
<li>Page 88 is not suggested because user 1 already likes it.</li>
</ul>
</li>
</ul>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">page_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recommended_page</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Likes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">l</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Friendship</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user2_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user1_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">page_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">page_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Likes</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">page_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">recommended_page</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Likes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">l</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Friendship</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user1_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">user_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">user2_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">page_id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">page_id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Likes</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1270-all-people-report-to-the-given-manager">1270. All People Report to the Given Manager</h2>
<h4 id="description-59">Description</h4>
<p>Table: Employees</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>employee_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>employee_name</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>manager_id</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>employee_id</code> is the primary key.</li>
<li>Each row indicates that the employee reports to their direct manager with <code>manager_id</code>.</li>
<li>The head of the company is the employee with <code>employee_id = 1</code>.</li>
</ul>
<p>Write an SQL query to find <code>employee_id</code> of all employees that <strong>directly or indirectly report</strong> to the head of the company.</p>
<ul>
<li>The indirect relation between managers will not exceed 3 levels.</li>
<li>Return the result table in any order without duplicates.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Employees table:</p>
<table>
  <thead>
      <tr>
          <th>employee_id</th>
          <th>employee_name</th>
          <th>manager_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Boss</td>
          <td>1</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Alice</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Bob</td>
          <td>1</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Daniel</td>
          <td>2</td>
      </tr>
      <tr>
          <td>7</td>
          <td>Luis</td>
          <td>4</td>
      </tr>
      <tr>
          <td>8</td>
          <td>Jhon</td>
          <td>3</td>
      </tr>
      <tr>
          <td>9</td>
          <td>Angela</td>
          <td>8</td>
      </tr>
      <tr>
          <td>77</td>
          <td>Robert</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>employee_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2</td>
      </tr>
      <tr>
          <td>77</td>
      </tr>
      <tr>
          <td>4</td>
      </tr>
      <tr>
          <td>7</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>Employees 2 and 77 report <strong>directly</strong> to the head (1).</li>
<li>Employee 4 reports indirectly: <code>4 → 2 → 1</code>.</li>
<li>Employee 7 reports indirectly: <code>7 → 4 → 2 → 1</code>.</li>
<li>Employees 3, 8, 9 do <strong>not</strong> report to the head directly or indirectly.</li>
</ul>
</li>
</ul>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employees</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employees</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Employees</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">AND</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e3</span><span class="p">.</span><span class="n">employee_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">employee_id</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">e2</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="n">e3</span><span class="p">.</span><span class="n">manager_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1280-students-and-examinations">1280. Students and Examinations</h2>
<h4 id="description-60">Description</h4>
<p>Table: Students</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>student_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>student_name</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>student_id</code> is the primary key.</li>
<li>Each row contains the ID and name of a student.</li>
</ul>
<p>Table: Subjects</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>subject_name</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>subject_name</code> is the primary key.</li>
<li>Each row contains the name of a subject.</li>
</ul>
<p>Table: Examinations</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>student_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>subject_name</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<ul>
<li>There is no primary key; duplicates may exist.</li>
<li>Each student takes every subject.</li>
<li>Each row indicates that a student attended the exam of a subject.</li>
</ul>
<p>Write an SQL query to find the <strong>number of times each student attended each exam</strong>.</p>
<ul>
<li>Order the result table by <code>student_id</code> and <code>subject_name</code>.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Students table:</p>
<table>
  <thead>
      <tr>
          <th>student_id</th>
          <th>student_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Alice</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Bob</td>
      </tr>
      <tr>
          <td>13</td>
          <td>John</td>
      </tr>
      <tr>
          <td>6</td>
          <td>Alex</td>
      </tr>
  </tbody>
</table>
<p>Subjects table:</p>
<table>
  <thead>
      <tr>
          <th>subject_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Math</td>
      </tr>
      <tr>
          <td>Physics</td>
      </tr>
      <tr>
          <td>Programming</td>
      </tr>
  </tbody>
</table>
<p>Examinations table:</p>
<table>
  <thead>
      <tr>
          <th>student_id</th>
          <th>subject_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Physics</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Programming</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Programming</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Physics</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>13</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>13</td>
          <td>Programming</td>
      </tr>
      <tr>
          <td>13</td>
          <td>Physics</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Math</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Math</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>student_id</th>
          <th>student_name</th>
          <th>subject_name</th>
          <th>attended_exams</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Alice</td>
          <td>Math</td>
          <td>3</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Alice</td>
          <td>Physics</td>
          <td>2</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Alice</td>
          <td>Programming</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Bob</td>
          <td>Math</td>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Bob</td>
          <td>Physics</td>
          <td>0</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Bob</td>
          <td>Programming</td>
          <td>1</td>
      </tr>
      <tr>
          <td>6</td>
          <td>Alex</td>
          <td>Math</td>
          <td>0</td>
      </tr>
      <tr>
          <td>6</td>
          <td>Alex</td>
          <td>Physics</td>
          <td>0</td>
      </tr>
      <tr>
          <td>6</td>
          <td>Alex</td>
          <td>Programming</td>
          <td>0</td>
      </tr>
      <tr>
          <td>13</td>
          <td>John</td>
          <td>Math</td>
          <td>1</td>
      </tr>
      <tr>
          <td>13</td>
          <td>John</td>
          <td>Physics</td>
          <td>1</td>
      </tr>
      <tr>
          <td>13</td>
          <td>John</td>
          <td>Programming</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>Alice attended Math 3 times, Physics 2 times, Programming 1 time.</li>
<li>Bob attended Math and Programming once, Physics 0 times.</li>
<li>Alex did not attend any exam.</li>
<li>John attended all subjects once.</li>
</ul>
</li>
</ul>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">student_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">s</span><span class="p">.</span><span class="n">student_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">u</span><span class="p">.</span><span class="n">subject_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">COUNT</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">subject_name</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">attended_exams</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Students</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">Subjects</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Examinations</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">student_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">student_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">subject_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">subject_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">subject_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">student_id</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">subject_name</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="1285-find-the-start-and-end-number-of-continuous-ranges">1285. Find the Start and End Number of Continuous Ranges</h2>
<h4 id="description-61">Description</h4>
<p>Table: Logs</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>log_id</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>log_id</code> is the primary key.</li>
<li>Each row contains an ID in the log table.</li>
<li>Some IDs may be missing.</li>
</ul>
<p>Write an SQL query to find the <strong>start and end number of continuous ranges</strong> in the table <code>Logs</code>.</p>
<ul>
<li>Order the result table by <code>start_id</code>.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Logs table:</p>
<table>
  <thead>
      <tr>
          <th>log_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
      </tr>
      <tr>
          <td>2</td>
      </tr>
      <tr>
          <td>3</td>
      </tr>
      <tr>
          <td>7</td>
      </tr>
      <tr>
          <td>8</td>
      </tr>
      <tr>
          <td>10</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>start_id</th>
          <th>end_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>7</td>
          <td>8</td>
      </tr>
      <tr>
          <td>10</td>
          <td>10</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>Range 1–3 is continuous.</li>
<li>4–6 is missing.</li>
<li>Range 7–8 is continuous.</li>
<li>9 is missing.</li>
<li>10 is a single-element range.

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Solution using subqueries
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">l1</span><span class="p">.</span><span class="n">log_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">start_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">l2</span><span class="p">.</span><span class="n">log_id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">end_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">log_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Logs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">log_id</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Logs</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">l1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">log_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Logs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">log_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Logs</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">l2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">l1</span><span class="p">.</span><span class="n">log_id</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">l2</span><span class="p">.</span><span class="n">log_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">l1</span><span class="p">.</span><span class="n">log_id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Solution using variables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">MIN</span><span class="p">(</span><span class="n">log_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">start_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">MAX</span><span class="p">(</span><span class="n">log_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">end_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="p">(</span><span class="o">@</span><span class="n">id</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Logs</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">id</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">init</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">log_id</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details></li>
</ul>
</li>
</ul>
<h2 id="1294-weather-type-in-each-country">1294. Weather Type in Each Country</h2>
<h4 id="description-62">Description</h4>
<p>Table: Countries</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>country_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>country_name</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>country_id</code> is the primary key.</li>
<li>Each row contains the ID and name of a country.</li>
</ul>
<p>Table: Weather</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>country_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>weather_state</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>day</td>
          <td>date</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(country_id, day)</code> is the primary key.</li>
<li>Each row indicates the weather state in a country for one day.</li>
</ul>
<p>Write an SQL query to find the <strong>type of weather</strong> in each country for <strong>November 2019</strong>.</p>
<ul>
<li><code>weather_type</code> rules:
<ul>
<li>&ldquo;Cold&rdquo; if average <code>weather_state</code> ≤ 15</li>
<li>&ldquo;Hot&rdquo; if average <code>weather_state</code> ≥ 25</li>
<li>&ldquo;Warm&rdquo; otherwise</li>
</ul>
</li>
<li>Return the result table in any order.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Countries table:</p>
<table>
  <thead>
      <tr>
          <th>country_id</th>
          <th>country_name</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2</td>
          <td>USA</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Australia</td>
      </tr>
      <tr>
          <td>7</td>
          <td>Peru</td>
      </tr>
      <tr>
          <td>5</td>
          <td>China</td>
      </tr>
      <tr>
          <td>8</td>
          <td>Morocco</td>
      </tr>
      <tr>
          <td>9</td>
          <td>Spain</td>
      </tr>
  </tbody>
</table>
<p>Weather table:</p>
<table>
  <thead>
      <tr>
          <th>country_id</th>
          <th>weather_state</th>
          <th>day</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2</td>
          <td>15</td>
          <td>2019-11-01</td>
      </tr>
      <tr>
          <td>3</td>
          <td>-2</td>
          <td>2019-11-10</td>
      </tr>
      <tr>
          <td>3</td>
          <td>0</td>
          <td>2019-11-11</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>2019-11-12</td>
      </tr>
      <tr>
          <td>5</td>
          <td>16</td>
          <td>2019-11-07</td>
      </tr>
      <tr>
          <td>5</td>
          <td>18</td>
          <td>2019-11-09</td>
      </tr>
      <tr>
          <td>5</td>
          <td>21</td>
          <td>2019-11-23</td>
      </tr>
      <tr>
          <td>7</td>
          <td>25</td>
          <td>2019-11-28</td>
      </tr>
      <tr>
          <td>8</td>
          <td>25</td>
          <td>2019-11-05</td>
      </tr>
      <tr>
          <td>8</td>
          <td>27</td>
          <td>2019-11-15</td>
      </tr>
      <tr>
          <td>8</td>
          <td>31</td>
          <td>2019-11-25</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>country_name</th>
          <th>weather_type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>USA</td>
          <td>Cold</td>
      </tr>
      <tr>
          <td>Australia</td>
          <td>Cold</td>
      </tr>
      <tr>
          <td>Peru</td>
          <td>Hot</td>
      </tr>
      <tr>
          <td>China</td>
          <td>Warm</td>
      </tr>
      <tr>
          <td>Morocco</td>
          <td>Hot</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>USA average in November = 15 → Cold</li>
<li>Australia average = (-2 + 0 + 3)/3 = 0.33 → Cold</li>
<li>Peru average = 25 → Hot</li>
<li>China average = (16 + 18 + 21)/3 ≈ 18.33 → Warm</li>
<li>Morocco average = (25 + 27 + 31)/3 ≈ 27.67 → Hot</li>
<li>Spain has no data for November → excluded

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">country_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">CASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="k">WHEN</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">weather_state</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Cold&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="k">WHEN</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">weather_state</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Hot&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Warm&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">weather_type</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Weather</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">w</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Countries</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">country_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">country_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">day</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2019-11-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2019-11-30&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">country_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details></li>
</ul>
</li>
</ul>
<h2 id="1303-find-the-team-size">1303. Find the Team Size</h2>
<h4 id="description-63">Description</h4>
<p>Table: Employee</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>employee_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>team_id</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>employee_id</code> is the primary key.</li>
<li>Each row contains the ID of an employee and their respective team.</li>
</ul>
<p>Write an SQL query to find the <strong>team size</strong> of each employee.</p>
<ul>
<li>Return the result table in any order.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Employee table:</p>
<table>
  <thead>
      <tr>
          <th>employee_id</th>
          <th>team_id</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>8</td>
      </tr>
      <tr>
          <td>2</td>
          <td>8</td>
      </tr>
      <tr>
          <td>3</td>
          <td>8</td>
      </tr>
      <tr>
          <td>4</td>
          <td>7</td>
      </tr>
      <tr>
          <td>5</td>
          <td>9</td>
      </tr>
      <tr>
          <td>6</td>
          <td>9</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>employee_id</th>
          <th>team_size</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>3</td>
      </tr>
      <tr>
          <td>2</td>
          <td>3</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
      </tr>
      <tr>
          <td>4</td>
          <td>1</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2</td>
      </tr>
      <tr>
          <td>6</td>
          <td>2</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>Employees 1, 2, 3 are in team 8 → team size 3</li>
<li>Employee 4 is in team 7 → team size 1</li>
<li>Employees 5, 6 are in team 9 → team size 2

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">employee_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">t</span><span class="p">.</span><span class="n">team_size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">team_id</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">team_size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Employee</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">team_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">team_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">team_id</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details></li>
</ul>
</li>
</ul>
<h2 id="1308-running-total-for-different-genders">1308. Running Total for Different Genders</h2>
<h4 id="description-64">Description</h4>
<p>Table: Scores</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>player_name</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>gender</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>day</td>
          <td>date</td>
      </tr>
      <tr>
          <td>score_points</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(gender, day)</code> is the primary key.</li>
<li>Each row indicates a player’s score on a certain day.</li>
<li>Gender is <code>'F'</code> for females team, <code>'M'</code> for males team.</li>
</ul>
<p>Write an SQL query to find the <strong>total score</strong> for each gender at each day.</p>
<ul>
<li>Order the result by <code>gender</code> and <code>day</code>.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Scores table:</p>
<table>
  <thead>
      <tr>
          <th>player_name</th>
          <th>gender</th>
          <th>day</th>
          <th>score_points</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Aron</td>
          <td>F</td>
          <td>2020-01-01</td>
          <td>17</td>
      </tr>
      <tr>
          <td>Alice</td>
          <td>F</td>
          <td>2020-01-07</td>
          <td>23</td>
      </tr>
      <tr>
          <td>Bajrang</td>
          <td>M</td>
          <td>2020-01-07</td>
          <td>7</td>
      </tr>
      <tr>
          <td>Khali</td>
          <td>M</td>
          <td>2019-12-25</td>
          <td>11</td>
      </tr>
      <tr>
          <td>Slaman</td>
          <td>M</td>
          <td>2019-12-30</td>
          <td>13</td>
      </tr>
      <tr>
          <td>Joe</td>
          <td>M</td>
          <td>2019-12-31</td>
          <td>3</td>
      </tr>
      <tr>
          <td>Jose</td>
          <td>M</td>
          <td>2019-12-18</td>
          <td>2</td>
      </tr>
      <tr>
          <td>Priya</td>
          <td>F</td>
          <td>2019-12-31</td>
          <td>23</td>
      </tr>
      <tr>
          <td>Priyanka</td>
          <td>F</td>
          <td>2019-12-30</td>
          <td>17</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>gender</th>
          <th>day</th>
          <th>total</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>F</td>
          <td>2019-12-30</td>
          <td>17</td>
      </tr>
      <tr>
          <td>F</td>
          <td>2019-12-31</td>
          <td>40</td>
      </tr>
      <tr>
          <td>F</td>
          <td>2020-01-01</td>
          <td>57</td>
      </tr>
      <tr>
          <td>F</td>
          <td>2020-01-07</td>
          <td>80</td>
      </tr>
      <tr>
          <td>M</td>
          <td>2019-12-18</td>
          <td>2</td>
      </tr>
      <tr>
          <td>M</td>
          <td>2019-12-25</td>
          <td>13</td>
      </tr>
      <tr>
          <td>M</td>
          <td>2019-12-30</td>
          <td>26</td>
      </tr>
      <tr>
          <td>M</td>
          <td>2019-12-31</td>
          <td>29</td>
      </tr>
      <tr>
          <td>M</td>
          <td>2020-01-07</td>
          <td>36</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>Running total for females: 17 → 40 → 57 → 80</li>
<li>Running total for males: 2 → 13 → 26 → 29 → 36

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">gender</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">s1</span><span class="p">.</span><span class="k">day</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">SUM</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="n">score_points</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">total</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Scores</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">Scores</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="n">gender</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="k">day</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="k">day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="k">day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">gender</span><span class="p">,</span><span class="w"> </span><span class="k">day</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details></li>
</ul>
</li>
</ul>
<h2 id="1321-restaurant-growth">1321. Restaurant Growth</h2>
<h4 id="description-65">Description</h4>
<p>Table: Customer</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>customer_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>name</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>visited_on</td>
          <td>date</td>
      </tr>
      <tr>
          <td>amount</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(customer_id, visited_on)</code> is the primary key.</li>
<li>This table contains customer transactions in a restaurant.</li>
<li><code>visited_on</code> is the date of visit.</li>
<li><code>amount</code> is the total paid by a customer.</li>
</ul>
<p>Write an SQL query to compute <strong>moving average</strong> of customer payments in a 7-day window (current day + 6 previous days).</p>
<ul>
<li>Return <code>visited_on</code>, total <code>amount</code> of that day, and <code>average_amount</code> (rounded to 2 decimals).</li>
<li>Order by <code>visited_on</code>.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Customer table:</p>
<table>
  <thead>
      <tr>
          <th>customer_id</th>
          <th>name</th>
          <th>visited_on</th>
          <th>amount</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Jhon</td>
          <td>2019-01-01</td>
          <td>100</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Daniel</td>
          <td>2019-01-02</td>
          <td>110</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Jade</td>
          <td>2019-01-03</td>
          <td>120</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Khaled</td>
          <td>2019-01-04</td>
          <td>130</td>
      </tr>
      <tr>
          <td>5</td>
          <td>Winston</td>
          <td>2019-01-05</td>
          <td>110</td>
      </tr>
      <tr>
          <td>6</td>
          <td>Elvis</td>
          <td>2019-01-06</td>
          <td>140</td>
      </tr>
      <tr>
          <td>7</td>
          <td>Anna</td>
          <td>2019-01-07</td>
          <td>150</td>
      </tr>
      <tr>
          <td>8</td>
          <td>Maria</td>
          <td>2019-01-08</td>
          <td>80</td>
      </tr>
      <tr>
          <td>9</td>
          <td>Jaze</td>
          <td>2019-01-09</td>
          <td>110</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Jhon</td>
          <td>2019-01-10</td>
          <td>130</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Jade</td>
          <td>2019-01-10</td>
          <td>150</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>visited_on</th>
          <th>amount</th>
          <th>average_amount</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>2019-01-07</td>
          <td>860</td>
          <td>122.86</td>
      </tr>
      <tr>
          <td>2019-01-08</td>
          <td>840</td>
          <td>120.00</td>
      </tr>
      <tr>
          <td>2019-01-09</td>
          <td>840</td>
          <td>120.00</td>
      </tr>
      <tr>
          <td>2019-01-10</td>
          <td>1000</td>
          <td>142.86</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ol>
<li>First moving average (2019-01-01 to 2019-01-07): (100 + 110 + 120 + 130 + 110 + 140 + 150)/7 = 122.86</li>
<li>Second moving average (2019-01-02 to 2019-01-08): 120</li>
<li>Third moving average (2019-01-03 to 2019-01-09): 120</li>
<li>Fourth moving average (2019-01-04 to 2019-01-10): 142.86

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL, user defined variables)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">visited_on</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">amount</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">average_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">visited_on</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">cnt</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cnt</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">d7</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">d6</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">d6</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">d5</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">d5</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">d4</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">d4</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">d3</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">d3</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">d2</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">d2</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">d1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">d1</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="o">@</span><span class="n">total</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">d1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">d2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">d3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">d4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">d5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">d6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">@</span><span class="n">d7</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ROUND</span><span class="p">(</span><span class="o">@</span><span class="n">total</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">average_amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">visited_on</span><span class="p">,</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">amount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Customer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">visited_on</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">cnt</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">total</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">d1</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">d2</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">d3</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">d4</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">d5</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">d6</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="o">@</span><span class="n">d7</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details></li>
</ol>
</li>
</ul>
<h2 id="1322-ads-performance">1322. Ads Performance</h2>
<h4 id="description-66">Description</h4>
<p>Table: Ads</p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ad_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>user_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>action</td>
          <td>enum</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(ad_id, user_id)</code> is the primary key.</li>
<li><code>action</code> can be one of: <code>'Clicked'</code>, <code>'Viewed'</code>, <code>'Ignored'</code>.</li>
<li>Each row represents a user&rsquo;s action on an Ad.</li>
</ul>
<p>A company wants to calculate the performance of each Ad using <strong>Click-Through Rate (CTR)</strong>:</p>
<ul>
<li><strong>CTR</strong> formula:
<ul>
<li>If <code>total_clicks + total_views = 0</code>, CTR = 0</li>
<li>Otherwise: <code>CTR = total_clicks / (total_clicks + total_views) * 100</code></li>
</ul>
</li>
</ul>
<p>Write an SQL query to find CTR for each Ad.</p>
<ul>
<li>Round CTR to 2 decimals.</li>
<li>Order by CTR descending, and by <code>ad_id</code> ascending in case of tie.</li>
</ul>
<p><strong>Example:</strong></p>
<p>Ads table:</p>
<table>
  <thead>
      <tr>
          <th>ad_id</th>
          <th>user_id</th>
          <th>action</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>Clicked</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2</td>
          <td>Clicked</td>
      </tr>
      <tr>
          <td>3</td>
          <td>3</td>
          <td>Viewed</td>
      </tr>
      <tr>
          <td>5</td>
          <td>5</td>
          <td>Ignored</td>
      </tr>
      <tr>
          <td>1</td>
          <td>7</td>
          <td>Ignored</td>
      </tr>
      <tr>
          <td>2</td>
          <td>7</td>
          <td>Viewed</td>
      </tr>
      <tr>
          <td>3</td>
          <td>5</td>
          <td>Clicked</td>
      </tr>
      <tr>
          <td>1</td>
          <td>4</td>
          <td>Viewed</td>
      </tr>
      <tr>
          <td>2</td>
          <td>11</td>
          <td>Viewed</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>Clicked</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>ad_id</th>
          <th>ctr</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>66.67</td>
      </tr>
      <tr>
          <td>3</td>
          <td>50.00</td>
      </tr>
      <tr>
          <td>2</td>
          <td>33.33</td>
      </tr>
      <tr>
          <td>5</td>
          <td>0.00</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>ad_id=1: CTR = 2 / (2+1) * 100 = 66.67</li>
<li>ad_id=2: CTR = 1 / (1+2) * 100 = 33.33</li>
<li>ad_id=3: CTR = 1 / (1+1) * 100 = 50.00</li>
<li>ad_id=5: CTR = 0 (no clicks or views)

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ad_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">clicks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">views</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">clicks</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">clicks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">views</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ctr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ad_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;Clicked&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">clicks</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;Viewed&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">views</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Ads</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ad_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">ctr</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">ad_id</span><span class="w"> </span><span class="k">ASC</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details></li>
</ul>
</li>
</ul>
<h2 id="1327-list-the-products-ordered-in-a-period">1327. List the Products Ordered in a Period</h2>
<h4 id="description-67">Description</h4>
<p><strong>Table: Products</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>product_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>product_name</td>
          <td>varchar</td>
      </tr>
      <tr>
          <td>product_category</td>
          <td>varchar</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>product_id</code> is the primary key.</li>
</ul>
<p><strong>Table: Orders</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>product_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>order_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>unit</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>product_id</code> is a foreign key to Products.</li>
<li><code>unit</code> is the number of products ordered on <code>order_date</code>.</li>
<li>There may be duplicate rows.</li>
</ul>
<p>Write an SQL query to get the names of products with <strong>≥ 100 units</strong> ordered in <strong>February 2020</strong> and their total amount. Return the result in any order.</p>
<p><strong>Example:</strong></p>
<p>Products table:</p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>product_name</th>
          <th>product_category</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Leetcode Solutions</td>
          <td>Book</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Jewels of Stringology</td>
          <td>Book</td>
      </tr>
      <tr>
          <td>3</td>
          <td>HP</td>
          <td>Laptop</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Lenovo</td>
          <td>Laptop</td>
      </tr>
      <tr>
          <td>5</td>
          <td>Leetcode Kit</td>
          <td>T-shirt</td>
      </tr>
  </tbody>
</table>
<p>Orders table:</p>
<table>
  <thead>
      <tr>
          <th>product_id</th>
          <th>order_date</th>
          <th>unit</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2020-02-05</td>
          <td>60</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2020-02-10</td>
          <td>70</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2020-01-18</td>
          <td>30</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2020-02-11</td>
          <td>80</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2020-02-17</td>
          <td>2</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2020-02-24</td>
          <td>3</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2020-03-01</td>
          <td>20</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2020-03-04</td>
          <td>30</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2020-03-04</td>
          <td>60</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2020-02-25</td>
          <td>50</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2020-02-27</td>
          <td>50</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2020-03-01</td>
          <td>50</td>
      </tr>
  </tbody>
</table>
<p>Result table:</p>
<table>
  <thead>
      <tr>
          <th>product_name</th>
          <th>unit</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Leetcode Solutions</td>
          <td>130</td>
      </tr>
      <tr>
          <td>Leetcode Kit</td>
          <td>100</td>
      </tr>
  </tbody>
</table>
<ul>
<li><strong>Explanation:</strong>
<ul>
<li>Product 1: 60 + 70 = 130</li>
<li>Product 5: 50 + 50 = 100</li>
<li>Products 2, 3, 4 do not reach 100 units in Feb 2020

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">product_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">unit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">o</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Products</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">p</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">product_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">order_date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="s1">&#39;2020-02-01&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="s1">&#39;2020-02-29&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">product_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">HAVING</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details></li>
</ul>
</li>
</ul>
<h2 id="1336-number-of-transactions-per-visit">1336. Number of Transactions per Visit</h2>
<h4 id="description-68">Description</h4>
<p><strong>Table: Visits</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>user_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>visit_date</td>
          <td>date</td>
      </tr>
  </tbody>
</table>
<ul>
<li><code>(user_id, visit_date)</code> is the primary key.</li>
<li>Each row indicates that a user visited the bank on that date.</li>
</ul>
<p><strong>Table: Transactions</strong></p>
<table>
  <thead>
      <tr>
          <th>Column Name</th>
          <th>Type</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>user_id</td>
          <td>int</td>
      </tr>
      <tr>
          <td>transaction_date</td>
          <td>date</td>
      </tr>
      <tr>
          <td>amount</td>
          <td>int</td>
      </tr>
  </tbody>
</table>
<ul>
<li>There is no primary key; may contain duplicates.</li>
<li>Each row indicates a transaction by a user on <code>transaction_date</code>.</li>
<li>It is guaranteed that a transaction occurs on a day the user visited (<code>Visits</code> table contains the pair <code>(user_id, transaction_date)</code>).</li>
</ul>
<p>Write an SQL query to find the number of users who did <code>0, 1, 2, ...</code> transactions per visit. The result should include all counts from <code>0</code> up to the maximum transactions by any user in a single visit.</p>
<p><strong>Result columns:</strong></p>
<ul>
<li><code>transactions_count</code>: number of transactions in one visit</li>
<li><code>visits_count</code>: number of visits with that many transactions</li>
</ul>
<p>Order by <code>transactions_count</code>.</p>
<h4 id="example">Example</h4>
<p><strong>Visits table:</strong></p>
<table>
  <thead>
      <tr>
          <th>user_id</th>
          <th>visit_date</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2020-01-01</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2020-01-02</td>
      </tr>
      <tr>
          <td>12</td>
          <td>2020-01-01</td>
      </tr>
      <tr>
          <td>19</td>
          <td>2020-01-03</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2020-01-02</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2020-01-03</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2020-01-04</td>
      </tr>
      <tr>
          <td>7</td>
          <td>2020-01-11</td>
      </tr>
      <tr>
          <td>9</td>
          <td>2020-01-25</td>
      </tr>
      <tr>
          <td>8</td>
          <td>2020-01-28</td>
      </tr>
  </tbody>
</table>
<p><strong>Transactions table:</strong></p>
<table>
  <thead>
      <tr>
          <th>user_id</th>
          <th>transaction_date</th>
          <th>amount</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2020-01-02</td>
          <td>120</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2020-01-03</td>
          <td>22</td>
      </tr>
      <tr>
          <td>7</td>
          <td>2020-01-11</td>
          <td>232</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2020-01-04</td>
          <td>7</td>
      </tr>
      <tr>
          <td>9</td>
          <td>2020-01-25</td>
          <td>33</td>
      </tr>
      <tr>
          <td>9</td>
          <td>2020-01-25</td>
          <td>66</td>
      </tr>
      <tr>
          <td>8</td>
          <td>2020-01-28</td>
          <td>1</td>
      </tr>
      <tr>
          <td>9</td>
          <td>2020-01-25</td>
          <td>99</td>
      </tr>
  </tbody>
</table>
<p><strong>Result table:</strong></p>
<table>
  <thead>
      <tr>
          <th>transactions_count</th>
          <th>visits_count</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>4</td>
      </tr>
      <tr>
          <td>1</td>
          <td>5</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0</td>
      </tr>
      <tr>
          <td>3</td>
          <td>1</td>
      </tr>
  </tbody>
</table>
<ul>
<li>Explanation:
<ul>
<li><code>0</code> transactions: 4 visits</li>
<li><code>1</code> transaction: 5 visits</li>
<li><code>2</code> transactions: 0 visits</li>
<li><code>3</code> transactions: 1 visit</li>
</ul>
</li>
</ul>
<hr>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution (MySQL)
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">transactions_count</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">visits_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Visits</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">visit_date</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">transaction_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">UNION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">transactions_count</span><span class="p">,</span><span class="w"> </span><span class="k">IF</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">visits_count</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">visits_count</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">visits_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">tc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">transactions_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="o">@</span><span class="n">tc</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">tc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">tc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">tc</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">u</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">tc</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="n">IFNULL</span><span class="p">(</span><span class="k">MAX</span><span class="p">(</span><span class="n">transactions_count</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">transactions_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">transaction_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">transactions_count</span><span class="p">,</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">visits_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">transactions_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Transactions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">transaction_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">transactions_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">t</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">transactions_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">transactions_count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">transactions_count</span><span class="p">;</span></span></span></code></pre></div>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
<article class="default">
  <header class="headline">
  </header>

<h1 id="pyspark-1">Pyspark 1</h1>

<h2 id="1-write-a-pyspark-query-using-below-input-to-get-below-output">1. Write a PySpark query using below input to get below output?</h2>
<h4 id="input">Input</h4>
<table>
  <thead>
      <tr>
          <th>name</th>
          <th>Hobbies</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Alice</td>
          <td>Badminton, Tennis</td>
      </tr>
      <tr>
          <td>Bob</td>
          <td>Tennis, Cricket</td>
      </tr>
      <tr>
          <td>Julie</td>
          <td>Cricket, Carroms</td>
      </tr>
  </tbody>
</table>
<h4 id="output">Output</h4>
<table>
  <thead>
      <tr>
          <th>name</th>
          <th>Hobbies</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Alice</td>
          <td>Badminton</td>
      </tr>
      <tr>
          <td>Alice</td>
          <td>Tennis</td>
      </tr>
      <tr>
          <td>Bob</td>
          <td>Tennis</td>
      </tr>
      <tr>
          <td>Bob</td>
          <td>Cricket</td>
      </tr>
      <tr>
          <td>Julie</td>
          <td>Cricket</td>
      </tr>
      <tr>
          <td>Julie</td>
          <td>Carroms</td>
      </tr>
  </tbody>
</table>
<hr>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">split</span><span class="p">,</span> <span class="n">explode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;HobbiesSplit&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Badminton, Tennis&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Tennis, Cricket&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Julie&#34;</span><span class="p">,</span> <span class="s2">&#34;Cricket, Carroms&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;Hobbies&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Split and explode hobbies</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Hobbies&#34;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&#34;Hobbies&#34;</span><span class="p">],</span> <span class="s2">&#34;,\s*&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="2-write-a-pyspark-query-using-the-below-input-to-get-the-required-output">2. Write a PySpark query using the below input to get the required output.</h2>
<h4 id="input-1">Input</h4>
<table>
  <thead>
      <tr>
          <th>City1</th>
          <th>City2</th>
          <th>City3</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Goa</td>
          <td>null</td>
          <td>Ap</td>
      </tr>
      <tr>
          <td>null</td>
          <td>AP</td>
          <td>null</td>
      </tr>
      <tr>
          <td>null</td>
          <td>null</td>
          <td>Bglr</td>
      </tr>
  </tbody>
</table>
<h4 id="expected-output">Expected Output</h4>
<table>
  <thead>
      <tr>
          <th>Result</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Goa</td>
      </tr>
      <tr>
          <td>AP</td>
      </tr>
      <tr>
          <td>Bglr</td>
      </tr>
  </tbody>
</table>
<hr>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample Input Data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;Goa&#34;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&#34;Ap&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&#34;AP&#34;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&#34;Bglr&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;City1&#34;</span><span class="p">,</span> <span class="s2">&#34;City2&#34;</span><span class="p">,</span> <span class="s2">&#34;City3&#34;</span><span class="p">])</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Use COALESCE to pick the first non-null city</span>
</span></span><span class="line"><span class="cl"><span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">F</span><span class="o">.</span><span class="n">coalesce</span><span class="p">(</span><span class="s2">&#34;City1&#34;</span><span class="p">,</span> <span class="s2">&#34;City2&#34;</span><span class="p">,</span> <span class="s2">&#34;City3&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Result&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="3-question--student-result-classification">3. Question – Student Result Classification</h2>
<p>You have a PySpark DataFrame <code>df</code> containing student marks in multiple subjects:</p>
<table>
  <thead>
      <tr>
          <th>Id</th>
          <th>Name</th>
          <th>Subject</th>
          <th>Mark</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>Steve</td>
          <td>SQL</td>
          <td>90</td>
      </tr>
      <tr>
          <td>1</td>
          <td>Steve</td>
          <td>PySpark</td>
          <td>100</td>
      </tr>
      <tr>
          <td>2</td>
          <td>David</td>
          <td>SQL</td>
          <td>70</td>
      </tr>
      <tr>
          <td>2</td>
          <td>David</td>
          <td>PySpark</td>
          <td>60</td>
      </tr>
      <tr>
          <td>3</td>
          <td>John</td>
          <td>SQL</td>
          <td>30</td>
      </tr>
      <tr>
          <td>3</td>
          <td>John</td>
          <td>PySpark</td>
          <td>20</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Shree</td>
          <td>SQL</td>
          <td>50</td>
      </tr>
  </tbody>
</table>
<ol>
<li>
<p>Write a PySpark query to calculate the <strong>average percentage</strong> for each student across all subjects.</p>
</li>
<li>
<p>Based on the percentage, assign a <strong>Result</strong> column using the following rules:</p>
<ul>
<li><strong>Distinction</strong> → Percentage ≥ 70</li>
<li><strong>First Class</strong> → 60 ≤ Percentage &lt; 70</li>
<li><strong>Second Class</strong> → 50 ≤ Percentage &lt; 60</li>
<li><strong>Third Class</strong> → 40 ≤ Percentage &lt; 50</li>
<li><strong>Fail</strong> → Percentage &lt; 40</li>
</ul>
</li>
</ol>
<p>Show the final DataFrame with columns: <code>Id</code>, <code>Name</code>, <code>Percentage</code>, <code>Result</code>.</p>
<hr>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">when</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;StudentMarks&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Steve&#39;</span><span class="p">,</span> <span class="s1">&#39;SQL&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Steve&#39;</span><span class="p">,</span> <span class="s1">&#39;PySpark&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;David&#39;</span><span class="p">,</span> <span class="s1">&#39;SQL&#39;</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;David&#39;</span><span class="p">,</span> <span class="s1">&#39;PySpark&#39;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;SQL&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;PySpark&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Shree&#39;</span><span class="p">,</span> <span class="s1">&#39;SQL&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Id&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Subject&#34;</span><span class="p">,</span> <span class="s2">&#34;Mark&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Calculate average percentage per student</span>
</span></span><span class="line"><span class="cl"><span class="n">df_per</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;Id&#34;</span><span class="p">,</span> <span class="s2">&#34;Name&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">avg</span><span class="p">(</span><span class="s2">&#34;Mark&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Assign Result based on percentage</span>
</span></span><span class="line"><span class="cl"><span class="n">df_final</span> <span class="o">=</span> <span class="n">df_per</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">,</span> <span class="s2">&#34;Distinction&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">when</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">70</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">),</span> <span class="s2">&#34;First Class&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">when</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">),</span> <span class="s2">&#34;Second Class&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">when</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;Percentage&#34;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">),</span> <span class="s2">&#34;Third Class&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="s2">&#34;Fail&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Result&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_final</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="4-department-wise-employee-ranking">4. Department-wise Employee Ranking</h2>
<h4 id="question"><strong>Question</strong></h4>
<p>You are given the following employee dataset:</p>
<table>
  <thead>
      <tr>
          <th>EmpId</th>
          <th>EmpName</th>
          <th>Salary</th>
          <th>DeptName</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>A</td>
          <td>1000</td>
          <td>IT</td>
      </tr>
      <tr>
          <td>2</td>
          <td>B</td>
          <td>1500</td>
          <td>IT</td>
      </tr>
      <tr>
          <td>3</td>
          <td>C</td>
          <td>2500</td>
          <td>IT</td>
      </tr>
      <tr>
          <td>4</td>
          <td>D</td>
          <td>3000</td>
          <td>HR</td>
      </tr>
      <tr>
          <td>5</td>
          <td>E</td>
          <td>2000</td>
          <td>HR</td>
      </tr>
      <tr>
          <td>6</td>
          <td>F</td>
          <td>1000</td>
          <td>HR</td>
      </tr>
      <tr>
          <td>7</td>
          <td>G</td>
          <td>4000</td>
          <td>Sales</td>
      </tr>
      <tr>
          <td>8</td>
          <td>H</td>
          <td>4000</td>
          <td>Sales</td>
      </tr>
      <tr>
          <td>9</td>
          <td>I</td>
          <td>1000</td>
          <td>Sales</td>
      </tr>
      <tr>
          <td>10</td>
          <td>J</td>
          <td>2000</td>
          <td>Sales</td>
      </tr>
  </tbody>
</table>
<p>You need to:</p>
<ol>
<li>Assign a <strong>dense rank</strong> to employees based on their salary <strong>within each department</strong>, sorted in <strong>descending order</strong>.</li>
<li>Display only those employees who hold the <strong>2nd highest salary</strong> in each department.</li>
</ol>
<hr>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;EmployeeRanking&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Input Data</span>
</span></span><span class="line"><span class="cl"><span class="n">data1</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s2">&#34;A&#34;</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="s2">&#34;IT&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s2">&#34;B&#34;</span><span class="p">,</span><span class="mi">1500</span><span class="p">,</span><span class="s2">&#34;IT&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s2">&#34;C&#34;</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="s2">&#34;IT&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s2">&#34;D&#34;</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="s2">&#34;HR&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="s2">&#34;E&#34;</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="s2">&#34;HR&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s2">&#34;F&#34;</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="s2">&#34;HR&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="s2">&#34;G&#34;</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="s2">&#34;Sales&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="s2">&#34;H&#34;</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="s2">&#34;Sales&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="s2">&#34;I&#34;</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="s2">&#34;Sales&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s2">&#34;J&#34;</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="s2">&#34;Sales&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">schema1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;EmpId&#34;</span><span class="p">,</span><span class="s2">&#34;EmpName&#34;</span><span class="p">,</span><span class="s2">&#34;Salary&#34;</span><span class="p">,</span><span class="s2">&#34;DeptName&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">schema1</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Apply dense_rank() by department based on descending salary</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rank</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">dense_rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">DeptName</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Salary</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Filter employees with 2nd highest salary</span>
</span></span><span class="line"><span class="cl"><span class="n">df_second_highest</span> <span class="o">=</span> <span class="n">df_rank</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">df_rank</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_second_highest</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="5-employee-salary-report-by-department-and-manager">5. Employee Salary Report by Department and Manager</h2>
<h4 id="question-1"><strong>Question</strong></h4>
<p>You are given two DataFrames:</p>
<h4 id="1-employee-salary-information"><strong>1️⃣ Employee Salary Information</strong></h4>
<table>
  <thead>
      <tr>
          <th>EmpId</th>
          <th>EmpName</th>
          <th>Mgrid</th>
          <th>deptid</th>
          <th>salarydt</th>
          <th>salary</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>100</td>
          <td>Raj</td>
          <td>null</td>
          <td>1</td>
          <td>01-04-23</td>
          <td>50000</td>
      </tr>
      <tr>
          <td>200</td>
          <td>Joanne</td>
          <td>100</td>
          <td>1</td>
          <td>01-04-23</td>
          <td>4000</td>
      </tr>
      <tr>
          <td>200</td>
          <td>Joanne</td>
          <td>100</td>
          <td>1</td>
          <td>13-04-23</td>
          <td>4500</td>
      </tr>
      <tr>
          <td>200</td>
          <td>Joanne</td>
          <td>100</td>
          <td>1</td>
          <td>14-04-23</td>
          <td>4020</td>
      </tr>
  </tbody>
</table>
<h4 id="2-department-information"><strong>2️⃣ Department Information</strong></h4>
<table>
  <thead>
      <tr>
          <th>deptid</th>
          <th>deptname</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>IT</td>
      </tr>
      <tr>
          <td>2</td>
          <td>HR</td>
      </tr>
  </tbody>
</table>
<hr>
<h4 id="task"><strong>Task</strong></h4>
<ol>
<li>Convert the <code>salarydt</code> column to <strong>date type</strong>.</li>
<li>Join both DataFrames to add <strong>department name</strong>.</li>
<li>Perform a <strong>self-join</strong> to get each employee’s <strong>manager name</strong> (based on <code>Mgrid = EmpId</code>).</li>
<li>Group the data to calculate the <strong>total salary paid</strong> for each employee, month, and year within their department, along with their manager’s name.</li>
</ol>
<hr>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">to_date</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">date_format</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;EmployeeSalaryReport&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Employee Salary DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">data1</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&#34;Raj&#34;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;01-04-23&#34;</span><span class="p">,</span> <span class="mi">50000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;Joanne&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;01-04-23&#34;</span><span class="p">,</span> <span class="mi">4000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;Joanne&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;13-04-23&#34;</span><span class="p">,</span> <span class="mi">4500</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;Joanne&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;14-04-23&#34;</span><span class="p">,</span> <span class="mi">4020</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">schema1</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;EmpId&#34;</span><span class="p">,</span> <span class="s2">&#34;EmpName&#34;</span><span class="p">,</span> <span class="s2">&#34;Mgrid&#34;</span><span class="p">,</span> <span class="s2">&#34;deptid&#34;</span><span class="p">,</span> <span class="s2">&#34;salarydt&#34;</span><span class="p">,</span> <span class="s2">&#34;salary&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_salary</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">schema1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Department DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;IT&#34;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;HR&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">schema2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;deptid&#34;</span><span class="p">,</span> <span class="s2">&#34;deptname&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_dept</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">schema2</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 1: Convert salarydt to Date Type</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df_salary</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;Newsaldt&#34;</span><span class="p">,</span> <span class="n">to_date</span><span class="p">(</span><span class="s2">&#34;salarydt&#34;</span><span class="p">,</span> <span class="s2">&#34;dd-MM-yy&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 2: Join department data</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_dept</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;deptid&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: Self join to get Manager Name</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df1</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;b&#34;</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;a.Mgrid&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;b.EmpId&#34;</span><span class="p">),</span> <span class="s2">&#34;left&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;a.deptname&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;b.EmpName&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;ManagerName&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;a.EmpName&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;a.Newsaldt&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">col</span><span class="p">(</span><span class="s2">&#34;a.salary&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 4: Group by Dept, Manager, Employee, Year, and Month</span>
</span></span><span class="line"><span class="cl"><span class="n">df3</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df2</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;deptname&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ManagerName&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;EmpName&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">year</span><span class="p">(</span><span class="s2">&#34;Newsaldt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Year&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">date_format</span><span class="p">(</span><span class="s2">&#34;Newsaldt&#34;</span><span class="p">,</span> <span class="s2">&#34;MMMM&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Month&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&#34;salary&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df3</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="6-month-over-month-sales-growth-calculation">6. Month-over-Month Sales Growth Calculation</h2>
<h4 id="question-2"><strong>Question</strong></h4>
<p>You are given the following sales order dataset:</p>
<table>
  <thead>
      <tr>
          <th>SOId</th>
          <th>SODate</th>
          <th>ItemId</th>
          <th>ItemQty</th>
          <th>ItemValue</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>2024-01-01</td>
          <td>I1</td>
          <td>10</td>
          <td>1000</td>
      </tr>
      <tr>
          <td>2</td>
          <td>2024-01-15</td>
          <td>I2</td>
          <td>20</td>
          <td>2000</td>
      </tr>
      <tr>
          <td>3</td>
          <td>2024-02-01</td>
          <td>I3</td>
          <td>10</td>
          <td>1500</td>
      </tr>
      <tr>
          <td>4</td>
          <td>2024-02-15</td>
          <td>I4</td>
          <td>20</td>
          <td>2500</td>
      </tr>
      <tr>
          <td>5</td>
          <td>2024-03-01</td>
          <td>I5</td>
          <td>30</td>
          <td>3000</td>
      </tr>
      <tr>
          <td>6</td>
          <td>2024-03-10</td>
          <td>I6</td>
          <td>40</td>
          <td>3500</td>
      </tr>
      <tr>
          <td>7</td>
          <td>2024-03-20</td>
          <td>I7</td>
          <td>20</td>
          <td>2500</td>
      </tr>
      <tr>
          <td>8</td>
          <td>2024-03-30</td>
          <td>I8</td>
          <td>10</td>
          <td>1000</td>
      </tr>
  </tbody>
</table>
<hr>
<h4 id="task-1"><strong>Task</strong></h4>
<ol>
<li>
<p>Convert the <code>SODate</code> column into a <strong>DateType</strong>.</p>
</li>
<li>
<p>Extract <strong>Month</strong> and <strong>Year</strong> from the sales order date.</p>
</li>
<li>
<p>Calculate <strong>total sales per month</strong> (<code>sum(ItemValue)</code>).</p>
</li>
<li>
<p>Use a <strong>window function (<code>lag</code>)</strong> to get the <strong>previous month’s total sales</strong>.</p>
</li>
<li>
<p>Compute the <strong>month-over-month sales growth percentage</strong> using:</p>
<p>[
Growth% = \frac{(CurrentMonth - PrevMonth) * 100}{CurrentMonth}
]</p>
</li>
</ol>
<hr>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;MonthlySalesGrowth&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample Data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2024-01-01&#39;</span><span class="p">,</span> <span class="s2">&#34;I1&#34;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;2024-01-15&#34;</span><span class="p">,</span> <span class="s2">&#34;I2&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;2024-02-01&#34;</span><span class="p">,</span> <span class="s2">&#34;I3&#34;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1500</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s2">&#34;2024-02-15&#34;</span><span class="p">,</span> <span class="s2">&#34;I4&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2500</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;2024-03-01&#34;</span><span class="p">,</span> <span class="s2">&#34;I5&#34;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3000</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s2">&#34;2024-03-10&#34;</span><span class="p">,</span> <span class="s2">&#34;I6&#34;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">3500</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s2">&#34;2024-03-20&#34;</span><span class="p">,</span> <span class="s2">&#34;I7&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2500</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s2">&#34;2024-03-30&#34;</span><span class="p">,</span> <span class="s2">&#34;I8&#34;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;SOId&#34;</span><span class="p">,</span> <span class="s2">&#34;SODate&#34;</span><span class="p">,</span> <span class="s2">&#34;ItemId&#34;</span><span class="p">,</span> <span class="s2">&#34;ItemQty&#34;</span><span class="p">,</span> <span class="s2">&#34;ItemValue&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 1: Convert SODate to DateType</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;SODate&#34;</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">SODate</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DateType</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 2: Extract Month, Year</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">month</span><span class="p">(</span><span class="s2">&#34;SODate&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Month&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">year</span><span class="p">(</span><span class="s2">&#34;SODate&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Year&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span><span class="p">(</span><span class="s2">&#34;ItemValue&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: Aggregate monthly total sales</span>
</span></span><span class="line"><span class="cl"><span class="n">df3</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;Month&#34;</span><span class="p">,</span> <span class="s2">&#34;Year&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s2">&#34;ItemValue&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;TotalSale&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 4: Use lag() to find previous month&#39;s sale</span>
</span></span><span class="line"><span class="cl"><span class="n">df4</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">lag</span><span class="p">(</span><span class="s2">&#34;TotalSale&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">Window</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s2">&#34;Month&#34;</span><span class="p">,</span> <span class="s2">&#34;Year&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;PrevSale&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 5: Calculate Month-over-Month growth %</span>
</span></span><span class="line"><span class="cl"><span class="n">df_final</span> <span class="o">=</span> <span class="n">df4</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;*&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;TotalSale&#34;</span><span class="p">)</span> <span class="o">-</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;PrevSale&#34;</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">col</span><span class="p">(</span><span class="s2">&#34;TotalSale&#34;</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Growth_Percentage&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_final</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="7-average-machine-processing-time">7. Average Machine Processing Time</h2>
<h4 id="question-3"><strong>Question</strong></h4>
<p>You are given the following dataset representing machine process activity logs:</p>
<table>
  <thead>
      <tr>
          <th>Machine_id</th>
          <th>processid</th>
          <th>activityid</th>
          <th>timestamp</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td>0</td>
          <td>start</td>
          <td>0.712</td>
      </tr>
      <tr>
          <td>0</td>
          <td>0</td>
          <td>end</td>
          <td>1.520</td>
      </tr>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>start</td>
          <td>3.140</td>
      </tr>
      <tr>
          <td>0</td>
          <td>1</td>
          <td>end</td>
          <td>4.120</td>
      </tr>
      <tr>
          <td>1</td>
          <td>0</td>
          <td>start</td>
          <td>0.550</td>
      </tr>
      <tr>
          <td>1</td>
          <td>0</td>
          <td>end</td>
          <td>1.550</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>start</td>
          <td>0.430</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>end</td>
          <td>1.420</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0</td>
          <td>start</td>
          <td>4.100</td>
      </tr>
      <tr>
          <td>2</td>
          <td>0</td>
          <td>end</td>
          <td>4.512</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>start</td>
          <td>2.500</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>end</td>
          <td>5.000</td>
      </tr>
  </tbody>
</table>
<hr>
<h4 id="task-2"><strong>Task</strong></h4>
<ol>
<li>Identify <strong>start</strong> and <strong>end</strong> times for each <code>processid</code> and <code>Machine_id</code>.</li>
<li>Calculate the <strong>processing duration</strong> (<code>endtime - starttime</code>) for each process.</li>
<li>Find the <strong>average processing time per machine</strong> across all its processes.</li>
</ol>
<hr>
<h4 id="pyspark-solution"><strong>PySpark Solution</strong></h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;MachineProcessingTime&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 1: Input Data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="mf">0.712</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="mf">1.520</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="mf">3.140</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="mf">4.120</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="mf">0.550</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="mf">1.550</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="mf">0.430</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="mf">1.420</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="mf">4.100</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="mf">4.512</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="mf">2.500</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="mf">5.000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Machine_id&#34;</span><span class="p">,</span> <span class="s2">&#34;processid&#34;</span><span class="p">,</span> <span class="s2">&#34;activityid&#34;</span><span class="p">,</span> <span class="s2">&#34;timestamp&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 2: Split start and end timestamps</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df1</span><span class="o">.</span><span class="n">Machine_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">df1</span><span class="o">.</span><span class="n">processid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">when</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">activityid</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;starttime&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">when</span><span class="p">(</span><span class="n">df1</span><span class="o">.</span><span class="n">activityid</span> <span class="o">==</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="n">df1</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;endtime&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: Aggregate start and end timestamps per process</span>
</span></span><span class="line"><span class="cl"><span class="n">df3</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;Machine_id&#34;</span><span class="p">,</span> <span class="s2">&#34;processid&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nb">max</span><span class="p">(</span><span class="s2">&#34;starttime&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;starttime&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nb">max</span><span class="p">(</span><span class="s2">&#34;endtime&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;endtime&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 4: Calculate processing duration</span>
</span></span><span class="line"><span class="cl"><span class="n">df4</span> <span class="o">=</span> <span class="n">df3</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df3</span><span class="o">.</span><span class="n">Machine_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">endtime</span> <span class="o">-</span> <span class="n">df3</span><span class="o">.</span><span class="n">starttime</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;diff&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 5: Calculate average processing time per machine</span>
</span></span><span class="line"><span class="cl"><span class="n">df_final</span> <span class="o">=</span> <span class="n">df4</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;Machine_id&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">avg</span><span class="p">(</span><span class="s2">&#34;diff&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;avg_processing_time&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_final</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="8-combine-multiple-skills-into-a-single-column">8. Combine Multiple Skills into a Single Column</h2>
<h4 id="question-4"><strong>Question</strong></h4>
<p>You are given the following employee skill dataset:</p>
<table>
  <thead>
      <tr>
          <th>EmpId</th>
          <th>EmpName</th>
          <th>Skill</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>John</td>
          <td>ADF</td>
      </tr>
      <tr>
          <td>1</td>
          <td>John</td>
          <td>ADB</td>
      </tr>
      <tr>
          <td>1</td>
          <td>John</td>
          <td>PowerBI</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Joanne</td>
          <td>ADF</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Joanne</td>
          <td>SQL</td>
      </tr>
      <tr>
          <td>2</td>
          <td>Joanne</td>
          <td>Crystal Report</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Vikas</td>
          <td>ADF</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Vikas</td>
          <td>SQL</td>
      </tr>
      <tr>
          <td>3</td>
          <td>Vikas</td>
          <td>SSIS</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Monu</td>
          <td>SQL</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Monu</td>
          <td>SSIS</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Monu</td>
          <td>SSAS</td>
      </tr>
      <tr>
          <td>4</td>
          <td>Monu</td>
          <td>ADF</td>
      </tr>
  </tbody>
</table>
<hr>
<h4 id="task-3"><strong>Task</strong></h4>
<ol>
<li>Group the records by <strong>employee name</strong>.</li>
<li>Collect all skills of each employee into a single list.</li>
<li>Concatenate those skills into a single comma-separated string under a new column <strong><code>Skills</code></strong>.</li>
</ol>
<hr>
<h4 id="pyspark-solution-1"><strong>PySpark Solution</strong></h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">collect_list</span><span class="p">,</span> <span class="n">concat_ws</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;EmployeeSkills&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 1: Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;ADF&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;ADB&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;PowerBI&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Joanne&#39;</span><span class="p">,</span> <span class="s1">&#39;ADF&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Joanne&#39;</span><span class="p">,</span> <span class="s1">&#39;SQL&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Joanne&#39;</span><span class="p">,</span> <span class="s1">&#39;Crystal Report&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Vikas&#39;</span><span class="p">,</span> <span class="s1">&#39;ADF&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Vikas&#39;</span><span class="p">,</span> <span class="s1">&#39;SQL&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Vikas&#39;</span><span class="p">,</span> <span class="s1">&#39;SSIS&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Monu&#39;</span><span class="p">,</span> <span class="s1">&#39;SQL&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Monu&#39;</span><span class="p">,</span> <span class="s1">&#39;SSIS&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Monu&#39;</span><span class="p">,</span> <span class="s1">&#39;SSAS&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Monu&#39;</span><span class="p">,</span> <span class="s1">&#39;ADF&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;EmpId&#34;</span><span class="p">,</span> <span class="s2">&#34;EmpName&#34;</span><span class="p">,</span> <span class="s2">&#34;Skill&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 2: Collect all skills per employee into a list</span>
</span></span><span class="line"><span class="cl"><span class="n">df2</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;EmpName&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">collect_list</span><span class="p">(</span><span class="s2">&#34;Skill&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Skill&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: Convert list to comma-separated string</span>
</span></span><span class="line"><span class="cl"><span class="n">df3</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;EmpName&#34;</span><span class="p">,</span> <span class="n">concat_ws</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">,</span> <span class="s2">&#34;Skill&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Skills&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df3</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="9-split-phone-numbers-into-std-code-and-phone-number">9. Split Phone Numbers into STD Code and Phone Number</h2>
<h4 id="question-5"><strong>Question</strong></h4>
<p>You are given the following dataset containing employee names and their phone numbers:</p>
<table>
  <thead>
      <tr>
          <th>name</th>
          <th>phone</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Joanne</td>
          <td>040-20215632</td>
      </tr>
      <tr>
          <td>Tom</td>
          <td>044-23651023</td>
      </tr>
      <tr>
          <td>John</td>
          <td>086-12456782</td>
      </tr>
  </tbody>
</table>
<p>Each phone number is stored in the format:<br>
<code>&lt;STD Code&gt;-&lt;Phone Number&gt;</code></p>
<hr>
<h4 id="task-4"><strong>Task</strong></h4>
<ol>
<li>
<p>Split the <code>phone</code> column into two new columns:</p>
<ul>
<li><strong><code>std_code</code></strong> → Contains the STD code before the hyphen.</li>
<li><strong><code>phone_num</code></strong> → Contains the actual phone number after the hyphen.</li>
</ul>
</li>
<li>
<p>Display the final DataFrame.</p>
</li>
</ol>
<hr>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">split</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;PhoneNumberSplit&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 1: Create DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;Joanne&#39;</span><span class="p">,</span> <span class="s2">&#34;040-20215632&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;Tom&#39;</span><span class="p">,</span> <span class="s2">&#34;044-23651023&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s2">&#34;086-12456782&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;phone&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 2: Split phone number into STD code and phone number</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;std_code&#34;</span><span class="p">,</span> <span class="n">split</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="s2">&#34;-&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&#34;phone_num&#34;</span><span class="p">,</span> <span class="n">split</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="s2">&#34;-&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
  </div>
</details>
<h2 id="10find-actor-director-pairs-with-more-than-two-collaborations">10.Find Actor-Director Pairs with More Than Two Collaborations</h2>
<h4 id="question-6"><strong>Question</strong></h4>
<p>You are given a dataset containing details of <strong>actors</strong> and <strong>directors</strong>, where each record represents a collaboration between them:</p>
<table>
  <thead>
      <tr>
          <th>ActorId</th>
          <th>DirectorId</th>
          <th>timestamp</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>0</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>1</td>
      </tr>
      <tr>
          <td>1</td>
          <td>1</td>
          <td>2</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>3</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>4</td>
      </tr>
      <tr>
          <td>1</td>
          <td>2</td>
          <td>5</td>
      </tr>
      <tr>
          <td>2</td>
          <td>1</td>
          <td>6</td>
      </tr>
  </tbody>
</table>
<hr>
<h4 id="task-5"><strong>Task</strong></h4>
<p>Find all <strong>Actor–Director pairs</strong> that have worked together on <strong>more than two occasions</strong>.</p>
<hr>
<h4 id="pyspark-solution-2"><strong>PySpark Solution</strong></h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;ActorDirectorCollaboration&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 1: Define schema and data</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;ActorId&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;DirectorId&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">StructField</span><span class="p">(</span><span class="s2">&#34;timestamp&#34;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span></span></span></code></pre></div>

<details class=" box cstyle notices transparent expand">
  <summary class="box-label">
    <i class="expander-icon fa-fw fas fa-chevron-right"></i> 
    Solution
  </summary>
  <div class="box-content">
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Step 2: Group by ActorId and DirectorId and count occurrences</span>
</span></span><span class="line"><span class="cl"><span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;ActorId&#34;</span><span class="p">,</span> <span class="s2">&#34;DirectorId&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 3: Filter pairs with count &gt; 2</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">result_df</span><span class="p">[</span><span class="s2">&#34;count&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Step 4: Display Actor-Director pairs with more than 2 collaborations</span>
</span></span><span class="line"><span class="cl"><span class="n">df1</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;ActorId&#34;</span><span class="p">,</span> <span class="s2">&#34;DirectorId&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
  </div>
</details>

  <footer class="footline">
  </footer>
</article>
          </section>
<article class="chapter narrow">
  <header class="headline">
  </header>
<div class="article-subheading">Chapter 5</div>

<h1 id="interview-prep">Interview Prep</h1>


  <footer class="footline">
  </footer>
</article>
          <section>
            <h1 class="a11y-only">Subsections of Interview Prep</h1>
<article class="default">
  <header class="headline">
  </header>

<h1 id="adf-1">ADF 1</h1>

<h2 id="1-what-are-the-different-types-of-integration-runtimesir-in-adf-and-when-should-you-use-each">1. What are the different types of Integration runtimes(IR) in ADF, and when should you use each?</h2>
<p><strong>Integration runtime (IR)</strong> is a compute engine that provides computational resources to perform <strong>data movement, transformation, and orchestration</strong> in ADF.</p>
<h3 id="types-of-integration-runtimes">Types of Integration Runtimes</h3>
<ol>
<li>
<p><strong>Azure IR</strong></p>
<ul>
<li>Use when performing <strong>data movement, transformation, and orchestration entirely within the cloud</strong>.</li>
</ul>
</li>
<li>
<p><strong>Self-Hosted IR</strong></p>
<ul>
<li>Use when <strong>any source or destination is an on-premises system</strong>.</li>
<li>Required to <strong>pull data from on-prem systems</strong>.</li>
</ul>
</li>
<li>
<p><strong>Azure SSIS IR</strong></p>
<ul>
<li>Specifically built to <strong>lift and shift Microsoft SSIS packages</strong>.</li>
</ul>
</li>
</ol>
<h3 id="managing-integration-runtimes-in-adf">Managing Integration Runtimes in ADF</h3>
<ul>
<li>Navigate to <strong>ADF -&gt; Manage tab -&gt; Integration Runtimes</strong>.</li>
<li><strong>AutoResolveIntegrationRuntime</strong> is present by default.</li>
</ul>
<h3 id="creating-a-new-ir">Creating a New IR</h3>
<ol>
<li>Click on <strong>Add</strong>.</li>
<li>Choose the type of IR: <strong>Self-Hosted</strong>, <strong>SSIS</strong>, or <strong>Airflow</strong>.</li>
</ol>
<h2 id="2-platform-for-creating-azure-self-hosted-ir">2. Platform for Creating Azure Self-Hosted IR</h2>
<ul>
<li><strong>Self-Hosted IR</strong> requires compute <strong>outside of Azure</strong>, so you can use:
<ul>
<li>A <strong>local machine</strong></li>
<li>A <strong>hosted virtual machine</strong></li>
</ul>
</li>
</ul>
<h2 id="3-handling-schema-drift-in-adf">3. Handling Schema Drift in ADF</h2>
<p>When dealing with <strong>evolving datasets</strong>, e.g., a new column appears in the source not present in the destination:</p>
<ul>
<li>Use <strong>Mapping Dataflows</strong> to apply transformations.</li>
</ul>
<h3 id="options-in-mapping-dataflows">Options in Mapping Dataflows</h3>
<ol>
<li>
<p><strong>Schema Drift</strong></p>
<ul>
<li>Available when creating the <strong>source dataset</strong> in Mapping Dataflows.</li>
<li>Allows handling evolving schemas without errors.</li>
<li>Example: If a 5th column appears in the source, it will be written to the destination, with <strong>NULL for existing records</strong>.</li>
</ul>
</li>
<li>
<p><strong>Auto Mapping</strong></p>
<ul>
<li>Automatically maps columns between source and destination, eliminating manual schema mapping.</li>
</ul>
</li>
</ol>
<h3 id="recommended-approach">Recommended Approach</h3>
<ul>
<li><strong>Combine Schema Drift and Auto Mapping</strong> to handle evolving datasets seamlessly.</li>
</ul>
<h2 id="4-how-would-you-load-multiple-data-files-from-rest-apis-using-single-copy-activity">4. How would you load multiple data files from REST APIs using SINGLE copy activity?</h2>
<h3 id="steps">Steps</h3>
<ol>
<li>
<p><strong>Create a new pipeline</strong></p>
<ul>
<li>Go to <strong>Author tab → Create a new pipeline</strong> (name it <code>pipAPI</code>).</li>
</ul>
</li>
<li>
<p><strong>Add a ForEach activity</strong></p>
<ul>
<li>Drag a <strong>ForEach</strong> activity into the pipeline.</li>
</ul>
</li>
<li>
<p><strong>Configure ForEach parameters</strong></p>
<ul>
<li>In the <strong>Parameters</strong> tab of the ForEach activity, create a parameter:
<ul>
<li><strong>Name:</strong> <code>loop_value</code></li>
<li><strong>Type:</strong> <code>Array</code></li>
<li><strong>Default Value:</strong>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nt">&#34;fname&#34;</span><span class="p">:</span> <span class="s2">&#34;x.csv&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nt">&#34;fname&#34;</span><span class="p">:</span> <span class="s2">&#34;y.csv&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nt">&#34;fname&#34;</span><span class="p">:</span> <span class="s2">&#34;z.csv&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span></span></span></code></pre></div>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Set the ForEach items</strong></p>
<ul>
<li>Go to the <strong>Settings</strong> tab → under <strong>Items</strong>, add dynamic content:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">@pipeline().parameters.loop_value</span></span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><strong>Add a Copy Data activity inside ForEach</strong></p>
<ul>
<li>Drag a <strong>Copy Data</strong> activity inside the ForEach loop.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="source-configuration">Source Configuration</h3>
<ol start="6">
<li>
<p><strong>Create Source Dataset</strong></p>
<ul>
<li>Create a dataset <code>ds_api</code> with:
<ul>
<li><strong>Datastore:</strong> HTTP</li>
<li><strong>Data format:</strong> CSV</li>
</ul>
</li>
<li>Choose or create a linked service <code>ls_api</code>:
<ul>
<li><strong>Integration Runtime:</strong> AutoResolveIR</li>
<li><strong>Base URL:</strong> <code>https://raw.githubuserdata.com/</code></li>
<li><strong>Authentication type:</strong> Anonymous</li>
<li>Test and create the connection.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Parameterize the Source Dataset</strong></p>
<ul>
<li>Go to the <strong>Parameters</strong> tab:
<ul>
<li>Add parameter:
<ul>
<li><strong>Name:</strong> <code>p_filenm</code></li>
<li><strong>Type:</strong> String</li>
<li><strong>Default value:</strong> <code>@item().fname</code></li>
</ul>
</li>
</ul>
</li>
<li>Go to the <strong>Connection</strong> tab → under <strong>Relative URL</strong>, add dynamic content:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">anshikagit/ADF/refs/heads/main/Data/@{dataset().p_filenm}</span></span></code></pre></div>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="sink-configuration">Sink Configuration</h3>
<ol start="8">
<li>
<p><strong>Create Sink Dataset</strong></p>
<ul>
<li>Create a dataset <code>ds_adls</code> with:
<ul>
<li><strong>Datastore:</strong> ADLS Gen2</li>
<li><strong>Data format:</strong> CSV</li>
</ul>
</li>
<li>Choose or create a linked service <code>ls_adls</code>:
<ul>
<li><strong>Integration Runtime:</strong> AutoResolveIR</li>
<li><strong>Storage account name:</strong> ansadfstrg11</li>
<li>Test and create the connection.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Parameterize the Sink Dataset</strong></p>
<ul>
<li>Go to the <strong>Parameters</strong> tab:
<ul>
<li>Add parameters:
<ul>
<li><strong>p_folder:</strong> string</li>
<li><strong>p_file:</strong> string</li>
</ul>
</li>
<li>Default values:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">@item().fname</span></span></code></pre></div>
</li>
</ul>
</li>
<li>In the <strong>Connection</strong> tab, under <strong>File path</strong>, add dynamic content:
<ul>
<li><strong>Directory:</strong> <code>@dataset().p_folder</code></li>
<li><strong>Filename:</strong> <code>@dataset().p_file.csv</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<ol start="10">
<li><strong>Run the Pipeline</strong>
<ul>
<li>Click <strong>Debug</strong> to execute the pipeline and verify multiple file copies from REST API to ADLS Gen2.</li>
</ul>
</li>
</ol>
<h2 id="5-how-would-you-design-a-fault-tolerant-adf-pipeline-to-process-billions-of-records-daily">5. How would you design a fault tolerant ADF pipeline to process billions of records daily?</h2>
<p>To handle large-scale data processing (billions of records per day) in <strong>Azure Data Factory (ADF)</strong> efficiently and reliably, the following mechanisms can be leveraged:</p>
<hr>
<h3 id="a-retry-policy">a. Retry Policy</h3>
<ul>
<li>ADF provides built-in <strong>Retry Policy</strong> for all activities.</li>
<li>You can specify:
<ul>
<li><strong>Number of retries</strong> — how many times an activity should retry upon failure.</li>
<li><strong>Retry interval</strong> — time gap between retries.</li>
</ul>
</li>
</ul>
<p><strong>Example:</strong><br>
If a Copy Activity fails due to transient network issues, setting:</p>
<ul>
<li><strong>Retry count:</strong> <code>3</code></li>
<li><strong>Retry interval:</strong> <code>30 seconds</code><br>
ensures ADF automatically retries before marking the activity as failed.</li>
</ul>
<hr>
<h3 id="b-parallelism-in-mapping-data-flows">b. Parallelism in Mapping Data Flows</h3>
<h4 id="i-parallelism-within-a-single-mapping-data-flow">i. Parallelism within a Single Mapping Data Flow</h4>
<ul>
<li>Enables <strong>multiple sink operations</strong> to run <strong>simultaneously</strong> within the same data flow.</li>
<li>Example:<br>
Processing customer data and writing to both:
<ul>
<li>A <strong>SQL database</strong> (for analytics)</li>
<li>A <strong>Data Lake</strong> (for archival)</li>
</ul>
</li>
</ul>
<p>By enabling <strong>&ldquo;Run in parallel&rdquo;</strong> in <strong>Sink Properties</strong>, both sinks execute concurrently instead of sequentially — improving overall performance.</p>
<hr>
<h4 id="ii-parallelism-across-multiple-data-flow-activities-in-a-pipeline">ii. Parallelism Across Multiple Data Flow Activities in a Pipeline</h4>
<p><strong>1. Independent Data Sources</strong></p>
<ul>
<li>If two datasets (e.g., <strong>Sales</strong> and <strong>Inventory</strong>) are independent:
<ul>
<li>Create two Data Flow activities — one for each dataset.</li>
<li>Place them in <strong>parallel branches</strong> within the pipeline.</li>
<li>ADF executes both simultaneously, reducing total runtime.</li>
</ul>
</li>
</ul>
<p><strong>2. Parallel ForEach Processing</strong></p>
<ul>
<li>When processing multiple files (e.g., CSVs in a folder) with identical transformation logic:
<ul>
<li>Use a <strong>ForEach</strong> activity to iterate through the files.</li>
<li>Enable <strong>parallel execution</strong> inside ForEach.</li>
<li>ADF will process multiple files concurrently, greatly accelerating throughput.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="c-failure-notification-and-alerts">c. Failure Notification and Alerts</h3>
<p>To ensure quick response to failures:</p>
<ol>
<li>Go to the <strong>Monitor</strong> tab in ADF.</li>
<li>Click <strong>New Alert Rule</strong>.</li>
<li>Provide details:
<ul>
<li><strong>Name:</strong> <code>failAlert1</code></li>
<li><strong>Severity:</strong> Choose appropriate level.</li>
</ul>
</li>
<li>In <strong>Target criteria</strong>:
<ul>
<li>Add metrics such as:
<ul>
<li><strong>Activity type(s)</strong></li>
<li><strong>Name(s)</strong></li>
<li><strong>Pipeline name(s)</strong></li>
<li><strong>Failure type(s)</strong></li>
</ul>
</li>
</ul>
</li>
<li>Define <strong>condition</strong>, <strong>threshold</strong>, <strong>period</strong>, and <strong>frequency</strong> for triggering alerts.</li>
<li>Configure <strong>Notifications</strong>:
<ul>
<li>Add Email, SMS, or both.</li>
<li>Provide recipient details.</li>
<li>Save to activate the alert.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Example:<br>
For the Copy Activity inside the ForEach (as in Question 4), include the <strong>ForEach activity</strong> itself in alert criteria since a child failure causes the parent to fail as well.</p></blockquote>
<hr>
<p>By combining <strong>Retry Policies</strong>, <strong>Parallelism</strong>, and <strong>Automated Failure Alerts</strong>, you can design a highly <strong>fault-tolerant</strong>, <strong>scalable</strong>, and <strong>resilient</strong> ADF pipeline capable of processing billions of records daily.</p>
<h2 id="6-your-adf-pipeline-is-running-slow--how-to-identify-and-fix-performance-bottlenecks">6. Your ADF Pipeline is Running Slow — How to Identify and Fix Performance Bottlenecks</h2>
<h3 id="a-initial-step-monitor-and-identify">a. Initial Step: Monitor and Identify</h3>
<ul>
<li>As a Data Engineer, the <strong>first step</strong> is to monitor the pipeline and <strong>identify which activity</strong> is causing delays.</li>
<li>Use the <strong>Monitor</strong> tab in ADF to review activity runtimes and pinpoint the bottleneck.</li>
</ul>
<h3 id="b-common-root-causes-and-fixes">b. Common Root Causes and Fixes</h3>
<ol>
<li>
<p><strong>Slow Data Flows</strong></p>
<ul>
<li>Issue: Data flow execution takes longer than expected.</li>
<li>Fix: <strong>Prune the data</strong> in the early stages (apply filters or reduce columns before transformation).</li>
</ul>
</li>
<li>
<p><strong>Slow Copy Activity</strong></p>
<ul>
<li>Issue: Copying data from <strong>on-premises to Azure</strong> takes too long due to <strong>Self-Hosted Integration Runtime (IR)</strong> throttling.</li>
<li>Fix: Scale up the IR VM, allocate more CPU/memory, or distribute load across multiple IR nodes.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="7-implementing-incremental-data-load-in-adf-for-large-transactional-databases">7. Implementing Incremental Data Load in ADF for Large Transactional Databases</h2>
<h3 id="a-watermark-approach--step-by-step">a. Watermark Approach — Step-by-Step</h3>
<ol>
<li>
<p><strong>Identify a Watermark Column</strong><br>
Choose a column that updates with each new or modified record, e.g., <code>lastModifiedDate</code> or an increasing <code>ID</code>.</p>
</li>
<li>
<p><strong>Store the Watermark Value</strong><br>
Maintain the last processed watermark value in a <strong>control table</strong> or <strong>pipeline variable</strong>.</p>
</li>
<li>
<p><strong>Filter Data</strong></p>
<ul>
<li>Use a <strong>Lookup Activity</strong> to fetch the last watermark from the control table.</li>
<li>Use a <strong>Copy Activity</strong> with a dynamic query:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">SourceTable</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">lastModifiedDate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">@</span><span class="err">{</span><span class="n">activity</span><span class="p">(</span><span class="s1">&#39;Lookup&#39;</span><span class="p">).</span><span class="k">output</span><span class="p">.</span><span class="n">firstRow</span><span class="p">.</span><span class="n">LastWatermark</span><span class="err">}</span></span></span></code></pre></div>
</li>
</ul>
</li>
<li>
<p><strong>Update the Watermark</strong><br>
After the successful copy, use a <strong>Stored Procedure</strong> or <strong>Script Activity</strong> to update the watermark table with the new maximum watermark value.</p>
</li>
</ol>
<hr>
<h3 id="b-cdc-change-data-capture-approach">b. CDC (Change Data Capture) Approach</h3>
<ol>
<li>
<p><strong>Enable CDC on Source</strong><br>
Activate CDC on the source database and required tables — this tracks inserts, updates, and deletes in system tables.</p>
</li>
<li>
<p><strong>Use ADF’s Built-in CDC Feature</strong><br>
ADF can directly read from CDC system tables to identify changed data automatically.</p>
</li>
<li>
<p><strong>Extract and Apply Changes</strong></p>
<ul>
<li>Use the <code>__$operation</code> field to determine change type:
<ul>
<li><code>1</code>: Delete</li>
<li><code>2</code>: Insert</li>
<li><code>3</code>/<code>4</code>: Update</li>
</ul>
</li>
<li>Apply logic accordingly in your sink.</li>
</ul>
</li>
<li>
<p><strong>Manage Checkpoints Automatically</strong><br>
ADF maintains <strong>checkpoints</strong> (like LSN) to ensure only new changes since the last run are processed.</p>
</li>
</ol>
<hr>
<h2 id="8-processing-a-json-file-with-unknown-structure-in-adf">8. Processing a JSON File with Unknown Structure in ADF</h2>
<ul>
<li>Enable <strong>Schema Drift</strong> to handle schema evolution dynamically.</li>
<li>In a <strong>Mapping Data Flow</strong>:
<ol>
<li>Turn on <strong>Debug Mode</strong> to preview the schema.</li>
<li>Apply <strong>Flatten Transformation</strong> to denormalize nested JSON structures for processing.</li>
</ol>
</li>
</ul>
<hr>
<h2 id="9-implementing-real-time-streaming-pipeline-in-adf">9. Implementing Real-Time Streaming Pipeline in ADF</h2>
<h3 id="scenario">Scenario</h3>
<p>A new file arrives in an ADLS container, and you need to <strong>copy it automatically</strong> to another container.</p>
<h3 id="solution-event-based-trigger">Solution: Event-Based Trigger</h3>
<ul>
<li>Use an <strong>Event-Based Trigger</strong> to automatically start the pipeline whenever a new file arrives.</li>
</ul>
<h3 id="configuration-steps">Configuration Steps</h3>
<ol>
<li>Register <strong>Event Grid Services</strong> under <strong>Subscriptions</strong>.</li>
<li>Create a new <strong>Event-Based Trigger</strong> in ADF:
<ul>
<li>Trigger type: <strong>Blob Created</strong></li>
<li>Linked service: Connect to the ADLS container.</li>
<li>Action: Launch the desired pipeline (e.g., Copy Activity).</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>Note:</strong> Registration of <strong>Event Grid Services</strong> is mandatory before using Event-Based Triggers.</p></blockquote>
<h2 id="10-how-would-you-load-data-to-different-locations-based-on-file-name-in-adf">10. How Would You Load Data to Different Locations Based on File Name in ADF</h2>
<h3 id="a-get-file-list-get-metadata-activity">a. Get File List (Get Metadata Activity)</h3>
<ul>
<li>Start the pipeline with a <strong>Get Metadata</strong> activity.</li>
<li>Configure it to retrieve <strong>Child Items</strong> from the source folder in your storage account.</li>
<li>This activity outputs a list of all files present in the specified source location.</li>
</ul>
<h3 id="b-iterate-over-files-for-each-activity">b. Iterate Over Files (For Each Activity)</h3>
<ul>
<li>Pass the output of the <strong>Get Metadata</strong> activity to a <strong>For Each</strong> activity.</li>
<li>This allows the pipeline to <strong>loop through each file</strong> found in the source folder and process them one by one.</li>
</ul>
<h3 id="c-conditional-routing-if-condition-activity">c. Conditional Routing (If Condition Activity)</h3>
<ul>
<li>Inside the <strong>For Each</strong> loop, add an <strong>If Condition</strong> activity.</li>
<li>Use expressions to check the file name for specific patterns or keywords to determine where each file should go.</li>
<li>Example expressions:</li>
</ul>
<p><code>@contains(item().name, 'sales')</code>
or
<code>@startsWith(item().name, 'marketing')</code></p>
<p><strong>Based on the Condition</strong></p>
<ul>
<li>If the file name contains <strong>&ldquo;sales&rdquo;</strong>, route it to a <strong>Sales</strong> destination folder.</li>
<li>If it contains <strong>&ldquo;marketing&rdquo;</strong>, route it to a <strong>Marketing</strong> destination folder.</li>
</ul>
<hr>
<h3 id="d-load-data-copy-data-activity">d. Load Data (Copy Data Activity)</h3>
<ul>
<li>Each branch of the <strong>If Condition</strong> activity will contain a <strong>Copy Data</strong> activity.</li>
<li>Configure as follows:
<ul>
<li><strong>Source Dataset:</strong> The current file being processed (<code>@item().name</code>)</li>
<li><strong>Sink Dataset:</strong> The target destination based on the file name (e.g., Sales or Marketing folder)</li>
</ul>
</li>
<li>The <strong>Copy Data</strong> activity will copy files to their respective destinations according to the defined condition logic.</li>
</ul>
<hr>
<h3 id="example-pipeline-flow">Example Pipeline Flow</h3>
<ol>
<li><strong>Get Metadata Activity</strong> → Retrieve list of files from the source folder.</li>
<li><strong>For Each Activity</strong> → Iterate through each file.</li>
<li><strong>If Condition Activity</strong> → Check the file name for keywords like “sales” or “marketing.”</li>
<li><strong>Copy Data Activity</strong> → Load the file into the corresponding destination folder based on the condition.</li>
</ol>
<h2 id="11-storing-all-file-names-in-a-variable--counting-files-in-a-folder">11. Storing All File Names in a Variable &amp; Counting Files in a Folder</h2>
<h3 id="a-get-file-list">a. Get File List</h3>
<ul>
<li>Use a <strong>Get Metadata</strong> activity configured with <strong>Child Items</strong>.</li>
<li>This returns a single array containing the names of all files and subfolders in the specified location.</li>
</ul>
<h3 id="b-iterate-over-files">b. Iterate Over Files</h3>
<ul>
<li>Use a <strong>For Each</strong> activity to loop through the array returned by Get Metadata.</li>
<li>Inside the loop, you can process each file individually.</li>
</ul>
<h3 id="c-store-file-names">c. Store File Names</h3>
<ul>
<li>Use <strong>Set Variable</strong> and <strong>Append Variable</strong> activities to store and manipulate the list of file names:
<ul>
<li><strong>Set Variable:</strong> Assign an entire list of file names to a pipeline variable (e.g., <code>fileNamesArray</code>).</li>
<li><strong>Append Variable:</strong> When building the list dynamically within a loop, add one filename at a time.
<ul>
<li>Useful if looping through multiple folders and combining all filenames into a single list.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="d-count-the-files">d. Count the Files</h3>
<ul>
<li>Use a second <strong>Set Variable</strong> activity to store the count of files.</li>
<li>Create a variable of type <strong>Integer</strong> (e.g., <code>fileCount</code>).</li>
<li>Use the following expression in the <strong>Value</strong> field:</li>
</ul>
<p><code>@length(variables('fileNamesArray'))</code></p>
<h2 id="12-pipeline-design-in-adf-to-copy-only-files-not-present-in-destination">12. Pipeline Design in ADF to Copy Only Files Not Present in Destination</h2>
<h3 id="a-get-source-file-list">a. Get Source File List</h3>
<ul>
<li>Use a <strong>Get Metadata</strong> activity to retrieve a list of all files from the <strong>source folder</strong>.</li>
</ul>
<h3 id="b-get-destination-file-list">b. Get Destination File List</h3>
<ul>
<li>Use a second <strong>Get Metadata</strong> activity to retrieve all files from the <strong>destination folder</strong>.</li>
<li>Store this list in a <strong>pipeline variable</strong> (e.g., <code>destinationFiles</code>).</li>
</ul>
<h3 id="c-iterate-and-compare">c. Iterate and Compare</h3>
<ul>
<li>Use a <strong>For Each</strong> activity to loop through the array of source files obtained from the first <strong>Get Metadata</strong> activity.</li>
</ul>
<h3 id="d-implement-the-condition">d. Implement the Condition</h3>
<ul>
<li>Inside the loop, add an <strong>If Condition</strong> activity to check if the current file from the source exists in the destination variable.</li>
<li>Expression example:</li>
</ul>
<p><code>@not(contains(string(variables('destinationFiles')), item().name))</code></p>
<h3 id="e-copy-the-file">e. Copy the File</h3>
<ul>
<li>Place a <strong>Copy Data</strong> activity inside the <strong>True</strong> block of the <strong>If Condition</strong>.</li>
<li>This ensures that only files <strong>not present in the destination</strong> are copied from the source.</li>
</ul>
<h2 id="13-calling-secrets-stored-in-key-vault-in-adf">13. Calling Secrets Stored in Key Vault in ADF</h2>
<h3 id="creation-of-secret-in-key-vault">Creation of Secret in Key Vault</h3>
<ol>
<li>
<p><strong>Create Key Vault</strong></p>
<ul>
<li>In the Azure Portal, search for <strong>&ldquo;Key Vaults&rdquo;</strong> and click <strong>Create</strong>.</li>
<li>Fill in the basic details: Subscription, Resource Group, Name (globally unique), and Region.</li>
</ul>
</li>
<li>
<p><strong>Assign Key Vault Administrator Role</strong></p>
<ul>
<li>Navigate to <strong>IAM</strong> and assign the <strong>Key Vault Administrator</strong> role to the ID authorized to create secrets.</li>
</ul>
</li>
<li>
<p><strong>Create a Secret</strong></p>
<ul>
<li>Go to <strong>Secrets</strong> inside the Key Vault and create a new secret.</li>
</ul>
</li>
<li>
<p><strong>(Optional) Provide 3rd Party Access</strong></p>
<ul>
<li>To allow access to external services like Databricks:
<ul>
<li>Key Vault → <strong>Access Configuration</strong> → Choose <strong>Vault Access Policy</strong> to grant data plane access.</li>
</ul>
</li>
<li>By default, <strong>Azure RBAC</strong> is used. This step can also be configured during Key Vault creation.</li>
</ul>
</li>
<li>
<p><strong>Set Access Policies for ADF</strong></p>
<ul>
<li>Navigate to <strong>Access Policies</strong> or <strong>Access Control (IAM)</strong> in the Key Vault.</li>
<li>Grant your <strong>Azure Data Factory</strong> <strong>Get</strong> and <strong>List</strong> permissions for secrets via its <strong>Managed Identity</strong>.</li>
</ul>
</li>
</ol>
<hr>
<h3 id="calling-the-secret-in-adf">Calling the Secret in ADF</h3>
<h4 id="1-standard-method-recommended">1. Standard Method (Recommended)</h4>
<ul>
<li>
<p><strong>Create a Key Vault Linked Service</strong></p>
<ul>
<li>Go to <strong>Manage → Linked Services → New</strong> in your ADF instance.</li>
<li>Choose <strong>Azure Key Vault</strong> and point it to your Key Vault.</li>
</ul>
</li>
<li>
<p><strong>Reference the Secret in Another Linked Service</strong></p>
<ul>
<li>When creating a linked service for a data store (e.g., SQL Database), select the option to <strong>Reference a Secret</strong> for sensitive fields like passwords.</li>
<li>Choose the Key Vault Linked Service created above and provide the <strong>secret name</strong> (e.g., <code>MyDatabasePassword</code>).</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2-advanced-method-using-web-activity">2. Advanced Method (Using Web Activity)</h4>
<ul>
<li>
<p><strong>Use Web Activity to Retrieve Secret Dynamically</strong></p>
<ol>
<li>Add a <strong>Web Activity</strong> to your pipeline.</li>
<li>Configure REST API call to Key Vault:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>https://&lt;your_key_vault_name&gt;.vault.azure.net/secrets/&lt;your_secret_name&gt;?api-version=7.4</code></pre></div>
</li>
<li><strong>Authentication:</strong> Managed Identity<br>
<strong>Resource:</strong> <code>https://vault.azure.net</code></li>
<li><strong>Method:</strong> GET</li>
</ol>
</li>
<li>
<p><strong>Use the Secret in Subsequent Activities</strong></p>
<ul>
<li>The secret value will be in the Web Activity output.</li>
<li>Reference it using an expression:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">@activity(&#39;Web1&#39;).output.value</span></span></code></pre></div>
</li>
</ul>
</li>
</ul>
<h2 id="14-avoiding-out-of-memory-oom-errors-in-adf-pipelines-processing-large-datasets">14. Avoiding Out-of-Memory (OOM) Errors in ADF Pipelines Processing Large Datasets</h2>
<h3 id="a-optimize-your-integration-runtime-ir">a. Optimize Your Integration Runtime (IR)</h3>
<ul>
<li>The <strong>IR</strong> is the compute engine for your pipeline. Proper configuration ensures enough memory for large workloads.</li>
</ul>
<h4 id="mapping-data-flows">Mapping Data Flows</h4>
<ul>
<li>Scale up the <strong>Azure IR</strong> used by your data flow.</li>
<li>Increase <strong>Core Count</strong> and choose <strong>Memory Optimized</strong> compute type.</li>
<li>This provides more resources to the underlying Spark cluster for large transformations.</li>
</ul>
<h4 id="self-hosted-ir">Self-Hosted IR</h4>
<ul>
<li>For on-premises data processing, add more nodes to your <strong>Self-Hosted IR</strong>.</li>
<li>Distributes workload across machines to prevent a single node from running out of memory.</li>
</ul>
<hr>
<h3 id="b-partition-large-datasets">b. Partition Large Datasets</h3>
<ul>
<li>Breaking data into smaller chunks prevents OOM issues.</li>
</ul>
<h4 id="files">Files</h4>
<ul>
<li>Use <strong>Get Metadata</strong> to retrieve all files in a folder.</li>
<li>Use a <strong>For Each</strong> loop to process files individually via <strong>Copy Data</strong> or <strong>Mapping Data Flow</strong>.</li>
<li>In <strong>Data Flow source options</strong>, set partitioning (single, multiple, or none) to enable parallel processing.</li>
</ul>
<h4 id="database-tables">Database Tables</h4>
<ul>
<li>Implement <strong>iterative range copy</strong> for large tables:
<ul>
<li>Use a <strong>Lookup</strong> activity to find min and max values of a key column (e.g., ID or date).</li>
<li>Use a <strong>For Each</strong> loop to copy smaller chunks (e.g., 100,000 rows at a time) with a <strong>parameterized query</strong>.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="c-tune-activity-specific-settings">c. Tune Activity-Specific Settings</h3>
<h4 id="mapping-data-flow">Mapping Data Flow</h4>
<ul>
<li>Be cautious with <strong>Broadcast joins or lookups</strong>:
<ul>
<li>Broadcasting improves performance but can cause OOM if the dataset is too large.</li>
<li>Turn off broadcasting for large streams if necessary.</li>
</ul>
</li>
<li>Prune or filter data early in the flow to reduce memory usage.</li>
</ul>
<h4 id="copy-data-activity">Copy Data Activity</h4>
<ul>
<li>For extremely large single files (XML, JSON, Excel), OOM can occur.</li>
<li>Use the <strong>Binary Copy</strong> feature to move files without loading content into memory.</li>
</ul>
<h2 id="15-ensuring-idempotency-in-adf-pipelines">15. Ensuring Idempotency in ADF Pipelines</h2>
<p><strong>Idempotency</strong> ensures that running the same process multiple times with the same input produces the <strong>same result</strong> as running it once, preventing duplicate processing of records. This can be achieved using <strong>UPSERT</strong> on file data, often with <strong>inline datasets</strong> (e.g., Delta Lake) in Mapping Data Flows.</p>
<hr>
<h3 id="a-source-transformations">a. Source Transformations</h3>
<ul>
<li>Configure <strong>at least two source transformations</strong>:
<ol>
<li><strong>Incoming Data Source</strong> – your new data.</li>
<li><strong>Destination Data Source</strong> – existing data in the target.</li>
</ol>
</li>
<li>Use <strong>inline datasets</strong> to define connection details and schema directly in the data flow.</li>
</ul>
<hr>
<h3 id="b-exists-transformation">b. Exists Transformation</h3>
<ul>
<li>Use an <strong>Exists transformation</strong> to implement idempotency.</li>
<li>It acts like a <code>WHERE EXISTS</code> clause in SQL:
<ul>
<li>Checks if rows from the <strong>incoming data stream</strong> (left stream) exist in the <strong>destination stream</strong> (right stream) based on a key (e.g., primary key).</li>
</ul>
</li>
</ul>
<hr>
<h3 id="c-conditional-split">c. Conditional Split</h3>
<ul>
<li>Chain a <strong>Conditional Split</strong> transformation after the Exists transformation.</li>
<li>Split the data into two streams:
<ol>
<li><strong>New Records</strong> – rows where the key does <strong>not exist</strong> in the destination; these will be inserted.</li>
<li><strong>Existing Records</strong> – rows where the key <strong>does exist</strong>; these will be updated.</li>
</ol>
</li>
</ul>
<hr>
<h3 id="d-alter-row--sink">d. Alter Row &amp; Sink</h3>
<ul>
<li>Connect an <strong>Alter Row</strong> transformation to each stream from the Conditional Split:
<ul>
<li><strong>New Records</strong> → set <strong>Insert</strong> policy.</li>
<li><strong>Existing Records</strong> → set <strong>Upsert</strong> or <strong>Update</strong> policy.</li>
</ul>
</li>
<li>Connect both Alter Row outputs to a single <strong>Sink</strong> transformation.
<ul>
<li>Configure the sink to allow <strong>Insert</strong> and <strong>Upsert/Update</strong> policies.</li>
<li>Define the <strong>key columns</strong> for correct record matching.</li>
</ul>
</li>
</ul>
<p>This approach ensures that <strong>duplicate processing of the same records does not occur</strong>, maintaining idempotency in your ADF pipeline.</p>
<h2 id="16-enforcing-file-processing-order-in-adf">16. Enforcing File Processing Order in ADF</h2>
<ul>
<li>To process files in a <strong>specific order</strong> (e.g., <code>sales.csv</code> → <code>product.csv</code> → <code>cust.csv</code>), use the <strong>Sequential</strong> option in the <strong>For Each</strong> activity.</li>
<li>This ensures that files are processed <strong>one after another</strong> rather than in parallel.</li>
</ul>
<hr>
<h2 id="17-processing-two-files-with-different-schemas-using-a-single-copy-data-activity">17. Processing Two Files with Different Schemas Using a Single Copy Data Activity</h2>
<h3 id="a-source-dataset">a. Source Dataset</h3>
<ul>
<li>Create a <strong>source dataset</strong> that takes the <strong>file name as a parameter</strong>.</li>
<li>In the <strong>file path settings</strong>, use a dynamic expression:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">@item().name</span></span></code></pre></div>
</li>
</ul>
<p>This passes the current file name from the For Each loop to the Copy Data activity.</p>
<h3 id="b-dynamic-mapping">b. Dynamic Mapping</h3>
<h4 id="delete-static-mapping">Delete Static Mapping</h4>
<ul>
<li>In the <strong>Mapping</strong> tab of the Copy Data activity, remove existing column mappings.</li>
<li>You can either delete the entire mapping table or remove columns manually.</li>
</ul>
<h4 id="enable-schema-drift">Enable Schema Drift</h4>
<ul>
<li>In the <strong>source settings</strong> of the Copy Data activity, enable <strong>Schema Drift</strong>.</li>
<li>This allows the activity to <strong>dynamically handle different schemas</strong> at runtime.</li>
</ul>
<h4 id="map-dynamically">Map Dynamically</h4>
<p><strong>Option 1: Auto-Mapping</strong></p>
<ul>
<li>Leave the <strong>Mapping</strong> tab blank.</li>
<li>ADF will automatically map columns from source to sink based on matching names.</li>
</ul>
<p><strong>Option 2: Explicit Dynamic Mapping</strong></p>
<ul>
<li>If column transformation or renaming is required, define <strong>dynamic mappings</strong> using expressions.</li>
<li>For simple copy scenarios, leaving the mapping blank is the most efficient approach.</li>
</ul>

  <footer class="footline">
  </footer>
</article>
          </section>
          </section>
        </div>
      </main>
    </div>
    <script src="/js/js-yaml/js-yaml.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-color.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-dispatch.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-drag.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-ease.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-interpolate.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-selection.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-timer.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-transition.min.js?1759986780" defer></script>
    <script src="/js/d3/d3-zoom.min.js?1759986780" defer></script>
    <script src="/js/mermaid/mermaid.min.js?1759986780" defer></script>
    <script>
      window.relearn.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/js/clipboard/clipboard.min.js?1759986780" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1759986780" defer></script>
    <script src="/js/theme.js?1759986780" defer></script>
  </body>
</html>
