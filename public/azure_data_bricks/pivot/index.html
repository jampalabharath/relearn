<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="The pivot operation in PySpark is used to transpose rows into columns based on a specified column’s unique values.
It’s particularly useful for creating wide-format data, where values in one column become new column headers, and corresponding values from another column fill those headers.
Key Concepts groupBy and pivot
The pivot method is typically used in combination with groupBy. You group by certain columns and pivot one column to create new columns. Aggregation Function">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Pivot :: Data Engineering Notes">
    <meta name="twitter:description" content="The pivot operation in PySpark is used to transpose rows into columns based on a specified column’s unique values.
It’s particularly useful for creating wide-format data, where values in one column become new column headers, and corresponding values from another column fill those headers.
Key Concepts groupBy and pivot
The pivot method is typically used in combination with groupBy. You group by certain columns and pivot one column to create new columns. Aggregation Function">
    <meta property="og:url" content="https://example.org/azure_data_bricks/pivot/">
    <meta property="og:site_name" content="Data Engineering Notes">
    <meta property="og:title" content="Pivot :: Data Engineering Notes">
    <meta property="og:description" content="The pivot operation in PySpark is used to transpose rows into columns based on a specified column’s unique values.
It’s particularly useful for creating wide-format data, where values in one column become new column headers, and corresponding values from another column fill those headers.
Key Concepts groupBy and pivot
The pivot method is typically used in combination with groupBy. You group by certain columns and pivot one column to create new columns. Aggregation Function">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Azure Data Bricks">
    <meta itemprop="name" content="Pivot :: Data Engineering Notes">
    <meta itemprop="description" content="The pivot operation in PySpark is used to transpose rows into columns based on a specified column’s unique values.
It’s particularly useful for creating wide-format data, where values in one column become new column headers, and corresponding values from another column fill those headers.
Key Concepts groupBy and pivot
The pivot method is typically used in combination with groupBy. You group by certain columns and pivot one column to create new columns. Aggregation Function">
    <meta itemprop="wordCount" content="870">
    <title>Pivot :: Data Engineering Notes</title>
    <link href="/images/favicon.ico?1757668587" rel="icon" type="image/x-icon" sizes="any">
    <link href="/css/auto-complete/auto-complete.min.css?1757668587" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1757668587" defer></script>
    <script src="/js/search-lunr.min.js?1757668587" defer></script>
    <script src="/js/search.min.js?1757668587" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1757668587";
    </script>
    <script src="/js/lunr/lunr.min.js?1757668587" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1757668587" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1757668587" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1757668587" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1757668587" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1757668587" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1757668587" rel="stylesheet">
    <link href="/css/theme.min.css?1757668587" rel="stylesheet">
    <link href="/css/format-html.min.css?1757668587" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/azure_data_bricks\/pivot\/';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/example.org';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto', 'zen-light', 'zen-dark' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script><style>
:root {
    --MENU-WIDTH-S: 14.375rem;
    --MENU-WIDTH-M: 14.375rem;
    --MENU-WIDTH-L: 18.75rem;
    --MAIN-WIDTH-MAX: 1000rem;
}
</style>
  </head>
  <body class="mobile-support html" data-url="/azure_data_bricks/pivot/">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#key-concepts">Key Concepts</a></li>
    <li><a href="#example-code-pivot-in-pyspark">Example Code: Pivot in PySpark</a>
      <ul>
        <li><a href="#sample-data">Sample Data</a></li>
        <li><a href="#code-implementation">Code Implementation</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#output">Output</a></li>
    <li><a href="#explanation-of-code">Explanation of Code</a></li>
    <li><a href="#notes">Notes</a></li>
    <li><a href="#unpivot-in-pyspark">Unpivot in PySpark</a>
      <ul>
        <li><a href="#key-concepts-1">Key Concepts</a></li>
        <li><a href="#1-purpose-of-unpivot">1. Purpose of Unpivot:</a></li>
        <li><a href="#2-syntax-overview">2. Syntax Overview:</a></li>
        <li><a href="#3-performance">3. Performance:</a></li>
        <li><a href="#example-unpivot-in-pyspark">Example: Unpivot in PySpark</a></li>
      </ul>
    </li>
    <li><a href="#explanation-of-code-1">Explanation of Code</a></li>
    <li><a href="#alternative-methods">Alternative Methods</a></li>
    <li><a href="#notes-1">Notes</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class="a11y-only"><a itemprop="item" href="/"><span itemprop="name">Data Engineering Notes</span></a><meta itemprop="position" content="1">&nbsp;/&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/azure_data_bricks/"><span itemprop="name">ADB</span></a><meta itemprop="position" content="2">&nbsp;/&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">Pivot</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-edit" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="https://github.com/jampalabharath/relearn/tree/main/content/Azure_Data_Bricks/Pivot.md" rel="external" target="_blank" title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/azure_data_bricks/explode/" title="Explode (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/azure_data_bricks/comparisons/" title="Comparisons (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable azure_data_bricks" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="pivot">Pivot</h1>

<p>The <strong>pivot</strong> operation in PySpark is used to <strong>transpose rows into columns</strong> based on a specified column&rsquo;s unique values.<br>
It&rsquo;s particularly useful for creating <strong>wide-format data</strong>, where values in one column become new column headers, and corresponding values from another column fill those headers.</p>
<hr>
<h2 id="key-concepts">Key Concepts</h2>
<ol>
<li>
<p><strong>groupBy and pivot</strong></p>
<ul>
<li>The <code>pivot</code> method is typically used in combination with <code>groupBy</code>.</li>
<li>You group by certain columns and pivot one column to create new columns.</li>
</ul>
</li>
<li>
<p><strong>Aggregation Function</strong></p>
<ul>
<li>You need to specify an aggregation function (like <code>sum</code>, <code>avg</code>, <code>count</code>, etc.) to fill the values in the pivoted columns.</li>
</ul>
</li>
<li>
<p><strong>Performance Consideration</strong></p>
<ul>
<li>Pivoting can be <strong>computationally expensive</strong>, especially with a high number of unique values in the pivot column.</li>
<li>For better performance, explicitly specify the values to pivot if possible.</li>
</ul>
</li>
<li>
<p><strong>Syntax</strong></p>
</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">dataframe</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;group_column&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&#34;pivot_column&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggregation_function</span><span class="p">)</span></span></span></code></pre></div>
<h2 id="example-code-pivot-in-pyspark">Example Code: Pivot in PySpark</h2>
<h3 id="sample-data">Sample Data</h3>
<p>Imagine we have a DataFrame of sales data with the following schema:</p>
<table>
  <thead>
      <tr>
          <th>Product</th>
          <th>Region</th>
          <th>Sales</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>North</td>
          <td>100</td>
      </tr>
      <tr>
          <td>B</td>
          <td>North</td>
          <td>150</td>
      </tr>
      <tr>
          <td>A</td>
          <td>South</td>
          <td>200</td>
      </tr>
      <tr>
          <td>B</td>
          <td>South</td>
          <td>300</td>
      </tr>
  </tbody>
</table>
<p>We want to pivot the data so that regions (North, South) become columns and the sales values are aggregated.</p>
<h3 id="code-implementation">Code Implementation</h3>
<h1 id="example-pivot-in-pyspark">Example: Pivot in PySpark</h1>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="nb">sum</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;PivotExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a sample DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;North&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;North&#34;</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;South&#34;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;South&#34;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="s2">&#34;Region&#34;</span><span class="p">,</span> <span class="s2">&#34;Sales&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pivot the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">pivoted_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the results</span>
</span></span><span class="line"><span class="cl"><span class="n">pivoted_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h2 id="output">Output</h2>
<table>
  <thead>
      <tr>
          <th>Product</th>
          <th>North</th>
          <th>South</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>100</td>
          <td>200</td>
      </tr>
      <tr>
          <td>B</td>
          <td>150</td>
          <td>300</td>
      </tr>
  </tbody>
</table>
<h2 id="explanation-of-code">Explanation of Code</h2>
<ol>
<li>
<p><strong>groupBy(&ldquo;Product&rdquo;)</strong></p>
<ul>
<li>Groups the data by the <code>Product</code> column.</li>
</ul>
</li>
<li>
<p><strong>pivot(&ldquo;Region&rdquo;)</strong></p>
<ul>
<li>Transforms unique values in the <code>Region</code> column (<code>North</code>, <code>South</code>) into new columns.</li>
</ul>
</li>
<li>
<p><strong>agg(sum(&ldquo;Sales&rdquo;))</strong></p>
<ul>
<li>Computes the sum of <code>Sales</code> for each combination of <code>Product</code> and the new columns created by the pivot.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="notes">Notes</h2>
<ul>
<li><strong>Explicit Pivot Values</strong>: To improve performance, you can specify the pivot values explicitly.</li>
</ul>
<p><code>df.groupBy(&quot;Product&quot;).pivot(&quot;Region&quot;, [&quot;North&quot;, &quot;South&quot;]).agg(sum(&quot;Sales&quot;))</code></p>
<ul>
<li><strong>Handling Null Values</strong>: If some combinations of <code>groupBy</code> and pivot values have no corresponding rows, the resulting cells will contain <code>null</code>.</li>
<li><strong>Alternative Aggregations</strong>: You can use other aggregation functions like <code>avg</code>, <code>max</code>, <code>min</code>, etc.</li>
</ul>
<hr>
<p>This approach is commonly used in creating <strong>summary reports</strong> or preparing data for <strong>machine learning models</strong> where wide-format data is required.</p>
<h2 id="unpivot-in-pyspark">Unpivot in PySpark</h2>
<p>The unpivot operation (also called melting) is used to transform a wide-format table into a long-format table. This means columns are turned into rows, effectively reversing the pivot operation. PySpark doesn&rsquo;t have a direct unpivot function like Pandas&rsquo; melt, but you can achieve it using the selectExpr method or a combination of stack and other DataFrame transformations.</p>
<h3 id="key-concepts-1">Key Concepts</h3>
<h3 id="1-purpose-of-unpivot">1. Purpose of Unpivot:</h3>
<ul>
<li>
<p>Simplifies data analysis by converting column headers into a single column (e.g., categorical variables).</p>
</li>
<li>
<p>Ideal for scenarios where you need to aggregate data further or visualize it in a long format.</p>
</li>
</ul>
<h3 id="2-syntax-overview">2. Syntax Overview:</h3>
<ul>
<li>
<p>Use the stack function inside a selectExpr to unpivot.</p>
</li>
<li>
<p>Stack reshapes the DataFrame by creating multiple rows for specified columns.</p>
</li>
</ul>
<h3 id="3-performance">3. Performance:</h3>
<ul>
<li>Unpivoting can generate many rows, especially if the original DataFrame is wide with numerous columns. Ensure your environment can handle the resulting data volume.</li>
</ul>
<h3 id="example-unpivot-in-pyspark">Example: Unpivot in PySpark</h3>
<p><strong>Sample Data</strong>
Suppose we have the following DataFrame:</p>
<table>
  <thead>
      <tr>
          <th>Product</th>
          <th>North</th>
          <th>South</th>
          <th>East</th>
          <th>West</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>A</td>
          <td>100</td>
          <td>200</td>
          <td>150</td>
          <td>130</td>
      </tr>
      <tr>
          <td>B</td>
          <td>150</td>
          <td>300</td>
          <td>200</td>
          <td>180</td>
      </tr>
  </tbody>
</table>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a Spark session</span>
</span></span><span class="line"><span class="cl"><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&#34;UnpivotExample&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Sample data</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="s2">&#34;North&#34;</span><span class="p">,</span> <span class="s2">&#34;South&#34;</span><span class="p">,</span> <span class="s2">&#34;East&#34;</span><span class="p">,</span> <span class="s2">&#34;West&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create the DataFrame</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Unpivot the DataFrame using stack</span>
</span></span><span class="line"><span class="cl"><span class="n">unpivoted_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">selectExpr</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Product&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;stack(4, &#39;North&#39;, North, &#39;South&#39;, South, &#39;East&#39;, East, &#39;West&#39;, West) as (Region, Sales)&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show the results</span>
</span></span><span class="line"><span class="cl"><span class="n">unpivoted_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h2 id="explanation-of-code-1">Explanation of Code</h2>
<ol>
<li>
<p><strong>Input DataFrame</strong>:</p>
<ul>
<li>Each column (North, South, East, West) represents a region&rsquo;s sales for each product.</li>
</ul>
</li>
<li>
<p><strong>selectExpr with stack</strong>:</p>
<ul>
<li>The stack function takes two arguments:
<ul>
<li>The number of columns being unpivoted (4 in this case).</li>
<li>A sequence of column-value pairs: &lsquo;ColumnName1&rsquo;, ColumnValue1, &lsquo;ColumnName2&rsquo;, ColumnValue2, &hellip;.</li>
</ul>
</li>
<li>The result is two new columns: the first contains the column names (now rows, Region), and the second contains the corresponding values (Sales).</li>
</ul>
</li>
<li>
<p><strong>Aliasing Columns</strong>:</p>
<ul>
<li>The stack result is aliased as (Region, Sales) to give meaningful names to the new columns.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="alternative-methods">Alternative Methods</h2>
<p><strong>Using withColumn and union</strong>:<br>
If stack isn&rsquo;t flexible enough, you can manually combine rows for each column:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a DataFrame with union operations for unpivoting</span>
</span></span><span class="line"><span class="cl"><span class="n">north</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&#34;North&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;North&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">south</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&#34;South&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;South&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">east</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&#34;East&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;East&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">west</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&#34;Product&#34;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&#34;West&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Region&#34;</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&#34;West&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&#34;Sales&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Combine all rows using union</span>
</span></span><span class="line"><span class="cl"><span class="n">unpivoted_df</span> <span class="o">=</span> <span class="n">north</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">south</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">east</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">west</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Show results</span>
</span></span><span class="line"><span class="cl"><span class="n">unpivoted_df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></div>
<h2 id="notes-1">Notes</h2>
<ol>
<li>
<p><strong>Performance Considerations</strong></p>
<ul>
<li><code>stack</code> is efficient for unpivoting a large number of columns.</li>
<li>The <code>union</code> method may become unwieldy for many columns, but it offers more control over the transformation process.</li>
</ul>
</li>
<li>
<p><strong>Dynamic Column Unpivoting</strong></p>
<ul>
<li>If the column names are not fixed (dynamic), you can:
<ul>
<li>Collect the column names dynamically using <code>df.columns</code>.</li>
<li>Construct the <code>selectExpr</code> or <code>union</code> queries programmatically.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Resulting Format</strong></p>
<ul>
<li>After unpivoting, the data will have more rows but fewer columns.</li>
<li>Ensure downstream processes are optimized to handle the increased row count.</li>
</ul>
</li>
</ol>
<hr>
<p>Unpivoting is a powerful operation for <strong>restructuring data</strong> and is frequently used in <strong>data preprocessing, reporting, and machine learning pipelines</strong>.</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<head>
  <style>
    #R-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-right: auto;
    }

    #R-logo img {
      width: 48px;
      height: 48px;
      object-fit: contain;
      cursor: pointer;
      transition: transform 0.2s ease-in-out;
    }

    #R-logo img:hover {
      transform: scale(1.05);
    }

    #R-logo .logo-title {
  margin-left: 0.5rem;   
  font-size: 1.2rem;     
  line-height: 1;        
  display: flex;
  align-items: center;   
}
  </style>
</head>



<a id="R-logo" class="R-default" href="/">
  <img src="/images/logo.png" alt="brand logo">
  <span class="logo-title">Relearn</span>
</a>
        </div>
        <search><form action="/search/" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/sql/"><input type="checkbox" id="R-section-6b91b02647756f9b5e29b003bccc4db0" aria-controls="R-subsections-6b91b02647756f9b5e29b003bccc4db0"><label for="R-section-6b91b02647756f9b5e29b003bccc4db0"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu SQL</span></label><a class="padding" href="/sql/">SQL<i class="fa-fw fas fa-check read-icon"></i></a><ul id="R-subsections-6b91b02647756f9b5e29b003bccc4db0" class="collapsible-menu">
            <li class="" data-nav-id="/sql/select/"><a class="padding" href="/sql/select/">SELECT Query<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/ddl/"><a class="padding" href="/sql/ddl/">DDL<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/dml/"><a class="padding" href="/sql/dml/">DML<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/filter/"><a class="padding" href="/sql/filter/">Filtering Data<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/joins/"><a class="padding" href="/sql/joins/">Joins<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/set-operations/"><a class="padding" href="/sql/set-operations/">Set Operations<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/string-functions/"><a class="padding" href="/sql/string-functions/">String Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/number-functions/"><a class="padding" href="/sql/number-functions/">Number Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/date-time1/"><a class="padding" href="/sql/date-time1/">Date &amp; Time Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/date-time2/"><a class="padding" href="/sql/date-time2/">Date &amp; Time Formats<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/null-functions/"><a class="padding" href="/sql/null-functions/">NULL Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/case-statement/"><a class="padding" href="/sql/case-statement/">CASE Statement<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/aggregate-functions/"><a class="padding" href="/sql/aggregate-functions/">Aggregate Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/window-functions/"><a class="padding" href="/sql/window-functions/">Window Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/sql/window_aggregations/"><a class="padding" href="/sql/window_aggregations/">Window Aggregate Functions<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li>
            <li class="" data-nav-id="/azure_data_factory/"><a class="padding" href="/azure_data_factory/">ADF<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="parent " data-nav-id="/azure_data_bricks/"><input type="checkbox" id="R-section-be307a2f2d32c2a195add2e28563a24e" aria-controls="R-subsections-be307a2f2d32c2a195add2e28563a24e" checked><label for="R-section-be307a2f2d32c2a195add2e28563a24e"><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu ADB</span></label><a class="padding" href="/azure_data_bricks/">ADB<i class="fa-fw fas fa-check read-icon"></i></a><ul id="R-subsections-be307a2f2d32c2a195add2e28563a24e" class="collapsible-menu">
            <li class="" data-nav-id="/azure_data_bricks/df-creation/"><a class="padding" href="/azure_data_bricks/df-creation/">DF Basics<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/df-operations/"><a class="padding" href="/azure_data_bricks/df-operations/">DF Operations<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/functions/"><a class="padding" href="/azure_data_bricks/functions/">Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/date/"><a class="padding" href="/azure_data_bricks/date/">Date Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/nulls/"><a class="padding" href="/azure_data_bricks/nulls/">Handling Nulls<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/aggregations/"><a class="padding" href="/azure_data_bricks/aggregations/">Aggregate functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/joins/"><a class="padding" href="/azure_data_bricks/joins/">Joins<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/when/"><a class="padding" href="/azure_data_bricks/when/">When|Cast|Union<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/window-functions/"><a class="padding" href="/azure_data_bricks/window-functions/">Window Functions<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/explode/"><a class="padding" href="/azure_data_bricks/explode/">Explode<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="active " data-nav-id="/azure_data_bricks/pivot/"><a class="padding" href="/azure_data_bricks/pivot/">Pivot<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/azure_data_bricks/comparisons/"><a class="padding" href="/azure_data_bricks/comparisons/">Comparisons<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
            <li class="R-variantswitcher">
              <div class="padding menu-control">
                <i class="fa-fw fas fa-paint-brush"></i>
                <span>&nbsp;</span>
                <div class="control-style">
                  <label class="a11y-only" for="R-select-variant">Theme</label>
                  <select id="R-select-variant">
                    <option id="R-select-variant-auto" value="auto" selected>Auto</option>
                    <option id="R-select-variant-zen-light" value="zen-light">Zen Light</option>
                    <option id="R-select-variant-zen-dark" value="zen-dark">Zen Dark</option>
                  </select>
                </div>
                <div class="clear"></div>
              </div>
              <script>window.relearn.markVariant();</script>
            </li>
            <li class="R-historyclearer">
              <div class="padding menu-control">
                <i class="fa-fw fas fa-history"></i>
                <span>&nbsp;</span>
                <div class="control-style">
                  <button>Clear History</button>
                </div>
                <div class="clear"></div>
              </div>
            </li>
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/js/clipboard/clipboard.min.js?1757668587" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1757668587" defer></script>
    <script src="/js/theme.min.js?1757668587" defer></script>
  </body>
</html>
